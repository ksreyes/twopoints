[
  {
    "path": "posts/2022-11-05-wdi/",
    "title": "Exercises in plotting WDI data",
    "description": "",
    "author": [],
    "date": "2022-11-05",
    "categories": [],
    "contents": "\r\nIn the old days I used to download WDI datasets in Excel format and point-and-click my way to a neat little chart. Now I want to try using the WDI package and some ggplot wizardry.\r\n\r\n\r\nlibrary(tidyverse)\r\nlibrary(ggplot2)\r\nlibrary(WDI)\r\n\r\n\r\nA simple line chart\r\nTo start, let’s try plotting the GDP per capita of the Philippines and Vietnam in constant 2015 US$.\r\n\r\n\r\ndf <- WDI(country = c(\"PH\",\"VN\"),\r\n          indicator = \"NY.GDP.PCAP.KD\",\r\n          start = 1990) %>% \r\n  as_tibble()\r\n\r\nggplot(df, aes(x = year, y = NY.GDP.PCAP.KD, color = country)) +\r\n  geom_line()\r\n\r\n\r\n\r\nGreat. Now let’s try to get a cleaner chart by removing everything we don’t need: the axis labels, the legend title, the vertical grid lines, the tick marks. Let’s also add a chart title.\r\n\r\n\r\nggplot(df, aes(x = year, y = NY.GDP.PCAP.KD, color = country)) +\r\n  geom_line() +\r\n  labs(title = \"GDP per capita in constant 2015 US$\") +\r\n  theme(axis.title = element_blank(),\r\n        axis.ticks = element_blank(),\r\n        legend.position = \"right\",\r\n        legend.title = element_blank(),\r\n        panel.grid.major.x = element_blank(),\r\n        panel.grid.minor.x = element_blank(),\r\n        panel.grid.minor.y = element_blank())\r\n\r\n\r\n\r\nIt’s a serviceable chart, but not a particularly attractive chart. Let’s spend some more time glamming it up. The numbers on the y-axis could use a thousands separator. The plot lines could be a little thicker. We can also make tweaks to the text sizes, the colors, the margins, and so forth.\r\n\r\n\r\nggplot(df, aes(x = year, y = NY.GDP.PCAP.KD, color = country)) +\r\n  geom_line(size = 1) +\r\n  labs(title = \"GDP per capita in constant 2015 US$\") +\r\n  scale_color_manual(values = c(\"#076fe4\", \"#f2500d\")) + \r\n  scale_y_continuous(label = function(x) prettyNum(x, big.mark = \",\", scientific = FALSE)) + \r\n  theme(aspect.ratio = .7,\r\n        axis.title = element_blank(),\r\n        axis.ticks = element_blank(),\r\n        axis.text.x = element_text(size = 10, margin = margin(5, 0, 0, 0)),\r\n        axis.text.y = element_text(size = 10, margin = margin(0, 5, 0, 0)),\r\n        plot.title = element_text(size = 12, hjust = .5, face = \"bold\", margin = margin(0, 0, 10, 0)),\r\n        legend.position = \"right\",\r\n        legend.title = element_blank(),\r\n        legend.text = element_text(size = 11),\r\n        panel.background = element_rect(fill = \"gray97\"),\r\n        panel.grid.major.x = element_blank(),\r\n        panel.grid.minor.x = element_blank(),\r\n        panel.grid.minor.y = element_blank())\r\n\r\n\r\n\r\nNow this to me is pleasing to the eye. A document populated with charts like this—as opposed to charts like the first two above—would be much more motivating to read.\r\nA labeled scatterplot\r\nI think one useful way to categorize countries is according to whether they are big and rich, big and poor, small and rich, or small and poor. We can visualize this in a scatterplot with population on one axis and GDP per capita on the other. Let’s load up the data and plot the scatter.\r\n\r\n\r\ndf <- WDI(country = \"all\",\r\n          indicator = c(\"gpc\" = \"NY.GDP.PCAP.KD\", \r\n                        \"pop\" = \"SP.POP.TOTL\"),\r\n          start = 2015,\r\n          end = 2015,\r\n          extra = TRUE) %>% \r\n  as_tibble() %>%\r\n  filter(region != \"Aggregates\") %>%\r\n  select(country, gpc, pop) %>%\r\n  drop_na()\r\n\r\nggplot(df, aes(x = pop, y = gpc)) +\r\n  geom_point()\r\n\r\n\r\n\r\nWhat an atrocious chart! To make it comprehensible, we’ll need to re-express the axes in log scale first.\r\n\r\n\r\nggplot(df, aes(x = log10(pop), y = log2(gpc))) +\r\n  geom_point() + \r\n  scale_x_continuous(name = \"Population\",\r\n                     breaks = c(log10(10^4), log10(10^5), log10(10^6), log10(10^7), log10(10^8), log10(10^9)),\r\n                     label = c(\"10,000\", \"100,000\", \"1 million\", \"10 million\", \"100 million\", \"1 billion\")) +\r\n  scale_y_continuous(name = \"GDP per capita constant 2015 US$\",\r\n                     breaks = c(log2(500), log2(1500), log2(10000), log2(30000)),\r\n                     label = function(x) prettyNum(2^x, big.mark = \",\", scientific = FALSE))\r\n\r\n\r\n\r\nBetter! Let’s make further tweaks to the colors and so on to make it more attractive. In addition, let’s include some dividing lines to group big, small, rich, and poor countries. Some sensible definitions would be that “big” countries are those with 100 million people and above while “rich” countries are those with GDP per capita of $30,000 and above.\r\n\r\n\r\nggplot(df, aes(x = log10(pop), y = log2(gpc))) +\r\n  geom_point(shape = 16, size = 3, color = \"#076fe4\") + \r\n  labs(title = \"Big and small, rich and poor\") +\r\n  geom_vline(xintercept = log10(10^8), size = .5, linetype = \"dashed\", color = \"gray50\") +\r\n  geom_hline(yintercept = log2(30000), size = .5, linetype = \"dashed\", color = \"gray50\") + \r\n  scale_x_continuous(name = \"Population\",\r\n                     breaks = c(log10(10^4), log10(10^5), log10(10^6), log10(10^7), log10(10^8), log10(10^9)),\r\n                     label = c(\"10,000\", \"100,000\", \"1 million\", \"10 million\", \"100 million\", \"1 billion\")) +\r\n  scale_y_continuous(name = \"GDP per capita constant 2015 US$\",\r\n                     breaks = c(log2(500), log2(1500), log2(10000), log2(30000)),\r\n                     label = function(x) prettyNum(2^x, big.mark = \",\", scientific = FALSE)) + \r\n  theme(axis.title = element_text(size = 11),\r\n        axis.title.x = element_text(margin = margin(10, 0, 0, 0)),\r\n        axis.title.y = element_text(margin = margin(0, 10, 0, 0)),\r\n        axis.text.x = element_text(size = 10, margin = margin(5, 0, 0, 0)),\r\n        axis.text.y = element_text(size = 10, margin = margin(0, 5, 0, 0)),\r\n        axis.ticks = element_blank(),\r\n        plot.title = element_text(size = 12, hjust = .5, face = \"bold\", margin = margin(0, 0, 10, 0)),\r\n        panel.background = element_rect(fill = \"gray97\"),\r\n        panel.grid = element_blank())\r\n\r\n\r\n\r\nAnd here’s the interesting result. Under this set of definitions, there are really only two big and rich countries: the United States and Japan. The biggest small and rich country is Germany, with a population of 82 million, while the richest small and poor country is Mexico, with a GDP per capita of $9,600. In short, no country in the near future is expected to join the big-and-rich club.1\r\nNow let’s make some finishing touches to the chart. First, let’s add the labels “big”, “small”, “rich”, and “poor” on either side of the dotted lines to make it clear what they are indicating. Second, let’s bold the axis labels “30,000” and “100 million” to highlight the chosen thresholds for bigness and richness. Third, let’s label the points for the U.S., Japan, Germany, and Mexico to facilitate the discussion accompanying the chart. We also highlight these four points by making all other points transparent.\r\n\r\n\r\nggplot(df, aes(x = log10(pop), y = log2(gpc))) +\r\n  geom_point(shape = 16, size = 3, color = \"#076fe4\", alpha = ifelse(df$country %in% c(\"United States\", \"Japan\", \"Germany\", \"Mexico\"), 1, .25)) +\r\n  labs(title = \"Big and small, rich and poor\") +\r\n  \r\n  # Dashed lines\r\n  geom_vline(xintercept = log10(10^8), size = .5, linetype = \"dashed\", color = \"gray50\") +\r\n  geom_hline(yintercept = log2(30000), size = .5, linetype = \"dashed\", color = \"gray50\") + \r\n  annotate(\"text\", x = log10(10^8) + .05, y = log2(200000), hjust = 0, label = \"big\", size = 3.5, color = \"gray50\") +\r\n  annotate(\"text\", x = log10(10^8) - .05, y = log2(200000), hjust = 1, label = \"small\", size = 3.5, color = \"gray50\") +\r\n  annotate(\"text\", x = log10(10.5^9), y = log2(30000) + .2, vjust = 0, label = \"rich\", size = 3.5, color = \"gray50\") +\r\n  annotate(\"text\", x = log10(10.5^9), y = log2(30000) - .15, vjust = 1, label = \"poor\", size = 3.5, color = \"gray50\") +\r\n  \r\n  # Highlighted points\r\n  annotate(\"text\", x = log10(df$pop[df$country == \"United States\"]), y = log2(df$gpc[df$country == \"United States\"]) + .4, hjust = 0, vjust = 0, label = \"United States\", size = 3.5, fontface = \"bold\") + \r\n  annotate(\"text\", x = log10(df$pop[df$country == \"Japan\"]) + .1, y = log2(df$gpc[df$country == \"Japan\"]), hjust = 0, vjust = 0, label = \"Japan\", size = 3.5, fontface = \"bold\") + \r\n  annotate(\"text\", x = log10(df$pop[df$country == \"Germany\"]), y = log2(df$gpc[df$country == \"Germany\"]) + .4, hjust = .5, vjust = 0, label = \"Germany\", size = 3.5, fontface = \"bold\") + \r\n  annotate(\"text\", x = log10(df$pop[df$country == \"Mexico\"]), y = log2(df$gpc[df$country == \"Mexico\"]) + .4, hjust = .5, vjust = 0, label = \"Mexico\", size = 3.5, fontface = \"bold\") + \r\n  \r\n  scale_x_continuous(name = \"Population\",\r\n                     breaks = c(log10(10^4), log10(10^5), log10(10^6), log10(10^7), log10(10^8), log10(10^9)),\r\n                     label = c(\"10,000\", \"100,000\", \"1 million\", \"10 million\", \"100 million\", \"1 billion\")) +\r\n  scale_y_continuous(name = \"GDP per capita constant 2015 US$\",\r\n                     breaks = c(log2(500), log2(1500), log2(10000), log2(30000)),\r\n                     label = function(x) prettyNum(2^x, big.mark = \",\", scientific = FALSE)) + \r\n  theme(axis.title = element_text(size = 11),\r\n        axis.title.x = element_text(margin = margin(10, 0, 0, 0)),\r\n        axis.title.y = element_text(margin = margin(0, 10, 0, 0)),\r\n        axis.text.x = element_text(size = 10, margin = margin(5, 0, 0, 0), face = c(\"plain\", \"plain\", \"plain\", \"plain\", \"bold\", \"plain\")),\r\n        axis.text.y = element_text(size = 10, margin = margin(0, 5, 0, 0), face = c(\"plain\", \"plain\", \"plain\", \"bold\")),\r\n        axis.ticks = element_blank(),\r\n        plot.title = element_text(size = 12, hjust = .5, face = \"bold\", margin = margin(0, 0, 10, 0)),\r\n        panel.background = element_rect(fill = \"gray97\"),\r\n        panel.grid = element_blank())\r\n\r\n\r\n\r\nAnd here’s the final chart!\r\n\r\nNot that this should be taken too seriously! Some would say 81 million people would make you a pretty big country. And there are PPP-flavored quibbles to be made about GDP per capita.↩︎\r\n",
    "preview": "posts/2022-11-05-wdi/wdi_files/figure-html5/unnamed-chunk-8-1.png",
    "last_modified": "2022-11-07T21:41:31+08:00",
    "input_file": {},
    "preview_width": 1248,
    "preview_height": 768
  }
]
