<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2025-04-17">

<title>The economics of tariffs – Two Points Make a Line</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../..//images/logo-icon.png" rel="icon" type="image/png">
<script src="../../site_libs/cookie-consent/cookie-consent.js"></script>
<link href="../../site_libs/cookie-consent/cookie-consent.css" rel="stylesheet">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-1b8bdd54251b1dae93b0b1789678b00e.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="../../site_libs/quarto-contrib/intersection-observer-polyfill-1.0.0/intersection-observer.js"></script>
<script src="../../site_libs/quarto-contrib/scrollama-3.2.0/scrollama.min.js"></script>
<script src="../../site_libs/quarto-contrib/closeread-0.1.0/closeread.js"></script>
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-EJMC44PZ56"></script>

<script type="text/plain" cookie-consent="tracking">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-EJMC44PZ56', { 'anonymize_ip': true});
</script>

<script type="text/javascript" charset="UTF-8">
document.addEventListener('DOMContentLoaded', function () {
cookieconsent.run({
  "notice_banner_type":"simple",
  "consent_type":"implied",
  "palette":"light",
  "language":"en",
  "page_load_consent_levels":["strictly-necessary","functionality","tracking","targeting"],
  "notice_banner_reject_button_hide":false,
  "preferences_center_close_button_hide":false,
  "website_name":""
  ,
"language":"en"
  });
});
</script> 
  
<script type="module" src="../../site_libs/quarto-ojs/quarto-ojs-runtime.js"></script>
<link href="../../site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">
<meta cr-debug-mode="false">
<meta cr-remove-header-space="false">


<link rel="stylesheet" href="../../site_libs/quarto-contrib/quarto-project/qmd-lab/closeread/closeread.css">
<meta property="og:title" content="The economics of tariffs – Two Points Make a Line">
<meta property="og:description" content="Thinking clearly about the costs and benefits of taxing imports. Plus an aside on that odd tiny cross by the Marienkirche entrance">
<meta property="og:image" content="https://twopoints.blog/posts/2025-04-16-econ-tariffs/thumbnail.gif">
<meta property="og:site_name" content="Two Points Make a Line">
<meta name="twitter:title" content="The economics of tariffs – Two Points Make a Line">
<meta name="twitter:description" content="Thinking clearly about the costs and benefits of taxing imports. Plus an aside on that odd tiny cross by the Marienkirche entrance">
<meta name="twitter:image" content="https://twopoints.blog/posts/2025-04-16-econ-tariffs/thumbnail.gif">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../images/logo-icon-invert.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Two Points Make a Line</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <span class="nav-link">
<span class="menu-text">Telling stories through visualized data — by Kenneth S. Reyes</span>
    </span>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/ksreyes/twopoints"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">
      <!-- user-provided yaml closeread style options -->
      <style>
        :root {
          --cr-narrative-background-color-overlay: #f7f7f7;
--cr-narrative-border-radius: 0;
--cr-narrative-font-size: 1em;
--cr-section-background-color: transparent;
--cr-narrative-text-color-overlay: black;
        }
      </style>
    

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">The economics of tariffs</h1>
<p class="subtitle lead">Thinking clearly about the costs and benefits of taxing imports. Plus an aside on that odd tiny cross by the Marienkirche entrance</p>
  <div class="quarto-categories">
    <div class="quarto-category">D3/OJS</div>
  </div>
  </div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">April 17, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p>Since my <a href="https://twopoints.blog/posts/2025-04-09-to-seek-anothers-profit/">last post</a>, the tariff policy of the United States has undergone a number of major shifts. <a href="https://www.tradecomplianceresourcehub.com/2025/04/14/trump-2-0-tariff-tracker/">As things stand</a>, the reciprocal tariffs announced on April 2 have been <a href="https://truthsocial.com/@realDonaldTrump/posts/114309144289505174">paused for 90 days</a>, leaving a blanket +10% rate on all countries except Canada and Mexico (who face +25%) and China (who faces +145%, but with the massive asterisk that consumer electronics are <a href="https://www.reuters.com/markets/us-excludes-smartphones-computers-reciprocal-tariffs-2025-04-12/">exempted</a>… <a href="https://www.reuters.com/markets/trump-plans-separate-levy-exempted-electronics-amid-trade-war-lutnick-says-2025-04-13/">for now</a>). In addition, steel, aluminum, and automobile imports had earlier been levied a +25% rate.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<p>Like any economic policy, tariffs have a set of costs and benefits that are challenging to disentangle. Tariffs are a tax on imports, so fundamentally money is being transferred from the private sector to the government. But who from the private sector is paying, the domestic consumer or the foreign firm? Taxing a product makes it more expensive, so we can also expect tariffs to dampen demand. To what extent do tariffs cause markets to shrink? What metric can we use to say whether benefits outweigh costs?</p>
<p>These are questions that a few nifty diagrams from intermediate economics can shed light on. In this post, I take you through a crash course on the geometry of partial equilibrium tax analysis. The goal is not to determine definitively whether tariffs are good or bad but to identify the assumptions that lead to either conclusion. Once the logic is clarified, it becomes an empirical matter to determine which assumptions actually hold in the real world.</p>
<div class="cr-section cr-column-screen overlay-center">
<div class="narrative-col">
<div class="progress-block">
<div class="trigger new-trigger" data-focus-on="cr-fig1">
<div class="narrative">
<p>Let’s start with the basics of supply and demand.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-fig1">
<div class="narrative">
<p>The <strong>import demand curve</strong> traces the total quantities domestic consumers as a whole are willing to buy at different price points. It is downward-sloping because the higher the price, the less consumers are willing to buy.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-fig1">
<div class="narrative">
<p>For example, suppose consumers are faced with a price of $17.10. Depending on preferences, the individual consumer may be willing to buy 1, 2, or any number of units. For the curve drawn, adding these individual demand together results in a total quantity demanded of 24 units.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-fig1">
<div class="narrative">
<p>Similarly, the <strong>export supply curve</strong> traces the quantity foreign firms as a whole are willing to sell at every possible price point. It is upward-sloping because the higher the price, the more firms are willing to sell.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-fig1">
<div class="narrative">
<p>The market <strong>clears</strong> when the price is such that the amount consumers are willing to buy is equal to the amount firms are willing to sell. In this example, the market-clearing price is $9.20.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-fig1">
<div class="narrative">
<p>Economists assume that markets generally tend towards this state of <strong>equilibrium</strong>. Any deviation results in a shortage or a glut, which in a free and competitive market will not be self-sustaining.</p>
</div>
</div>
</div>
</div>
<div class="sticky-col">
<div class="sticky-col-stack">
<div id="cr-fig1" class="sticky">
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb1" data-startfrom="54" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 53;"><span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> id <span class="op">=</span> d3<span class="op">.</span><span class="fu">randomInt</span>(<span class="dv">100000</span><span class="op">,</span> <span class="dv">1000000</span>)()<span class="op">;</span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> params <span class="op">=</span> { <span class="dt">q</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">p</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">es</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">ed</span><span class="op">:</span> <span class="kw">null</span> }<span class="op">;</span></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> axisTitles <span class="op">=</span> { <span class="dt">x</span><span class="op">:</span> <span class="st">"Output"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="st">"$/unit"</span> }<span class="op">;</span></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>  params<span class="op">.</span><span class="at">es</span> <span class="op">=</span> <span class="fl">1.5</span><span class="op">;</span></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>  params<span class="op">.</span><span class="at">ed</span> <span class="op">=</span> <span class="op">-</span><span class="fl">1.25</span><span class="op">;</span></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>  params<span class="op">.</span><span class="at">q</span> <span class="op">=</span> <span class="fu">qStar</span>(params)<span class="op">;</span></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>  params<span class="op">.</span><span class="at">p</span> <span class="op">=</span> <span class="fu">supplyFxn</span>(params)<span class="op">;</span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yScaler <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> max<span class="op">.</span><span class="at">p</span>])</span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([dim<span class="op">.</span><span class="at">height</span><span class="op">,</span> padding<span class="op">.</span><span class="at">top</span>])<span class="op">;</span></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Diagram</span></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> container <span class="op">=</span> d3<span class="op">.</span><span class="fu">create</span>(<span class="st">"div"</span>)</span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"diagram"</span>)<span class="op">;</span></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> container<span class="op">.</span><span class="fu">append</span>(<span class="st">"svg"</span>)</span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> <span class="st">"100%"</span>)</span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [</span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>      <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> </span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>      dim<span class="op">.</span><span class="at">width</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">right</span><span class="op">,</span> </span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>      dim<span class="op">.</span><span class="at">height</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">bottom</span></span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(drawBackground)<span class="op">;</span></span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> panel <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span> margin<span class="op">.</span><span class="at">left</span> <span class="sc">}</span><span class="vs">,</span><span class="sc">${</span> margin<span class="op">.</span><span class="at">top</span> <span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> demandGuideSample <span class="op">=</span> panel<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(yGuide<span class="op">,</span> md<span class="op">,</span> { <span class="dt">q</span><span class="op">:</span> <span class="dv">24</span><span class="op">,</span> <span class="dt">ed</span><span class="op">:</span> params<span class="op">.</span><span class="at">ed</span> }<span class="op">,</span> yScaler<span class="op">,</span> <span class="st">",.1f"</span>)</span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(xGuides<span class="op">,</span> md<span class="op">,</span> { <span class="dt">q</span><span class="op">:</span> <span class="dv">24</span><span class="op">,</span> <span class="dt">ed</span><span class="op">:</span> params<span class="op">.</span><span class="at">ed</span> }<span class="op">,</span> yScaler)<span class="op">;</span></span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> supplyCurve <span class="op">=</span> panel<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clip<span class="op">,</span> id)</span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurveFull<span class="op">,</span> id<span class="op">,</span> xs<span class="op">,</span> params<span class="op">,</span> yScaler)</span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(</span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a>      addLabel<span class="op">,</span> <span class="st">"Export supply"</span><span class="op">,</span> </span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a>      <span class="fu">xScaler</span>(<span class="dv">95</span>)<span class="op">,</span> </span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a>      <span class="fu">yScaler</span>(<span class="fu">supplyFxn</span>({ <span class="dt">q</span><span class="op">:</span> <span class="dv">95</span><span class="op">,</span> <span class="dt">es</span><span class="op">:</span> params<span class="op">.</span><span class="at">es</span> })) <span class="op">-</span> <span class="dv">15</span><span class="op">,</span></span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>      <span class="st">"middle"</span></span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> demandCurve <span class="op">=</span> panel<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clip<span class="op">,</span> id)</span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurveFull<span class="op">,</span> id<span class="op">,</span> md<span class="op">,</span> params<span class="op">,</span> yScaler)</span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(</span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a>      addLabel<span class="op">,</span> <span class="st">"Import demand"</span><span class="op">,</span> </span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a>      <span class="fu">xScaler</span>(<span class="dv">70</span>)<span class="op">,</span></span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a>      <span class="fu">yScaler</span>(<span class="fu">demandFxn</span>({ <span class="dt">q</span><span class="op">:</span> <span class="dv">50</span><span class="op">,</span> <span class="dt">ed</span><span class="op">:</span> params<span class="op">.</span><span class="at">ed</span> }))</span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> guidesEq <span class="op">=</span> panel<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(yGuide<span class="op">,</span> xs<span class="op">,</span> params<span class="op">,</span> yScaler<span class="op">,</span> <span class="st">",.1f"</span>)</span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(xGuides<span class="op">,</span> xs<span class="op">,</span> params<span class="op">,</span> yScaler)<span class="op">;</span></span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a>  panel<span class="op">.</span><span class="fu">call</span>(panelAxes<span class="op">,</span> axisTitles)<span class="op">;</span></span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Scroll animations</span></span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> pts <span class="op">=</span> [</span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">start</span><span class="op">:</span> <span class="op">.</span><span class="dv">145</span><span class="op">,</span> <span class="dt">end</span><span class="op">:</span> <span class="op">.</span><span class="dv">165</span> }<span class="op">,</span></span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">start</span><span class="op">:</span> <span class="op">.</span><span class="dv">340</span><span class="op">,</span> <span class="dt">end</span><span class="op">:</span> <span class="op">.</span><span class="dv">360</span> }<span class="op">,</span></span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">start</span><span class="op">:</span> <span class="op">.</span><span class="dv">460</span><span class="op">,</span> <span class="dt">end</span><span class="op">:</span> <span class="op">.</span><span class="dv">480</span> }<span class="op">,</span></span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">start</span><span class="op">:</span> <span class="op">.</span><span class="dv">525</span><span class="op">,</span> <span class="dt">end</span><span class="op">:</span> <span class="op">.</span><span class="dv">545</span> }<span class="op">,</span></span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">start</span><span class="op">:</span> <span class="op">.</span><span class="dv">695</span><span class="op">,</span> <span class="dt">end</span><span class="op">:</span> <span class="op">.</span><span class="dv">715</span> }<span class="op">,</span></span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a>  demandCurve</span>
<span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"opacity"</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (crProgressBlock <span class="op">&gt;=</span> <span class="op">.</span><span class="dv">145</span> <span class="op">&amp;&amp;</span> crProgressBlock <span class="op">&lt;</span> <span class="op">.</span><span class="dv">46</span>) {</span>
<span id="cb1-128"><a href="#cb1-128" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="fu">fadeIn</span>(pts[<span class="dv">0</span>])(crProgressBlock)<span class="op">;</span></span>
<span id="cb1-129"><a href="#cb1-129" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> <span class="cf">if</span> (crProgressBlock <span class="op">&gt;=</span> <span class="op">.</span><span class="dv">46</span> <span class="op">&amp;&amp;</span> crProgressBlock <span class="op">&lt;</span> <span class="op">.</span><span class="dv">695</span>) {</span>
<span id="cb1-130"><a href="#cb1-130" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="fu">fadeOut</span>(pts[<span class="dv">2</span>])(crProgressBlock)<span class="op">;</span></span>
<span id="cb1-131"><a href="#cb1-131" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> <span class="cf">if</span> (crProgressBlock <span class="op">&gt;=</span> <span class="op">.</span><span class="dv">695</span>) {</span>
<span id="cb1-132"><a href="#cb1-132" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="fu">fadeIn</span>(pts[<span class="dv">4</span>])(crProgressBlock)<span class="op">;</span></span>
<span id="cb1-133"><a href="#cb1-133" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb1-134"><a href="#cb1-134" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-135"><a href="#cb1-135" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb1-136"><a href="#cb1-136" aria-hidden="true" tabindex="-1"></a>     })<span class="op">;</span></span>
<span id="cb1-137"><a href="#cb1-137" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-138"><a href="#cb1-138" aria-hidden="true" tabindex="-1"></a>  demandGuideSample</span>
<span id="cb1-139"><a href="#cb1-139" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"opacity"</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb1-140"><a href="#cb1-140" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (crProgressBlock <span class="op">&gt;=</span> <span class="op">.</span><span class="dv">34</span> <span class="op">&amp;&amp;</span> crProgressBlock <span class="op">&lt;</span> <span class="op">.</span><span class="dv">46</span>) {</span>
<span id="cb1-141"><a href="#cb1-141" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="fu">fadeIn</span>(pts[<span class="dv">1</span>])(crProgressBlock)<span class="op">;</span></span>
<span id="cb1-142"><a href="#cb1-142" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> <span class="cf">if</span> (crProgressBlock <span class="op">&gt;=</span> <span class="op">.</span><span class="dv">46</span>) {</span>
<span id="cb1-143"><a href="#cb1-143" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="fu">fadeOut</span>(pts[<span class="dv">2</span>])(crProgressBlock)<span class="op">;</span></span>
<span id="cb1-144"><a href="#cb1-144" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb1-145"><a href="#cb1-145" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-146"><a href="#cb1-146" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb1-147"><a href="#cb1-147" aria-hidden="true" tabindex="-1"></a>     })<span class="op">;</span></span>
<span id="cb1-148"><a href="#cb1-148" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-149"><a href="#cb1-149" aria-hidden="true" tabindex="-1"></a>  supplyCurve</span>
<span id="cb1-150"><a href="#cb1-150" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"opacity"</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb1-151"><a href="#cb1-151" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (crProgressBlock <span class="op">&gt;=</span> <span class="op">.</span><span class="dv">525</span>) {</span>
<span id="cb1-152"><a href="#cb1-152" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="fu">fadeIn</span>(pts[<span class="dv">3</span>])(crProgressBlock)<span class="op">;</span></span>
<span id="cb1-153"><a href="#cb1-153" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb1-154"><a href="#cb1-154" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-155"><a href="#cb1-155" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb1-156"><a href="#cb1-156" aria-hidden="true" tabindex="-1"></a>     })<span class="op">;</span></span>
<span id="cb1-157"><a href="#cb1-157" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-158"><a href="#cb1-158" aria-hidden="true" tabindex="-1"></a>  guidesEq</span>
<span id="cb1-159"><a href="#cb1-159" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"opacity"</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb1-160"><a href="#cb1-160" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (crProgressBlock <span class="op">&gt;=</span> <span class="op">.</span><span class="dv">695</span>) {</span>
<span id="cb1-161"><a href="#cb1-161" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="fu">fadeIn</span>(pts[<span class="dv">4</span>])(crProgressBlock)<span class="op">;</span></span>
<span id="cb1-162"><a href="#cb1-162" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb1-163"><a href="#cb1-163" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-164"><a href="#cb1-164" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb1-165"><a href="#cb1-165" aria-hidden="true" tabindex="-1"></a>     })<span class="op">;</span></span>
<span id="cb1-166"><a href="#cb1-166" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb1-167"><a href="#cb1-167" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> container<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb1-168"><a href="#cb1-168" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-1" data-nodetype="expression">

</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="cr-section cr-column-screen overlay-center">
<div class="narrative-col">
<div class="progress-block">
<div class="trigger new-trigger" data-focus-on="cr-fig2">
<div class="narrative">
<p>Now let’s add an <strong>80% tax on imports</strong>.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-fig2">
<div class="narrative">
<p>The tariff is represented by a second supply curve whose price points are 80% higher at all quantity levels.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-fig2">
<div class="narrative">
<p>The supply-and-demand diagram looks like this. Using the logic from earlier, the market clears at a price of <strong>$12.20</strong>.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-fig2">
<div class="narrative">
<p>But note that from the firms’ perspective, $12.20 isn’t the unit price they receive since they have to pay the tariff. Using their original supply curve, the price they actually receive is $6.80. <span class="highlight">There is then a <strong>wedge</strong> between what consumers pay and what firms receive.</span></p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-fig2">
<div class="narrative">
<p>This wedge is the government’s tax revenue. It is equal to the area of the red box, which in this example is ($12.20 – $6.80) x 33 = $178.20.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-fig2">
<div class="narrative">
<p>Here now are two scenarios: one without tariffs where the market clears at $9.20 and another with an 80% tariff where the market clears at $12.20.</p>
</div>
</div>
</div>
</div>
<div class="sticky-col">
<div class="sticky-col-stack">
<div id="cr-fig2" class="sticky">
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb2" data-startfrom="193" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 192;"><span id="cb2-193"><a href="#cb2-193" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb2-194"><a href="#cb2-194" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> id <span class="op">=</span> d3<span class="op">.</span><span class="fu">randomInt</span>(<span class="dv">100000</span><span class="op">,</span> <span class="dv">1000000</span>)()<span class="op">;</span></span>
<span id="cb2-195"><a href="#cb2-195" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> params <span class="op">=</span> { <span class="dt">q</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">p</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">es</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">ed</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">t</span><span class="op">:</span> <span class="kw">null</span> }<span class="op">;</span></span>
<span id="cb2-196"><a href="#cb2-196" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> axisTitles <span class="op">=</span> { <span class="dt">x</span><span class="op">:</span> <span class="st">"Output"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="st">"$/unit"</span> }<span class="op">;</span></span>
<span id="cb2-197"><a href="#cb2-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-198"><a href="#cb2-198" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> pts <span class="op">=</span> [</span>
<span id="cb2-199"><a href="#cb2-199" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">start</span><span class="op">:</span> <span class="op">.</span><span class="dv">140</span><span class="op">,</span> <span class="dt">end</span><span class="op">:</span> <span class="op">.</span><span class="dv">160</span> }<span class="op">,</span></span>
<span id="cb2-200"><a href="#cb2-200" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">start</span><span class="op">:</span> <span class="op">.</span><span class="dv">320</span><span class="op">,</span> <span class="dt">end</span><span class="op">:</span> <span class="op">.</span><span class="dv">340</span> }<span class="op">,</span></span>
<span id="cb2-201"><a href="#cb2-201" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">start</span><span class="op">:</span> <span class="op">.</span><span class="dv">500</span><span class="op">,</span> <span class="dt">end</span><span class="op">:</span> <span class="op">.</span><span class="dv">520</span> }<span class="op">,</span></span>
<span id="cb2-202"><a href="#cb2-202" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">start</span><span class="op">:</span> <span class="op">.</span><span class="dv">700</span><span class="op">,</span> <span class="dt">end</span><span class="op">:</span> <span class="op">.</span><span class="dv">720</span> }<span class="op">,</span></span>
<span id="cb2-203"><a href="#cb2-203" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">start</span><span class="op">:</span> <span class="op">.</span><span class="dv">870</span><span class="op">,</span> <span class="dt">end</span><span class="op">:</span> <span class="op">.</span><span class="dv">890</span> }<span class="op">,</span></span>
<span id="cb2-204"><a href="#cb2-204" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb2-205"><a href="#cb2-205" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-206"><a href="#cb2-206" aria-hidden="true" tabindex="-1"></a>  params<span class="op">.</span><span class="at">es</span> <span class="op">=</span> <span class="fl">1.5</span><span class="op">;</span></span>
<span id="cb2-207"><a href="#cb2-207" aria-hidden="true" tabindex="-1"></a>  params<span class="op">.</span><span class="at">ed</span> <span class="op">=</span> <span class="op">-</span><span class="fl">1.25</span><span class="op">;</span></span>
<span id="cb2-208"><a href="#cb2-208" aria-hidden="true" tabindex="-1"></a>  params<span class="op">.</span><span class="at">t</span> <span class="op">=</span> <span class="op">.</span><span class="dv">8</span> <span class="op">*</span> <span class="fu">fadeIn</span>(pts[<span class="dv">0</span>])(crProgressBlock)<span class="op">;</span></span>
<span id="cb2-209"><a href="#cb2-209" aria-hidden="true" tabindex="-1"></a>  params<span class="op">.</span><span class="at">q</span> <span class="op">=</span> <span class="fu">qStar</span>(params)<span class="op">;</span></span>
<span id="cb2-210"><a href="#cb2-210" aria-hidden="true" tabindex="-1"></a>  params<span class="op">.</span><span class="at">p</span> <span class="op">=</span> <span class="fu">supplyFxn</span>(params)<span class="op">;</span></span>
<span id="cb2-211"><a href="#cb2-211" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-212"><a href="#cb2-212" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yScaler <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb2-213"><a href="#cb2-213" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> max<span class="op">.</span><span class="at">p</span>])</span>
<span id="cb2-214"><a href="#cb2-214" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([dim<span class="op">.</span><span class="at">height</span><span class="op">,</span> padding<span class="op">.</span><span class="at">top</span>])<span class="op">;</span></span>
<span id="cb2-215"><a href="#cb2-215" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-216"><a href="#cb2-216" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Diagram</span></span>
<span id="cb2-217"><a href="#cb2-217" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-218"><a href="#cb2-218" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> container <span class="op">=</span> d3<span class="op">.</span><span class="fu">create</span>(<span class="st">"div"</span>)</span>
<span id="cb2-219"><a href="#cb2-219" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"diagram"</span>)<span class="op">;</span></span>
<span id="cb2-220"><a href="#cb2-220" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-221"><a href="#cb2-221" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> container<span class="op">.</span><span class="fu">append</span>(<span class="st">"svg"</span>)</span>
<span id="cb2-222"><a href="#cb2-222" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> <span class="st">"100%"</span>)</span>
<span id="cb2-223"><a href="#cb2-223" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [</span>
<span id="cb2-224"><a href="#cb2-224" aria-hidden="true" tabindex="-1"></a>      <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> </span>
<span id="cb2-225"><a href="#cb2-225" aria-hidden="true" tabindex="-1"></a>      dim<span class="op">.</span><span class="at">width</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">right</span><span class="op">,</span> </span>
<span id="cb2-226"><a href="#cb2-226" aria-hidden="true" tabindex="-1"></a>      dim<span class="op">.</span><span class="at">height</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">bottom</span></span>
<span id="cb2-227"><a href="#cb2-227" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb2-228"><a href="#cb2-228" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(drawBackground)<span class="op">;</span></span>
<span id="cb2-229"><a href="#cb2-229" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-230"><a href="#cb2-230" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> panel <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb2-231"><a href="#cb2-231" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span> margin<span class="op">.</span><span class="at">left</span> <span class="sc">}</span><span class="vs">,</span><span class="sc">${</span> margin<span class="op">.</span><span class="at">top</span> <span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb2-232"><a href="#cb2-232" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-233"><a href="#cb2-233" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> revenue <span class="op">=</span> panel<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb2-234"><a href="#cb2-234" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addAreaBox<span class="op">,</span> </span>
<span id="cb2-235"><a href="#cb2-235" aria-hidden="true" tabindex="-1"></a>      id<span class="op">,</span> </span>
<span id="cb2-236"><a href="#cb2-236" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">id</span><span class="op">:</span> <span class="st">"revenue"</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Government revenues"</span> }<span class="op">,</span> </span>
<span id="cb2-237"><a href="#cb2-237" aria-hidden="true" tabindex="-1"></a>      { </span>
<span id="cb2-238"><a href="#cb2-238" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x1</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> </span>
<span id="cb2-239"><a href="#cb2-239" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y1</span><span class="op">:</span> <span class="fu">yScaler</span>(<span class="fu">supplyFxn</span>({ <span class="dt">q</span><span class="op">:</span> <span class="dv">33</span><span class="op">,</span> <span class="dt">es</span><span class="op">:</span> params<span class="op">.</span><span class="at">es</span> }))<span class="op">,</span> </span>
<span id="cb2-240"><a href="#cb2-240" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x2</span><span class="op">:</span> <span class="fu">xScaler</span>(<span class="dv">33</span>)<span class="op">,</span> </span>
<span id="cb2-241"><a href="#cb2-241" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y2</span><span class="op">:</span> <span class="fu">yScaler</span>(<span class="fu">supplyTaxedFxn</span>({ <span class="dt">q</span><span class="op">:</span> <span class="dv">33</span><span class="op">,</span> <span class="dt">es</span><span class="op">:</span> params<span class="op">.</span><span class="at">es</span><span class="op">,</span> <span class="dt">t</span><span class="op">:</span> params<span class="op">.</span><span class="at">t</span> })) </span>
<span id="cb2-242"><a href="#cb2-242" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb2-243"><a href="#cb2-243" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-244"><a href="#cb2-244" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-245"><a href="#cb2-245" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> supplyTaxedCurve <span class="op">=</span> panel<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb2-246"><a href="#cb2-246" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clip<span class="op">,</span> id)</span>
<span id="cb2-247"><a href="#cb2-247" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurveFull<span class="op">,</span> id<span class="op">,</span> xst<span class="op">,</span> params<span class="op">,</span> yScaler)</span>
<span id="cb2-248"><a href="#cb2-248" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(</span>
<span id="cb2-249"><a href="#cb2-249" aria-hidden="true" tabindex="-1"></a>      addLabel<span class="op">,</span> <span class="st">"Supply with tariff"</span><span class="op">,</span> </span>
<span id="cb2-250"><a href="#cb2-250" aria-hidden="true" tabindex="-1"></a>      <span class="fu">xScaler</span>(<span class="dv">70</span>) <span class="op">-</span> <span class="dv">15</span><span class="op">,</span> </span>
<span id="cb2-251"><a href="#cb2-251" aria-hidden="true" tabindex="-1"></a>      <span class="fu">yScaler</span>(<span class="fu">supplyTaxedFxn</span>({ <span class="dt">q</span><span class="op">:</span> <span class="dv">70</span><span class="op">,</span> <span class="dt">es</span><span class="op">:</span> params<span class="op">.</span><span class="at">es</span><span class="op">,</span> <span class="dt">t</span><span class="op">:</span> params<span class="op">.</span><span class="at">t</span> }))<span class="op">,</span></span>
<span id="cb2-252"><a href="#cb2-252" aria-hidden="true" tabindex="-1"></a>      <span class="st">"end"</span></span>
<span id="cb2-253"><a href="#cb2-253" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb2-254"><a href="#cb2-254" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-255"><a href="#cb2-255" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> supplyCurve <span class="op">=</span> panel<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb2-256"><a href="#cb2-256" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clip<span class="op">,</span> id)</span>
<span id="cb2-257"><a href="#cb2-257" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurveFull<span class="op">,</span> id<span class="op">,</span> xs<span class="op">,</span> params<span class="op">,</span> yScaler)</span>
<span id="cb2-258"><a href="#cb2-258" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(</span>
<span id="cb2-259"><a href="#cb2-259" aria-hidden="true" tabindex="-1"></a>      addLabel<span class="op">,</span> <span class="st">"Export supply"</span><span class="op">,</span> </span>
<span id="cb2-260"><a href="#cb2-260" aria-hidden="true" tabindex="-1"></a>      <span class="fu">xScaler</span>(<span class="dv">70</span>) <span class="op">+</span> <span class="dv">15</span><span class="op">,</span> </span>
<span id="cb2-261"><a href="#cb2-261" aria-hidden="true" tabindex="-1"></a>      <span class="fu">yScaler</span>(<span class="fu">supplyFxn</span>({ <span class="dt">q</span><span class="op">:</span> <span class="dv">70</span><span class="op">,</span> <span class="dt">es</span><span class="op">:</span> params<span class="op">.</span><span class="at">es</span> })) <span class="op">+</span> <span class="dv">10</span><span class="op">,</span></span>
<span id="cb2-262"><a href="#cb2-262" aria-hidden="true" tabindex="-1"></a>      <span class="st">"start"</span></span>
<span id="cb2-263"><a href="#cb2-263" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb2-264"><a href="#cb2-264" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-265"><a href="#cb2-265" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> demandCurve <span class="op">=</span> panel<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb2-266"><a href="#cb2-266" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clip<span class="op">,</span> id)</span>
<span id="cb2-267"><a href="#cb2-267" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurveFull<span class="op">,</span> id<span class="op">,</span> md<span class="op">,</span> params<span class="op">,</span> yScaler)</span>
<span id="cb2-268"><a href="#cb2-268" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(</span>
<span id="cb2-269"><a href="#cb2-269" aria-hidden="true" tabindex="-1"></a>      addLabel<span class="op">,</span> <span class="st">"Import demand"</span><span class="op">,</span> </span>
<span id="cb2-270"><a href="#cb2-270" aria-hidden="true" tabindex="-1"></a>      <span class="fu">xScaler</span>(<span class="dv">70</span>)<span class="op">,</span></span>
<span id="cb2-271"><a href="#cb2-271" aria-hidden="true" tabindex="-1"></a>      <span class="fu">yScaler</span>(<span class="fu">demandFxn</span>({ <span class="dt">q</span><span class="op">:</span> <span class="dv">50</span><span class="op">,</span> <span class="dt">ed</span><span class="op">:</span> params<span class="op">.</span><span class="at">ed</span> }))</span>
<span id="cb2-272"><a href="#cb2-272" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb2-273"><a href="#cb2-273" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-274"><a href="#cb2-274" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> supplyGuide <span class="op">=</span> panel<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb2-275"><a href="#cb2-275" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(yGuide<span class="op">,</span> xs<span class="op">,</span> { <span class="dt">q</span><span class="op">:</span> <span class="dv">33</span><span class="op">,</span> <span class="dt">es</span><span class="op">:</span> params<span class="op">.</span><span class="at">es</span> }<span class="op">,</span> yScaler<span class="op">,</span> <span class="st">",.1f"</span>)<span class="op">;</span></span>
<span id="cb2-276"><a href="#cb2-276" aria-hidden="true" tabindex="-1"></a>  supplyGuide<span class="op">.</span><span class="fu">select</span>(<span class="st">"text"</span>)</span>
<span id="cb2-277"><a href="#cb2-277" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"#b3b3b3"</span>)<span class="op">;</span></span>
<span id="cb2-278"><a href="#cb2-278" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-279"><a href="#cb2-279" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> demandGuidesTaxed <span class="op">=</span> panel<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb2-280"><a href="#cb2-280" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(yGuide<span class="op">,</span> xst<span class="op">,</span> { <span class="dt">q</span><span class="op">:</span> <span class="dv">33</span><span class="op">,</span> <span class="dt">es</span><span class="op">:</span> params<span class="op">.</span><span class="at">es</span><span class="op">,</span> <span class="dt">t</span><span class="op">:</span> params<span class="op">.</span><span class="at">t</span> }<span class="op">,</span> yScaler<span class="op">,</span> <span class="st">",.1f"</span>)</span>
<span id="cb2-281"><a href="#cb2-281" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(xGuides<span class="op">,</span> xst<span class="op">,</span> { <span class="dt">q</span><span class="op">:</span> <span class="dv">33</span><span class="op">,</span> <span class="dt">es</span><span class="op">:</span> params<span class="op">.</span><span class="at">es</span><span class="op">,</span> <span class="dt">t</span><span class="op">:</span> params<span class="op">.</span><span class="at">t</span> }<span class="op">,</span> yScaler)<span class="op">;</span></span>
<span id="cb2-282"><a href="#cb2-282" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-283"><a href="#cb2-283" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> guidesEq <span class="op">=</span> panel<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb2-284"><a href="#cb2-284" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(yGuide<span class="op">,</span> xs<span class="op">,</span> params<span class="op">,</span> yScaler<span class="op">,</span> <span class="st">",.1f"</span>)</span>
<span id="cb2-285"><a href="#cb2-285" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(xGuides<span class="op">,</span> xs<span class="op">,</span> params<span class="op">,</span> yScaler)<span class="op">;</span></span>
<span id="cb2-286"><a href="#cb2-286" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-287"><a href="#cb2-287" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> points <span class="op">=</span> panel<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">;</span></span>
<span id="cb2-288"><a href="#cb2-288" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-289"><a href="#cb2-289" aria-hidden="true" tabindex="-1"></a>  points<span class="op">.</span><span class="fu">append</span>(<span class="st">"circle"</span>)</span>
<span id="cb2-290"><a href="#cb2-290" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"guide-point primary"</span>)</span>
<span id="cb2-291"><a href="#cb2-291" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cx"</span><span class="op">,</span> <span class="fu">xScaler</span>(<span class="dv">46</span>))</span>
<span id="cb2-292"><a href="#cb2-292" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cy"</span><span class="op">,</span> <span class="fu">yScaler</span>(<span class="fu">demandFxn</span>({ <span class="dt">q</span><span class="op">:</span> <span class="dv">46</span><span class="op">,</span> <span class="dt">ed</span><span class="op">:</span> params<span class="op">.</span><span class="at">ed</span> })))</span>
<span id="cb2-293"><a href="#cb2-293" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> <span class="dv">5</span>)<span class="op">;</span></span>
<span id="cb2-294"><a href="#cb2-294" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-295"><a href="#cb2-295" aria-hidden="true" tabindex="-1"></a>  points<span class="op">.</span><span class="fu">append</span>(<span class="st">"circle"</span>)</span>
<span id="cb2-296"><a href="#cb2-296" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"guide-point secondary"</span>)</span>
<span id="cb2-297"><a href="#cb2-297" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cx"</span><span class="op">,</span> <span class="fu">xScaler</span>(<span class="dv">33</span>))</span>
<span id="cb2-298"><a href="#cb2-298" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cy"</span><span class="op">,</span> <span class="fu">yScaler</span>(<span class="fu">supplyTaxedFxn</span>({ <span class="dt">q</span><span class="op">:</span> <span class="dv">33</span><span class="op">,</span> <span class="dt">es</span><span class="op">:</span> params<span class="op">.</span><span class="at">es</span><span class="op">,</span> <span class="dt">t</span><span class="op">:</span> params<span class="op">.</span><span class="at">t</span> })))</span>
<span id="cb2-299"><a href="#cb2-299" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> <span class="dv">5</span>)<span class="op">;</span></span>
<span id="cb2-300"><a href="#cb2-300" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-301"><a href="#cb2-301" aria-hidden="true" tabindex="-1"></a>  panel<span class="op">.</span><span class="fu">call</span>(panelAxes<span class="op">,</span> axisTitles)<span class="op">;</span></span>
<span id="cb2-302"><a href="#cb2-302" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-303"><a href="#cb2-303" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Scroll animations</span></span>
<span id="cb2-304"><a href="#cb2-304" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-305"><a href="#cb2-305" aria-hidden="true" tabindex="-1"></a>  supplyTaxedCurve<span class="op">.</span><span class="fu">select</span>(<span class="st">"text"</span>)<span class="op">.</span><span class="fu">style</span>(<span class="st">"opacity"</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb2-306"><a href="#cb2-306" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="fu">fadeIn</span>(pts[<span class="dv">0</span>])(crProgressBlock)<span class="op">;</span></span>
<span id="cb2-307"><a href="#cb2-307" aria-hidden="true" tabindex="-1"></a>   })<span class="op">;</span></span>
<span id="cb2-308"><a href="#cb2-308" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb2-309"><a href="#cb2-309" aria-hidden="true" tabindex="-1"></a>  demandCurve</span>
<span id="cb2-310"><a href="#cb2-310" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"opacity"</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb2-311"><a href="#cb2-311" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (crProgressBlock <span class="op">&gt;=</span> pts[<span class="dv">1</span>]<span class="op">.</span><span class="at">start</span> <span class="op">&amp;&amp;</span> crProgressBlock <span class="op">&lt;</span> pts[<span class="dv">2</span>]<span class="op">.</span><span class="at">start</span>) {</span>
<span id="cb2-312"><a href="#cb2-312" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="fu">fadeIn</span>(pts[<span class="dv">1</span>])(crProgressBlock)<span class="op">;</span></span>
<span id="cb2-313"><a href="#cb2-313" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> <span class="cf">if</span> (crProgressBlock <span class="op">&gt;=</span> pts[<span class="dv">2</span>]<span class="op">.</span><span class="at">start</span> <span class="op">&amp;&amp;</span> crProgressBlock <span class="op">&lt;</span> pts[<span class="dv">3</span>]<span class="op">.</span><span class="at">start</span>) {</span>
<span id="cb2-314"><a href="#cb2-314" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="fu">fadeOut</span>(pts[<span class="dv">2</span>])(crProgressBlock)<span class="op">;</span></span>
<span id="cb2-315"><a href="#cb2-315" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> <span class="cf">if</span> (crProgressBlock <span class="op">&gt;=</span> pts[<span class="dv">4</span>]<span class="op">.</span><span class="at">start</span>) {</span>
<span id="cb2-316"><a href="#cb2-316" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="fu">fadeIn</span>(pts[<span class="dv">4</span>])(crProgressBlock)<span class="op">;</span></span>
<span id="cb2-317"><a href="#cb2-317" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb2-318"><a href="#cb2-318" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb2-319"><a href="#cb2-319" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb2-320"><a href="#cb2-320" aria-hidden="true" tabindex="-1"></a>     })<span class="op">;</span></span>
<span id="cb2-321"><a href="#cb2-321" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb2-322"><a href="#cb2-322" aria-hidden="true" tabindex="-1"></a>  demandGuidesTaxed<span class="op">.</span><span class="fu">style</span>(<span class="st">"opacity"</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb2-323"><a href="#cb2-323" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="fu">fadeIn</span>(pts[<span class="dv">1</span>])(crProgressBlock)<span class="op">;</span></span>
<span id="cb2-324"><a href="#cb2-324" aria-hidden="true" tabindex="-1"></a>   })<span class="op">;</span></span>
<span id="cb2-325"><a href="#cb2-325" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-326"><a href="#cb2-326" aria-hidden="true" tabindex="-1"></a>  supplyCurve</span>
<span id="cb2-327"><a href="#cb2-327" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"opacity"</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb2-328"><a href="#cb2-328" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (crProgressBlock <span class="op">&gt;=</span> pts[<span class="dv">1</span>]<span class="op">.</span><span class="at">start</span> <span class="op">&amp;&amp;</span> crProgressBlock <span class="op">&lt;</span> pts[<span class="dv">2</span>]<span class="op">.</span><span class="at">start</span>) {</span>
<span id="cb2-329"><a href="#cb2-329" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="fu">fadeOut</span>(pts[<span class="dv">1</span>])(crProgressBlock)<span class="op">;</span></span>
<span id="cb2-330"><a href="#cb2-330" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> <span class="cf">if</span> (crProgressBlock <span class="op">&gt;=</span> pts[<span class="dv">2</span>]<span class="op">.</span><span class="at">start</span>) {</span>
<span id="cb2-331"><a href="#cb2-331" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="fu">fadeIn</span>(pts[<span class="dv">2</span>])(crProgressBlock)<span class="op">;</span></span>
<span id="cb2-332"><a href="#cb2-332" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb2-333"><a href="#cb2-333" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb2-334"><a href="#cb2-334" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb2-335"><a href="#cb2-335" aria-hidden="true" tabindex="-1"></a>     })<span class="op">;</span></span>
<span id="cb2-336"><a href="#cb2-336" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb2-337"><a href="#cb2-337" aria-hidden="true" tabindex="-1"></a>  supplyGuide<span class="op">.</span><span class="fu">style</span>(<span class="st">"opacity"</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb2-338"><a href="#cb2-338" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="fu">fadeIn</span>(pts[<span class="dv">2</span>])(crProgressBlock)<span class="op">;</span></span>
<span id="cb2-339"><a href="#cb2-339" aria-hidden="true" tabindex="-1"></a>   })<span class="op">;</span></span>
<span id="cb2-340"><a href="#cb2-340" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb2-341"><a href="#cb2-341" aria-hidden="true" tabindex="-1"></a>  guidesEq<span class="op">.</span><span class="fu">style</span>(<span class="st">"opacity"</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb2-342"><a href="#cb2-342" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="fu">fadeIn</span>(pts[<span class="dv">4</span>])(crProgressBlock)<span class="op">;</span></span>
<span id="cb2-343"><a href="#cb2-343" aria-hidden="true" tabindex="-1"></a>   })<span class="op">;</span></span>
<span id="cb2-344"><a href="#cb2-344" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb2-345"><a href="#cb2-345" aria-hidden="true" tabindex="-1"></a>  points<span class="op">.</span><span class="fu">style</span>(<span class="st">"opacity"</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb2-346"><a href="#cb2-346" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="fu">fadeIn</span>(pts[<span class="dv">4</span>])(crProgressBlock)<span class="op">;</span></span>
<span id="cb2-347"><a href="#cb2-347" aria-hidden="true" tabindex="-1"></a>   })<span class="op">;</span></span>
<span id="cb2-348"><a href="#cb2-348" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb2-349"><a href="#cb2-349" aria-hidden="true" tabindex="-1"></a>  revenue<span class="op">.</span><span class="fu">style</span>(<span class="st">"opacity"</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb2-350"><a href="#cb2-350" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">fadeIn</span>(pts[<span class="dv">3</span>])(crProgressBlock)</span>
<span id="cb2-351"><a href="#cb2-351" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb2-352"><a href="#cb2-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-353"><a href="#cb2-353" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> container<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb2-354"><a href="#cb2-354" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-2" data-nodetype="expression">

</div>
</div>
</div>
</div>
</div>
</div>
</div>
<p>Notice that the post-tariff market price is $12.20, which is just 32% higher than the tariff-free price of $9.20 — even if the tariff rate is 80%. What happened? The market shrank: firms have to charge more so consumers in turn demand less, which pulls the price down. The market-clearing quantity level falls from 46 units to 33 units. This demonstrates an important point about tariffs. Unless firms want their products to languish on shelves, <span class="highlight">they generally cannot pass the entire cost of the tariff to consumers</span>. Back-of-the-envelope calculations that see the iPhone selling for <a href="https://www.cnet.com/personal-finance/taxes/making-sense-of-phone-tariffs-see-how-much-prices-iphone-prices-could-rise/">over $3,000</a>, for example, are eye-catching but hyperbolic.</p>
<p>But the market does shrink. Consumers pay more and buy less; likewise, firms sell less and earn less. The winner is the government, who receives the tariff revenue. The question is, if we tally up everyone’s gains and losses, does the economy as a whole gain or lose? To answer this, we need to introduce the concept of <strong>economic surplus</strong>, the key metric in welfare analysis.</p>
<div class="cr-section cr-column-screen overlay-center">
<div class="narrative-col">
<div class="progress-block">
<div class="trigger new-trigger" data-focus-on="cr-fig3">
<div class="narrative">
<p>Let’s return to the tariff-free market equilibrium.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-fig3">
<div class="narrative">
<p>Consumers pay $9.20 under this equilibrium.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-fig3">
<div class="narrative">
<p>But the market demand curve implies that some are willing to pay more than that. For example, a total of 25 units are demanded by consumers who are willing to pay $16.40 for the good.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-fig3">
<div class="narrative">
<p>Because they pay the market-clearing price of $9.20, they get a <strong>surplus</strong> of $7.20.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-fig3">
<div class="narrative">
<p>The total surplus consumers enjoy is represented by the shaded region above the price line and below the market demand curve.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-fig3">
<div class="narrative">
<p>Similarly, firms get a surplus from selling the product at a price above that at which they were willing to sell.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-fig3">
<div class="narrative">
<p>The sum of consumer and producer surplus represents the total surplus enjoyed by participants of the market in equilibrium.</p>
</div>
</div>
</div>
</div>
<div class="sticky-col">
<div class="sticky-col-stack">
<div id="cr-fig3" class="sticky">
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb3" data-startfrom="385" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 384;"><span id="cb3-385"><a href="#cb3-385" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb3-386"><a href="#cb3-386" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> id <span class="op">=</span> d3<span class="op">.</span><span class="fu">randomInt</span>(<span class="dv">100000</span><span class="op">,</span> <span class="dv">1000000</span>)()<span class="op">;</span></span>
<span id="cb3-387"><a href="#cb3-387" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> params <span class="op">=</span> { <span class="dt">q</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">p</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">es</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">ed</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">t</span><span class="op">:</span> <span class="kw">null</span> }<span class="op">;</span></span>
<span id="cb3-388"><a href="#cb3-388" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> axisTitles <span class="op">=</span> { <span class="dt">x</span><span class="op">:</span> <span class="st">"Output"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="st">"$/unit"</span> }<span class="op">;</span></span>
<span id="cb3-389"><a href="#cb3-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-390"><a href="#cb3-390" aria-hidden="true" tabindex="-1"></a>  params<span class="op">.</span><span class="at">es</span> <span class="op">=</span> <span class="fl">1.5</span><span class="op">;</span></span>
<span id="cb3-391"><a href="#cb3-391" aria-hidden="true" tabindex="-1"></a>  params<span class="op">.</span><span class="at">ed</span> <span class="op">=</span> <span class="op">-</span><span class="fl">1.25</span><span class="op">;</span></span>
<span id="cb3-392"><a href="#cb3-392" aria-hidden="true" tabindex="-1"></a>  params<span class="op">.</span><span class="at">q</span> <span class="op">=</span> <span class="fu">qStar</span>(params)<span class="op">;</span></span>
<span id="cb3-393"><a href="#cb3-393" aria-hidden="true" tabindex="-1"></a>  params<span class="op">.</span><span class="at">p</span> <span class="op">=</span> <span class="fu">supplyFxn</span>(params)<span class="op">;</span></span>
<span id="cb3-394"><a href="#cb3-394" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-395"><a href="#cb3-395" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yScaler <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb3-396"><a href="#cb3-396" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> max<span class="op">.</span><span class="at">p</span>])</span>
<span id="cb3-397"><a href="#cb3-397" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([dim<span class="op">.</span><span class="at">height</span><span class="op">,</span> padding<span class="op">.</span><span class="at">top</span>])<span class="op">;</span></span>
<span id="cb3-398"><a href="#cb3-398" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-399"><a href="#cb3-399" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Diagram</span></span>
<span id="cb3-400"><a href="#cb3-400" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-401"><a href="#cb3-401" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> container <span class="op">=</span> d3<span class="op">.</span><span class="fu">create</span>(<span class="st">"div"</span>)</span>
<span id="cb3-402"><a href="#cb3-402" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"diagram"</span>)<span class="op">;</span></span>
<span id="cb3-403"><a href="#cb3-403" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-404"><a href="#cb3-404" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> container<span class="op">.</span><span class="fu">append</span>(<span class="st">"svg"</span>)</span>
<span id="cb3-405"><a href="#cb3-405" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> <span class="st">"100%"</span>)</span>
<span id="cb3-406"><a href="#cb3-406" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [</span>
<span id="cb3-407"><a href="#cb3-407" aria-hidden="true" tabindex="-1"></a>      <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> </span>
<span id="cb3-408"><a href="#cb3-408" aria-hidden="true" tabindex="-1"></a>      dim<span class="op">.</span><span class="at">width</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">right</span><span class="op">,</span> </span>
<span id="cb3-409"><a href="#cb3-409" aria-hidden="true" tabindex="-1"></a>      dim<span class="op">.</span><span class="at">height</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">bottom</span></span>
<span id="cb3-410"><a href="#cb3-410" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb3-411"><a href="#cb3-411" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(drawBackground)<span class="op">;</span></span>
<span id="cb3-412"><a href="#cb3-412" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-413"><a href="#cb3-413" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> panel <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb3-414"><a href="#cb3-414" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span> margin<span class="op">.</span><span class="at">left</span> <span class="sc">}</span><span class="vs">,</span><span class="sc">${</span> margin<span class="op">.</span><span class="at">top</span> <span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb3-415"><a href="#cb3-415" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-416"><a href="#cb3-416" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> cs <span class="op">=</span> panel<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb3-417"><a href="#cb3-417" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clipWide<span class="op">,</span> id)</span>
<span id="cb3-418"><a href="#cb3-418" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addAreaCurve<span class="op">,</span> id<span class="op">,</span> md<span class="op">,</span> params<span class="op">,</span> yScaler)<span class="op">;</span></span>
<span id="cb3-419"><a href="#cb3-419" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-420"><a href="#cb3-420" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> ps <span class="op">=</span> panel<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb3-421"><a href="#cb3-421" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clipWide<span class="op">,</span> id)</span>
<span id="cb3-422"><a href="#cb3-422" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addAreaCurve<span class="op">,</span> id<span class="op">,</span> xs<span class="op">,</span> params<span class="op">,</span> yScaler)<span class="op">;</span></span>
<span id="cb3-423"><a href="#cb3-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-424"><a href="#cb3-424" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> supplyCurve <span class="op">=</span> panel<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb3-425"><a href="#cb3-425" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clip<span class="op">,</span> id)</span>
<span id="cb3-426"><a href="#cb3-426" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurveFull<span class="op">,</span> id<span class="op">,</span> xs<span class="op">,</span> params<span class="op">,</span> yScaler)</span>
<span id="cb3-427"><a href="#cb3-427" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(</span>
<span id="cb3-428"><a href="#cb3-428" aria-hidden="true" tabindex="-1"></a>      addLabel<span class="op">,</span> <span class="st">"Export supply"</span><span class="op">,</span> </span>
<span id="cb3-429"><a href="#cb3-429" aria-hidden="true" tabindex="-1"></a>      <span class="fu">xScaler</span>(<span class="dv">95</span>)<span class="op">,</span> </span>
<span id="cb3-430"><a href="#cb3-430" aria-hidden="true" tabindex="-1"></a>      <span class="fu">yScaler</span>(<span class="fu">supplyFxn</span>({ <span class="dt">q</span><span class="op">:</span> <span class="dv">95</span><span class="op">,</span> <span class="dt">es</span><span class="op">:</span> params<span class="op">.</span><span class="at">es</span> })) <span class="op">-</span> <span class="dv">15</span><span class="op">,</span></span>
<span id="cb3-431"><a href="#cb3-431" aria-hidden="true" tabindex="-1"></a>      <span class="st">"middle"</span></span>
<span id="cb3-432"><a href="#cb3-432" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb3-433"><a href="#cb3-433" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-434"><a href="#cb3-434" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> demandCurve <span class="op">=</span> panel<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb3-435"><a href="#cb3-435" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clip<span class="op">,</span> id)</span>
<span id="cb3-436"><a href="#cb3-436" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurveFull<span class="op">,</span> id<span class="op">,</span> md<span class="op">,</span> params<span class="op">,</span> yScaler)</span>
<span id="cb3-437"><a href="#cb3-437" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(</span>
<span id="cb3-438"><a href="#cb3-438" aria-hidden="true" tabindex="-1"></a>      addLabel<span class="op">,</span> <span class="st">"Import demand"</span><span class="op">,</span> </span>
<span id="cb3-439"><a href="#cb3-439" aria-hidden="true" tabindex="-1"></a>      <span class="fu">xScaler</span>(<span class="dv">70</span>)<span class="op">,</span></span>
<span id="cb3-440"><a href="#cb3-440" aria-hidden="true" tabindex="-1"></a>      <span class="fu">yScaler</span>(<span class="fu">demandFxn</span>({ <span class="dt">q</span><span class="op">:</span> <span class="dv">50</span><span class="op">,</span> <span class="dt">ed</span><span class="op">:</span> params<span class="op">.</span><span class="at">ed</span> }))</span>
<span id="cb3-441"><a href="#cb3-441" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb3-442"><a href="#cb3-442" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-443"><a href="#cb3-443" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> demandGuideSample <span class="op">=</span> panel<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb3-444"><a href="#cb3-444" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(yGuide<span class="op">,</span> md<span class="op">,</span> { <span class="dt">q</span><span class="op">:</span> <span class="dv">25</span><span class="op">,</span> <span class="dt">ed</span><span class="op">:</span> params<span class="op">.</span><span class="at">ed</span> }<span class="op">,</span> yScaler<span class="op">,</span> <span class="st">",.1f"</span>)</span>
<span id="cb3-445"><a href="#cb3-445" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(xGuides<span class="op">,</span> md<span class="op">,</span> { <span class="dt">q</span><span class="op">:</span> <span class="dv">25</span><span class="op">,</span> <span class="dt">ed</span><span class="op">:</span> params<span class="op">.</span><span class="at">ed</span> }<span class="op">,</span> yScaler)<span class="op">;</span></span>
<span id="cb3-446"><a href="#cb3-446" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-447"><a href="#cb3-447" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> csGuide <span class="op">=</span> panel<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">;</span></span>
<span id="cb3-448"><a href="#cb3-448" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-449"><a href="#cb3-449" aria-hidden="true" tabindex="-1"></a>  csGuide<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb3-450"><a href="#cb3-450" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"curlybrace"</span>)</span>
<span id="cb3-451"><a href="#cb3-451" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> () <span class="kw">=&gt;</span> <span class="fu">curlyBrace</span>(</span>
<span id="cb3-452"><a href="#cb3-452" aria-hidden="true" tabindex="-1"></a>      [<span class="fu">xScaler</span>(<span class="dv">25</span>) <span class="op">-</span> <span class="dv">5</span><span class="op">,</span> <span class="fu">yScaler</span>(<span class="fl">16.4</span>) <span class="op">+</span> <span class="dv">5</span>]<span class="op">,</span> </span>
<span id="cb3-453"><a href="#cb3-453" aria-hidden="true" tabindex="-1"></a>      <span class="fu">yScaler</span>(<span class="fl">9.2</span>) <span class="op">-</span> <span class="fu">yScaler</span>(<span class="fl">16.4</span>) <span class="op">-</span> <span class="dv">15</span></span>
<span id="cb3-454"><a href="#cb3-454" aria-hidden="true" tabindex="-1"></a>    ))<span class="op">;</span></span>
<span id="cb3-455"><a href="#cb3-455" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-456"><a href="#cb3-456" aria-hidden="true" tabindex="-1"></a>  csGuide<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb3-457"><a href="#cb3-457" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"curlybrace-label"</span>)</span>
<span id="cb3-458"><a href="#cb3-458" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="fu">xScaler</span>(<span class="dv">25</span>) <span class="op">-</span> <span class="dv">20</span>)</span>
<span id="cb3-459"><a href="#cb3-459" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="fu">yScaler</span>(<span class="fl">12.8</span>))</span>
<span id="cb3-460"><a href="#cb3-460" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"end"</span>)</span>
<span id="cb3-461"><a href="#cb3-461" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="fl">7.2</span>)</span>
<span id="cb3-462"><a href="#cb3-462" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-463"><a href="#cb3-463" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> guidesEq <span class="op">=</span> panel<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb3-464"><a href="#cb3-464" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(yGuide<span class="op">,</span> xs<span class="op">,</span> params<span class="op">,</span> yScaler<span class="op">,</span> <span class="st">",.1f"</span>)</span>
<span id="cb3-465"><a href="#cb3-465" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(xGuides<span class="op">,</span> xs<span class="op">,</span> params<span class="op">,</span> yScaler)<span class="op">;</span></span>
<span id="cb3-466"><a href="#cb3-466" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-467"><a href="#cb3-467" aria-hidden="true" tabindex="-1"></a>  panel<span class="op">.</span><span class="fu">call</span>(panelAxes<span class="op">,</span> axisTitles)<span class="op">;</span></span>
<span id="cb3-468"><a href="#cb3-468" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-469"><a href="#cb3-469" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Scroll animations</span></span>
<span id="cb3-470"><a href="#cb3-470" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-471"><a href="#cb3-471" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> pts <span class="op">=</span> [</span>
<span id="cb3-472"><a href="#cb3-472" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">start</span><span class="op">:</span> <span class="op">.</span><span class="dv">120</span><span class="op">,</span> <span class="dt">end</span><span class="op">:</span> <span class="op">.</span><span class="dv">140</span> }<span class="op">,</span>  <span class="co">// 0</span></span>
<span id="cb3-473"><a href="#cb3-473" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">start</span><span class="op">:</span> <span class="op">.</span><span class="dv">270</span><span class="op">,</span> <span class="dt">end</span><span class="op">:</span> <span class="op">.</span><span class="dv">290</span> }<span class="op">,</span>  <span class="co">// 1</span></span>
<span id="cb3-474"><a href="#cb3-474" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">start</span><span class="op">:</span> <span class="op">.</span><span class="dv">430</span><span class="op">,</span> <span class="dt">end</span><span class="op">:</span> <span class="op">.</span><span class="dv">450</span> }<span class="op">,</span>  <span class="co">// 2</span></span>
<span id="cb3-475"><a href="#cb3-475" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">start</span><span class="op">:</span> <span class="op">.</span><span class="dv">585</span><span class="op">,</span> <span class="dt">end</span><span class="op">:</span> <span class="op">.</span><span class="dv">605</span> }<span class="op">,</span>  <span class="co">// 3</span></span>
<span id="cb3-476"><a href="#cb3-476" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">start</span><span class="op">:</span> <span class="op">.</span><span class="dv">735</span><span class="op">,</span> <span class="dt">end</span><span class="op">:</span> <span class="op">.</span><span class="dv">755</span> }<span class="op">,</span>  <span class="co">// 4</span></span>
<span id="cb3-477"><a href="#cb3-477" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">start</span><span class="op">:</span> <span class="op">.</span><span class="dv">890</span><span class="op">,</span> <span class="dt">end</span><span class="op">:</span> <span class="op">.</span><span class="dv">910</span> }<span class="op">,</span>  <span class="co">// 5</span></span>
<span id="cb3-478"><a href="#cb3-478" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb3-479"><a href="#cb3-479" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-480"><a href="#cb3-480" aria-hidden="true" tabindex="-1"></a>  demandCurve<span class="op">.</span><span class="fu">style</span>(<span class="st">"opacity"</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb3-481"><a href="#cb3-481" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (prog <span class="op">&gt;=</span> pts[<span class="dv">4</span>]<span class="op">.</span><span class="at">start</span> <span class="op">&amp;&amp;</span> prog <span class="op">&lt;</span> pts[<span class="dv">5</span>]<span class="op">.</span><span class="at">start</span>) {</span>
<span id="cb3-482"><a href="#cb3-482" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="fu">fadeOut</span>(pts[<span class="dv">4</span>])(prog)<span class="op">;</span></span>
<span id="cb3-483"><a href="#cb3-483" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (prog <span class="op">&gt;=</span> pts[<span class="dv">5</span>]<span class="op">.</span><span class="at">start</span>) {</span>
<span id="cb3-484"><a href="#cb3-484" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="fu">fadeIn</span>(pts[<span class="dv">5</span>])(prog)<span class="op">;</span></span>
<span id="cb3-485"><a href="#cb3-485" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb3-486"><a href="#cb3-486" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb3-487"><a href="#cb3-487" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-488"><a href="#cb3-488" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb3-489"><a href="#cb3-489" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-490"><a href="#cb3-490" aria-hidden="true" tabindex="-1"></a>  supplyCurve<span class="op">.</span><span class="fu">style</span>(<span class="st">"opacity"</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb3-491"><a href="#cb3-491" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (prog <span class="op">&gt;=</span> pts[<span class="dv">0</span>]<span class="op">.</span><span class="at">start</span> <span class="op">&amp;&amp;</span> prog <span class="op">&lt;</span> pts[<span class="dv">4</span>]<span class="op">.</span><span class="at">start</span>) {</span>
<span id="cb3-492"><a href="#cb3-492" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="fu">fadeOut</span>(pts[<span class="dv">0</span>])(prog)<span class="op">;</span></span>
<span id="cb3-493"><a href="#cb3-493" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (prog <span class="op">&gt;=</span> pts[<span class="dv">4</span>]<span class="op">.</span><span class="at">start</span>) {</span>
<span id="cb3-494"><a href="#cb3-494" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="fu">fadeIn</span>(pts[<span class="dv">4</span>])(prog)<span class="op">;</span></span>
<span id="cb3-495"><a href="#cb3-495" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb3-496"><a href="#cb3-496" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb3-497"><a href="#cb3-497" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-498"><a href="#cb3-498" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb3-499"><a href="#cb3-499" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-500"><a href="#cb3-500" aria-hidden="true" tabindex="-1"></a>  demandGuideSample<span class="op">.</span><span class="fu">style</span>(<span class="st">"opacity"</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb3-501"><a href="#cb3-501" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (prog <span class="op">&gt;=</span> pts[<span class="dv">1</span>]<span class="op">.</span><span class="at">start</span> <span class="op">&amp;&amp;</span> prog <span class="op">&lt;</span> pts[<span class="dv">3</span>]<span class="op">.</span><span class="at">start</span>) {</span>
<span id="cb3-502"><a href="#cb3-502" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="fu">fadeIn</span>(pts[<span class="dv">1</span>])(prog)<span class="op">;</span></span>
<span id="cb3-503"><a href="#cb3-503" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (prog <span class="op">&gt;=</span> pts[<span class="dv">3</span>]<span class="op">.</span><span class="at">start</span>) {</span>
<span id="cb3-504"><a href="#cb3-504" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="fu">fadeOut</span>(pts[<span class="dv">3</span>])(prog)<span class="op">;</span></span>
<span id="cb3-505"><a href="#cb3-505" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb3-506"><a href="#cb3-506" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-507"><a href="#cb3-507" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-508"><a href="#cb3-508" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb3-509"><a href="#cb3-509" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-510"><a href="#cb3-510" aria-hidden="true" tabindex="-1"></a>  csGuide<span class="op">.</span><span class="fu">style</span>(<span class="st">"opacity"</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb3-511"><a href="#cb3-511" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (prog <span class="op">&gt;=</span> pts[<span class="dv">2</span>]<span class="op">.</span><span class="at">start</span> <span class="op">&amp;&amp;</span> prog <span class="op">&lt;</span> pts[<span class="dv">3</span>]<span class="op">.</span><span class="at">start</span>) {</span>
<span id="cb3-512"><a href="#cb3-512" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="fu">fadeIn</span>(pts[<span class="dv">2</span>])(prog)<span class="op">;</span></span>
<span id="cb3-513"><a href="#cb3-513" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (prog <span class="op">&gt;=</span> pts[<span class="dv">3</span>]<span class="op">.</span><span class="at">start</span>) {</span>
<span id="cb3-514"><a href="#cb3-514" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="fu">fadeOut</span>(pts[<span class="dv">3</span>])(prog)<span class="op">;</span></span>
<span id="cb3-515"><a href="#cb3-515" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb3-516"><a href="#cb3-516" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-517"><a href="#cb3-517" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-518"><a href="#cb3-518" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb3-519"><a href="#cb3-519" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-520"><a href="#cb3-520" aria-hidden="true" tabindex="-1"></a>  cs<span class="op">.</span><span class="fu">style</span>(<span class="st">"opacity"</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb3-521"><a href="#cb3-521" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (prog <span class="op">&gt;=</span> pts[<span class="dv">1</span>]<span class="op">.</span><span class="at">start</span> <span class="op">&amp;&amp;</span> prog <span class="op">&lt;</span> pts[<span class="dv">4</span>]<span class="op">.</span><span class="at">start</span>) {</span>
<span id="cb3-522"><a href="#cb3-522" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="fu">fadeIn</span>(pts[<span class="dv">3</span>])(prog)<span class="op">;</span></span>
<span id="cb3-523"><a href="#cb3-523" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (prog <span class="op">&gt;=</span> pts[<span class="dv">4</span>]<span class="op">.</span><span class="at">start</span> <span class="op">&amp;&amp;</span> prog <span class="op">&lt;</span> pts[<span class="dv">5</span>]<span class="op">.</span><span class="at">start</span>) {</span>
<span id="cb3-524"><a href="#cb3-524" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="fu">fadeOut</span>(pts[<span class="dv">4</span>])(prog)<span class="op">;</span></span>
<span id="cb3-525"><a href="#cb3-525" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (prog <span class="op">&gt;=</span> pts[<span class="dv">5</span>]<span class="op">.</span><span class="at">start</span>) {</span>
<span id="cb3-526"><a href="#cb3-526" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="fu">fadeIn</span>(pts[<span class="dv">5</span>])(prog)<span class="op">;</span></span>
<span id="cb3-527"><a href="#cb3-527" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb3-528"><a href="#cb3-528" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-529"><a href="#cb3-529" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-530"><a href="#cb3-530" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb3-531"><a href="#cb3-531" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-532"><a href="#cb3-532" aria-hidden="true" tabindex="-1"></a>  ps<span class="op">.</span><span class="fu">style</span>(<span class="st">"opacity"</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb3-533"><a href="#cb3-533" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">fadeIn</span>(pts[<span class="dv">4</span>])(prog)<span class="op">;</span></span>
<span id="cb3-534"><a href="#cb3-534" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb3-535"><a href="#cb3-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-536"><a href="#cb3-536" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> container<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb3-537"><a href="#cb3-537" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-3" data-nodetype="expression">

</div>
</div>
</div>
</div>
</div>
</div>
</div>
<p>“Surplus” is one of those esoteric concepts in economics that is nevertheless useful for real world questions. Everyone can agree that it is better for consumers to have as big a gap as possible between the price they’re willing to pay and the price they actually pay. Likewise for firms. Therefore, <span class="highlight">maximizing the total surplus in a market is desirable as a rule</span>.</p>
<div class="cr-section cr-column-screen overlay-center">
<div class="narrative-col">
<div class="progress-block">
<div class="trigger new-trigger" data-focus-on="cr-fig4">
<div class="narrative">
<p>How does a tariff affect total surplus?</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-fig4">
<div class="narrative">
<p>It reduces it!</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-fig4">
<div class="narrative">
<p>But it’s not all bad as some of this lost surplus ends up as revenues for the government.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-fig4">
<div class="narrative">
<p>This region, however, goes to no one. It reflects surplus lost due to the market shrinkage the tariff causes. It is known in economics as the <strong>deadweight loss</strong>.</p>
</div>
</div>
</div>
</div>
<div class="sticky-col">
<div class="sticky-col-stack">
<div id="cr-fig4" class="sticky">
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb4" data-startfrom="560" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 559;"><span id="cb4-560"><a href="#cb4-560" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb4-561"><a href="#cb4-561" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> id <span class="op">=</span> d3<span class="op">.</span><span class="fu">randomInt</span>(<span class="dv">100000</span><span class="op">,</span> <span class="dv">1000000</span>)()<span class="op">;</span></span>
<span id="cb4-562"><a href="#cb4-562" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> params <span class="op">=</span> { <span class="dt">q</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">p</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">es</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">ed</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">t</span><span class="op">:</span> <span class="kw">null</span> }<span class="op">;</span></span>
<span id="cb4-563"><a href="#cb4-563" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> axisTitles <span class="op">=</span> { <span class="dt">x</span><span class="op">:</span> <span class="st">"Output"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="st">"$/unit"</span> }<span class="op">;</span></span>
<span id="cb4-564"><a href="#cb4-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-565"><a href="#cb4-565" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> pts <span class="op">=</span> [</span>
<span id="cb4-566"><a href="#cb4-566" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">start</span><span class="op">:</span> <span class="op">.</span><span class="dv">15</span><span class="op">,</span> <span class="dt">end</span><span class="op">:</span> <span class="op">.</span><span class="dv">24</span> }<span class="op">,</span>  <span class="co">// 0</span></span>
<span id="cb4-567"><a href="#cb4-567" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">start</span><span class="op">:</span> <span class="op">.</span><span class="dv">24</span><span class="op">,</span> <span class="dt">end</span><span class="op">:</span> <span class="op">.</span><span class="dv">25</span> }<span class="op">,</span>  <span class="co">// 1</span></span>
<span id="cb4-568"><a href="#cb4-568" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">start</span><span class="op">:</span> <span class="op">.</span><span class="dv">51</span><span class="op">,</span> <span class="dt">end</span><span class="op">:</span> <span class="op">.</span><span class="dv">53</span> }<span class="op">,</span>  <span class="co">// 2</span></span>
<span id="cb4-569"><a href="#cb4-569" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">start</span><span class="op">:</span> <span class="op">.</span><span class="dv">80</span><span class="op">,</span> <span class="dt">end</span><span class="op">:</span> <span class="op">.</span><span class="dv">82</span> }<span class="op">,</span>  <span class="co">// 3</span></span>
<span id="cb4-570"><a href="#cb4-570" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb4-571"><a href="#cb4-571" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-572"><a href="#cb4-572" aria-hidden="true" tabindex="-1"></a>  params<span class="op">.</span><span class="at">es</span> <span class="op">=</span> <span class="fl">1.5</span><span class="op">;</span></span>
<span id="cb4-573"><a href="#cb4-573" aria-hidden="true" tabindex="-1"></a>  params<span class="op">.</span><span class="at">ed</span> <span class="op">=</span> <span class="op">-</span><span class="fl">1.25</span><span class="op">;</span></span>
<span id="cb4-574"><a href="#cb4-574" aria-hidden="true" tabindex="-1"></a>  params<span class="op">.</span><span class="at">t</span> <span class="op">=</span> <span class="op">.</span><span class="dv">8</span> <span class="op">*</span> <span class="fu">fadeIn</span>(pts[<span class="dv">0</span>])(prog)<span class="op">;</span></span>
<span id="cb4-575"><a href="#cb4-575" aria-hidden="true" tabindex="-1"></a>  params<span class="op">.</span><span class="at">q</span> <span class="op">=</span> <span class="fu">qStar</span>(params)<span class="op">;</span></span>
<span id="cb4-576"><a href="#cb4-576" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> qtStar <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(<span class="op">-</span><span class="fl">16.58</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">pow</span>(params<span class="op">.</span><span class="at">t</span><span class="op">,</span> <span class="op">.</span><span class="dv">78</span>) <span class="op">+</span> <span class="fl">46.44</span>)<span class="op">;</span></span>
<span id="cb4-577"><a href="#cb4-577" aria-hidden="true" tabindex="-1"></a>  params<span class="op">.</span><span class="at">p</span> <span class="op">=</span> <span class="fu">supplyFxn</span>(params)<span class="op">;</span></span>
<span id="cb4-578"><a href="#cb4-578" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-579"><a href="#cb4-579" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yScaler <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb4-580"><a href="#cb4-580" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> max<span class="op">.</span><span class="at">p</span>])</span>
<span id="cb4-581"><a href="#cb4-581" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([dim<span class="op">.</span><span class="at">height</span><span class="op">,</span> padding<span class="op">.</span><span class="at">top</span>])<span class="op">;</span></span>
<span id="cb4-582"><a href="#cb4-582" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-583"><a href="#cb4-583" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Diagram</span></span>
<span id="cb4-584"><a href="#cb4-584" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-585"><a href="#cb4-585" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> container <span class="op">=</span> d3<span class="op">.</span><span class="fu">create</span>(<span class="st">"div"</span>)</span>
<span id="cb4-586"><a href="#cb4-586" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"diagram"</span>)<span class="op">;</span></span>
<span id="cb4-587"><a href="#cb4-587" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-588"><a href="#cb4-588" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> container<span class="op">.</span><span class="fu">append</span>(<span class="st">"svg"</span>)</span>
<span id="cb4-589"><a href="#cb4-589" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> <span class="st">"100%"</span>)</span>
<span id="cb4-590"><a href="#cb4-590" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [</span>
<span id="cb4-591"><a href="#cb4-591" aria-hidden="true" tabindex="-1"></a>      <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> </span>
<span id="cb4-592"><a href="#cb4-592" aria-hidden="true" tabindex="-1"></a>      dim<span class="op">.</span><span class="at">width</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">right</span><span class="op">,</span> </span>
<span id="cb4-593"><a href="#cb4-593" aria-hidden="true" tabindex="-1"></a>      dim<span class="op">.</span><span class="at">height</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">bottom</span></span>
<span id="cb4-594"><a href="#cb4-594" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb4-595"><a href="#cb4-595" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(drawBackground)<span class="op">;</span></span>
<span id="cb4-596"><a href="#cb4-596" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-597"><a href="#cb4-597" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> panel <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb4-598"><a href="#cb4-598" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span> margin<span class="op">.</span><span class="at">left</span> <span class="sc">}</span><span class="vs">,</span><span class="sc">${</span> margin<span class="op">.</span><span class="at">top</span> <span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb4-599"><a href="#cb4-599" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-600"><a href="#cb4-600" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> cs <span class="op">=</span> panel<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb4-601"><a href="#cb4-601" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clipWide<span class="op">,</span> id)</span>
<span id="cb4-602"><a href="#cb4-602" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addAreaCurve<span class="op">,</span> id<span class="op">,</span> md<span class="op">,</span> { <span class="dt">q</span><span class="op">:</span> qtStar<span class="op">,</span> <span class="dt">ed</span><span class="op">:</span> params<span class="op">.</span><span class="at">ed</span> }<span class="op">,</span> yScaler)<span class="op">;</span></span>
<span id="cb4-603"><a href="#cb4-603" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-604"><a href="#cb4-604" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> ps <span class="op">=</span> panel<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb4-605"><a href="#cb4-605" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addAreaCurve<span class="op">,</span> id<span class="op">,</span> xs<span class="op">,</span> { <span class="dt">q</span><span class="op">:</span> qtStar<span class="op">,</span> <span class="dt">es</span><span class="op">:</span> params<span class="op">.</span><span class="at">es</span> }<span class="op">,</span> yScaler)<span class="op">;</span></span>
<span id="cb4-606"><a href="#cb4-606" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-607"><a href="#cb4-607" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> dwl <span class="op">=</span> panel<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb4-608"><a href="#cb4-608" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"area-dwl"</span>)</span>
<span id="cb4-609"><a href="#cb4-609" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addAreaCurve<span class="op">,</span> id<span class="op">,</span> md<span class="op">,</span> { <span class="dt">ed</span><span class="op">:</span> params<span class="op">.</span><span class="at">ed</span> }<span class="op">,</span> yScaler<span class="op">,</span> <span class="dv">33</span><span class="op">,</span> <span class="dv">46</span>)</span>
<span id="cb4-610"><a href="#cb4-610" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addAreaCurve<span class="op">,</span> id<span class="op">,</span> xs<span class="op">,</span> { <span class="dt">es</span><span class="op">:</span> params<span class="op">.</span><span class="at">es</span> }<span class="op">,</span> yScaler<span class="op">,</span> <span class="dv">33</span><span class="op">,</span> <span class="dv">46</span>)<span class="op">;</span></span>
<span id="cb4-611"><a href="#cb4-611" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-612"><a href="#cb4-612" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> revenue <span class="op">=</span> panel<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb4-613"><a href="#cb4-613" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addAreaBox<span class="op">,</span> </span>
<span id="cb4-614"><a href="#cb4-614" aria-hidden="true" tabindex="-1"></a>      id<span class="op">,</span> </span>
<span id="cb4-615"><a href="#cb4-615" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">id</span><span class="op">:</span> <span class="st">"revenue"</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Government revenues"</span> }<span class="op">,</span> </span>
<span id="cb4-616"><a href="#cb4-616" aria-hidden="true" tabindex="-1"></a>      { </span>
<span id="cb4-617"><a href="#cb4-617" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x1</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> </span>
<span id="cb4-618"><a href="#cb4-618" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y1</span><span class="op">:</span> <span class="fu">yScaler</span>(<span class="fu">supplyFxn</span>({ <span class="dt">q</span><span class="op">:</span> qtStar<span class="op">,</span> <span class="dt">es</span><span class="op">:</span> params<span class="op">.</span><span class="at">es</span> }))<span class="op">,</span> </span>
<span id="cb4-619"><a href="#cb4-619" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x2</span><span class="op">:</span> <span class="fu">xScaler</span>(qtStar)<span class="op">,</span> </span>
<span id="cb4-620"><a href="#cb4-620" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y2</span><span class="op">:</span> <span class="fu">yScaler</span>(<span class="fu">demandFxn</span>({ <span class="dt">q</span><span class="op">:</span> qtStar<span class="op">,</span> <span class="dt">ed</span><span class="op">:</span> params<span class="op">.</span><span class="at">ed</span> })) </span>
<span id="cb4-621"><a href="#cb4-621" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb4-622"><a href="#cb4-622" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb4-623"><a href="#cb4-623" aria-hidden="true" tabindex="-1"></a>  revenue<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb4-624"><a href="#cb4-624" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"area-label revenue"</span>)</span>
<span id="cb4-625"><a href="#cb4-625" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="fu">xScaler</span>(<span class="dv">13</span>))</span>
<span id="cb4-626"><a href="#cb4-626" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="fu">yScaler</span>(<span class="dv">11</span>))</span>
<span id="cb4-627"><a href="#cb4-627" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">"Tax revenue"</span>)<span class="op">;</span></span>
<span id="cb4-628"><a href="#cb4-628" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-629"><a href="#cb4-629" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> supplyTaxedCurve <span class="op">=</span> panel<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb4-630"><a href="#cb4-630" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clip<span class="op">,</span> id)</span>
<span id="cb4-631"><a href="#cb4-631" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurveFull<span class="op">,</span> id<span class="op">,</span> xst<span class="op">,</span> params<span class="op">,</span> yScaler)<span class="op">;</span></span>
<span id="cb4-632"><a href="#cb4-632" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-633"><a href="#cb4-633" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> supplyTaxedCurveLabel <span class="op">=</span> panel<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb4-634"><a href="#cb4-634" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(</span>
<span id="cb4-635"><a href="#cb4-635" aria-hidden="true" tabindex="-1"></a>      addLabel<span class="op">,</span> <span class="st">"Supply with tariff"</span><span class="op">,</span> </span>
<span id="cb4-636"><a href="#cb4-636" aria-hidden="true" tabindex="-1"></a>      <span class="fu">xScaler</span>(<span class="dv">70</span>) <span class="op">-</span> <span class="dv">15</span><span class="op">,</span> </span>
<span id="cb4-637"><a href="#cb4-637" aria-hidden="true" tabindex="-1"></a>      <span class="fu">yScaler</span>(<span class="fu">supplyTaxedFxn</span>({ <span class="dt">q</span><span class="op">:</span> <span class="dv">70</span><span class="op">,</span> <span class="dt">es</span><span class="op">:</span> params<span class="op">.</span><span class="at">es</span><span class="op">,</span> <span class="dt">t</span><span class="op">:</span> params<span class="op">.</span><span class="at">t</span> }))<span class="op">,</span></span>
<span id="cb4-638"><a href="#cb4-638" aria-hidden="true" tabindex="-1"></a>      <span class="st">"end"</span></span>
<span id="cb4-639"><a href="#cb4-639" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb4-640"><a href="#cb4-640" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-641"><a href="#cb4-641" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> supplyCurve <span class="op">=</span> panel<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb4-642"><a href="#cb4-642" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clip<span class="op">,</span> id)</span>
<span id="cb4-643"><a href="#cb4-643" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurveFull<span class="op">,</span> id<span class="op">,</span> xs<span class="op">,</span> params<span class="op">,</span> yScaler)</span>
<span id="cb4-644"><a href="#cb4-644" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(</span>
<span id="cb4-645"><a href="#cb4-645" aria-hidden="true" tabindex="-1"></a>      addLabel<span class="op">,</span> <span class="st">"Export supply"</span><span class="op">,</span> </span>
<span id="cb4-646"><a href="#cb4-646" aria-hidden="true" tabindex="-1"></a>      <span class="fu">xScaler</span>(<span class="dv">70</span>) <span class="op">+</span> <span class="dv">15</span><span class="op">,</span> </span>
<span id="cb4-647"><a href="#cb4-647" aria-hidden="true" tabindex="-1"></a>      <span class="fu">yScaler</span>(<span class="fu">supplyFxn</span>({ <span class="dt">q</span><span class="op">:</span> <span class="dv">70</span><span class="op">,</span> <span class="dt">es</span><span class="op">:</span> params<span class="op">.</span><span class="at">es</span> })) <span class="op">+</span> <span class="dv">10</span><span class="op">,</span></span>
<span id="cb4-648"><a href="#cb4-648" aria-hidden="true" tabindex="-1"></a>      <span class="st">"start"</span></span>
<span id="cb4-649"><a href="#cb4-649" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb4-650"><a href="#cb4-650" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-651"><a href="#cb4-651" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> demandCurve <span class="op">=</span> panel<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb4-652"><a href="#cb4-652" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clip<span class="op">,</span> id)</span>
<span id="cb4-653"><a href="#cb4-653" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurveFull<span class="op">,</span> id<span class="op">,</span> md<span class="op">,</span> params<span class="op">,</span> yScaler)</span>
<span id="cb4-654"><a href="#cb4-654" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(</span>
<span id="cb4-655"><a href="#cb4-655" aria-hidden="true" tabindex="-1"></a>      addLabel<span class="op">,</span> <span class="st">"Import demand"</span><span class="op">,</span> </span>
<span id="cb4-656"><a href="#cb4-656" aria-hidden="true" tabindex="-1"></a>      <span class="fu">xScaler</span>(<span class="dv">70</span>)<span class="op">,</span></span>
<span id="cb4-657"><a href="#cb4-657" aria-hidden="true" tabindex="-1"></a>      <span class="fu">yScaler</span>(<span class="fu">demandFxn</span>({ <span class="dt">q</span><span class="op">:</span> <span class="dv">50</span><span class="op">,</span> <span class="dt">ed</span><span class="op">:</span> params<span class="op">.</span><span class="at">ed</span> }))</span>
<span id="cb4-658"><a href="#cb4-658" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb4-659"><a href="#cb4-659" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-660"><a href="#cb4-660" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> supplyGuide <span class="op">=</span> panel<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb4-661"><a href="#cb4-661" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(yGuide<span class="op">,</span> xs<span class="op">,</span> { <span class="dt">q</span><span class="op">:</span> qtStar<span class="op">,</span> <span class="dt">es</span><span class="op">:</span> params<span class="op">.</span><span class="at">es</span> }<span class="op">,</span> yScaler<span class="op">,</span> <span class="st">",.1f"</span>)<span class="op">;</span></span>
<span id="cb4-662"><a href="#cb4-662" aria-hidden="true" tabindex="-1"></a>  supplyGuide<span class="op">.</span><span class="fu">select</span>(<span class="st">"text"</span>)</span>
<span id="cb4-663"><a href="#cb4-663" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"#b3b3b3"</span>)<span class="op">;</span></span>
<span id="cb4-664"><a href="#cb4-664" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-665"><a href="#cb4-665" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> demandGuidesTaxed <span class="op">=</span> panel<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb4-666"><a href="#cb4-666" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(yGuide<span class="op">,</span> md<span class="op">,</span> { <span class="dt">q</span><span class="op">:</span> qtStar<span class="op">,</span> <span class="dt">ed</span><span class="op">:</span> params<span class="op">.</span><span class="at">ed</span> }<span class="op">,</span> yScaler<span class="op">,</span> <span class="st">",.1f"</span>)</span>
<span id="cb4-667"><a href="#cb4-667" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(xGuides<span class="op">,</span> xst<span class="op">,</span> { <span class="dt">q</span><span class="op">:</span> qtStar<span class="op">,</span> <span class="dt">es</span><span class="op">:</span> params<span class="op">.</span><span class="at">es</span><span class="op">,</span> <span class="dt">t</span><span class="op">:</span> params<span class="op">.</span><span class="at">t</span> }<span class="op">,</span> yScaler)<span class="op">;</span></span>
<span id="cb4-668"><a href="#cb4-668" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-669"><a href="#cb4-669" aria-hidden="true" tabindex="-1"></a>  panel<span class="op">.</span><span class="fu">call</span>(panelAxes<span class="op">,</span> axisTitles)<span class="op">;</span></span>
<span id="cb4-670"><a href="#cb4-670" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-671"><a href="#cb4-671" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Scroll animations</span></span>
<span id="cb4-672"><a href="#cb4-672" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-673"><a href="#cb4-673" aria-hidden="true" tabindex="-1"></a>  supplyTaxedCurveLabel<span class="op">.</span><span class="fu">style</span>(<span class="st">"opacity"</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb4-674"><a href="#cb4-674" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">fadeIn</span>(pts[<span class="dv">1</span>])(prog)<span class="op">;</span></span>
<span id="cb4-675"><a href="#cb4-675" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb4-676"><a href="#cb4-676" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-677"><a href="#cb4-677" aria-hidden="true" tabindex="-1"></a>  revenue<span class="op">.</span><span class="fu">style</span>(<span class="st">"opacity"</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb4-678"><a href="#cb4-678" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">fadeIn</span>(pts[<span class="dv">2</span>])(prog)<span class="op">;</span></span>
<span id="cb4-679"><a href="#cb4-679" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb4-680"><a href="#cb4-680" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-681"><a href="#cb4-681" aria-hidden="true" tabindex="-1"></a>  dwl<span class="op">.</span><span class="fu">style</span>(<span class="st">"opacity"</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb4-682"><a href="#cb4-682" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">fadeIn</span>(pts[<span class="dv">3</span>])(prog)<span class="op">;</span></span>
<span id="cb4-683"><a href="#cb4-683" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb4-684"><a href="#cb4-684" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-685"><a href="#cb4-685" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> container<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb4-686"><a href="#cb4-686" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-4" data-nodetype="expression">

</div>
</div>
</div>
</div>
</div>
</div>
</div>
<p>We can refine this cost–benefit calculus further by being a bit more nationalistic. Firms in this market are foreign after all, so perhaps we don’t mind their lost surplus so much.</p>
<div class="cr-section cr-column-screen overlay-center">
<div class="narrative-col">
<div class="progress-block">
<div class="trigger new-trigger" data-focus-on="cr-fig5">
<div class="narrative">
<p>Let’s examine the colored areas again.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-fig5">
<div class="narrative">
<p>This is the region of lost surplus.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-fig5">
<div class="narrative">
<p>This is the tax collected from foreign firms — an unambiguous win for our country.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-fig5">
<div class="narrative">
<p>This is the tax collected from domestic consumers. Annoying for consumers but it could be put to good use.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-fig5">
<div class="narrative">
<p>This is the firms’ share of the deadweight loss. Not our problem!</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-fig5">
<div class="narrative">
<p>And finally, this is our consumers’ share of the deadweight loss — an unambiguous loss for our country.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-fig5">
<div class="narrative">
<p>Altogether, we are comparing the size of the red region (gain from taxing foreign firms) against the size of the gray region (lost surplus for domestic consumers).</p>
</div>
</div>
</div>
</div>
<div class="sticky-col">
<div class="sticky-col-stack">
<div id="cr-fig5" class="sticky">
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb5" data-startfrom="716" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 715;"><span id="cb5-716"><a href="#cb5-716" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb5-717"><a href="#cb5-717" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> id <span class="op">=</span> d3<span class="op">.</span><span class="fu">randomInt</span>(<span class="dv">100000</span><span class="op">,</span> <span class="dv">1000000</span>)()<span class="op">;</span></span>
<span id="cb5-718"><a href="#cb5-718" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> params <span class="op">=</span> { <span class="dt">q</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">p</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">es</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">ed</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">t</span><span class="op">:</span> <span class="kw">null</span> }<span class="op">;</span></span>
<span id="cb5-719"><a href="#cb5-719" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> axisTitles <span class="op">=</span> { <span class="dt">x</span><span class="op">:</span> <span class="st">"Output"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="st">"$/unit"</span> }<span class="op">;</span></span>
<span id="cb5-720"><a href="#cb5-720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-721"><a href="#cb5-721" aria-hidden="true" tabindex="-1"></a>  params<span class="op">.</span><span class="at">es</span> <span class="op">=</span> <span class="fl">1.5</span><span class="op">;</span></span>
<span id="cb5-722"><a href="#cb5-722" aria-hidden="true" tabindex="-1"></a>  params<span class="op">.</span><span class="at">ed</span> <span class="op">=</span> <span class="op">-</span><span class="fl">1.25</span><span class="op">;</span></span>
<span id="cb5-723"><a href="#cb5-723" aria-hidden="true" tabindex="-1"></a>  params<span class="op">.</span><span class="at">t</span> <span class="op">=</span> <span class="op">.</span><span class="dv">8</span><span class="op">;</span></span>
<span id="cb5-724"><a href="#cb5-724" aria-hidden="true" tabindex="-1"></a>  params<span class="op">.</span><span class="at">q</span> <span class="op">=</span> <span class="fu">qStar</span>(params)<span class="op">;</span></span>
<span id="cb5-725"><a href="#cb5-725" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> qtStar <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(<span class="op">-</span><span class="fl">16.58</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">pow</span>(params<span class="op">.</span><span class="at">t</span><span class="op">,</span> <span class="op">.</span><span class="dv">78</span>) <span class="op">+</span> <span class="fl">46.44</span>)<span class="op">;</span></span>
<span id="cb5-726"><a href="#cb5-726" aria-hidden="true" tabindex="-1"></a>  params<span class="op">.</span><span class="at">p</span> <span class="op">=</span> <span class="fu">supplyFxn</span>(params)<span class="op">;</span></span>
<span id="cb5-727"><a href="#cb5-727" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-728"><a href="#cb5-728" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yScaler <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb5-729"><a href="#cb5-729" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> max<span class="op">.</span><span class="at">p</span>])</span>
<span id="cb5-730"><a href="#cb5-730" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([dim<span class="op">.</span><span class="at">height</span><span class="op">,</span> padding<span class="op">.</span><span class="at">top</span>])<span class="op">;</span></span>
<span id="cb5-731"><a href="#cb5-731" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-732"><a href="#cb5-732" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Diagram</span></span>
<span id="cb5-733"><a href="#cb5-733" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-734"><a href="#cb5-734" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> container <span class="op">=</span> d3<span class="op">.</span><span class="fu">create</span>(<span class="st">"div"</span>)</span>
<span id="cb5-735"><a href="#cb5-735" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"diagram"</span>)<span class="op">;</span></span>
<span id="cb5-736"><a href="#cb5-736" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-737"><a href="#cb5-737" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> container<span class="op">.</span><span class="fu">append</span>(<span class="st">"svg"</span>)</span>
<span id="cb5-738"><a href="#cb5-738" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> <span class="st">"100%"</span>)</span>
<span id="cb5-739"><a href="#cb5-739" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [</span>
<span id="cb5-740"><a href="#cb5-740" aria-hidden="true" tabindex="-1"></a>      <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> </span>
<span id="cb5-741"><a href="#cb5-741" aria-hidden="true" tabindex="-1"></a>      dim<span class="op">.</span><span class="at">width</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">right</span><span class="op">,</span> </span>
<span id="cb5-742"><a href="#cb5-742" aria-hidden="true" tabindex="-1"></a>      dim<span class="op">.</span><span class="at">height</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">bottom</span></span>
<span id="cb5-743"><a href="#cb5-743" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb5-744"><a href="#cb5-744" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(drawBackground)<span class="op">;</span></span>
<span id="cb5-745"><a href="#cb5-745" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-746"><a href="#cb5-746" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> panel <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb5-747"><a href="#cb5-747" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span> margin<span class="op">.</span><span class="at">left</span> <span class="sc">}</span><span class="vs">,</span><span class="sc">${</span> margin<span class="op">.</span><span class="at">top</span> <span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb5-748"><a href="#cb5-748" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-749"><a href="#cb5-749" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> cs <span class="op">=</span> panel<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb5-750"><a href="#cb5-750" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clipWide<span class="op">,</span> id)</span>
<span id="cb5-751"><a href="#cb5-751" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addAreaCurve<span class="op">,</span> id<span class="op">,</span> md<span class="op">,</span> { <span class="dt">q</span><span class="op">:</span> qtStar<span class="op">,</span> <span class="dt">ed</span><span class="op">:</span> params<span class="op">.</span><span class="at">ed</span> }<span class="op">,</span> yScaler)<span class="op">;</span></span>
<span id="cb5-752"><a href="#cb5-752" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-753"><a href="#cb5-753" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> ps <span class="op">=</span> panel<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb5-754"><a href="#cb5-754" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addAreaCurve<span class="op">,</span> id<span class="op">,</span> xs<span class="op">,</span> { <span class="dt">q</span><span class="op">:</span> qtStar<span class="op">,</span> <span class="dt">es</span><span class="op">:</span> params<span class="op">.</span><span class="at">es</span> }<span class="op">,</span> yScaler)<span class="op">;</span></span>
<span id="cb5-755"><a href="#cb5-755" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-756"><a href="#cb5-756" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> dwlConsumer <span class="op">=</span> panel<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb5-757"><a href="#cb5-757" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"area-dwl"</span>)</span>
<span id="cb5-758"><a href="#cb5-758" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addAreaCurve<span class="op">,</span> id<span class="op">,</span> md<span class="op">,</span> { <span class="dt">ed</span><span class="op">:</span> params<span class="op">.</span><span class="at">ed</span> }<span class="op">,</span> yScaler<span class="op">,</span> <span class="dv">33</span><span class="op">,</span> <span class="dv">46</span>)<span class="op">;</span></span>
<span id="cb5-759"><a href="#cb5-759" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-760"><a href="#cb5-760" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> dwlProducer <span class="op">=</span> panel<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb5-761"><a href="#cb5-761" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"area-dwl"</span>)</span>
<span id="cb5-762"><a href="#cb5-762" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addAreaCurve<span class="op">,</span> id<span class="op">,</span> xs<span class="op">,</span> { <span class="dt">es</span><span class="op">:</span> params<span class="op">.</span><span class="at">es</span> }<span class="op">,</span> yScaler<span class="op">,</span> <span class="dv">33</span><span class="op">,</span> <span class="dv">46</span>)<span class="op">;</span></span>
<span id="cb5-763"><a href="#cb5-763" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-764"><a href="#cb5-764" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> revenue <span class="op">=</span> panel<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb5-765"><a href="#cb5-765" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addAreaBox<span class="op">,</span> </span>
<span id="cb5-766"><a href="#cb5-766" aria-hidden="true" tabindex="-1"></a>      id<span class="op">,</span> </span>
<span id="cb5-767"><a href="#cb5-767" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">id</span><span class="op">:</span> <span class="st">"revenue"</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Government revenues"</span> }<span class="op">,</span> </span>
<span id="cb5-768"><a href="#cb5-768" aria-hidden="true" tabindex="-1"></a>      { </span>
<span id="cb5-769"><a href="#cb5-769" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x1</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> </span>
<span id="cb5-770"><a href="#cb5-770" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y1</span><span class="op">:</span> <span class="fu">yScaler</span>(<span class="fu">supplyFxn</span>({ <span class="dt">q</span><span class="op">:</span> qtStar<span class="op">,</span> <span class="dt">es</span><span class="op">:</span> params<span class="op">.</span><span class="at">es</span> }))<span class="op">,</span> </span>
<span id="cb5-771"><a href="#cb5-771" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x2</span><span class="op">:</span> <span class="fu">xScaler</span>(qtStar)<span class="op">,</span> </span>
<span id="cb5-772"><a href="#cb5-772" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y2</span><span class="op">:</span> <span class="fu">yScaler</span>(<span class="fu">demandFxn</span>({ <span class="dt">q</span><span class="op">:</span> qtStar<span class="op">,</span> <span class="dt">ed</span><span class="op">:</span> params<span class="op">.</span><span class="at">ed</span> })) </span>
<span id="cb5-773"><a href="#cb5-773" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-774"><a href="#cb5-774" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb5-775"><a href="#cb5-775" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-776"><a href="#cb5-776" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> lostSurplusRevenueDemand <span class="op">=</span> panel<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb5-777"><a href="#cb5-777" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addAreaBox<span class="op">,</span> </span>
<span id="cb5-778"><a href="#cb5-778" aria-hidden="true" tabindex="-1"></a>      id<span class="op">,</span> </span>
<span id="cb5-779"><a href="#cb5-779" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">id</span><span class="op">:</span> <span class="st">"dwl-consumer-revenue"</span> }<span class="op">,</span> </span>
<span id="cb5-780"><a href="#cb5-780" aria-hidden="true" tabindex="-1"></a>      { </span>
<span id="cb5-781"><a href="#cb5-781" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x1</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> </span>
<span id="cb5-782"><a href="#cb5-782" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y1</span><span class="op">:</span> <span class="fu">yScaler</span>(<span class="fu">demandFxn</span>(params))<span class="op">,</span> </span>
<span id="cb5-783"><a href="#cb5-783" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x2</span><span class="op">:</span> <span class="fu">xScaler</span>(qtStar)<span class="op">,</span> </span>
<span id="cb5-784"><a href="#cb5-784" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y2</span><span class="op">:</span> <span class="fu">yScaler</span>(<span class="fu">demandFxn</span>({ <span class="dt">q</span><span class="op">:</span> qtStar<span class="op">,</span> <span class="dt">ed</span><span class="op">:</span> params<span class="op">.</span><span class="at">ed</span> })) </span>
<span id="cb5-785"><a href="#cb5-785" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-786"><a href="#cb5-786" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb5-787"><a href="#cb5-787" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-788"><a href="#cb5-788" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="fu">demandFxn</span>({ <span class="dt">q</span><span class="op">:</span> qtStar<span class="op">,</span> <span class="dt">ed</span><span class="op">:</span> params<span class="op">.</span><span class="at">ed</span> }))</span>
<span id="cb5-789"><a href="#cb5-789" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-790"><a href="#cb5-790" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> lostSurplusRevenueSupply <span class="op">=</span> panel<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb5-791"><a href="#cb5-791" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addAreaBox<span class="op">,</span> </span>
<span id="cb5-792"><a href="#cb5-792" aria-hidden="true" tabindex="-1"></a>      id<span class="op">,</span> </span>
<span id="cb5-793"><a href="#cb5-793" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">id</span><span class="op">:</span> <span class="st">"dwl-producer-revenue"</span> }<span class="op">,</span> </span>
<span id="cb5-794"><a href="#cb5-794" aria-hidden="true" tabindex="-1"></a>      { </span>
<span id="cb5-795"><a href="#cb5-795" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x1</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> </span>
<span id="cb5-796"><a href="#cb5-796" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y1</span><span class="op">:</span> <span class="fu">yScaler</span>(<span class="fu">supplyFxn</span>(params))<span class="op">,</span> </span>
<span id="cb5-797"><a href="#cb5-797" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x2</span><span class="op">:</span> <span class="fu">xScaler</span>(qtStar)<span class="op">,</span> </span>
<span id="cb5-798"><a href="#cb5-798" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y2</span><span class="op">:</span> <span class="fu">yScaler</span>(<span class="fu">supplyFxn</span>({ <span class="dt">q</span><span class="op">:</span> qtStar<span class="op">,</span> <span class="dt">es</span><span class="op">:</span> params<span class="op">.</span><span class="at">es</span> })) </span>
<span id="cb5-799"><a href="#cb5-799" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-800"><a href="#cb5-800" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb5-801"><a href="#cb5-801" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-802"><a href="#cb5-802" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> supplyTaxedCurve <span class="op">=</span> panel<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb5-803"><a href="#cb5-803" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clip<span class="op">,</span> id)</span>
<span id="cb5-804"><a href="#cb5-804" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurveFull<span class="op">,</span> id<span class="op">,</span> xst<span class="op">,</span> params<span class="op">,</span> yScaler)<span class="op">;</span></span>
<span id="cb5-805"><a href="#cb5-805" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-806"><a href="#cb5-806" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> supplyTaxedCurveLabel <span class="op">=</span> panel<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb5-807"><a href="#cb5-807" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(</span>
<span id="cb5-808"><a href="#cb5-808" aria-hidden="true" tabindex="-1"></a>      addLabel<span class="op">,</span> <span class="st">"Supply with tariff"</span><span class="op">,</span> </span>
<span id="cb5-809"><a href="#cb5-809" aria-hidden="true" tabindex="-1"></a>      <span class="fu">xScaler</span>(<span class="dv">70</span>) <span class="op">-</span> <span class="dv">15</span><span class="op">,</span> </span>
<span id="cb5-810"><a href="#cb5-810" aria-hidden="true" tabindex="-1"></a>      <span class="fu">yScaler</span>(<span class="fu">supplyTaxedFxn</span>({ <span class="dt">q</span><span class="op">:</span> <span class="dv">70</span><span class="op">,</span> <span class="dt">es</span><span class="op">:</span> params<span class="op">.</span><span class="at">es</span><span class="op">,</span> <span class="dt">t</span><span class="op">:</span> params<span class="op">.</span><span class="at">t</span> }))<span class="op">,</span></span>
<span id="cb5-811"><a href="#cb5-811" aria-hidden="true" tabindex="-1"></a>      <span class="st">"end"</span></span>
<span id="cb5-812"><a href="#cb5-812" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb5-813"><a href="#cb5-813" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-814"><a href="#cb5-814" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> supplyCurve <span class="op">=</span> panel<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb5-815"><a href="#cb5-815" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clip<span class="op">,</span> id)</span>
<span id="cb5-816"><a href="#cb5-816" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurveFull<span class="op">,</span> id<span class="op">,</span> xs<span class="op">,</span> params<span class="op">,</span> yScaler)</span>
<span id="cb5-817"><a href="#cb5-817" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(</span>
<span id="cb5-818"><a href="#cb5-818" aria-hidden="true" tabindex="-1"></a>      addLabel<span class="op">,</span> <span class="st">"Export supply"</span><span class="op">,</span> </span>
<span id="cb5-819"><a href="#cb5-819" aria-hidden="true" tabindex="-1"></a>      <span class="fu">xScaler</span>(<span class="dv">70</span>) <span class="op">+</span> <span class="dv">15</span><span class="op">,</span> </span>
<span id="cb5-820"><a href="#cb5-820" aria-hidden="true" tabindex="-1"></a>      <span class="fu">yScaler</span>(<span class="fu">supplyFxn</span>({ <span class="dt">q</span><span class="op">:</span> <span class="dv">70</span><span class="op">,</span> <span class="dt">es</span><span class="op">:</span> params<span class="op">.</span><span class="at">es</span> })) <span class="op">+</span> <span class="dv">10</span><span class="op">,</span></span>
<span id="cb5-821"><a href="#cb5-821" aria-hidden="true" tabindex="-1"></a>      <span class="st">"start"</span></span>
<span id="cb5-822"><a href="#cb5-822" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb5-823"><a href="#cb5-823" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-824"><a href="#cb5-824" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> demandCurve <span class="op">=</span> panel<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb5-825"><a href="#cb5-825" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clip<span class="op">,</span> id)</span>
<span id="cb5-826"><a href="#cb5-826" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurveFull<span class="op">,</span> id<span class="op">,</span> md<span class="op">,</span> params<span class="op">,</span> yScaler)</span>
<span id="cb5-827"><a href="#cb5-827" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(</span>
<span id="cb5-828"><a href="#cb5-828" aria-hidden="true" tabindex="-1"></a>      addLabel<span class="op">,</span> <span class="st">"Import demand"</span><span class="op">,</span> </span>
<span id="cb5-829"><a href="#cb5-829" aria-hidden="true" tabindex="-1"></a>      <span class="fu">xScaler</span>(<span class="dv">70</span>)<span class="op">,</span></span>
<span id="cb5-830"><a href="#cb5-830" aria-hidden="true" tabindex="-1"></a>      <span class="fu">yScaler</span>(<span class="fu">demandFxn</span>({ <span class="dt">q</span><span class="op">:</span> <span class="dv">50</span><span class="op">,</span> <span class="dt">ed</span><span class="op">:</span> params<span class="op">.</span><span class="at">ed</span> }))</span>
<span id="cb5-831"><a href="#cb5-831" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb5-832"><a href="#cb5-832" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-833"><a href="#cb5-833" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> supplyGuide <span class="op">=</span> panel<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb5-834"><a href="#cb5-834" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(yGuide<span class="op">,</span> xs<span class="op">,</span> { <span class="dt">q</span><span class="op">:</span> qtStar<span class="op">,</span> <span class="dt">es</span><span class="op">:</span> params<span class="op">.</span><span class="at">es</span> }<span class="op">,</span> yScaler<span class="op">,</span> <span class="st">",.1f"</span>)<span class="op">;</span></span>
<span id="cb5-835"><a href="#cb5-835" aria-hidden="true" tabindex="-1"></a>  supplyGuide<span class="op">.</span><span class="fu">select</span>(<span class="st">"text"</span>)</span>
<span id="cb5-836"><a href="#cb5-836" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"#b3b3b3"</span>)<span class="op">;</span></span>
<span id="cb5-837"><a href="#cb5-837" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-838"><a href="#cb5-838" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> demandGuidesTaxed <span class="op">=</span> panel<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb5-839"><a href="#cb5-839" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(yGuide<span class="op">,</span> md<span class="op">,</span> { <span class="dt">q</span><span class="op">:</span> qtStar<span class="op">,</span> <span class="dt">ed</span><span class="op">:</span> params<span class="op">.</span><span class="at">ed</span> }<span class="op">,</span> yScaler<span class="op">,</span> <span class="st">",.1f"</span>)</span>
<span id="cb5-840"><a href="#cb5-840" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(xGuides<span class="op">,</span> xst<span class="op">,</span> { <span class="dt">q</span><span class="op">:</span> qtStar<span class="op">,</span> <span class="dt">es</span><span class="op">:</span> params<span class="op">.</span><span class="at">es</span><span class="op">,</span> <span class="dt">t</span><span class="op">:</span> params<span class="op">.</span><span class="at">t</span> }<span class="op">,</span> yScaler)<span class="op">;</span></span>
<span id="cb5-841"><a href="#cb5-841" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-842"><a href="#cb5-842" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> guidesEq <span class="op">=</span> panel<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb5-843"><a href="#cb5-843" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(yGuide<span class="op">,</span> xs<span class="op">,</span> params<span class="op">,</span> yScaler<span class="op">,</span> <span class="st">",.1f"</span>)</span>
<span id="cb5-844"><a href="#cb5-844" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(xGuides<span class="op">,</span> xs<span class="op">,</span> params<span class="op">,</span> yScaler)<span class="op">;</span></span>
<span id="cb5-845"><a href="#cb5-845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-846"><a href="#cb5-846" aria-hidden="true" tabindex="-1"></a>  panel<span class="op">.</span><span class="fu">call</span>(panelAxes<span class="op">,</span> axisTitles)<span class="op">;</span></span>
<span id="cb5-847"><a href="#cb5-847" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-848"><a href="#cb5-848" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Scroll animations</span></span>
<span id="cb5-849"><a href="#cb5-849" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-850"><a href="#cb5-850" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> pts <span class="op">=</span> [</span>
<span id="cb5-851"><a href="#cb5-851" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">start</span><span class="op">:</span> <span class="op">.</span><span class="dv">125</span><span class="op">,</span> <span class="dt">end</span><span class="op">:</span> <span class="op">.</span><span class="dv">145</span> }<span class="op">,</span>  <span class="co">// 0</span></span>
<span id="cb5-852"><a href="#cb5-852" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">start</span><span class="op">:</span> <span class="op">.</span><span class="dv">275</span><span class="op">,</span> <span class="dt">end</span><span class="op">:</span> <span class="op">.</span><span class="dv">295</span> }<span class="op">,</span>  <span class="co">// 1</span></span>
<span id="cb5-853"><a href="#cb5-853" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">start</span><span class="op">:</span> <span class="op">.</span><span class="dv">430</span><span class="op">,</span> <span class="dt">end</span><span class="op">:</span> <span class="op">.</span><span class="dv">450</span> }<span class="op">,</span>  <span class="co">// 2</span></span>
<span id="cb5-854"><a href="#cb5-854" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">start</span><span class="op">:</span> <span class="op">.</span><span class="dv">590</span><span class="op">,</span> <span class="dt">end</span><span class="op">:</span> <span class="op">.</span><span class="dv">610</span> }<span class="op">,</span>  <span class="co">// 3</span></span>
<span id="cb5-855"><a href="#cb5-855" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">start</span><span class="op">:</span> <span class="op">.</span><span class="dv">740</span><span class="op">,</span> <span class="dt">end</span><span class="op">:</span> <span class="op">.</span><span class="dv">760</span> }<span class="op">,</span>  <span class="co">// 4</span></span>
<span id="cb5-856"><a href="#cb5-856" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">start</span><span class="op">:</span> <span class="op">.</span><span class="dv">895</span><span class="op">,</span> <span class="dt">end</span><span class="op">:</span> <span class="op">.</span><span class="dv">915</span> }<span class="op">,</span>  <span class="co">// 5</span></span>
<span id="cb5-857"><a href="#cb5-857" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb5-858"><a href="#cb5-858" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-859"><a href="#cb5-859" aria-hidden="true" tabindex="-1"></a>  cs<span class="op">.</span><span class="fu">style</span>(<span class="st">"opacity"</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb5-860"><a href="#cb5-860" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">fadeOut</span>(pts[<span class="dv">0</span>])(prog)<span class="op">;</span></span>
<span id="cb5-861"><a href="#cb5-861" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb5-862"><a href="#cb5-862" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-863"><a href="#cb5-863" aria-hidden="true" tabindex="-1"></a>  ps<span class="op">.</span><span class="fu">style</span>(<span class="st">"opacity"</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb5-864"><a href="#cb5-864" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">fadeOut</span>(pts[<span class="dv">0</span>])(prog)<span class="op">;</span></span>
<span id="cb5-865"><a href="#cb5-865" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb5-866"><a href="#cb5-866" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-867"><a href="#cb5-867" aria-hidden="true" tabindex="-1"></a>  revenue<span class="op">.</span><span class="fu">style</span>(<span class="st">"opacity"</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb5-868"><a href="#cb5-868" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">fadeOut</span>(pts[<span class="dv">1</span>])(prog)<span class="op">;</span></span>
<span id="cb5-869"><a href="#cb5-869" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb5-870"><a href="#cb5-870" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-871"><a href="#cb5-871" aria-hidden="true" tabindex="-1"></a>  dwlProducer<span class="op">.</span><span class="fu">style</span>(<span class="st">"opacity"</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb5-872"><a href="#cb5-872" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (prog <span class="op">&gt;=</span> pts[<span class="dv">1</span>]<span class="op">.</span><span class="at">start</span> <span class="op">&amp;&amp;</span> prog <span class="op">&lt;</span> pts[<span class="dv">3</span>]<span class="op">.</span><span class="at">start</span>) {</span>
<span id="cb5-873"><a href="#cb5-873" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="fu">fadeOut</span>(pts[<span class="dv">1</span>])(prog)<span class="op">;</span></span>
<span id="cb5-874"><a href="#cb5-874" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (prog <span class="op">&gt;=</span> pts[<span class="dv">3</span>]<span class="op">.</span><span class="at">start</span> <span class="op">&amp;&amp;</span> prog <span class="op">&lt;</span> pts[<span class="dv">4</span>]<span class="op">.</span><span class="at">start</span>) {</span>
<span id="cb5-875"><a href="#cb5-875" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="fu">fadeIn</span>(pts[<span class="dv">3</span>])(prog)<span class="op">;</span></span>
<span id="cb5-876"><a href="#cb5-876" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (prog <span class="op">&gt;=</span> pts[<span class="dv">4</span>]<span class="op">.</span><span class="at">start</span>) {</span>
<span id="cb5-877"><a href="#cb5-877" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="fu">fadeOut</span>(pts[<span class="dv">4</span>])(prog)<span class="op">;</span></span>
<span id="cb5-878"><a href="#cb5-878" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-879"><a href="#cb5-879" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb5-880"><a href="#cb5-880" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-881"><a href="#cb5-881" aria-hidden="true" tabindex="-1"></a>  dwlConsumer<span class="op">.</span><span class="fu">style</span>(<span class="st">"opacity"</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb5-882"><a href="#cb5-882" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (prog <span class="op">&gt;=</span> pts[<span class="dv">1</span>]<span class="op">.</span><span class="at">start</span> <span class="op">&amp;&amp;</span> prog <span class="op">&lt;</span> pts[<span class="dv">4</span>]<span class="op">.</span><span class="at">start</span>) {</span>
<span id="cb5-883"><a href="#cb5-883" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="fu">fadeOut</span>(pts[<span class="dv">1</span>])(prog)<span class="op">;</span></span>
<span id="cb5-884"><a href="#cb5-884" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (prog <span class="op">&gt;=</span> pts[<span class="dv">4</span>]<span class="op">.</span><span class="at">start</span>) {</span>
<span id="cb5-885"><a href="#cb5-885" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="fu">fadeIn</span>(pts[<span class="dv">4</span>])(prog)<span class="op">;</span></span>
<span id="cb5-886"><a href="#cb5-886" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb5-887"><a href="#cb5-887" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb5-888"><a href="#cb5-888" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-889"><a href="#cb5-889" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb5-890"><a href="#cb5-890" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-891"><a href="#cb5-891" aria-hidden="true" tabindex="-1"></a>  lostSurplusRevenueSupply<span class="op">.</span><span class="fu">style</span>(<span class="st">"opacity"</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb5-892"><a href="#cb5-892" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (prog <span class="op">&gt;=</span> pts[<span class="dv">1</span>]<span class="op">.</span><span class="at">start</span> <span class="op">&amp;&amp;</span> prog <span class="op">&lt;</span> pts[<span class="dv">2</span>]<span class="op">.</span><span class="at">start</span>) {</span>
<span id="cb5-893"><a href="#cb5-893" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="fu">fadeIn</span>(pts[<span class="dv">1</span>])(prog)<span class="op">;</span></span>
<span id="cb5-894"><a href="#cb5-894" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (prog <span class="op">&gt;=</span> pts[<span class="dv">2</span>]<span class="op">.</span><span class="at">start</span> <span class="op">&amp;&amp;</span> prog <span class="op">&lt;</span> pts[<span class="dv">5</span>]<span class="op">.</span><span class="at">start</span>) {</span>
<span id="cb5-895"><a href="#cb5-895" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="fu">fadeOut</span>(pts[<span class="dv">2</span>])(prog)<span class="op">;</span></span>
<span id="cb5-896"><a href="#cb5-896" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (prog <span class="op">&gt;=</span> pts[<span class="dv">5</span>]<span class="op">.</span><span class="at">start</span>) {</span>
<span id="cb5-897"><a href="#cb5-897" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="fu">fadeIn</span>(pts[<span class="dv">5</span>])(prog)<span class="op">;</span></span>
<span id="cb5-898"><a href="#cb5-898" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb5-899"><a href="#cb5-899" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb5-900"><a href="#cb5-900" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-901"><a href="#cb5-901" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb5-902"><a href="#cb5-902" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-903"><a href="#cb5-903" aria-hidden="true" tabindex="-1"></a>  lostSurplusRevenueDemand<span class="op">.</span><span class="fu">style</span>(<span class="st">"opacity"</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb5-904"><a href="#cb5-904" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (prog <span class="op">&gt;=</span> pts[<span class="dv">2</span>]<span class="op">.</span><span class="at">start</span> <span class="op">&amp;&amp;</span> prog <span class="op">&lt;</span> pts[<span class="dv">3</span>]<span class="op">.</span><span class="at">start</span>) {</span>
<span id="cb5-905"><a href="#cb5-905" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="fu">fadeIn</span>(pts[<span class="dv">2</span>])(prog)<span class="op">;</span></span>
<span id="cb5-906"><a href="#cb5-906" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (prog <span class="op">&gt;=</span> pts[<span class="dv">3</span>]<span class="op">.</span><span class="at">start</span>) {</span>
<span id="cb5-907"><a href="#cb5-907" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="fu">fadeOut</span>(pts[<span class="dv">3</span>])(prog)<span class="op">;</span></span>
<span id="cb5-908"><a href="#cb5-908" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb5-909"><a href="#cb5-909" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb5-910"><a href="#cb5-910" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-911"><a href="#cb5-911" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb5-912"><a href="#cb5-912" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-913"><a href="#cb5-913" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> container<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb5-914"><a href="#cb5-914" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-5" data-nodetype="expression">

</div>
</div>
</div>
</div>
</div>
</div>
</div>
<p>The exact areas of these shapes can be calculated by using real world data to trace out the market supply and demand curves. This relatively simple toolkit can then be used to weigh costs and benefits given any import tax. For instance, it has <a href="https://pubs.aeaweb.org/doi/pdfplus/10.1257/jep.33.4.187">been estimated</a> that the first Trump administration’s tariffs back in 2018 raised $3.2 billion in taxes per month while imposing $1.4 billion in deadweight loss per month. In a future post, I will show how the slopes of the curves and the size of the tariff affect the sizes of these areas and the resulting cost–benefit calculus, but for now, let’s wrap up with a few caveats to this approach.</p>
<p>First, all of this is under a partial equilibrium setting. Economists say <em>partial</em> equilibrium when examining a single market while ignoring all others. In the real world, things aren’t so clean because different markets can affect each other. If you place an import tax on foreign cars, for example, domestic consumers might opt to buy domestic cars instead. One market shrinks while another expands. On the other hand, more expensive imports might force cash-strapped consumers to cut back on discretionary spending in general, so the tariff shrinks not just one market but many others. A full cost–benefit accounting ideally incorporates gains and losses in the economy as a whole.</p>
<p>Second, imposing tariffs on others generally elicits some form of retaliatory action. China for instance <a href="https://www.reuters.com/world/china/china-increase-tariffs-us-goods-125-up-84-finance-ministry-says-2025-04-11/">has matched</a> U.S. tariff hikes tit-for-tat up to 125%. Thus, when weighing any tariff policy, losses for domestic exporters from retaliatory action should be accounted for.</p>
<p>Finally, the time horizon of this analysis is firmly within the short run. Tariff policy is often less about raising tax revenues as it is part of a broader industrial policy to grow domestic firms over several years, even decades. The cost–benefit analysis we have developed here does not take such long-term goals into account.</p>
<hr>
<p>Tariffs are a terribly dry subject to be talking about at length, so as a palette cleanser, let me end this post with a fun bit of irreverent Berlin history from Barney White-Spunner’s <a href="https://www.amazon.de/Berlin-Biography-City-Barney-White-Spunner/dp/1471181537">book</a>. In the 14th century, the area of Berlin was part of the Margraviate of Brandenburg ruled by the House of Ascania. This line died out in 1319, resulting in a power struggle between the Saxons and the Wittelsbach dynasty.</p>
<p>Caught in the turmoil was a hapless priest named Nikolaus, the ranking clergyman and a vocal Saxon supporter in a city that was staunchly pro-Wittelsbach. He was beaten to death by a mob in 1325 somewhere around what is today Alexanderplatz. Outraged, the pope (incidentally anti-Wittelsbach) excommunicated Berlin for 20 years and demanded an atonement cross to mark the scene of the crime. Berliners dragged their feet and eventually put up a hilariously tiny unmarked cross. It now stands inconspicuous and graffitied by the Marienkirche entrance.</p>
<p><img src="atonementcross.jpg" class="img-fluid"></p>
<p>May your petty acts of malicious compliance also survive for the next 700 years. Happy Easter weekend! <img src="../../images/logo-icon.png" class="endmark img-fluid"></p>
<div class="cell">
<details class="code-fold hidden">
<summary>Parameters</summary>
<div class="sourceCode cell-code hidden" id="cb6" data-startfrom="944" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 943;"><span id="cb6-944"><a href="#cb6-944" aria-hidden="true" tabindex="-1"></a>prog <span class="op">=</span> crProgressBlock<span class="op">;</span></span>
<span id="cb6-945"><a href="#cb6-945" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-946"><a href="#cb6-946" aria-hidden="true" tabindex="-1"></a>dim <span class="op">=</span> ({ <span class="dt">width</span><span class="op">:</span> <span class="dv">400</span><span class="op">,</span> <span class="dt">height</span><span class="op">:</span> <span class="dv">280</span> })<span class="op">;</span></span>
<span id="cb6-947"><a href="#cb6-947" aria-hidden="true" tabindex="-1"></a>padding <span class="op">=</span> ({ <span class="dt">top</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dt">right</span><span class="op">:</span> <span class="dv">10</span> })<span class="op">;</span></span>
<span id="cb6-948"><a href="#cb6-948" aria-hidden="true" tabindex="-1"></a>margin <span class="op">=</span> ({ <span class="dt">top</span><span class="op">:</span> <span class="dv">50</span><span class="op">,</span> <span class="dt">right</span><span class="op">:</span> <span class="dv">100</span><span class="op">,</span> <span class="dt">bottom</span><span class="op">:</span> <span class="dv">40</span><span class="op">,</span> <span class="dt">left</span><span class="op">:</span> <span class="dv">70</span> })<span class="op">;</span></span>
<span id="cb6-949"><a href="#cb6-949" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-950"><a href="#cb6-950" aria-hidden="true" tabindex="-1"></a>blue <span class="op">=</span> ({ </span>
<span id="cb6-951"><a href="#cb6-951" aria-hidden="true" tabindex="-1"></a>  <span class="dt">base</span><span class="op">:</span> <span class="st">"#4889ab"</span><span class="op">,</span> </span>
<span id="cb6-952"><a href="#cb6-952" aria-hidden="true" tabindex="-1"></a>  <span class="dt">dull</span><span class="op">:</span> <span class="st">"#A2C4D2"</span><span class="op">,</span> </span>
<span id="cb6-953"><a href="#cb6-953" aria-hidden="true" tabindex="-1"></a>  <span class="dt">baseSelect</span><span class="op">:</span> <span class="st">"#0C6291"</span><span class="op">,</span> </span>
<span id="cb6-954"><a href="#cb6-954" aria-hidden="true" tabindex="-1"></a>  <span class="dt">dullSelect</span><span class="op">:</span> <span class="st">"#669DB8"</span></span>
<span id="cb6-955"><a href="#cb6-955" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb6-956"><a href="#cb6-956" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-957"><a href="#cb6-957" aria-hidden="true" tabindex="-1"></a>red <span class="op">=</span> ({ </span>
<span id="cb6-958"><a href="#cb6-958" aria-hidden="true" tabindex="-1"></a>  <span class="dt">base</span><span class="op">:</span> <span class="st">"#C85B89"</span><span class="op">,</span> </span>
<span id="cb6-959"><a href="#cb6-959" aria-hidden="true" tabindex="-1"></a>  <span class="dt">dull</span><span class="op">:</span> <span class="st">"#E29FBC"</span><span class="op">,</span> </span>
<span id="cb6-960"><a href="#cb6-960" aria-hidden="true" tabindex="-1"></a>  <span class="dt">baseSelect</span><span class="op">:</span> <span class="st">"#B13D70"</span><span class="op">,</span> </span>
<span id="cb6-961"><a href="#cb6-961" aria-hidden="true" tabindex="-1"></a>  <span class="dt">dullSelect</span><span class="op">:</span> <span class="st">"#D1729A"</span> </span>
<span id="cb6-962"><a href="#cb6-962" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb6-963"><a href="#cb6-963" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-964"><a href="#cb6-964" aria-hidden="true" tabindex="-1"></a>green <span class="op">=</span> ({ </span>
<span id="cb6-965"><a href="#cb6-965" aria-hidden="true" tabindex="-1"></a>  <span class="dt">base</span><span class="op">:</span> <span class="st">"#71B795"</span><span class="op">,</span> </span>
<span id="cb6-966"><a href="#cb6-966" aria-hidden="true" tabindex="-1"></a>  <span class="dt">dull</span><span class="op">:</span> <span class="st">"#B4D7C6"</span><span class="op">,</span> </span>
<span id="cb6-967"><a href="#cb6-967" aria-hidden="true" tabindex="-1"></a>  <span class="dt">baseSelect</span><span class="op">:</span> <span class="st">"#418462"</span><span class="op">,</span> </span>
<span id="cb6-968"><a href="#cb6-968" aria-hidden="true" tabindex="-1"></a>  <span class="dt">dullSelect</span><span class="op">:</span> <span class="st">"#73AA8E"</span> </span>
<span id="cb6-969"><a href="#cb6-969" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb6-970"><a href="#cb6-970" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-971"><a href="#cb6-971" aria-hidden="true" tabindex="-1"></a>gray <span class="op">=</span> ({ </span>
<span id="cb6-972"><a href="#cb6-972" aria-hidden="true" tabindex="-1"></a>  <span class="dt">base</span><span class="op">:</span> <span class="st">"#DDDDDD"</span><span class="op">,</span> </span>
<span id="cb6-973"><a href="#cb6-973" aria-hidden="true" tabindex="-1"></a>  <span class="dt">dull</span><span class="op">:</span> <span class="st">"#DDDDDD"</span><span class="op">,</span> </span>
<span id="cb6-974"><a href="#cb6-974" aria-hidden="true" tabindex="-1"></a>  <span class="dt">baseSelect</span><span class="op">:</span> <span class="st">"#D0D0D0"</span><span class="op">,</span> </span>
<span id="cb6-975"><a href="#cb6-975" aria-hidden="true" tabindex="-1"></a>  <span class="dt">dullSelect</span><span class="op">:</span> <span class="st">"#D0D0D0"</span> </span>
<span id="cb6-976"><a href="#cb6-976" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb6-977"><a href="#cb6-977" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-978"><a href="#cb6-978" aria-hidden="true" tabindex="-1"></a>tooltip <span class="op">=</span> d3<span class="op">.</span><span class="fu">select</span>(<span class="st">"body"</span>)</span>
<span id="cb6-979"><a href="#cb6-979" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">append</span>(<span class="st">"div"</span>)</span>
<span id="cb6-980"><a href="#cb6-980" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"tooltip"</span>)<span class="op">;</span></span>
<span id="cb6-981"><a href="#cb6-981" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-982"><a href="#cb6-982" aria-hidden="true" tabindex="-1"></a>line <span class="op">=</span> d3<span class="op">.</span><span class="fu">line</span>()<span class="op">.</span><span class="fu">curve</span>(d3<span class="op">.</span><span class="at">curveBasis</span>)<span class="op">;</span></span>
<span id="cb6-983"><a href="#cb6-983" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-984"><a href="#cb6-984" aria-hidden="true" tabindex="-1"></a>xScaler <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb6-985"><a href="#cb6-985" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> max<span class="op">.</span><span class="at">q</span>])</span>
<span id="cb6-986"><a href="#cb6-986" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> dim<span class="op">.</span><span class="at">width</span> <span class="op">-</span> padding<span class="op">.</span><span class="at">right</span>])<span class="op">;</span></span>
<span id="cb6-987"><a href="#cb6-987" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-988"><a href="#cb6-988" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">data</span>(fxn<span class="op">,</span> params<span class="op">,</span> yScaler<span class="op">,</span> start <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> end <span class="op">=</span> params<span class="op">.</span><span class="at">q</span>) {</span>
<span id="cb6-989"><a href="#cb6-989" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-990"><a href="#cb6-990" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> q <span class="op">=</span> params<span class="op">.</span><span class="at">q</span><span class="op">,</span> </span>
<span id="cb6-991"><a href="#cb6-991" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> params<span class="op">.</span><span class="at">p</span><span class="op">,</span> </span>
<span id="cb6-992"><a href="#cb6-992" aria-hidden="true" tabindex="-1"></a>    es <span class="op">=</span> params<span class="op">.</span><span class="at">es</span><span class="op">,</span></span>
<span id="cb6-993"><a href="#cb6-993" aria-hidden="true" tabindex="-1"></a>    ed <span class="op">=</span> params<span class="op">.</span><span class="at">ed</span><span class="op">,</span></span>
<span id="cb6-994"><a href="#cb6-994" aria-hidden="true" tabindex="-1"></a>    t <span class="op">=</span> params<span class="op">.</span><span class="at">t</span><span class="op">;</span></span>
<span id="cb6-995"><a href="#cb6-995" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-996"><a href="#cb6-996" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>({ <span class="dt">length</span><span class="op">:</span> end <span class="op">-</span> start <span class="op">+</span> <span class="dv">1</span> }<span class="op">,</span> (_<span class="op">,</span> i) <span class="kw">=&gt;</span> {</span>
<span id="cb6-997"><a href="#cb6-997" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> index <span class="op">=</span> i <span class="op">+</span> start</span>
<span id="cb6-998"><a href="#cb6-998" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> y <span class="op">=</span> <span class="fu">yScaler</span>(<span class="fu">fxn</span>({ <span class="dt">q</span><span class="op">:</span> index<span class="op">,</span> p<span class="op">,</span> es<span class="op">,</span> ed<span class="op">,</span> t })) <span class="op">??</span> <span class="op">-</span><span class="dv">500</span><span class="op">;</span></span>
<span id="cb6-999"><a href="#cb6-999" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> x <span class="op">=</span> (y <span class="op">==</span> <span class="kw">null</span>) <span class="op">?</span> <span class="kw">null</span> <span class="op">:</span> <span class="fu">xScaler</span>(index)<span class="op">;</span></span>
<span id="cb6-1000"><a href="#cb6-1000" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [x<span class="op">,</span> y]<span class="op">;</span></span>
<span id="cb6-1001"><a href="#cb6-1001" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb6-1002"><a href="#cb6-1002" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-1003"><a href="#cb6-1003" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-1004"><a href="#cb6-1004" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">dataMax</span>(fxn<span class="op">,</span> params<span class="op">,</span> yScaler) {</span>
<span id="cb6-1005"><a href="#cb6-1005" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-1006"><a href="#cb6-1006" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> q <span class="op">=</span> max<span class="op">.</span><span class="at">q</span><span class="op">,</span> </span>
<span id="cb6-1007"><a href="#cb6-1007" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> params<span class="op">.</span><span class="at">p</span><span class="op">,</span> </span>
<span id="cb6-1008"><a href="#cb6-1008" aria-hidden="true" tabindex="-1"></a>    es <span class="op">=</span> params<span class="op">.</span><span class="at">es</span><span class="op">,</span></span>
<span id="cb6-1009"><a href="#cb6-1009" aria-hidden="true" tabindex="-1"></a>    ed <span class="op">=</span> params<span class="op">.</span><span class="at">ed</span><span class="op">,</span></span>
<span id="cb6-1010"><a href="#cb6-1010" aria-hidden="true" tabindex="-1"></a>    t <span class="op">=</span> params<span class="op">.</span><span class="at">t</span><span class="op">;</span></span>
<span id="cb6-1011"><a href="#cb6-1011" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-1012"><a href="#cb6-1012" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>({ <span class="dt">length</span><span class="op">:</span> q <span class="op">+</span> <span class="dv">1</span> }<span class="op">,</span> (_<span class="op">,</span> i) <span class="kw">=&gt;</span> {</span>
<span id="cb6-1013"><a href="#cb6-1013" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> y <span class="op">=</span> <span class="fu">yScaler</span>(<span class="fu">fxn</span>({ <span class="dt">q</span><span class="op">:</span> i<span class="op">,</span> p<span class="op">,</span> es<span class="op">,</span> ed<span class="op">,</span> t })) <span class="op">??</span> <span class="op">-</span><span class="dv">500</span><span class="op">;</span></span>
<span id="cb6-1014"><a href="#cb6-1014" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> x <span class="op">=</span> (y <span class="op">==</span> <span class="kw">null</span>) <span class="op">?</span> <span class="kw">null</span> <span class="op">:</span> <span class="fu">xScaler</span>(i)<span class="op">;</span></span>
<span id="cb6-1015"><a href="#cb6-1015" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [x<span class="op">,</span> y]<span class="op">;</span></span>
<span id="cb6-1016"><a href="#cb6-1016" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb6-1017"><a href="#cb6-1017" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-1018"><a href="#cb6-1018" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-1019"><a href="#cb6-1019" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">fadeIn</span>({start<span class="op">,</span> end}) {</span>
<span id="cb6-1020"><a href="#cb6-1020" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb6-1021"><a href="#cb6-1021" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([start<span class="op">,</span> end])</span>
<span id="cb6-1022"><a href="#cb6-1022" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>])</span>
<span id="cb6-1023"><a href="#cb6-1023" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">clamp</span>(<span class="kw">true</span>)<span class="op">;</span></span>
<span id="cb6-1024"><a href="#cb6-1024" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-1025"><a href="#cb6-1025" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-1026"><a href="#cb6-1026" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">fadeOut</span>({start<span class="op">,</span> end}) {</span>
<span id="cb6-1027"><a href="#cb6-1027" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb6-1028"><a href="#cb6-1028" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([start<span class="op">,</span> end])</span>
<span id="cb6-1029"><a href="#cb6-1029" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([<span class="dv">1</span><span class="op">,</span> <span class="dv">0</span>])</span>
<span id="cb6-1030"><a href="#cb6-1030" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">clamp</span>(<span class="kw">true</span>)<span class="op">;</span></span>
<span id="cb6-1031"><a href="#cb6-1031" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-6-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-6-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-6-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-6-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-6-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-6-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-6-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-6-8" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-6-9" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-6-10" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-6-11" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-6-12" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-6-13" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-6-14" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-6-15" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold hidden">
<summary>Curves</summary>
<div class="sourceCode cell-code hidden" id="cb7" data-startfrom="1040" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1039;"><span id="cb7-1040"><a href="#cb7-1040" aria-hidden="true" tabindex="-1"></a>max <span class="op">=</span> ({ <span class="dt">q</span><span class="op">:</span> <span class="dv">95</span><span class="op">,</span> <span class="dt">p</span><span class="op">:</span> <span class="dv">27</span> })<span class="op">;</span></span>
<span id="cb7-1041"><a href="#cb7-1041" aria-hidden="true" tabindex="-1"></a>constant <span class="op">=</span> ({ <span class="dt">as</span><span class="op">:</span> <span class="dv">50</span><span class="op">,</span> <span class="dt">ad</span><span class="op">:</span> <span class="dv">750</span><span class="op">,</span> <span class="dt">bs</span><span class="op">:</span> <span class="dv">3</span><span class="op">,</span> <span class="dt">bd</span><span class="op">:</span> <span class="dv">3</span> })<span class="op">;</span></span>
<span id="cb7-1042"><a href="#cb7-1042" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1043"><a href="#cb7-1043" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">supplyFxn</span>({ q<span class="op">,</span> es } <span class="op">=</span> {}) {</span>
<span id="cb7-1044"><a href="#cb7-1044" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> (<span class="dv">1</span> <span class="op">/</span> constant<span class="op">.</span><span class="at">as</span>) <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">pow</span>(q<span class="op">,</span> es) <span class="op">+</span> constant<span class="op">.</span><span class="at">bs</span><span class="op">;</span></span>
<span id="cb7-1045"><a href="#cb7-1045" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-1046"><a href="#cb7-1046" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1047"><a href="#cb7-1047" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">supplyTaxedFxn</span>({ q<span class="op">,</span> es<span class="op">,</span> t } <span class="op">=</span> {}) {</span>
<span id="cb7-1048"><a href="#cb7-1048" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> (<span class="dv">1</span> <span class="op">+</span> t) <span class="op">*</span> ((<span class="dv">1</span> <span class="op">/</span> constant<span class="op">.</span><span class="at">as</span>) <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">pow</span>(q<span class="op">,</span> es) <span class="op">+</span> constant<span class="op">.</span><span class="at">bs</span>)<span class="op">;</span></span>
<span id="cb7-1049"><a href="#cb7-1049" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-1050"><a href="#cb7-1050" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1051"><a href="#cb7-1051" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">demandFxn</span>({ q<span class="op">,</span> ed } <span class="op">=</span> {}) {</span>
<span id="cb7-1052"><a href="#cb7-1052" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (q <span class="op">===</span> <span class="dv">0</span>) {</span>
<span id="cb7-1053"><a href="#cb7-1053" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> constant<span class="op">.</span><span class="at">ad</span> <span class="op">*</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb7-1054"><a href="#cb7-1054" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb7-1055"><a href="#cb7-1055" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> constant<span class="op">.</span><span class="at">ad</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">pow</span>(q<span class="op">,</span> ed) <span class="op">+</span> constant<span class="op">.</span><span class="at">bd</span><span class="op">;</span></span>
<span id="cb7-1056"><a href="#cb7-1056" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-1057"><a href="#cb7-1057" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-1058"><a href="#cb7-1058" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1059"><a href="#cb7-1059" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">qStar</span>({ es<span class="op">,</span> ed } <span class="op">=</span> {}) {</span>
<span id="cb7-1060"><a href="#cb7-1060" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> rawQ <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">pow</span>(constant<span class="op">.</span><span class="at">as</span> <span class="op">*</span> constant<span class="op">.</span><span class="at">ad</span><span class="op">,</span> <span class="dv">1</span> <span class="op">/</span> (es <span class="op">-</span> ed))<span class="op">;</span></span>
<span id="cb7-1061"><a href="#cb7-1061" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(rawQ)<span class="op">;</span></span>
<span id="cb7-1062"><a href="#cb7-1062" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-1063"><a href="#cb7-1063" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1064"><a href="#cb7-1064" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">qtStar</span>({ es<span class="op">,</span> ed } <span class="op">=</span> {}) {</span>
<span id="cb7-1065"><a href="#cb7-1065" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> rawQ <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">pow</span>(constant<span class="op">.</span><span class="at">as</span> <span class="op">*</span> constant<span class="op">.</span><span class="at">ad</span><span class="op">,</span> <span class="dv">1</span> <span class="op">/</span> (es <span class="op">-</span> ed))<span class="op">;</span></span>
<span id="cb7-1066"><a href="#cb7-1066" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(rawQ)<span class="op">;</span></span>
<span id="cb7-1067"><a href="#cb7-1067" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-1068"><a href="#cb7-1068" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1069"><a href="#cb7-1069" aria-hidden="true" tabindex="-1"></a>xs <span class="op">=</span> ({ </span>
<span id="cb7-1070"><a href="#cb7-1070" aria-hidden="true" tabindex="-1"></a>  <span class="dt">fxn</span><span class="op">:</span> supplyFxn<span class="op">,</span> </span>
<span id="cb7-1071"><a href="#cb7-1071" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="st">"Export supply curve"</span><span class="op">,</span> </span>
<span id="cb7-1072"><a href="#cb7-1072" aria-hidden="true" tabindex="-1"></a>  <span class="dt">areaLabel</span><span class="op">:</span> <span class="st">"Firm surplus"</span><span class="op">,</span></span>
<span id="cb7-1073"><a href="#cb7-1073" aria-hidden="true" tabindex="-1"></a>  <span class="dt">id</span><span class="op">:</span> <span class="st">"xs-curve"</span><span class="op">,</span> </span>
<span id="cb7-1074"><a href="#cb7-1074" aria-hidden="true" tabindex="-1"></a>  <span class="dt">scheme</span><span class="op">:</span> green </span>
<span id="cb7-1075"><a href="#cb7-1075" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb7-1076"><a href="#cb7-1076" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1077"><a href="#cb7-1077" aria-hidden="true" tabindex="-1"></a>xst <span class="op">=</span> ({ </span>
<span id="cb7-1078"><a href="#cb7-1078" aria-hidden="true" tabindex="-1"></a>  <span class="dt">fxn</span><span class="op">:</span> supplyTaxedFxn<span class="op">,</span> </span>
<span id="cb7-1079"><a href="#cb7-1079" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="st">"Supply with tariff"</span><span class="op">,</span> </span>
<span id="cb7-1080"><a href="#cb7-1080" aria-hidden="true" tabindex="-1"></a>  <span class="dt">areaLabel</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span></span>
<span id="cb7-1081"><a href="#cb7-1081" aria-hidden="true" tabindex="-1"></a>  <span class="dt">id</span><span class="op">:</span> <span class="st">"xst-curve"</span><span class="op">,</span> </span>
<span id="cb7-1082"><a href="#cb7-1082" aria-hidden="true" tabindex="-1"></a>  <span class="dt">scheme</span><span class="op">:</span> red </span>
<span id="cb7-1083"><a href="#cb7-1083" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb7-1084"><a href="#cb7-1084" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1085"><a href="#cb7-1085" aria-hidden="true" tabindex="-1"></a>md <span class="op">=</span> ({ </span>
<span id="cb7-1086"><a href="#cb7-1086" aria-hidden="true" tabindex="-1"></a>  <span class="dt">fxn</span><span class="op">:</span> demandFxn<span class="op">,</span> </span>
<span id="cb7-1087"><a href="#cb7-1087" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="st">"Import demand curve"</span><span class="op">,</span> </span>
<span id="cb7-1088"><a href="#cb7-1088" aria-hidden="true" tabindex="-1"></a>  <span class="dt">areaLabel</span><span class="op">:</span> <span class="st">"Consumer surplus"</span><span class="op">,</span></span>
<span id="cb7-1089"><a href="#cb7-1089" aria-hidden="true" tabindex="-1"></a>  <span class="dt">id</span><span class="op">:</span> <span class="st">"md-curve"</span><span class="op">,</span> </span>
<span id="cb7-1090"><a href="#cb7-1090" aria-hidden="true" tabindex="-1"></a>  <span class="dt">scheme</span><span class="op">:</span> blue </span>
<span id="cb7-1091"><a href="#cb7-1091" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-7-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-7-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-7-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-7-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-7-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-7-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-7-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-7-8" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-7-9" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-7-10" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold hidden">
<summary>Helper functions</summary>
<div class="sourceCode cell-code hidden" id="cb8" data-startfrom="1100" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1099;"><span id="cb8-1100"><a href="#cb8-1100" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">drawBackground</span>(selection) {</span>
<span id="cb8-1101"><a href="#cb8-1101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1102"><a href="#cb8-1102" aria-hidden="true" tabindex="-1"></a>  selection<span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb8-1103"><a href="#cb8-1103" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"bg"</span>)</span>
<span id="cb8-1104"><a href="#cb8-1104" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb8-1105"><a href="#cb8-1105" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> selection<span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span>))</span>
<span id="cb8-1106"><a href="#cb8-1106" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> <span class="st">"100%"</span>)<span class="op">;</span></span>
<span id="cb8-1107"><a href="#cb8-1107" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-1108"><a href="#cb8-1108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1109"><a href="#cb8-1109" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">addCurve</span>(selection<span class="op">,</span> </span>
<span id="cb8-1110"><a href="#cb8-1110" aria-hidden="true" tabindex="-1"></a>                  id<span class="op">,</span> </span>
<span id="cb8-1111"><a href="#cb8-1111" aria-hidden="true" tabindex="-1"></a>                  fxnInfo<span class="op">,</span> </span>
<span id="cb8-1112"><a href="#cb8-1112" aria-hidden="true" tabindex="-1"></a>                  params<span class="op">,</span> </span>
<span id="cb8-1113"><a href="#cb8-1113" aria-hidden="true" tabindex="-1"></a>                  yScaler<span class="op">,</span> </span>
<span id="cb8-1114"><a href="#cb8-1114" aria-hidden="true" tabindex="-1"></a>                  start <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> </span>
<span id="cb8-1115"><a href="#cb8-1115" aria-hidden="true" tabindex="-1"></a>                  end <span class="op">=</span> params<span class="op">.</span><span class="at">q</span>) {</span>
<span id="cb8-1116"><a href="#cb8-1116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1117"><a href="#cb8-1117" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> point <span class="op">=</span> <span class="fu">data</span>(fxnInfo<span class="op">.</span><span class="at">fxn</span><span class="op">,</span> params<span class="op">,</span> yScaler<span class="op">,</span> start<span class="op">,</span> end)[params<span class="op">.</span><span class="at">q</span>]</span>
<span id="cb8-1118"><a href="#cb8-1118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1119"><a href="#cb8-1119" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> curves <span class="op">=</span> selection<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb8-1120"><a href="#cb8-1120" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span> fxnInfo<span class="op">.</span><span class="at">id</span> <span class="sc">}</span><span class="vs">-</span><span class="sc">${</span> id <span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb8-1121"><a href="#cb8-1121" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"pointer-events"</span><span class="op">,</span> <span class="st">"visibleStroke"</span>)</span>
<span id="cb8-1122"><a href="#cb8-1122" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-1123"><a href="#cb8-1123" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Non-highlighted portion</span></span>
<span id="cb8-1124"><a href="#cb8-1124" aria-hidden="true" tabindex="-1"></a>  curves<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb8-1125"><a href="#cb8-1125" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"curve dulled"</span>)</span>
<span id="cb8-1126"><a href="#cb8-1126" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">line</span>(<span class="fu">data</span>(fxnInfo<span class="op">.</span><span class="at">fxn</span><span class="op">,</span> params<span class="op">,</span> yScaler<span class="op">,</span> start<span class="op">,</span> max<span class="op">.</span><span class="at">q</span>)))</span>
<span id="cb8-1127"><a href="#cb8-1127" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke"</span><span class="op">,</span> fxnInfo<span class="op">.</span><span class="at">scheme</span><span class="op">.</span><span class="at">dull</span>)<span class="op">;</span></span>
<span id="cb8-1128"><a href="#cb8-1128" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-1129"><a href="#cb8-1129" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Highlighted portion</span></span>
<span id="cb8-1130"><a href="#cb8-1130" aria-hidden="true" tabindex="-1"></a>  curves<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb8-1131"><a href="#cb8-1131" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"curve colored"</span>)</span>
<span id="cb8-1132"><a href="#cb8-1132" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">line</span>(<span class="fu">data</span>(fxnInfo<span class="op">.</span><span class="at">fxn</span><span class="op">,</span> params<span class="op">,</span> yScaler<span class="op">,</span> start<span class="op">,</span> end)))</span>
<span id="cb8-1133"><a href="#cb8-1133" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke"</span><span class="op">,</span> fxnInfo<span class="op">.</span><span class="at">scheme</span><span class="op">.</span><span class="at">base</span>)<span class="op">;</span></span>
<span id="cb8-1134"><a href="#cb8-1134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1135"><a href="#cb8-1135" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Add hover effects</span></span>
<span id="cb8-1136"><a href="#cb8-1136" aria-hidden="true" tabindex="-1"></a>  curves</span>
<span id="cb8-1137"><a href="#cb8-1137" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">on</span>(<span class="st">"mousemove"</span><span class="op">,</span> (<span class="bu">event</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb8-1138"><a href="#cb8-1138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1139"><a href="#cb8-1139" aria-hidden="true" tabindex="-1"></a>      d3<span class="op">.</span><span class="fu">selectAll</span>(<span class="vs">`#</span><span class="sc">${</span> fxnInfo<span class="op">.</span><span class="at">id</span> <span class="sc">}</span><span class="vs">-</span><span class="sc">${</span> id <span class="sc">}</span><span class="vs"> .curve.colored`</span>)</span>
<span id="cb8-1140"><a href="#cb8-1140" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">classed</span>(<span class="st">"hovered"</span><span class="op">,</span> <span class="kw">true</span>)</span>
<span id="cb8-1141"><a href="#cb8-1141" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke"</span><span class="op">,</span> fxnInfo<span class="op">.</span><span class="at">scheme</span><span class="op">.</span><span class="at">baseSelect</span>)<span class="op">;</span></span>
<span id="cb8-1142"><a href="#cb8-1142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1143"><a href="#cb8-1143" aria-hidden="true" tabindex="-1"></a>      d3<span class="op">.</span><span class="fu">selectAll</span>(<span class="vs">`#</span><span class="sc">${</span> fxnInfo<span class="op">.</span><span class="at">id</span> <span class="sc">}</span><span class="vs">-</span><span class="sc">${</span> id <span class="sc">}</span><span class="vs"> .curve.dulled`</span>)</span>
<span id="cb8-1144"><a href="#cb8-1144" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">classed</span>(<span class="st">"hovered"</span><span class="op">,</span> <span class="kw">true</span>)</span>
<span id="cb8-1145"><a href="#cb8-1145" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke"</span><span class="op">,</span> fxnInfo<span class="op">.</span><span class="at">scheme</span><span class="op">.</span><span class="at">dullSelect</span>)<span class="op">;</span></span>
<span id="cb8-1146"><a href="#cb8-1146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1147"><a href="#cb8-1147" aria-hidden="true" tabindex="-1"></a>      tooltip</span>
<span id="cb8-1148"><a href="#cb8-1148" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"left"</span><span class="op">,</span> <span class="bu">event</span><span class="op">.</span><span class="at">pageX</span> <span class="op">+</span> <span class="dv">10</span> <span class="op">+</span> <span class="st">"px"</span>)</span>
<span id="cb8-1149"><a href="#cb8-1149" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"top"</span><span class="op">,</span> <span class="bu">event</span><span class="op">.</span><span class="at">pageY</span> <span class="op">+</span> <span class="dv">10</span> <span class="op">+</span> <span class="st">"px"</span>)</span>
<span id="cb8-1150"><a href="#cb8-1150" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"display"</span><span class="op">,</span> <span class="st">"block"</span>)</span>
<span id="cb8-1151"><a href="#cb8-1151" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">text</span>(fxnInfo<span class="op">.</span><span class="at">label</span>)<span class="op">;</span></span>
<span id="cb8-1152"><a href="#cb8-1152" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb8-1153"><a href="#cb8-1153" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">on</span>(<span class="st">"mouseleave"</span><span class="op">,</span> (<span class="bu">event</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb8-1154"><a href="#cb8-1154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1155"><a href="#cb8-1155" aria-hidden="true" tabindex="-1"></a>      d3<span class="op">.</span><span class="fu">selectAll</span>(<span class="vs">`#</span><span class="sc">${</span> fxnInfo<span class="op">.</span><span class="at">id</span> <span class="sc">}</span><span class="vs">-</span><span class="sc">${</span> id <span class="sc">}</span><span class="vs"> .curve.colored`</span>)</span>
<span id="cb8-1156"><a href="#cb8-1156" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">classed</span>(<span class="st">"hovered"</span><span class="op">,</span> <span class="kw">false</span>)</span>
<span id="cb8-1157"><a href="#cb8-1157" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke"</span><span class="op">,</span> fxnInfo<span class="op">.</span><span class="at">scheme</span><span class="op">.</span><span class="at">base</span>)<span class="op">;</span></span>
<span id="cb8-1158"><a href="#cb8-1158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1159"><a href="#cb8-1159" aria-hidden="true" tabindex="-1"></a>      d3<span class="op">.</span><span class="fu">selectAll</span>(<span class="vs">`#</span><span class="sc">${</span> fxnInfo<span class="op">.</span><span class="at">id</span> <span class="sc">}</span><span class="vs">-</span><span class="sc">${</span> id <span class="sc">}</span><span class="vs"> .curve.dulled`</span>)</span>
<span id="cb8-1160"><a href="#cb8-1160" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">classed</span>(<span class="st">"hovered"</span><span class="op">,</span> <span class="kw">false</span>)</span>
<span id="cb8-1161"><a href="#cb8-1161" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke"</span><span class="op">,</span> fxnInfo<span class="op">.</span><span class="at">scheme</span><span class="op">.</span><span class="at">dull</span>)<span class="op">;</span></span>
<span id="cb8-1162"><a href="#cb8-1162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1163"><a href="#cb8-1163" aria-hidden="true" tabindex="-1"></a>      tooltip<span class="op">.</span><span class="fu">style</span>(<span class="st">"display"</span><span class="op">,</span> <span class="st">"none"</span>)<span class="op">;</span></span>
<span id="cb8-1164"><a href="#cb8-1164" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb8-1165"><a href="#cb8-1165" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-1166"><a href="#cb8-1166" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-1167"><a href="#cb8-1167" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">addCurveFull</span>(selection<span class="op">,</span> </span>
<span id="cb8-1168"><a href="#cb8-1168" aria-hidden="true" tabindex="-1"></a>                      id<span class="op">,</span> </span>
<span id="cb8-1169"><a href="#cb8-1169" aria-hidden="true" tabindex="-1"></a>                      fxnInfo<span class="op">,</span> </span>
<span id="cb8-1170"><a href="#cb8-1170" aria-hidden="true" tabindex="-1"></a>                      params<span class="op">,</span></span>
<span id="cb8-1171"><a href="#cb8-1171" aria-hidden="true" tabindex="-1"></a>                      yScaler<span class="op">,</span> </span>
<span id="cb8-1172"><a href="#cb8-1172" aria-hidden="true" tabindex="-1"></a>                      scheme <span class="op">=</span> fxnInfo<span class="op">.</span><span class="at">scheme</span>) {</span>
<span id="cb8-1173"><a href="#cb8-1173" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-1174"><a href="#cb8-1174" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> curves <span class="op">=</span> selection<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb8-1175"><a href="#cb8-1175" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span> fxnInfo<span class="op">.</span><span class="at">id</span> <span class="sc">}</span><span class="vs">-</span><span class="sc">${</span> id <span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb8-1176"><a href="#cb8-1176" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"pointer-events"</span><span class="op">,</span> <span class="st">"visibleStroke"</span>)<span class="op">;</span></span>
<span id="cb8-1177"><a href="#cb8-1177" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-1178"><a href="#cb8-1178" aria-hidden="true" tabindex="-1"></a>  curves<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb8-1179"><a href="#cb8-1179" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"curve"</span>)</span>
<span id="cb8-1180"><a href="#cb8-1180" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">line</span>(<span class="fu">data</span>(fxnInfo<span class="op">.</span><span class="at">fxn</span><span class="op">,</span> params<span class="op">,</span> yScaler<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> max<span class="op">.</span><span class="at">q</span>)))</span>
<span id="cb8-1181"><a href="#cb8-1181" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke"</span><span class="op">,</span> scheme<span class="op">.</span><span class="at">base</span>)<span class="op">;</span></span>
<span id="cb8-1182"><a href="#cb8-1182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1183"><a href="#cb8-1183" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Add hover effects</span></span>
<span id="cb8-1184"><a href="#cb8-1184" aria-hidden="true" tabindex="-1"></a>  curves</span>
<span id="cb8-1185"><a href="#cb8-1185" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">on</span>(<span class="st">"mousemove"</span><span class="op">,</span> (<span class="bu">event</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb8-1186"><a href="#cb8-1186" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-1187"><a href="#cb8-1187" aria-hidden="true" tabindex="-1"></a>      d3<span class="op">.</span><span class="fu">selectAll</span>(<span class="vs">`#</span><span class="sc">${</span> fxnInfo<span class="op">.</span><span class="at">id</span> <span class="sc">}</span><span class="vs">-</span><span class="sc">${</span> id <span class="sc">}</span><span class="vs"> .curve`</span>)</span>
<span id="cb8-1188"><a href="#cb8-1188" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">classed</span>(<span class="st">"hovered"</span><span class="op">,</span> <span class="kw">true</span>)</span>
<span id="cb8-1189"><a href="#cb8-1189" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke"</span><span class="op">,</span> scheme<span class="op">.</span><span class="at">baseSelect</span>)<span class="op">;</span></span>
<span id="cb8-1190"><a href="#cb8-1190" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-1191"><a href="#cb8-1191" aria-hidden="true" tabindex="-1"></a>      tooltip</span>
<span id="cb8-1192"><a href="#cb8-1192" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"left"</span><span class="op">,</span> <span class="bu">event</span><span class="op">.</span><span class="at">pageX</span> <span class="op">+</span> <span class="dv">18</span> <span class="op">+</span> <span class="st">"px"</span>)</span>
<span id="cb8-1193"><a href="#cb8-1193" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"top"</span><span class="op">,</span> <span class="bu">event</span><span class="op">.</span><span class="at">pageY</span> <span class="op">+</span> <span class="dv">18</span> <span class="op">+</span> <span class="st">"px"</span>)</span>
<span id="cb8-1194"><a href="#cb8-1194" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"display"</span><span class="op">,</span> <span class="st">"block"</span>)</span>
<span id="cb8-1195"><a href="#cb8-1195" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">text</span>(fxnInfo<span class="op">.</span><span class="at">label</span>)<span class="op">;</span></span>
<span id="cb8-1196"><a href="#cb8-1196" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-1197"><a href="#cb8-1197" aria-hidden="true" tabindex="-1"></a>      d3<span class="op">.</span><span class="fu">select</span>(<span class="bu">event</span><span class="op">.</span><span class="at">target</span>)<span class="op">.</span><span class="fu">style</span>(<span class="st">"cursor"</span><span class="op">,</span> <span class="st">"pointer"</span>)<span class="op">;</span></span>
<span id="cb8-1198"><a href="#cb8-1198" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb8-1199"><a href="#cb8-1199" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">on</span>(<span class="st">"mouseleave"</span><span class="op">,</span> (<span class="bu">event</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb8-1200"><a href="#cb8-1200" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-1201"><a href="#cb8-1201" aria-hidden="true" tabindex="-1"></a>      d3<span class="op">.</span><span class="fu">selectAll</span>(<span class="vs">`#</span><span class="sc">${</span> fxnInfo<span class="op">.</span><span class="at">id</span> <span class="sc">}</span><span class="vs">-</span><span class="sc">${</span> id <span class="sc">}</span><span class="vs"> .curve`</span>)</span>
<span id="cb8-1202"><a href="#cb8-1202" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">classed</span>(<span class="st">"hovered"</span><span class="op">,</span> <span class="kw">false</span>)</span>
<span id="cb8-1203"><a href="#cb8-1203" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke"</span><span class="op">,</span> scheme<span class="op">.</span><span class="at">base</span>)<span class="op">;</span></span>
<span id="cb8-1204"><a href="#cb8-1204" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-1205"><a href="#cb8-1205" aria-hidden="true" tabindex="-1"></a>      tooltip<span class="op">.</span><span class="fu">style</span>(<span class="st">"display"</span><span class="op">,</span> <span class="st">"none"</span>)<span class="op">;</span></span>
<span id="cb8-1206"><a href="#cb8-1206" aria-hidden="true" tabindex="-1"></a>      d3<span class="op">.</span><span class="fu">select</span>(<span class="bu">event</span><span class="op">.</span><span class="at">target</span>)<span class="op">.</span><span class="fu">style</span>(<span class="st">"cursor"</span><span class="op">,</span> <span class="st">"default"</span>)<span class="op">;</span></span>
<span id="cb8-1207"><a href="#cb8-1207" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb8-1208"><a href="#cb8-1208" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-1209"><a href="#cb8-1209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1210"><a href="#cb8-1210" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">addAreaBox</span>(selection<span class="op">,</span> id<span class="op">,</span> info<span class="op">,</span> corners) {</span>
<span id="cb8-1211"><a href="#cb8-1211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1212"><a href="#cb8-1212" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (corners<span class="op">.</span><span class="at">x1</span> <span class="op">===</span> <span class="kw">undefined</span>) corners<span class="op">.</span><span class="at">x1</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb8-1213"><a href="#cb8-1213" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (corners<span class="op">.</span><span class="at">x2</span> <span class="op">===</span> <span class="kw">undefined</span>) corners<span class="op">.</span><span class="at">x2</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb8-1214"><a href="#cb8-1214" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (corners<span class="op">.</span><span class="at">y1</span> <span class="op">===</span> <span class="kw">undefined</span>) corners<span class="op">.</span><span class="at">y1</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb8-1215"><a href="#cb8-1215" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (corners<span class="op">.</span><span class="at">y2</span> <span class="op">===</span> <span class="kw">undefined</span>) corners<span class="op">.</span><span class="at">y2</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb8-1216"><a href="#cb8-1216" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-1217"><a href="#cb8-1217" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> area <span class="op">=</span> selection<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb8-1218"><a href="#cb8-1218" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="vs">`area-</span><span class="sc">${</span> info<span class="op">.</span><span class="at">id</span> <span class="sc">}</span><span class="vs">-</span><span class="sc">${</span> id <span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb8-1219"><a href="#cb8-1219" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="vs">`area area-</span><span class="sc">${</span> info<span class="op">.</span><span class="at">id</span> <span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb8-1220"><a href="#cb8-1220" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> d3<span class="op">.</span><span class="fu">line</span>()([ </span>
<span id="cb8-1221"><a href="#cb8-1221" aria-hidden="true" tabindex="-1"></a>      [corners<span class="op">.</span><span class="at">x1</span><span class="op">,</span> corners<span class="op">.</span><span class="at">y1</span>]<span class="op">,</span> </span>
<span id="cb8-1222"><a href="#cb8-1222" aria-hidden="true" tabindex="-1"></a>      [corners<span class="op">.</span><span class="at">x2</span><span class="op">,</span> corners<span class="op">.</span><span class="at">y1</span>]<span class="op">,</span></span>
<span id="cb8-1223"><a href="#cb8-1223" aria-hidden="true" tabindex="-1"></a>      [corners<span class="op">.</span><span class="at">x2</span><span class="op">,</span> corners<span class="op">.</span><span class="at">y2</span>]<span class="op">,</span></span>
<span id="cb8-1224"><a href="#cb8-1224" aria-hidden="true" tabindex="-1"></a>      [corners<span class="op">.</span><span class="at">x1</span><span class="op">,</span> corners<span class="op">.</span><span class="at">y2</span>]</span>
<span id="cb8-1225"><a href="#cb8-1225" aria-hidden="true" tabindex="-1"></a>    ]))<span class="op">;</span></span>
<span id="cb8-1226"><a href="#cb8-1226" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-1227"><a href="#cb8-1227" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Add hover effects</span></span>
<span id="cb8-1228"><a href="#cb8-1228" aria-hidden="true" tabindex="-1"></a>  area</span>
<span id="cb8-1229"><a href="#cb8-1229" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">on</span>(<span class="st">"mousemove"</span><span class="op">,</span> (<span class="bu">event</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb8-1230"><a href="#cb8-1230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1231"><a href="#cb8-1231" aria-hidden="true" tabindex="-1"></a>      d3<span class="op">.</span><span class="fu">selectAll</span>(<span class="vs">`#area-</span><span class="sc">${</span> info<span class="op">.</span><span class="at">id</span> <span class="sc">}</span><span class="vs">-</span><span class="sc">${</span> id <span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb8-1232"><a href="#cb8-1232" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">classed</span>(<span class="st">"hovered"</span><span class="op">,</span> <span class="kw">true</span>)<span class="op">;</span></span>
<span id="cb8-1233"><a href="#cb8-1233" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-1234"><a href="#cb8-1234" aria-hidden="true" tabindex="-1"></a>      tooltip</span>
<span id="cb8-1235"><a href="#cb8-1235" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"left"</span><span class="op">,</span> <span class="bu">event</span><span class="op">.</span><span class="at">pageX</span> <span class="op">+</span> <span class="dv">18</span> <span class="op">+</span> <span class="st">"px"</span>)</span>
<span id="cb8-1236"><a href="#cb8-1236" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"top"</span><span class="op">,</span> <span class="bu">event</span><span class="op">.</span><span class="at">pageY</span> <span class="op">+</span> <span class="dv">18</span> <span class="op">+</span> <span class="st">"px"</span>)</span>
<span id="cb8-1237"><a href="#cb8-1237" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"display"</span><span class="op">,</span> <span class="st">"block"</span>)</span>
<span id="cb8-1238"><a href="#cb8-1238" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">text</span>(info<span class="op">.</span><span class="at">label</span>)<span class="op">;</span></span>
<span id="cb8-1239"><a href="#cb8-1239" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-1240"><a href="#cb8-1240" aria-hidden="true" tabindex="-1"></a>      d3<span class="op">.</span><span class="fu">select</span>(<span class="bu">event</span><span class="op">.</span><span class="at">target</span>)<span class="op">.</span><span class="fu">style</span>(<span class="st">"cursor"</span><span class="op">,</span> <span class="st">"pointer"</span>)<span class="op">;</span></span>
<span id="cb8-1241"><a href="#cb8-1241" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb8-1242"><a href="#cb8-1242" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">on</span>(<span class="st">"mouseleave"</span><span class="op">,</span> (<span class="bu">event</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb8-1243"><a href="#cb8-1243" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-1244"><a href="#cb8-1244" aria-hidden="true" tabindex="-1"></a>      d3<span class="op">.</span><span class="fu">selectAll</span>(<span class="vs">`#area-</span><span class="sc">${</span> info<span class="op">.</span><span class="at">id</span> <span class="sc">}</span><span class="vs">-</span><span class="sc">${</span> id <span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb8-1245"><a href="#cb8-1245" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">classed</span>(<span class="st">"hovered"</span><span class="op">,</span> <span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb8-1246"><a href="#cb8-1246" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-1247"><a href="#cb8-1247" aria-hidden="true" tabindex="-1"></a>      tooltip<span class="op">.</span><span class="fu">style</span>(<span class="st">"display"</span><span class="op">,</span> <span class="st">"none"</span>)<span class="op">;</span></span>
<span id="cb8-1248"><a href="#cb8-1248" aria-hidden="true" tabindex="-1"></a>      d3<span class="op">.</span><span class="fu">select</span>(<span class="bu">event</span><span class="op">.</span><span class="at">target</span>)<span class="op">.</span><span class="fu">style</span>(<span class="st">"cursor"</span><span class="op">,</span> <span class="st">"default"</span>)<span class="op">;</span></span>
<span id="cb8-1249"><a href="#cb8-1249" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb8-1250"><a href="#cb8-1250" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-1251"><a href="#cb8-1251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1252"><a href="#cb8-1252" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">addAreaCurve</span>(selection<span class="op">,</span> </span>
<span id="cb8-1253"><a href="#cb8-1253" aria-hidden="true" tabindex="-1"></a>                      id<span class="op">,</span> </span>
<span id="cb8-1254"><a href="#cb8-1254" aria-hidden="true" tabindex="-1"></a>                      fxnInfo<span class="op">,</span> </span>
<span id="cb8-1255"><a href="#cb8-1255" aria-hidden="true" tabindex="-1"></a>                      params<span class="op">,</span> </span>
<span id="cb8-1256"><a href="#cb8-1256" aria-hidden="true" tabindex="-1"></a>                      yScaler<span class="op">,</span></span>
<span id="cb8-1257"><a href="#cb8-1257" aria-hidden="true" tabindex="-1"></a>                      start <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> </span>
<span id="cb8-1258"><a href="#cb8-1258" aria-hidden="true" tabindex="-1"></a>                      end <span class="op">=</span> params<span class="op">.</span><span class="at">q</span>) {</span>
<span id="cb8-1259"><a href="#cb8-1259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1260"><a href="#cb8-1260" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> paramsend <span class="op">=</span> { <span class="op">...</span>params }<span class="op">;</span></span>
<span id="cb8-1261"><a href="#cb8-1261" aria-hidden="true" tabindex="-1"></a>  paramsend<span class="op">.</span><span class="at">q</span> <span class="op">=</span> end<span class="op">;</span></span>
<span id="cb8-1262"><a href="#cb8-1262" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> area <span class="op">=</span> selection<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb8-1263"><a href="#cb8-1263" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="vs">`area-</span><span class="sc">${</span> fxnInfo<span class="op">.</span><span class="at">id</span> <span class="sc">}</span><span class="vs">-</span><span class="sc">${</span> id <span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb8-1264"><a href="#cb8-1264" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"area area-"</span> <span class="op">+</span> fxnInfo<span class="op">.</span><span class="at">id</span>)</span>
<span id="cb8-1265"><a href="#cb8-1265" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="vs">`</span></span>
<span id="cb8-1266"><a href="#cb8-1266" aria-hidden="true" tabindex="-1"></a><span class="vs">      </span><span class="sc">${</span> <span class="fu">line</span>(<span class="fu">data</span>(fxnInfo<span class="op">.</span><span class="at">fxn</span><span class="op">,</span> params<span class="op">,</span> yScaler<span class="op">,</span> start<span class="op">,</span> end)) <span class="sc">}</span></span>
<span id="cb8-1267"><a href="#cb8-1267" aria-hidden="true" tabindex="-1"></a><span class="vs">      L </span><span class="sc">${</span> <span class="fu">xScaler</span>(start) <span class="sc">}</span><span class="vs">,</span><span class="sc">${</span> <span class="fu">yScaler</span>(fxnInfo<span class="op">.</span><span class="fu">fxn</span>(paramsend)) <span class="sc">}</span><span class="vs"> Z</span></span>
<span id="cb8-1268"><a href="#cb8-1268" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span>)<span class="op">;</span></span>
<span id="cb8-1269"><a href="#cb8-1269" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-1270"><a href="#cb8-1270" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Add hover effects</span></span>
<span id="cb8-1271"><a href="#cb8-1271" aria-hidden="true" tabindex="-1"></a>  area</span>
<span id="cb8-1272"><a href="#cb8-1272" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">on</span>(<span class="st">"mousemove"</span><span class="op">,</span> (<span class="bu">event</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb8-1273"><a href="#cb8-1273" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-1274"><a href="#cb8-1274" aria-hidden="true" tabindex="-1"></a>      d3<span class="op">.</span><span class="fu">select</span>(<span class="vs">`#area-</span><span class="sc">${</span> fxnInfo<span class="op">.</span><span class="at">id</span> <span class="sc">}</span><span class="vs">-</span><span class="sc">${</span> id <span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb8-1275"><a href="#cb8-1275" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">classed</span>(<span class="st">"hovered"</span><span class="op">,</span> <span class="kw">true</span>)<span class="op">;</span></span>
<span id="cb8-1276"><a href="#cb8-1276" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-1277"><a href="#cb8-1277" aria-hidden="true" tabindex="-1"></a>      tooltip</span>
<span id="cb8-1278"><a href="#cb8-1278" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"left"</span><span class="op">,</span> <span class="bu">event</span><span class="op">.</span><span class="at">pageX</span> <span class="op">+</span> <span class="dv">18</span> <span class="op">+</span> <span class="st">"px"</span>)</span>
<span id="cb8-1279"><a href="#cb8-1279" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"top"</span><span class="op">,</span> <span class="bu">event</span><span class="op">.</span><span class="at">pageY</span> <span class="op">+</span> <span class="dv">18</span> <span class="op">+</span> <span class="st">"px"</span>)</span>
<span id="cb8-1280"><a href="#cb8-1280" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"display"</span><span class="op">,</span> <span class="st">"block"</span>)</span>
<span id="cb8-1281"><a href="#cb8-1281" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">text</span>(fxnInfo<span class="op">.</span><span class="at">areaLabel</span>)<span class="op">;</span></span>
<span id="cb8-1282"><a href="#cb8-1282" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-1283"><a href="#cb8-1283" aria-hidden="true" tabindex="-1"></a>      d3<span class="op">.</span><span class="fu">select</span>(<span class="bu">event</span><span class="op">.</span><span class="at">target</span>)<span class="op">.</span><span class="fu">style</span>(<span class="st">"cursor"</span><span class="op">,</span> <span class="st">"pointer"</span>)<span class="op">;</span></span>
<span id="cb8-1284"><a href="#cb8-1284" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb8-1285"><a href="#cb8-1285" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">on</span>(<span class="st">"mouseleave"</span><span class="op">,</span> (<span class="bu">event</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb8-1286"><a href="#cb8-1286" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-1287"><a href="#cb8-1287" aria-hidden="true" tabindex="-1"></a>      d3<span class="op">.</span><span class="fu">selectAll</span>(<span class="vs">`#area-</span><span class="sc">${</span> fxnInfo<span class="op">.</span><span class="at">id</span> <span class="sc">}</span><span class="vs">-</span><span class="sc">${</span> id <span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb8-1288"><a href="#cb8-1288" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">classed</span>(<span class="st">"hovered"</span><span class="op">,</span> <span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb8-1289"><a href="#cb8-1289" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-1290"><a href="#cb8-1290" aria-hidden="true" tabindex="-1"></a>      tooltip<span class="op">.</span><span class="fu">style</span>(<span class="st">"display"</span><span class="op">,</span> <span class="st">"none"</span>)<span class="op">;</span></span>
<span id="cb8-1291"><a href="#cb8-1291" aria-hidden="true" tabindex="-1"></a>      d3<span class="op">.</span><span class="fu">select</span>(<span class="bu">event</span><span class="op">.</span><span class="at">target</span>)<span class="op">.</span><span class="fu">style</span>(<span class="st">"cursor"</span><span class="op">,</span> <span class="st">"default"</span>)<span class="op">;</span></span>
<span id="cb8-1292"><a href="#cb8-1292" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb8-1293"><a href="#cb8-1293" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-1294"><a href="#cb8-1294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1295"><a href="#cb8-1295" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">addAreaLostSurplus</span>(selection<span class="op">,</span> id<span class="op">,</span> params<span class="op">,</span> yScaler) {</span>
<span id="cb8-1296"><a href="#cb8-1296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1297"><a href="#cb8-1297" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> qStar <span class="op">=</span> <span class="dv">46</span><span class="op">;</span></span>
<span id="cb8-1298"><a href="#cb8-1298" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> qtStar <span class="op">=</span> <span class="dv">33</span><span class="op">;</span></span>
<span id="cb8-1299"><a href="#cb8-1299" aria-hidden="true" tabindex="-1"></a>  params<span class="op">.</span><span class="at">q</span> <span class="op">=</span> qStar<span class="op">;</span></span>
<span id="cb8-1300"><a href="#cb8-1300" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> paramst <span class="op">=</span> { <span class="op">...</span>params }<span class="op">;</span></span>
<span id="cb8-1301"><a href="#cb8-1301" aria-hidden="true" tabindex="-1"></a>  paramst<span class="op">.</span><span class="at">q</span> <span class="op">=</span> qtStar<span class="op">;</span></span>
<span id="cb8-1302"><a href="#cb8-1302" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-1303"><a href="#cb8-1303" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> area <span class="op">=</span> selection<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb8-1304"><a href="#cb8-1304" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="vs">`area-lost-surplus-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb8-1305"><a href="#cb8-1305" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"area area-lost-surplus"</span>)<span class="op">;</span></span>
<span id="cb8-1306"><a href="#cb8-1306" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-1307"><a href="#cb8-1307" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> areaDemandDWL <span class="op">=</span> area<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb8-1308"><a href="#cb8-1308" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="vs">`</span></span>
<span id="cb8-1309"><a href="#cb8-1309" aria-hidden="true" tabindex="-1"></a><span class="vs">      </span><span class="sc">${</span> <span class="fu">line</span>(<span class="fu">data</span>(demandFxn<span class="op">,</span> params<span class="op">,</span> yScaler<span class="op">,</span> qtStar<span class="op">,</span> qStar)) <span class="sc">}</span></span>
<span id="cb8-1310"><a href="#cb8-1310" aria-hidden="true" tabindex="-1"></a><span class="vs">      L </span><span class="sc">${</span> <span class="fu">xScaler</span>(qtStar) <span class="sc">}</span><span class="vs">,</span><span class="sc">${</span> <span class="fu">yScaler</span>(<span class="fu">demandFxn</span>(params)) <span class="sc">}</span><span class="vs"> Z</span></span>
<span id="cb8-1311"><a href="#cb8-1311" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span>)<span class="op">;</span></span>
<span id="cb8-1312"><a href="#cb8-1312" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-1313"><a href="#cb8-1313" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> areaSupplyDWL <span class="op">=</span> area<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb8-1314"><a href="#cb8-1314" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="vs">`</span></span>
<span id="cb8-1315"><a href="#cb8-1315" aria-hidden="true" tabindex="-1"></a><span class="vs">      </span><span class="sc">${</span> <span class="fu">line</span>(<span class="fu">data</span>(supplyFxn<span class="op">,</span> params<span class="op">,</span> yScaler<span class="op">,</span> qtStar<span class="op">,</span> qStar)) <span class="sc">}</span></span>
<span id="cb8-1316"><a href="#cb8-1316" aria-hidden="true" tabindex="-1"></a><span class="vs">      L </span><span class="sc">${</span> <span class="fu">xScaler</span>(qtStar) <span class="sc">}</span><span class="vs">,</span><span class="sc">${</span> <span class="fu">yScaler</span>(<span class="fu">supplyFxn</span>(params)) <span class="sc">}</span><span class="vs"> Z</span></span>
<span id="cb8-1317"><a href="#cb8-1317" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span>)<span class="op">;</span></span>
<span id="cb8-1318"><a href="#cb8-1318" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-1319"><a href="#cb8-1319" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> areaRevenue <span class="op">=</span> area<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb8-1320"><a href="#cb8-1320" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> d3<span class="op">.</span><span class="fu">line</span>()([ </span>
<span id="cb8-1321"><a href="#cb8-1321" aria-hidden="true" tabindex="-1"></a>      [<span class="dv">0</span><span class="op">,</span> <span class="fu">yScaler</span>(<span class="fu">supplyFxn</span>(paramst))]<span class="op">,</span> </span>
<span id="cb8-1322"><a href="#cb8-1322" aria-hidden="true" tabindex="-1"></a>      [<span class="fu">xScaler</span>(qtStar)<span class="op">,</span> <span class="fu">yScaler</span>(<span class="fu">supplyFxn</span>(paramst))]<span class="op">,</span></span>
<span id="cb8-1323"><a href="#cb8-1323" aria-hidden="true" tabindex="-1"></a>      [<span class="fu">xScaler</span>(qtStar)<span class="op">,</span> <span class="fu">yScaler</span>(<span class="fu">demandFxn</span>(paramst))]<span class="op">,</span></span>
<span id="cb8-1324"><a href="#cb8-1324" aria-hidden="true" tabindex="-1"></a>      [<span class="dv">0</span><span class="op">,</span> <span class="fu">yScaler</span>(<span class="fu">demandFxn</span>(paramst))]</span>
<span id="cb8-1325"><a href="#cb8-1325" aria-hidden="true" tabindex="-1"></a>    ]))<span class="op">;</span></span>
<span id="cb8-1326"><a href="#cb8-1326" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-1327"><a href="#cb8-1327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1328"><a href="#cb8-1328" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">clip</span>(selection<span class="op">,</span> id) {</span>
<span id="cb8-1329"><a href="#cb8-1329" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-1330"><a href="#cb8-1330" aria-hidden="true" tabindex="-1"></a>  selection<span class="op">.</span><span class="fu">attr</span>(<span class="st">"clip-path"</span><span class="op">,</span> <span class="vs">`url(#clip-</span><span class="sc">${</span> id <span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb8-1331"><a href="#cb8-1331" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-1332"><a href="#cb8-1332" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> clip <span class="op">=</span> selection<span class="op">.</span><span class="fu">append</span>(<span class="st">"clipPath"</span>)</span>
<span id="cb8-1333"><a href="#cb8-1333" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="vs">`clip-</span><span class="sc">${</span> id <span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb8-1334"><a href="#cb8-1334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1335"><a href="#cb8-1335" aria-hidden="true" tabindex="-1"></a>  clip<span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb8-1336"><a href="#cb8-1336" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"clip"</span>)</span>
<span id="cb8-1337"><a href="#cb8-1337" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb8-1338"><a href="#cb8-1338" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb8-1339"><a href="#cb8-1339" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> dim<span class="op">.</span><span class="at">width</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">right</span>)</span>
<span id="cb8-1340"><a href="#cb8-1340" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> dim<span class="op">.</span><span class="at">height</span>)<span class="op">;</span></span>
<span id="cb8-1341"><a href="#cb8-1341" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-1342"><a href="#cb8-1342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1343"><a href="#cb8-1343" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">clipWide</span>(selection<span class="op">,</span> id) {</span>
<span id="cb8-1344"><a href="#cb8-1344" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-1345"><a href="#cb8-1345" aria-hidden="true" tabindex="-1"></a>  selection<span class="op">.</span><span class="fu">attr</span>(<span class="st">"clip-path"</span><span class="op">,</span> <span class="vs">`url(#clip-wide-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb8-1346"><a href="#cb8-1346" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-1347"><a href="#cb8-1347" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> clip <span class="op">=</span> selection<span class="op">.</span><span class="fu">append</span>(<span class="st">"clipPath"</span>)</span>
<span id="cb8-1348"><a href="#cb8-1348" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="vs">`clip-wide-</span><span class="sc">${</span> id <span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb8-1349"><a href="#cb8-1349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1350"><a href="#cb8-1350" aria-hidden="true" tabindex="-1"></a>  clip<span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb8-1351"><a href="#cb8-1351" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"clip"</span>)</span>
<span id="cb8-1352"><a href="#cb8-1352" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb8-1353"><a href="#cb8-1353" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb8-1354"><a href="#cb8-1354" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> dim<span class="op">.</span><span class="at">width</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">right</span>)</span>
<span id="cb8-1355"><a href="#cb8-1355" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> dim<span class="op">.</span><span class="at">height</span>)<span class="op">;</span></span>
<span id="cb8-1356"><a href="#cb8-1356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1357"><a href="#cb8-1357" aria-hidden="true" tabindex="-1"></a>  clip<span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb8-1358"><a href="#cb8-1358" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"clip"</span>)</span>
<span id="cb8-1359"><a href="#cb8-1359" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="op">-</span>margin<span class="op">.</span><span class="at">left</span>)</span>
<span id="cb8-1360"><a href="#cb8-1360" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="op">-</span><span class="dv">10</span>)</span>
<span id="cb8-1361"><a href="#cb8-1361" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> margin<span class="op">.</span><span class="at">left</span>)</span>
<span id="cb8-1362"><a href="#cb8-1362" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> dim<span class="op">.</span><span class="at">height</span> <span class="op">+</span> <span class="dv">20</span>)<span class="op">;</span></span>
<span id="cb8-1363"><a href="#cb8-1363" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-1364"><a href="#cb8-1364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1365"><a href="#cb8-1365" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">panelAxes</span>(selection<span class="op">,</span> titles) {</span>
<span id="cb8-1366"><a href="#cb8-1366" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-1367"><a href="#cb8-1367" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> axes <span class="op">=</span> selection<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb8-1368"><a href="#cb8-1368" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"axis"</span>)<span class="op">;</span></span>
<span id="cb8-1369"><a href="#cb8-1369" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-1370"><a href="#cb8-1370" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Axis lines</span></span>
<span id="cb8-1371"><a href="#cb8-1371" aria-hidden="true" tabindex="-1"></a>  axes<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb8-1372"><a href="#cb8-1372" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"axis-line"</span>)</span>
<span id="cb8-1373"><a href="#cb8-1373" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> d3<span class="op">.</span><span class="fu">line</span>()([</span>
<span id="cb8-1374"><a href="#cb8-1374" aria-hidden="true" tabindex="-1"></a>      [dim<span class="op">.</span><span class="at">width</span><span class="op">,</span> dim<span class="op">.</span><span class="at">height</span>]<span class="op">,</span> </span>
<span id="cb8-1375"><a href="#cb8-1375" aria-hidden="true" tabindex="-1"></a>      [<span class="dv">0</span><span class="op">,</span> dim<span class="op">.</span><span class="at">height</span>]<span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span>]</span>
<span id="cb8-1376"><a href="#cb8-1376" aria-hidden="true" tabindex="-1"></a>    ]))<span class="op">;</span></span>
<span id="cb8-1377"><a href="#cb8-1377" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-1378"><a href="#cb8-1378" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Axis titles    </span></span>
<span id="cb8-1379"><a href="#cb8-1379" aria-hidden="true" tabindex="-1"></a>  axes<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb8-1380"><a href="#cb8-1380" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb8-1381"><a href="#cb8-1381" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"axis-text axis-text-x"</span>)</span>
<span id="cb8-1382"><a href="#cb8-1382" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(titles<span class="op">.</span><span class="at">x</span>)</span>
<span id="cb8-1383"><a href="#cb8-1383" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> dim<span class="op">.</span><span class="at">width</span> <span class="op">+</span> <span class="dv">10</span>)</span>
<span id="cb8-1384"><a href="#cb8-1384" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> dim<span class="op">.</span><span class="at">height</span>)<span class="op">;</span></span>
<span id="cb8-1385"><a href="#cb8-1385" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-1386"><a href="#cb8-1386" aria-hidden="true" tabindex="-1"></a>  axes<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb8-1387"><a href="#cb8-1387" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"axis-text axis-text-y"</span>)</span>
<span id="cb8-1388"><a href="#cb8-1388" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(titles<span class="op">.</span><span class="at">y</span>)</span>
<span id="cb8-1389"><a href="#cb8-1389" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb8-1390"><a href="#cb8-1390" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="op">-</span><span class="dv">15</span>)<span class="op">;</span></span>
<span id="cb8-1391"><a href="#cb8-1391" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-1392"><a href="#cb8-1392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1393"><a href="#cb8-1393" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">xGuides</span>(selection<span class="op">,</span> fxnInfo<span class="op">,</span> params<span class="op">,</span> yScaler) {</span>
<span id="cb8-1394"><a href="#cb8-1394" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-1395"><a href="#cb8-1395" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> point <span class="op">=</span> <span class="fu">data</span>(fxnInfo<span class="op">.</span><span class="at">fxn</span><span class="op">,</span> params<span class="op">,</span> yScaler)[params<span class="op">.</span><span class="at">q</span>]<span class="op">;</span></span>
<span id="cb8-1396"><a href="#cb8-1396" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> guide <span class="op">=</span> selection<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb8-1397"><a href="#cb8-1397" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"guide"</span>)<span class="op">;</span></span>
<span id="cb8-1398"><a href="#cb8-1398" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-1399"><a href="#cb8-1399" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Dashed line</span></span>
<span id="cb8-1400"><a href="#cb8-1400" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> dashedLine <span class="op">=</span> guide<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb8-1401"><a href="#cb8-1401" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"dashed-line"</span>)</span>
<span id="cb8-1402"><a href="#cb8-1402" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">line</span>([</span>
<span id="cb8-1403"><a href="#cb8-1403" aria-hidden="true" tabindex="-1"></a>      [point[<span class="dv">0</span>]<span class="op">,</span> point[<span class="dv">1</span>]]<span class="op">,</span> </span>
<span id="cb8-1404"><a href="#cb8-1404" aria-hidden="true" tabindex="-1"></a>      [point[<span class="dv">0</span>]<span class="op">,</span> dim<span class="op">.</span><span class="at">height</span>]</span>
<span id="cb8-1405"><a href="#cb8-1405" aria-hidden="true" tabindex="-1"></a>    ]))<span class="op">;</span></span>
<span id="cb8-1406"><a href="#cb8-1406" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-1407"><a href="#cb8-1407" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Tick</span></span>
<span id="cb8-1408"><a href="#cb8-1408" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> tick <span class="op">=</span> guide<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb8-1409"><a href="#cb8-1409" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"tick tick-x"</span>)</span>
<span id="cb8-1410"><a href="#cb8-1410" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(d3<span class="op">.</span><span class="fu">format</span>(<span class="st">",.0f"</span>)(params<span class="op">.</span><span class="at">q</span>))</span>
<span id="cb8-1411"><a href="#cb8-1411" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="fu">xScaler</span>(params<span class="op">.</span><span class="at">q</span>))</span>
<span id="cb8-1412"><a href="#cb8-1412" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> dim<span class="op">.</span><span class="at">height</span>)<span class="op">;</span></span>
<span id="cb8-1413"><a href="#cb8-1413" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-1414"><a href="#cb8-1414" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-1415"><a href="#cb8-1415" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">yGuide</span>(selection<span class="op">,</span> fxnInfo<span class="op">,</span> params<span class="op">,</span> yScaler<span class="op">,</span> format <span class="op">=</span> <span class="st">",.0f"</span>) {</span>
<span id="cb8-1416"><a href="#cb8-1416" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-1417"><a href="#cb8-1417" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> point <span class="op">=</span> <span class="fu">data</span>(fxnInfo<span class="op">.</span><span class="at">fxn</span><span class="op">,</span> params<span class="op">,</span> yScaler)[params<span class="op">.</span><span class="at">q</span>]<span class="op">;</span></span>
<span id="cb8-1418"><a href="#cb8-1418" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> guide <span class="op">=</span> selection<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb8-1419"><a href="#cb8-1419" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"guide"</span>)<span class="op">;</span></span>
<span id="cb8-1420"><a href="#cb8-1420" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-1421"><a href="#cb8-1421" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Dashed line</span></span>
<span id="cb8-1422"><a href="#cb8-1422" aria-hidden="true" tabindex="-1"></a>  guide<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb8-1423"><a href="#cb8-1423" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"dashed-line"</span>)</span>
<span id="cb8-1424"><a href="#cb8-1424" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">line</span>([</span>
<span id="cb8-1425"><a href="#cb8-1425" aria-hidden="true" tabindex="-1"></a>      [point[<span class="dv">0</span>]<span class="op">,</span> point[<span class="dv">1</span>]]<span class="op">,</span> </span>
<span id="cb8-1426"><a href="#cb8-1426" aria-hidden="true" tabindex="-1"></a>      [<span class="dv">0</span><span class="op">,</span> point[<span class="dv">1</span>]]</span>
<span id="cb8-1427"><a href="#cb8-1427" aria-hidden="true" tabindex="-1"></a>    ]))<span class="op">;</span></span>
<span id="cb8-1428"><a href="#cb8-1428" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-1429"><a href="#cb8-1429" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Axis tick</span></span>
<span id="cb8-1430"><a href="#cb8-1430" aria-hidden="true" tabindex="-1"></a>  guide<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb8-1431"><a href="#cb8-1431" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"tick tick-y"</span>)</span>
<span id="cb8-1432"><a href="#cb8-1432" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(d3<span class="op">.</span><span class="fu">format</span>(format)(fxnInfo<span class="op">.</span><span class="fu">fxn</span>(params)))</span>
<span id="cb8-1433"><a href="#cb8-1433" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb8-1434"><a href="#cb8-1434" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> point[<span class="dv">1</span>])<span class="op">;</span></span>
<span id="cb8-1435"><a href="#cb8-1435" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-1436"><a href="#cb8-1436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1437"><a href="#cb8-1437" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">addLabel</span>(selection<span class="op">,</span> label<span class="op">,</span> x<span class="op">,</span> y<span class="op">,</span> anchor <span class="op">=</span> <span class="st">"start"</span>) {</span>
<span id="cb8-1438"><a href="#cb8-1438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1439"><a href="#cb8-1439" aria-hidden="true" tabindex="-1"></a>  selection<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb8-1440"><a href="#cb8-1440" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"curve-label"</span>)</span>
<span id="cb8-1441"><a href="#cb8-1441" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(label)</span>
<span id="cb8-1442"><a href="#cb8-1442" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> x)</span>
<span id="cb8-1443"><a href="#cb8-1443" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> y)</span>
<span id="cb8-1444"><a href="#cb8-1444" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> anchor)<span class="op">;</span></span>
<span id="cb8-1445"><a href="#cb8-1445" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-1446"><a href="#cb8-1446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1447"><a href="#cb8-1447" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">curlyBrace</span>(start<span class="op">,</span> length) {</span>
<span id="cb8-1448"><a href="#cb8-1448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1449"><a href="#cb8-1449" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> x0 <span class="op">=</span> start[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb8-1450"><a href="#cb8-1450" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> y0 <span class="op">=</span> start[<span class="dv">1</span>]<span class="op">;</span></span>
<span id="cb8-1451"><a href="#cb8-1451" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> scale <span class="op">=</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb8-1452"><a href="#cb8-1452" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> segment <span class="op">=</span> (length <span class="op">/</span> <span class="dv">2</span>) <span class="op">-</span> (scale <span class="op">*</span> <span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb8-1453"><a href="#cb8-1453" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-1454"><a href="#cb8-1454" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> m <span class="op">=</span> <span class="vs">`M </span><span class="sc">${</span> x0 <span class="sc">}</span><span class="vs">,</span><span class="sc">${</span> y0 <span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb8-1455"><a href="#cb8-1455" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> q1 <span class="op">=</span> <span class="vs">`Q </span><span class="sc">${</span> x0 <span class="op">-</span> scale <span class="sc">}</span><span class="vs">,</span><span class="sc">${</span> y0 <span class="sc">}</span><span class="vs"> </span><span class="sc">${</span> x0 <span class="op">-</span> scale <span class="sc">}</span><span class="vs">,</span><span class="sc">${</span> y0 <span class="op">+</span> scale <span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb8-1456"><a href="#cb8-1456" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> l1 <span class="op">=</span> <span class="vs">`L </span><span class="sc">${</span> x0 <span class="op">-</span> scale <span class="sc">}</span><span class="vs">,</span><span class="sc">${</span> y0 <span class="op">+</span> scale <span class="op">+</span> segment <span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb8-1457"><a href="#cb8-1457" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-1458"><a href="#cb8-1458" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> p <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb8-1459"><a href="#cb8-1459" aria-hidden="true" tabindex="-1"></a><span class="vs">    Q </span><span class="sc">${</span> x0 <span class="op">-</span> scale <span class="sc">}</span><span class="vs">,</span><span class="sc">${</span> y0 <span class="op">+</span> <span class="dv">2</span> <span class="op">*</span> scale <span class="op">+</span> segment <span class="sc">}</span></span>
<span id="cb8-1460"><a href="#cb8-1460" aria-hidden="true" tabindex="-1"></a><span class="vs">      </span><span class="sc">${</span> x0 <span class="op">-</span> <span class="dv">2</span> <span class="op">*</span> scale <span class="sc">}</span><span class="vs">,</span><span class="sc">${</span> y0 <span class="op">+</span> <span class="dv">2</span> <span class="op">*</span> scale <span class="op">+</span> segment <span class="sc">}</span></span>
<span id="cb8-1461"><a href="#cb8-1461" aria-hidden="true" tabindex="-1"></a><span class="vs">    Q </span><span class="sc">${</span> x0 <span class="op">-</span> scale <span class="sc">}</span><span class="vs">,</span><span class="sc">${</span> y0 <span class="op">+</span> <span class="dv">2</span> <span class="op">*</span> scale <span class="op">+</span> segment <span class="sc">}</span></span>
<span id="cb8-1462"><a href="#cb8-1462" aria-hidden="true" tabindex="-1"></a><span class="vs">      </span><span class="sc">${</span> x0 <span class="op">-</span> scale <span class="sc">}</span><span class="vs">,</span><span class="sc">${</span> y0 <span class="op">+</span> <span class="dv">3</span> <span class="op">*</span> scale <span class="op">+</span> segment <span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb8-1463"><a href="#cb8-1463" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-1464"><a href="#cb8-1464" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> l2 <span class="op">=</span> <span class="vs">`L </span><span class="sc">${</span> x0 <span class="op">-</span> scale <span class="sc">}</span><span class="vs">,</span><span class="sc">${</span> y0 <span class="op">+</span> <span class="dv">2</span> <span class="op">*</span> (scale <span class="op">+</span> segment) <span class="op">+</span> <span class="dv">2</span> <span class="op">*</span> scale <span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb8-1465"><a href="#cb8-1465" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> q2 <span class="op">=</span> <span class="vs">`Q </span><span class="sc">${</span> x0 <span class="op">-</span> scale <span class="sc">}</span><span class="vs">,</span><span class="sc">${</span> y0 <span class="op">+</span> <span class="dv">2</span> <span class="op">*</span> (scale <span class="op">+</span> segment) <span class="op">+</span> <span class="dv">3</span> <span class="op">*</span> scale <span class="sc">}</span><span class="vs"> </span></span>
<span id="cb8-1466"><a href="#cb8-1466" aria-hidden="true" tabindex="-1"></a><span class="vs">    </span><span class="sc">${</span> x0 <span class="sc">}</span><span class="vs">,</span><span class="sc">${</span> y0 <span class="op">+</span> <span class="dv">2</span> <span class="op">*</span> (scale <span class="op">+</span> segment) <span class="op">+</span> <span class="dv">3</span> <span class="op">*</span> scale <span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb8-1467"><a href="#cb8-1467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1468"><a href="#cb8-1468" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="vs">`</span><span class="sc">${</span>m<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>q1<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>l1<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>p<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>l2<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>q2<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb8-1469"><a href="#cb8-1469" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-1470"><a href="#cb8-1470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1471"><a href="#cb8-1471" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">labelsToggle</span>(container<span class="op">,</span> id) {</span>
<span id="cb8-1472"><a href="#cb8-1472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1473"><a href="#cb8-1473" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> form <span class="op">=</span> container<span class="op">.</span><span class="fu">append</span>(<span class="st">"form"</span>)</span>
<span id="cb8-1474"><a href="#cb8-1474" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"toggle-labels"</span>)<span class="op">;</span></span>
<span id="cb8-1475"><a href="#cb8-1475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-1476"><a href="#cb8-1476" aria-hidden="true" tabindex="-1"></a>  form<span class="op">.</span><span class="fu">append</span>(<span class="st">"input"</span>)</span>
<span id="cb8-1477"><a href="#cb8-1477" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"toggle-checkbox"</span>)</span>
<span id="cb8-1478"><a href="#cb8-1478" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"type"</span><span class="op">,</span> <span class="st">"checkbox"</span>)</span>
<span id="cb8-1479"><a href="#cb8-1479" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"name"</span><span class="op">,</span> <span class="st">"toggle-label"</span>)</span>
<span id="cb8-1480"><a href="#cb8-1480" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="vs">`checkbox-</span><span class="sc">${</span> id <span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb8-1481"><a href="#cb8-1481" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">property</span>(<span class="st">"checked"</span><span class="op">,</span> <span class="kw">true</span>)<span class="op">;</span></span>
<span id="cb8-1482"><a href="#cb8-1482" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-1483"><a href="#cb8-1483" aria-hidden="true" tabindex="-1"></a>  form<span class="op">.</span><span class="fu">append</span>(<span class="st">"label"</span>)</span>
<span id="cb8-1484"><a href="#cb8-1484" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"toggle-label"</span>)</span>
<span id="cb8-1485"><a href="#cb8-1485" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"for"</span><span class="op">,</span> <span class="vs">`checkbox-</span><span class="sc">${</span> id <span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb8-1486"><a href="#cb8-1486" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">"Labels"</span>)<span class="op">;</span></span>
<span id="cb8-1487"><a href="#cb8-1487" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-8-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-8-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-8-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-8-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-8-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-8-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-8-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-8-8" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-8-9" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-8-10" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-8-11" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-8-12" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-8-13" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-8-14" data-nodetype="declaration">

</div>
</div>
</div>
</div>




<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>These are additions to tariffs <a href="https://www.nytimes.com/interactive/2025/04/12/business/economy/china-tariff-product-costs.html">already existing</a> prior to the second Trump administration.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section></div></main> <!-- /main -->
<script type="ojs-module-contents">
eyJjb250ZW50cyI6W3sibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IntcbiAgY29uc3QgaWQgPSBkMy5yYW5kb21JbnQoMTAwMDAwLCAxMDAwMDAwKSgpO1xuICBjb25zdCBwYXJhbXMgPSB7IHE6IG51bGwsIHA6IG51bGwsIGVzOiBudWxsLCBlZDogbnVsbCB9O1xuICBjb25zdCBheGlzVGl0bGVzID0geyB4OiBcIk91dHB1dFwiLCB5OiBcIiQvdW5pdFwiIH07XG5cbiAgcGFyYW1zLmVzID0gMS41O1xuICBwYXJhbXMuZWQgPSAtMS4yNTtcbiAgcGFyYW1zLnEgPSBxU3RhcihwYXJhbXMpO1xuICBwYXJhbXMucCA9IHN1cHBseUZ4bihwYXJhbXMpO1xuICBcbiAgY29uc3QgeVNjYWxlciA9IGQzLnNjYWxlTGluZWFyKClcbiAgICAuZG9tYWluKFswLCBtYXgucF0pXG4gICAgLnJhbmdlKFtkaW0uaGVpZ2h0LCBwYWRkaW5nLnRvcF0pO1xuICBcbiAgLy8gRGlhZ3JhbVxuICBcbiAgY29uc3QgY29udGFpbmVyID0gZDMuY3JlYXRlKFwiZGl2XCIpXG4gICAgLmF0dHIoXCJjbGFzc1wiLCBcImRpYWdyYW1cIik7XG4gIFxuICBjb25zdCBzdmcgPSBjb250YWluZXIuYXBwZW5kKFwic3ZnXCIpXG4gICAgLmF0dHIoXCJ3aWR0aFwiLCBcIjEwMCVcIilcbiAgICAuYXR0cihcInZpZXdCb3hcIiwgW1xuICAgICAgMCwgMCwgXG4gICAgICBkaW0ud2lkdGggKyBtYXJnaW4ubGVmdCArIG1hcmdpbi5yaWdodCwgXG4gICAgICBkaW0uaGVpZ2h0ICsgbWFyZ2luLnRvcCArIG1hcmdpbi5ib3R0b21cbiAgICBdKVxuICAgIC5jYWxsKGRyYXdCYWNrZ3JvdW5kKTtcbiAgXG4gIGNvbnN0IHBhbmVsID0gc3ZnLmFwcGVuZChcImdcIilcbiAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBgdHJhbnNsYXRlKCR7IG1hcmdpbi5sZWZ0IH0sJHsgbWFyZ2luLnRvcCB9KWApO1xuICAgIFxuICBsZXQgZGVtYW5kR3VpZGVTYW1wbGUgPSBwYW5lbC5hcHBlbmQoXCJnXCIpXG4gICAgLmNhbGwoeUd1aWRlLCBtZCwgeyBxOiAyNCwgZWQ6IHBhcmFtcy5lZCB9LCB5U2NhbGVyLCBcIiwuMWZcIilcbiAgICAuY2FsbCh4R3VpZGVzLCBtZCwgeyBxOiAyNCwgZWQ6IHBhcmFtcy5lZCB9LCB5U2NhbGVyKTtcbiAgICBcbiAgbGV0IHN1cHBseUN1cnZlID0gcGFuZWwuYXBwZW5kKFwiZ1wiKVxuICAgIC5jYWxsKGNsaXAsIGlkKVxuICAgIC5jYWxsKGFkZEN1cnZlRnVsbCwgaWQsIHhzLCBwYXJhbXMsIHlTY2FsZXIpXG4gICAgLmNhbGwoXG4gICAgICBhZGRMYWJlbCwgXCJFeHBvcnQgc3VwcGx5XCIsIFxuICAgICAgeFNjYWxlcig5NSksIFxuICAgICAgeVNjYWxlcihzdXBwbHlGeG4oeyBxOiA5NSwgZXM6IHBhcmFtcy5lcyB9KSkgLSAxNSxcbiAgICAgIFwibWlkZGxlXCJcbiAgICApXG4gICAgLnN0eWxlKFwib3BhY2l0eVwiLCAwKTtcbiAgICBcbiAgbGV0IGRlbWFuZEN1cnZlID0gcGFuZWwuYXBwZW5kKFwiZ1wiKVxuICAgIC5jYWxsKGNsaXAsIGlkKVxuICAgIC5jYWxsKGFkZEN1cnZlRnVsbCwgaWQsIG1kLCBwYXJhbXMsIHlTY2FsZXIpXG4gICAgLmNhbGwoXG4gICAgICBhZGRMYWJlbCwgXCJJbXBvcnQgZGVtYW5kXCIsIFxuICAgICAgeFNjYWxlcig3MCksXG4gICAgICB5U2NhbGVyKGRlbWFuZEZ4bih7IHE6IDUwLCBlZDogcGFyYW1zLmVkIH0pKVxuICAgICk7XG4gIFxuICBsZXQgZ3VpZGVzRXEgPSBwYW5lbC5hcHBlbmQoXCJnXCIpXG4gICAgLmNhbGwoeUd1aWRlLCB4cywgcGFyYW1zLCB5U2NhbGVyLCBcIiwuMWZcIilcbiAgICAuY2FsbCh4R3VpZGVzLCB4cywgcGFyYW1zLCB5U2NhbGVyKTtcbiAgICBcbiAgcGFuZWwuY2FsbChwYW5lbEF4ZXMsIGF4aXNUaXRsZXMpO1xuICBcbiAgLy8gU2Nyb2xsIGFuaW1hdGlvbnNcbiAgXG4gIGNvbnN0IHB0cyA9IFtcbiAgICB7IHN0YXJ0OiAuMTQ1LCBlbmQ6IC4xNjUgfSxcbiAgICB7IHN0YXJ0OiAuMzQwLCBlbmQ6IC4zNjAgfSxcbiAgICB7IHN0YXJ0OiAuNDYwLCBlbmQ6IC40ODAgfSxcbiAgICB7IHN0YXJ0OiAuNTI1LCBlbmQ6IC41NDUgfSxcbiAgICB7IHN0YXJ0OiAuNjk1LCBlbmQ6IC43MTUgfSxcbiAgXTtcbiAgXG4gIGRlbWFuZEN1cnZlXG4gICAgLnN0eWxlKFwib3BhY2l0eVwiLCAoKSA9PiB7XG4gICAgICBpZiAoY3JQcm9ncmVzc0Jsb2NrID49IC4xNDUgJiYgY3JQcm9ncmVzc0Jsb2NrIDwgLjQ2KSB7XG4gICAgICAgIHJldHVybiBmYWRlSW4ocHRzWzBdKShjclByb2dyZXNzQmxvY2spO1xuICAgICAgfSBlbHNlIGlmIChjclByb2dyZXNzQmxvY2sgPj0gLjQ2ICYmIGNyUHJvZ3Jlc3NCbG9jayA8IC42OTUpIHtcbiAgICAgICAgcmV0dXJuIGZhZGVPdXQocHRzWzJdKShjclByb2dyZXNzQmxvY2spO1xuICAgICAgfSBlbHNlIGlmIChjclByb2dyZXNzQmxvY2sgPj0gLjY5NSkge1xuICAgICAgICByZXR1cm4gZmFkZUluKHB0c1s0XSkoY3JQcm9ncmVzc0Jsb2NrKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiAwO1xuICAgICAgfVxuICAgICB9KTtcbiAgXG4gIGRlbWFuZEd1aWRlU2FtcGxlXG4gICAgLnN0eWxlKFwib3BhY2l0eVwiLCAoKSA9PiB7XG4gICAgICBpZiAoY3JQcm9ncmVzc0Jsb2NrID49IC4zNCAmJiBjclByb2dyZXNzQmxvY2sgPCAuNDYpIHtcbiAgICAgICAgcmV0dXJuIGZhZGVJbihwdHNbMV0pKGNyUHJvZ3Jlc3NCbG9jayk7XG4gICAgICB9IGVsc2UgaWYgKGNyUHJvZ3Jlc3NCbG9jayA+PSAuNDYpIHtcbiAgICAgICAgcmV0dXJuIGZhZGVPdXQocHRzWzJdKShjclByb2dyZXNzQmxvY2spO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIDA7XG4gICAgICB9XG4gICAgIH0pO1xuICAgIFxuICBzdXBwbHlDdXJ2ZVxuICAgIC5zdHlsZShcIm9wYWNpdHlcIiwgKCkgPT4ge1xuICAgICAgaWYgKGNyUHJvZ3Jlc3NCbG9jayA+PSAuNTI1KSB7XG4gICAgICAgIHJldHVybiBmYWRlSW4ocHRzWzNdKShjclByb2dyZXNzQmxvY2spO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIDA7XG4gICAgICB9XG4gICAgIH0pO1xuICAgIFxuICBndWlkZXNFcVxuICAgIC5zdHlsZShcIm9wYWNpdHlcIiwgKCkgPT4ge1xuICAgICAgaWYgKGNyUHJvZ3Jlc3NCbG9jayA+PSAuNjk1KSB7XG4gICAgICAgIHJldHVybiBmYWRlSW4ocHRzWzRdKShjclByb2dyZXNzQmxvY2spO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIDA7XG4gICAgICB9XG4gICAgIH0pO1xuICAgICBcbiAgcmV0dXJuIGNvbnRhaW5lci5ub2RlKCk7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTIiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ7XG4gIGNvbnN0IGlkID0gZDMucmFuZG9tSW50KDEwMDAwMCwgMTAwMDAwMCkoKTtcbiAgY29uc3QgcGFyYW1zID0geyBxOiBudWxsLCBwOiBudWxsLCBlczogbnVsbCwgZWQ6IG51bGwsIHQ6IG51bGwgfTtcbiAgY29uc3QgYXhpc1RpdGxlcyA9IHsgeDogXCJPdXRwdXRcIiwgeTogXCIkL3VuaXRcIiB9O1xuXG4gIGNvbnN0IHB0cyA9IFtcbiAgICB7IHN0YXJ0OiAuMTQwLCBlbmQ6IC4xNjAgfSxcbiAgICB7IHN0YXJ0OiAuMzIwLCBlbmQ6IC4zNDAgfSxcbiAgICB7IHN0YXJ0OiAuNTAwLCBlbmQ6IC41MjAgfSxcbiAgICB7IHN0YXJ0OiAuNzAwLCBlbmQ6IC43MjAgfSxcbiAgICB7IHN0YXJ0OiAuODcwLCBlbmQ6IC44OTAgfSxcbiAgXTtcbiAgXG4gIHBhcmFtcy5lcyA9IDEuNTtcbiAgcGFyYW1zLmVkID0gLTEuMjU7XG4gIHBhcmFtcy50ID0gLjggKiBmYWRlSW4ocHRzWzBdKShjclByb2dyZXNzQmxvY2spO1xuICBwYXJhbXMucSA9IHFTdGFyKHBhcmFtcyk7XG4gIHBhcmFtcy5wID0gc3VwcGx5RnhuKHBhcmFtcyk7XG4gIFxuICBjb25zdCB5U2NhbGVyID0gZDMuc2NhbGVMaW5lYXIoKVxuICAgIC5kb21haW4oWzAsIG1heC5wXSlcbiAgICAucmFuZ2UoW2RpbS5oZWlnaHQsIHBhZGRpbmcudG9wXSk7XG4gIFxuICAvLyBEaWFncmFtXG4gIFxuICBjb25zdCBjb250YWluZXIgPSBkMy5jcmVhdGUoXCJkaXZcIilcbiAgICAuYXR0cihcImNsYXNzXCIsIFwiZGlhZ3JhbVwiKTtcbiAgXG4gIGNvbnN0IHN2ZyA9IGNvbnRhaW5lci5hcHBlbmQoXCJzdmdcIilcbiAgICAuYXR0cihcIndpZHRoXCIsIFwiMTAwJVwiKVxuICAgIC5hdHRyKFwidmlld0JveFwiLCBbXG4gICAgICAwLCAwLCBcbiAgICAgIGRpbS53aWR0aCArIG1hcmdpbi5sZWZ0ICsgbWFyZ2luLnJpZ2h0LCBcbiAgICAgIGRpbS5oZWlnaHQgKyBtYXJnaW4udG9wICsgbWFyZ2luLmJvdHRvbVxuICAgIF0pXG4gICAgLmNhbGwoZHJhd0JhY2tncm91bmQpO1xuICBcbiAgY29uc3QgcGFuZWwgPSBzdmcuYXBwZW5kKFwiZ1wiKVxuICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGB0cmFuc2xhdGUoJHsgbWFyZ2luLmxlZnQgfSwkeyBtYXJnaW4udG9wIH0pYCk7XG4gIFxuICBsZXQgcmV2ZW51ZSA9IHBhbmVsLmFwcGVuZChcImdcIilcbiAgICAuY2FsbChhZGRBcmVhQm94LCBcbiAgICAgIGlkLCBcbiAgICAgIHsgaWQ6IFwicmV2ZW51ZVwiLCBsYWJlbDogXCJHb3Zlcm5tZW50IHJldmVudWVzXCIgfSwgXG4gICAgICB7IFxuICAgICAgICB4MTogMCwgXG4gICAgICAgIHkxOiB5U2NhbGVyKHN1cHBseUZ4bih7IHE6IDMzLCBlczogcGFyYW1zLmVzIH0pKSwgXG4gICAgICAgIHgyOiB4U2NhbGVyKDMzKSwgXG4gICAgICAgIHkyOiB5U2NhbGVyKHN1cHBseVRheGVkRnhuKHsgcTogMzMsIGVzOiBwYXJhbXMuZXMsIHQ6IHBhcmFtcy50IH0pKSBcbiAgICAgIH1cbiAgICApXG4gICAgXG4gIGxldCBzdXBwbHlUYXhlZEN1cnZlID0gcGFuZWwuYXBwZW5kKFwiZ1wiKVxuICAgIC5jYWxsKGNsaXAsIGlkKVxuICAgIC5jYWxsKGFkZEN1cnZlRnVsbCwgaWQsIHhzdCwgcGFyYW1zLCB5U2NhbGVyKVxuICAgIC5jYWxsKFxuICAgICAgYWRkTGFiZWwsIFwiU3VwcGx5IHdpdGggdGFyaWZmXCIsIFxuICAgICAgeFNjYWxlcig3MCkgLSAxNSwgXG4gICAgICB5U2NhbGVyKHN1cHBseVRheGVkRnhuKHsgcTogNzAsIGVzOiBwYXJhbXMuZXMsIHQ6IHBhcmFtcy50IH0pKSxcbiAgICAgIFwiZW5kXCJcbiAgICApO1xuICBcbiAgbGV0IHN1cHBseUN1cnZlID0gcGFuZWwuYXBwZW5kKFwiZ1wiKVxuICAgIC5jYWxsKGNsaXAsIGlkKVxuICAgIC5jYWxsKGFkZEN1cnZlRnVsbCwgaWQsIHhzLCBwYXJhbXMsIHlTY2FsZXIpXG4gICAgLmNhbGwoXG4gICAgICBhZGRMYWJlbCwgXCJFeHBvcnQgc3VwcGx5XCIsIFxuICAgICAgeFNjYWxlcig3MCkgKyAxNSwgXG4gICAgICB5U2NhbGVyKHN1cHBseUZ4bih7IHE6IDcwLCBlczogcGFyYW1zLmVzIH0pKSArIDEwLFxuICAgICAgXCJzdGFydFwiXG4gICAgKTtcbiAgXG4gIGxldCBkZW1hbmRDdXJ2ZSA9IHBhbmVsLmFwcGVuZChcImdcIilcbiAgICAuY2FsbChjbGlwLCBpZClcbiAgICAuY2FsbChhZGRDdXJ2ZUZ1bGwsIGlkLCBtZCwgcGFyYW1zLCB5U2NhbGVyKVxuICAgIC5jYWxsKFxuICAgICAgYWRkTGFiZWwsIFwiSW1wb3J0IGRlbWFuZFwiLCBcbiAgICAgIHhTY2FsZXIoNzApLFxuICAgICAgeVNjYWxlcihkZW1hbmRGeG4oeyBxOiA1MCwgZWQ6IHBhcmFtcy5lZCB9KSlcbiAgICApO1xuICBcbiAgbGV0IHN1cHBseUd1aWRlID0gcGFuZWwuYXBwZW5kKFwiZ1wiKVxuICAgIC5jYWxsKHlHdWlkZSwgeHMsIHsgcTogMzMsIGVzOiBwYXJhbXMuZXMgfSwgeVNjYWxlciwgXCIsLjFmXCIpO1xuICBzdXBwbHlHdWlkZS5zZWxlY3QoXCJ0ZXh0XCIpXG4gICAgLnN0eWxlKFwiZmlsbFwiLCBcIiNiM2IzYjNcIik7XG4gIFxuICBsZXQgZGVtYW5kR3VpZGVzVGF4ZWQgPSBwYW5lbC5hcHBlbmQoXCJnXCIpXG4gICAgLmNhbGwoeUd1aWRlLCB4c3QsIHsgcTogMzMsIGVzOiBwYXJhbXMuZXMsIHQ6IHBhcmFtcy50IH0sIHlTY2FsZXIsIFwiLC4xZlwiKVxuICAgIC5jYWxsKHhHdWlkZXMsIHhzdCwgeyBxOiAzMywgZXM6IHBhcmFtcy5lcywgdDogcGFyYW1zLnQgfSwgeVNjYWxlcik7XG4gIFxuICBsZXQgZ3VpZGVzRXEgPSBwYW5lbC5hcHBlbmQoXCJnXCIpXG4gICAgLmNhbGwoeUd1aWRlLCB4cywgcGFyYW1zLCB5U2NhbGVyLCBcIiwuMWZcIilcbiAgICAuY2FsbCh4R3VpZGVzLCB4cywgcGFyYW1zLCB5U2NhbGVyKTtcbiAgXG4gIGxldCBwb2ludHMgPSBwYW5lbC5hcHBlbmQoXCJnXCIpO1xuICBcbiAgcG9pbnRzLmFwcGVuZChcImNpcmNsZVwiKVxuICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJndWlkZS1wb2ludCBwcmltYXJ5XCIpXG4gICAgLmF0dHIoXCJjeFwiLCB4U2NhbGVyKDQ2KSlcbiAgICAuYXR0cihcImN5XCIsIHlTY2FsZXIoZGVtYW5kRnhuKHsgcTogNDYsIGVkOiBwYXJhbXMuZWQgfSkpKVxuICAgIC5hdHRyKFwiclwiLCA1KTtcbiAgICBcbiAgcG9pbnRzLmFwcGVuZChcImNpcmNsZVwiKVxuICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJndWlkZS1wb2ludCBzZWNvbmRhcnlcIilcbiAgICAuYXR0cihcImN4XCIsIHhTY2FsZXIoMzMpKVxuICAgIC5hdHRyKFwiY3lcIiwgeVNjYWxlcihzdXBwbHlUYXhlZEZ4bih7IHE6IDMzLCBlczogcGFyYW1zLmVzLCB0OiBwYXJhbXMudCB9KSkpXG4gICAgLmF0dHIoXCJyXCIsIDUpO1xuICAgIFxuICBwYW5lbC5jYWxsKHBhbmVsQXhlcywgYXhpc1RpdGxlcyk7XG4gICAgXG4gIC8vIFNjcm9sbCBhbmltYXRpb25zXG4gIFxuICBzdXBwbHlUYXhlZEN1cnZlLnNlbGVjdChcInRleHRcIikuc3R5bGUoXCJvcGFjaXR5XCIsICgpID0+IHtcbiAgICAgIHJldHVybiBmYWRlSW4ocHRzWzBdKShjclByb2dyZXNzQmxvY2spO1xuICAgfSk7XG4gICAgIFxuICBkZW1hbmRDdXJ2ZVxuICAgIC5zdHlsZShcIm9wYWNpdHlcIiwgKCkgPT4ge1xuICAgICAgaWYgKGNyUHJvZ3Jlc3NCbG9jayA+PSBwdHNbMV0uc3RhcnQgJiYgY3JQcm9ncmVzc0Jsb2NrIDwgcHRzWzJdLnN0YXJ0KSB7XG4gICAgICAgIHJldHVybiBmYWRlSW4ocHRzWzFdKShjclByb2dyZXNzQmxvY2spO1xuICAgICAgfSBlbHNlIGlmIChjclByb2dyZXNzQmxvY2sgPj0gcHRzWzJdLnN0YXJ0ICYmIGNyUHJvZ3Jlc3NCbG9jayA8IHB0c1szXS5zdGFydCkge1xuICAgICAgICByZXR1cm4gZmFkZU91dChwdHNbMl0pKGNyUHJvZ3Jlc3NCbG9jayk7XG4gICAgICB9IGVsc2UgaWYgKGNyUHJvZ3Jlc3NCbG9jayA+PSBwdHNbNF0uc3RhcnQpIHtcbiAgICAgICAgcmV0dXJuIGZhZGVJbihwdHNbNF0pKGNyUHJvZ3Jlc3NCbG9jayk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gMDtcbiAgICAgIH1cbiAgICAgfSk7XG4gICAgIFxuICBkZW1hbmRHdWlkZXNUYXhlZC5zdHlsZShcIm9wYWNpdHlcIiwgKCkgPT4ge1xuICAgICAgcmV0dXJuIGZhZGVJbihwdHNbMV0pKGNyUHJvZ3Jlc3NCbG9jayk7XG4gICB9KTtcbiAgXG4gIHN1cHBseUN1cnZlXG4gICAgLnN0eWxlKFwib3BhY2l0eVwiLCAoKSA9PiB7XG4gICAgICBpZiAoY3JQcm9ncmVzc0Jsb2NrID49IHB0c1sxXS5zdGFydCAmJiBjclByb2dyZXNzQmxvY2sgPCBwdHNbMl0uc3RhcnQpIHtcbiAgICAgICAgcmV0dXJuIGZhZGVPdXQocHRzWzFdKShjclByb2dyZXNzQmxvY2spO1xuICAgICAgfSBlbHNlIGlmIChjclByb2dyZXNzQmxvY2sgPj0gcHRzWzJdLnN0YXJ0KSB7XG4gICAgICAgIHJldHVybiBmYWRlSW4ocHRzWzJdKShjclByb2dyZXNzQmxvY2spO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIDE7XG4gICAgICB9XG4gICAgIH0pO1xuICAgICBcbiAgc3VwcGx5R3VpZGUuc3R5bGUoXCJvcGFjaXR5XCIsICgpID0+IHtcbiAgICAgIHJldHVybiBmYWRlSW4ocHRzWzJdKShjclByb2dyZXNzQmxvY2spO1xuICAgfSk7XG4gICAgIFxuICBndWlkZXNFcS5zdHlsZShcIm9wYWNpdHlcIiwgKCkgPT4ge1xuICAgICAgcmV0dXJuIGZhZGVJbihwdHNbNF0pKGNyUHJvZ3Jlc3NCbG9jayk7XG4gICB9KTtcbiAgICAgXG4gIHBvaW50cy5zdHlsZShcIm9wYWNpdHlcIiwgKCkgPT4ge1xuICAgICAgcmV0dXJuIGZhZGVJbihwdHNbNF0pKGNyUHJvZ3Jlc3NCbG9jayk7XG4gICB9KTtcbiAgICAgXG4gIHJldmVudWUuc3R5bGUoXCJvcGFjaXR5XCIsICgpID0+IHtcbiAgICByZXR1cm4gZmFkZUluKHB0c1szXSkoY3JQcm9ncmVzc0Jsb2NrKVxuICB9KTtcblxuICByZXR1cm4gY29udGFpbmVyLm5vZGUoKTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IntcbiAgY29uc3QgaWQgPSBkMy5yYW5kb21JbnQoMTAwMDAwLCAxMDAwMDAwKSgpO1xuICBjb25zdCBwYXJhbXMgPSB7IHE6IG51bGwsIHA6IG51bGwsIGVzOiBudWxsLCBlZDogbnVsbCwgdDogbnVsbCB9O1xuICBjb25zdCBheGlzVGl0bGVzID0geyB4OiBcIk91dHB1dFwiLCB5OiBcIiQvdW5pdFwiIH07XG5cbiAgcGFyYW1zLmVzID0gMS41O1xuICBwYXJhbXMuZWQgPSAtMS4yNTtcbiAgcGFyYW1zLnEgPSBxU3RhcihwYXJhbXMpO1xuICBwYXJhbXMucCA9IHN1cHBseUZ4bihwYXJhbXMpO1xuICBcbiAgY29uc3QgeVNjYWxlciA9IGQzLnNjYWxlTGluZWFyKClcbiAgICAuZG9tYWluKFswLCBtYXgucF0pXG4gICAgLnJhbmdlKFtkaW0uaGVpZ2h0LCBwYWRkaW5nLnRvcF0pO1xuICBcbiAgLy8gRGlhZ3JhbVxuICBcbiAgY29uc3QgY29udGFpbmVyID0gZDMuY3JlYXRlKFwiZGl2XCIpXG4gICAgLmF0dHIoXCJjbGFzc1wiLCBcImRpYWdyYW1cIik7XG4gIFxuICBjb25zdCBzdmcgPSBjb250YWluZXIuYXBwZW5kKFwic3ZnXCIpXG4gICAgLmF0dHIoXCJ3aWR0aFwiLCBcIjEwMCVcIilcbiAgICAuYXR0cihcInZpZXdCb3hcIiwgW1xuICAgICAgMCwgMCwgXG4gICAgICBkaW0ud2lkdGggKyBtYXJnaW4ubGVmdCArIG1hcmdpbi5yaWdodCwgXG4gICAgICBkaW0uaGVpZ2h0ICsgbWFyZ2luLnRvcCArIG1hcmdpbi5ib3R0b21cbiAgICBdKVxuICAgIC5jYWxsKGRyYXdCYWNrZ3JvdW5kKTtcbiAgXG4gIGNvbnN0IHBhbmVsID0gc3ZnLmFwcGVuZChcImdcIilcbiAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBgdHJhbnNsYXRlKCR7IG1hcmdpbi5sZWZ0IH0sJHsgbWFyZ2luLnRvcCB9KWApO1xuICBcbiAgbGV0IGNzID0gcGFuZWwuYXBwZW5kKFwiZ1wiKVxuICAgIC5jYWxsKGNsaXBXaWRlLCBpZClcbiAgICAuY2FsbChhZGRBcmVhQ3VydmUsIGlkLCBtZCwgcGFyYW1zLCB5U2NhbGVyKTtcbiAgICBcbiAgbGV0IHBzID0gcGFuZWwuYXBwZW5kKFwiZ1wiKVxuICAgIC5jYWxsKGNsaXBXaWRlLCBpZClcbiAgICAuY2FsbChhZGRBcmVhQ3VydmUsIGlkLCB4cywgcGFyYW1zLCB5U2NhbGVyKTtcblxuICBsZXQgc3VwcGx5Q3VydmUgPSBwYW5lbC5hcHBlbmQoXCJnXCIpXG4gICAgLmNhbGwoY2xpcCwgaWQpXG4gICAgLmNhbGwoYWRkQ3VydmVGdWxsLCBpZCwgeHMsIHBhcmFtcywgeVNjYWxlcilcbiAgICAuY2FsbChcbiAgICAgIGFkZExhYmVsLCBcIkV4cG9ydCBzdXBwbHlcIiwgXG4gICAgICB4U2NhbGVyKDk1KSwgXG4gICAgICB5U2NhbGVyKHN1cHBseUZ4bih7IHE6IDk1LCBlczogcGFyYW1zLmVzIH0pKSAtIDE1LFxuICAgICAgXCJtaWRkbGVcIlxuICAgICk7XG4gIFxuICBsZXQgZGVtYW5kQ3VydmUgPSBwYW5lbC5hcHBlbmQoXCJnXCIpXG4gICAgLmNhbGwoY2xpcCwgaWQpXG4gICAgLmNhbGwoYWRkQ3VydmVGdWxsLCBpZCwgbWQsIHBhcmFtcywgeVNjYWxlcilcbiAgICAuY2FsbChcbiAgICAgIGFkZExhYmVsLCBcIkltcG9ydCBkZW1hbmRcIiwgXG4gICAgICB4U2NhbGVyKDcwKSxcbiAgICAgIHlTY2FsZXIoZGVtYW5kRnhuKHsgcTogNTAsIGVkOiBwYXJhbXMuZWQgfSkpXG4gICAgKTtcbiAgXG4gIGxldCBkZW1hbmRHdWlkZVNhbXBsZSA9IHBhbmVsLmFwcGVuZChcImdcIilcbiAgICAuY2FsbCh5R3VpZGUsIG1kLCB7IHE6IDI1LCBlZDogcGFyYW1zLmVkIH0sIHlTY2FsZXIsIFwiLC4xZlwiKVxuICAgIC5jYWxsKHhHdWlkZXMsIG1kLCB7IHE6IDI1LCBlZDogcGFyYW1zLmVkIH0sIHlTY2FsZXIpO1xuICAgIFxuICBsZXQgY3NHdWlkZSA9IHBhbmVsLmFwcGVuZChcImdcIik7XG4gIFxuICBjc0d1aWRlLmFwcGVuZChcInBhdGhcIilcbiAgICAuYXR0cihcImNsYXNzXCIsIFwiY3VybHlicmFjZVwiKVxuICAgIC5hdHRyKFwiZFwiLCAoKSA9PiBjdXJseUJyYWNlKFxuICAgICAgW3hTY2FsZXIoMjUpIC0gNSwgeVNjYWxlcigxNi40KSArIDVdLCBcbiAgICAgIHlTY2FsZXIoOS4yKSAtIHlTY2FsZXIoMTYuNCkgLSAxNVxuICAgICkpO1xuICAgIFxuICBjc0d1aWRlLmFwcGVuZChcInRleHRcIilcbiAgICAuYXR0cihcImNsYXNzXCIsIFwiY3VybHlicmFjZS1sYWJlbFwiKVxuICAgIC5hdHRyKFwieFwiLCB4U2NhbGVyKDI1KSAtIDIwKVxuICAgIC5hdHRyKFwieVwiLCB5U2NhbGVyKDEyLjgpKVxuICAgIC5zdHlsZShcInRleHQtYW5jaG9yXCIsIFwiZW5kXCIpXG4gICAgLnRleHQoNy4yKVxuICBcbiAgbGV0IGd1aWRlc0VxID0gcGFuZWwuYXBwZW5kKFwiZ1wiKVxuICAgIC5jYWxsKHlHdWlkZSwgeHMsIHBhcmFtcywgeVNjYWxlciwgXCIsLjFmXCIpXG4gICAgLmNhbGwoeEd1aWRlcywgeHMsIHBhcmFtcywgeVNjYWxlcik7XG4gIFxuICBwYW5lbC5jYWxsKHBhbmVsQXhlcywgYXhpc1RpdGxlcyk7XG4gIFxuICAvLyBTY3JvbGwgYW5pbWF0aW9uc1xuICBcbiAgY29uc3QgcHRzID0gW1xuICAgIHsgc3RhcnQ6IC4xMjAsIGVuZDogLjE0MCB9LCAgLy8gMFxuICAgIHsgc3RhcnQ6IC4yNzAsIGVuZDogLjI5MCB9LCAgLy8gMVxuICAgIHsgc3RhcnQ6IC40MzAsIGVuZDogLjQ1MCB9LCAgLy8gMlxuICAgIHsgc3RhcnQ6IC41ODUsIGVuZDogLjYwNSB9LCAgLy8gM1xuICAgIHsgc3RhcnQ6IC43MzUsIGVuZDogLjc1NSB9LCAgLy8gNFxuICAgIHsgc3RhcnQ6IC44OTAsIGVuZDogLjkxMCB9LCAgLy8gNVxuICBdO1xuICBcbiAgZGVtYW5kQ3VydmUuc3R5bGUoXCJvcGFjaXR5XCIsICgpID0+IHtcbiAgICBpZiAocHJvZyA+PSBwdHNbNF0uc3RhcnQgJiYgcHJvZyA8IHB0c1s1XS5zdGFydCkge1xuICAgICAgcmV0dXJuIGZhZGVPdXQocHRzWzRdKShwcm9nKTtcbiAgICB9IGVsc2UgaWYgKHByb2cgPj0gcHRzWzVdLnN0YXJ0KSB7XG4gICAgICByZXR1cm4gZmFkZUluKHB0c1s1XSkocHJvZyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiAxO1xuICAgIH1cbiAgfSk7XG4gIFxuICBzdXBwbHlDdXJ2ZS5zdHlsZShcIm9wYWNpdHlcIiwgKCkgPT4ge1xuICAgIGlmIChwcm9nID49IHB0c1swXS5zdGFydCAmJiBwcm9nIDwgcHRzWzRdLnN0YXJ0KSB7XG4gICAgICByZXR1cm4gZmFkZU91dChwdHNbMF0pKHByb2cpO1xuICAgIH0gZWxzZSBpZiAocHJvZyA+PSBwdHNbNF0uc3RhcnQpIHtcbiAgICAgIHJldHVybiBmYWRlSW4ocHRzWzRdKShwcm9nKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIDE7XG4gICAgfVxuICB9KTtcbiAgXG4gIGRlbWFuZEd1aWRlU2FtcGxlLnN0eWxlKFwib3BhY2l0eVwiLCAoKSA9PiB7XG4gICAgaWYgKHByb2cgPj0gcHRzWzFdLnN0YXJ0ICYmIHByb2cgPCBwdHNbM10uc3RhcnQpIHtcbiAgICAgIHJldHVybiBmYWRlSW4ocHRzWzFdKShwcm9nKTtcbiAgICB9IGVsc2UgaWYgKHByb2cgPj0gcHRzWzNdLnN0YXJ0KSB7XG4gICAgICByZXR1cm4gZmFkZU91dChwdHNbM10pKHByb2cpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gMDtcbiAgICB9XG4gIH0pO1xuICBcbiAgY3NHdWlkZS5zdHlsZShcIm9wYWNpdHlcIiwgKCkgPT4ge1xuICAgIGlmIChwcm9nID49IHB0c1syXS5zdGFydCAmJiBwcm9nIDwgcHRzWzNdLnN0YXJ0KSB7XG4gICAgICByZXR1cm4gZmFkZUluKHB0c1syXSkocHJvZyk7XG4gICAgfSBlbHNlIGlmIChwcm9nID49IHB0c1szXS5zdGFydCkge1xuICAgICAgcmV0dXJuIGZhZGVPdXQocHRzWzNdKShwcm9nKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIDA7XG4gICAgfVxuICB9KTtcbiAgXG4gIGNzLnN0eWxlKFwib3BhY2l0eVwiLCAoKSA9PiB7XG4gICAgaWYgKHByb2cgPj0gcHRzWzFdLnN0YXJ0ICYmIHByb2cgPCBwdHNbNF0uc3RhcnQpIHtcbiAgICAgIHJldHVybiBmYWRlSW4ocHRzWzNdKShwcm9nKTtcbiAgICB9IGVsc2UgaWYgKHByb2cgPj0gcHRzWzRdLnN0YXJ0ICYmIHByb2cgPCBwdHNbNV0uc3RhcnQpIHtcbiAgICAgIHJldHVybiBmYWRlT3V0KHB0c1s0XSkocHJvZyk7XG4gICAgfSBlbHNlIGlmIChwcm9nID49IHB0c1s1XS5zdGFydCkge1xuICAgICAgcmV0dXJuIGZhZGVJbihwdHNbNV0pKHByb2cpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gMDtcbiAgICB9XG4gIH0pO1xuICBcbiAgcHMuc3R5bGUoXCJvcGFjaXR5XCIsICgpID0+IHtcbiAgICByZXR1cm4gZmFkZUluKHB0c1s0XSkocHJvZyk7XG4gIH0pO1xuXG4gIHJldHVybiBjb250YWluZXIubm9kZSgpO1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC00IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoie1xuICBjb25zdCBpZCA9IGQzLnJhbmRvbUludCgxMDAwMDAsIDEwMDAwMDApKCk7XG4gIGNvbnN0IHBhcmFtcyA9IHsgcTogbnVsbCwgcDogbnVsbCwgZXM6IG51bGwsIGVkOiBudWxsLCB0OiBudWxsIH07XG4gIGNvbnN0IGF4aXNUaXRsZXMgPSB7IHg6IFwiT3V0cHV0XCIsIHk6IFwiJC91bml0XCIgfTtcblxuICBjb25zdCBwdHMgPSBbXG4gICAgeyBzdGFydDogLjE1LCBlbmQ6IC4yNCB9LCAgLy8gMFxuICAgIHsgc3RhcnQ6IC4yNCwgZW5kOiAuMjUgfSwgIC8vIDFcbiAgICB7IHN0YXJ0OiAuNTEsIGVuZDogLjUzIH0sICAvLyAyXG4gICAgeyBzdGFydDogLjgwLCBlbmQ6IC44MiB9LCAgLy8gM1xuICBdO1xuICBcbiAgcGFyYW1zLmVzID0gMS41O1xuICBwYXJhbXMuZWQgPSAtMS4yNTtcbiAgcGFyYW1zLnQgPSAuOCAqIGZhZGVJbihwdHNbMF0pKHByb2cpO1xuICBwYXJhbXMucSA9IHFTdGFyKHBhcmFtcyk7XG4gIGxldCBxdFN0YXIgPSBNYXRoLnJvdW5kKC0xNi41OCAqIE1hdGgucG93KHBhcmFtcy50LCAuNzgpICsgNDYuNDQpO1xuICBwYXJhbXMucCA9IHN1cHBseUZ4bihwYXJhbXMpO1xuICBcbiAgY29uc3QgeVNjYWxlciA9IGQzLnNjYWxlTGluZWFyKClcbiAgICAuZG9tYWluKFswLCBtYXgucF0pXG4gICAgLnJhbmdlKFtkaW0uaGVpZ2h0LCBwYWRkaW5nLnRvcF0pO1xuICBcbiAgLy8gRGlhZ3JhbVxuICBcbiAgY29uc3QgY29udGFpbmVyID0gZDMuY3JlYXRlKFwiZGl2XCIpXG4gICAgLmF0dHIoXCJjbGFzc1wiLCBcImRpYWdyYW1cIik7XG4gIFxuICBjb25zdCBzdmcgPSBjb250YWluZXIuYXBwZW5kKFwic3ZnXCIpXG4gICAgLmF0dHIoXCJ3aWR0aFwiLCBcIjEwMCVcIilcbiAgICAuYXR0cihcInZpZXdCb3hcIiwgW1xuICAgICAgMCwgMCwgXG4gICAgICBkaW0ud2lkdGggKyBtYXJnaW4ubGVmdCArIG1hcmdpbi5yaWdodCwgXG4gICAgICBkaW0uaGVpZ2h0ICsgbWFyZ2luLnRvcCArIG1hcmdpbi5ib3R0b21cbiAgICBdKVxuICAgIC5jYWxsKGRyYXdCYWNrZ3JvdW5kKTtcbiAgXG4gIGNvbnN0IHBhbmVsID0gc3ZnLmFwcGVuZChcImdcIilcbiAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBgdHJhbnNsYXRlKCR7IG1hcmdpbi5sZWZ0IH0sJHsgbWFyZ2luLnRvcCB9KWApO1xuICBcbiAgbGV0IGNzID0gcGFuZWwuYXBwZW5kKFwiZ1wiKVxuICAgIC5jYWxsKGNsaXBXaWRlLCBpZClcbiAgICAuY2FsbChhZGRBcmVhQ3VydmUsIGlkLCBtZCwgeyBxOiBxdFN0YXIsIGVkOiBwYXJhbXMuZWQgfSwgeVNjYWxlcik7XG4gICAgXG4gIGxldCBwcyA9IHBhbmVsLmFwcGVuZChcImdcIilcbiAgICAuY2FsbChhZGRBcmVhQ3VydmUsIGlkLCB4cywgeyBxOiBxdFN0YXIsIGVzOiBwYXJhbXMuZXMgfSwgeVNjYWxlcik7XG4gIFxuICBsZXQgZHdsID0gcGFuZWwuYXBwZW5kKFwiZ1wiKVxuICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJhcmVhLWR3bFwiKVxuICAgIC5jYWxsKGFkZEFyZWFDdXJ2ZSwgaWQsIG1kLCB7IGVkOiBwYXJhbXMuZWQgfSwgeVNjYWxlciwgMzMsIDQ2KVxuICAgIC5jYWxsKGFkZEFyZWFDdXJ2ZSwgaWQsIHhzLCB7IGVzOiBwYXJhbXMuZXMgfSwgeVNjYWxlciwgMzMsIDQ2KTtcbiAgICBcbiAgbGV0IHJldmVudWUgPSBwYW5lbC5hcHBlbmQoXCJnXCIpXG4gICAgLmNhbGwoYWRkQXJlYUJveCwgXG4gICAgICBpZCwgXG4gICAgICB7IGlkOiBcInJldmVudWVcIiwgbGFiZWw6IFwiR292ZXJubWVudCByZXZlbnVlc1wiIH0sIFxuICAgICAgeyBcbiAgICAgICAgeDE6IDAsIFxuICAgICAgICB5MTogeVNjYWxlcihzdXBwbHlGeG4oeyBxOiBxdFN0YXIsIGVzOiBwYXJhbXMuZXMgfSkpLCBcbiAgICAgICAgeDI6IHhTY2FsZXIocXRTdGFyKSwgXG4gICAgICAgIHkyOiB5U2NhbGVyKGRlbWFuZEZ4bih7IHE6IHF0U3RhciwgZWQ6IHBhcmFtcy5lZCB9KSkgXG4gICAgICB9XG4gICAgKTtcbiAgcmV2ZW51ZS5hcHBlbmQoXCJ0ZXh0XCIpXG4gICAgLmF0dHIoXCJjbGFzc1wiLCBcImFyZWEtbGFiZWwgcmV2ZW51ZVwiKVxuICAgIC5hdHRyKFwieFwiLCB4U2NhbGVyKDEzKSlcbiAgICAuYXR0cihcInlcIiwgeVNjYWxlcigxMSkpXG4gICAgLnRleHQoXCJUYXggcmV2ZW51ZVwiKTtcbiAgICBcbiAgbGV0IHN1cHBseVRheGVkQ3VydmUgPSBwYW5lbC5hcHBlbmQoXCJnXCIpXG4gICAgLmNhbGwoY2xpcCwgaWQpXG4gICAgLmNhbGwoYWRkQ3VydmVGdWxsLCBpZCwgeHN0LCBwYXJhbXMsIHlTY2FsZXIpO1xuICBcbiAgbGV0IHN1cHBseVRheGVkQ3VydmVMYWJlbCA9IHBhbmVsLmFwcGVuZChcImdcIilcbiAgICAuY2FsbChcbiAgICAgIGFkZExhYmVsLCBcIlN1cHBseSB3aXRoIHRhcmlmZlwiLCBcbiAgICAgIHhTY2FsZXIoNzApIC0gMTUsIFxuICAgICAgeVNjYWxlcihzdXBwbHlUYXhlZEZ4bih7IHE6IDcwLCBlczogcGFyYW1zLmVzLCB0OiBwYXJhbXMudCB9KSksXG4gICAgICBcImVuZFwiXG4gICAgKTtcbiAgXG4gIGxldCBzdXBwbHlDdXJ2ZSA9IHBhbmVsLmFwcGVuZChcImdcIilcbiAgICAuY2FsbChjbGlwLCBpZClcbiAgICAuY2FsbChhZGRDdXJ2ZUZ1bGwsIGlkLCB4cywgcGFyYW1zLCB5U2NhbGVyKVxuICAgIC5jYWxsKFxuICAgICAgYWRkTGFiZWwsIFwiRXhwb3J0IHN1cHBseVwiLCBcbiAgICAgIHhTY2FsZXIoNzApICsgMTUsIFxuICAgICAgeVNjYWxlcihzdXBwbHlGeG4oeyBxOiA3MCwgZXM6IHBhcmFtcy5lcyB9KSkgKyAxMCxcbiAgICAgIFwic3RhcnRcIlxuICAgICk7XG4gIFxuICBsZXQgZGVtYW5kQ3VydmUgPSBwYW5lbC5hcHBlbmQoXCJnXCIpXG4gICAgLmNhbGwoY2xpcCwgaWQpXG4gICAgLmNhbGwoYWRkQ3VydmVGdWxsLCBpZCwgbWQsIHBhcmFtcywgeVNjYWxlcilcbiAgICAuY2FsbChcbiAgICAgIGFkZExhYmVsLCBcIkltcG9ydCBkZW1hbmRcIiwgXG4gICAgICB4U2NhbGVyKDcwKSxcbiAgICAgIHlTY2FsZXIoZGVtYW5kRnhuKHsgcTogNTAsIGVkOiBwYXJhbXMuZWQgfSkpXG4gICAgKTtcbiAgXG4gIGxldCBzdXBwbHlHdWlkZSA9IHBhbmVsLmFwcGVuZChcImdcIilcbiAgICAuY2FsbCh5R3VpZGUsIHhzLCB7IHE6IHF0U3RhciwgZXM6IHBhcmFtcy5lcyB9LCB5U2NhbGVyLCBcIiwuMWZcIik7XG4gIHN1cHBseUd1aWRlLnNlbGVjdChcInRleHRcIilcbiAgICAuc3R5bGUoXCJmaWxsXCIsIFwiI2IzYjNiM1wiKTtcbiAgXG4gIGxldCBkZW1hbmRHdWlkZXNUYXhlZCA9IHBhbmVsLmFwcGVuZChcImdcIilcbiAgICAuY2FsbCh5R3VpZGUsIG1kLCB7IHE6IHF0U3RhciwgZWQ6IHBhcmFtcy5lZCB9LCB5U2NhbGVyLCBcIiwuMWZcIilcbiAgICAuY2FsbCh4R3VpZGVzLCB4c3QsIHsgcTogcXRTdGFyLCBlczogcGFyYW1zLmVzLCB0OiBwYXJhbXMudCB9LCB5U2NhbGVyKTtcbiAgXG4gIHBhbmVsLmNhbGwocGFuZWxBeGVzLCBheGlzVGl0bGVzKTtcbiAgICBcbiAgLy8gU2Nyb2xsIGFuaW1hdGlvbnNcbiAgXG4gIHN1cHBseVRheGVkQ3VydmVMYWJlbC5zdHlsZShcIm9wYWNpdHlcIiwgKCkgPT4ge1xuICAgIHJldHVybiBmYWRlSW4ocHRzWzFdKShwcm9nKTtcbiAgfSlcbiAgXG4gIHJldmVudWUuc3R5bGUoXCJvcGFjaXR5XCIsICgpID0+IHtcbiAgICByZXR1cm4gZmFkZUluKHB0c1syXSkocHJvZyk7XG4gIH0pXG4gIFxuICBkd2wuc3R5bGUoXCJvcGFjaXR5XCIsICgpID0+IHtcbiAgICByZXR1cm4gZmFkZUluKHB0c1szXSkocHJvZyk7XG4gIH0pXG4gIFxuICByZXR1cm4gY29udGFpbmVyLm5vZGUoKTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IntcbiAgY29uc3QgaWQgPSBkMy5yYW5kb21JbnQoMTAwMDAwLCAxMDAwMDAwKSgpO1xuICBjb25zdCBwYXJhbXMgPSB7IHE6IG51bGwsIHA6IG51bGwsIGVzOiBudWxsLCBlZDogbnVsbCwgdDogbnVsbCB9O1xuICBjb25zdCBheGlzVGl0bGVzID0geyB4OiBcIk91dHB1dFwiLCB5OiBcIiQvdW5pdFwiIH07XG5cbiAgcGFyYW1zLmVzID0gMS41O1xuICBwYXJhbXMuZWQgPSAtMS4yNTtcbiAgcGFyYW1zLnQgPSAuODtcbiAgcGFyYW1zLnEgPSBxU3RhcihwYXJhbXMpO1xuICBsZXQgcXRTdGFyID0gTWF0aC5yb3VuZCgtMTYuNTggKiBNYXRoLnBvdyhwYXJhbXMudCwgLjc4KSArIDQ2LjQ0KTtcbiAgcGFyYW1zLnAgPSBzdXBwbHlGeG4ocGFyYW1zKTtcbiAgXG4gIGNvbnN0IHlTY2FsZXIgPSBkMy5zY2FsZUxpbmVhcigpXG4gICAgLmRvbWFpbihbMCwgbWF4LnBdKVxuICAgIC5yYW5nZShbZGltLmhlaWdodCwgcGFkZGluZy50b3BdKTtcbiAgXG4gIC8vIERpYWdyYW1cbiAgXG4gIGNvbnN0IGNvbnRhaW5lciA9IGQzLmNyZWF0ZShcImRpdlwiKVxuICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJkaWFncmFtXCIpO1xuICBcbiAgY29uc3Qgc3ZnID0gY29udGFpbmVyLmFwcGVuZChcInN2Z1wiKVxuICAgIC5hdHRyKFwid2lkdGhcIiwgXCIxMDAlXCIpXG4gICAgLmF0dHIoXCJ2aWV3Qm94XCIsIFtcbiAgICAgIDAsIDAsIFxuICAgICAgZGltLndpZHRoICsgbWFyZ2luLmxlZnQgKyBtYXJnaW4ucmlnaHQsIFxuICAgICAgZGltLmhlaWdodCArIG1hcmdpbi50b3AgKyBtYXJnaW4uYm90dG9tXG4gICAgXSlcbiAgICAuY2FsbChkcmF3QmFja2dyb3VuZCk7XG4gIFxuICBjb25zdCBwYW5lbCA9IHN2Zy5hcHBlbmQoXCJnXCIpXG4gICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgYHRyYW5zbGF0ZSgkeyBtYXJnaW4ubGVmdCB9LCR7IG1hcmdpbi50b3AgfSlgKTtcbiAgXG4gIGxldCBjcyA9IHBhbmVsLmFwcGVuZChcImdcIilcbiAgICAuY2FsbChjbGlwV2lkZSwgaWQpXG4gICAgLmNhbGwoYWRkQXJlYUN1cnZlLCBpZCwgbWQsIHsgcTogcXRTdGFyLCBlZDogcGFyYW1zLmVkIH0sIHlTY2FsZXIpO1xuICAgIFxuICBsZXQgcHMgPSBwYW5lbC5hcHBlbmQoXCJnXCIpXG4gICAgLmNhbGwoYWRkQXJlYUN1cnZlLCBpZCwgeHMsIHsgcTogcXRTdGFyLCBlczogcGFyYW1zLmVzIH0sIHlTY2FsZXIpO1xuICBcbiAgbGV0IGR3bENvbnN1bWVyID0gcGFuZWwuYXBwZW5kKFwiZ1wiKVxuICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJhcmVhLWR3bFwiKVxuICAgIC5jYWxsKGFkZEFyZWFDdXJ2ZSwgaWQsIG1kLCB7IGVkOiBwYXJhbXMuZWQgfSwgeVNjYWxlciwgMzMsIDQ2KTtcbiAgICBcbiAgbGV0IGR3bFByb2R1Y2VyID0gcGFuZWwuYXBwZW5kKFwiZ1wiKVxuICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJhcmVhLWR3bFwiKVxuICAgIC5jYWxsKGFkZEFyZWFDdXJ2ZSwgaWQsIHhzLCB7IGVzOiBwYXJhbXMuZXMgfSwgeVNjYWxlciwgMzMsIDQ2KTtcbiAgICBcbiAgbGV0IHJldmVudWUgPSBwYW5lbC5hcHBlbmQoXCJnXCIpXG4gICAgLmNhbGwoYWRkQXJlYUJveCwgXG4gICAgICBpZCwgXG4gICAgICB7IGlkOiBcInJldmVudWVcIiwgbGFiZWw6IFwiR292ZXJubWVudCByZXZlbnVlc1wiIH0sIFxuICAgICAgeyBcbiAgICAgICAgeDE6IDAsIFxuICAgICAgICB5MTogeVNjYWxlcihzdXBwbHlGeG4oeyBxOiBxdFN0YXIsIGVzOiBwYXJhbXMuZXMgfSkpLCBcbiAgICAgICAgeDI6IHhTY2FsZXIocXRTdGFyKSwgXG4gICAgICAgIHkyOiB5U2NhbGVyKGRlbWFuZEZ4bih7IHE6IHF0U3RhciwgZWQ6IHBhcmFtcy5lZCB9KSkgXG4gICAgICB9XG4gICAgKTtcbiAgXG4gIGxldCBsb3N0U3VycGx1c1JldmVudWVEZW1hbmQgPSBwYW5lbC5hcHBlbmQoXCJnXCIpXG4gICAgLmNhbGwoYWRkQXJlYUJveCwgXG4gICAgICBpZCwgXG4gICAgICB7IGlkOiBcImR3bC1jb25zdW1lci1yZXZlbnVlXCIgfSwgXG4gICAgICB7IFxuICAgICAgICB4MTogMCwgXG4gICAgICAgIHkxOiB5U2NhbGVyKGRlbWFuZEZ4bihwYXJhbXMpKSwgXG4gICAgICAgIHgyOiB4U2NhbGVyKHF0U3RhciksIFxuICAgICAgICB5MjogeVNjYWxlcihkZW1hbmRGeG4oeyBxOiBxdFN0YXIsIGVkOiBwYXJhbXMuZWQgfSkpIFxuICAgICAgfVxuICAgICk7XG4gIFxuICBjb25zb2xlLmxvZyhkZW1hbmRGeG4oeyBxOiBxdFN0YXIsIGVkOiBwYXJhbXMuZWQgfSkpXG4gIFxuICBsZXQgbG9zdFN1cnBsdXNSZXZlbnVlU3VwcGx5ID0gcGFuZWwuYXBwZW5kKFwiZ1wiKVxuICAgIC5jYWxsKGFkZEFyZWFCb3gsIFxuICAgICAgaWQsIFxuICAgICAgeyBpZDogXCJkd2wtcHJvZHVjZXItcmV2ZW51ZVwiIH0sIFxuICAgICAgeyBcbiAgICAgICAgeDE6IDAsIFxuICAgICAgICB5MTogeVNjYWxlcihzdXBwbHlGeG4ocGFyYW1zKSksIFxuICAgICAgICB4MjogeFNjYWxlcihxdFN0YXIpLCBcbiAgICAgICAgeTI6IHlTY2FsZXIoc3VwcGx5RnhuKHsgcTogcXRTdGFyLCBlczogcGFyYW1zLmVzIH0pKSBcbiAgICAgIH1cbiAgICApO1xuICBcbiAgbGV0IHN1cHBseVRheGVkQ3VydmUgPSBwYW5lbC5hcHBlbmQoXCJnXCIpXG4gICAgLmNhbGwoY2xpcCwgaWQpXG4gICAgLmNhbGwoYWRkQ3VydmVGdWxsLCBpZCwgeHN0LCBwYXJhbXMsIHlTY2FsZXIpO1xuICBcbiAgbGV0IHN1cHBseVRheGVkQ3VydmVMYWJlbCA9IHBhbmVsLmFwcGVuZChcImdcIilcbiAgICAuY2FsbChcbiAgICAgIGFkZExhYmVsLCBcIlN1cHBseSB3aXRoIHRhcmlmZlwiLCBcbiAgICAgIHhTY2FsZXIoNzApIC0gMTUsIFxuICAgICAgeVNjYWxlcihzdXBwbHlUYXhlZEZ4bih7IHE6IDcwLCBlczogcGFyYW1zLmVzLCB0OiBwYXJhbXMudCB9KSksXG4gICAgICBcImVuZFwiXG4gICAgKTtcbiAgXG4gIGxldCBzdXBwbHlDdXJ2ZSA9IHBhbmVsLmFwcGVuZChcImdcIilcbiAgICAuY2FsbChjbGlwLCBpZClcbiAgICAuY2FsbChhZGRDdXJ2ZUZ1bGwsIGlkLCB4cywgcGFyYW1zLCB5U2NhbGVyKVxuICAgIC5jYWxsKFxuICAgICAgYWRkTGFiZWwsIFwiRXhwb3J0IHN1cHBseVwiLCBcbiAgICAgIHhTY2FsZXIoNzApICsgMTUsIFxuICAgICAgeVNjYWxlcihzdXBwbHlGeG4oeyBxOiA3MCwgZXM6IHBhcmFtcy5lcyB9KSkgKyAxMCxcbiAgICAgIFwic3RhcnRcIlxuICAgICk7XG4gIFxuICBsZXQgZGVtYW5kQ3VydmUgPSBwYW5lbC5hcHBlbmQoXCJnXCIpXG4gICAgLmNhbGwoY2xpcCwgaWQpXG4gICAgLmNhbGwoYWRkQ3VydmVGdWxsLCBpZCwgbWQsIHBhcmFtcywgeVNjYWxlcilcbiAgICAuY2FsbChcbiAgICAgIGFkZExhYmVsLCBcIkltcG9ydCBkZW1hbmRcIiwgXG4gICAgICB4U2NhbGVyKDcwKSxcbiAgICAgIHlTY2FsZXIoZGVtYW5kRnhuKHsgcTogNTAsIGVkOiBwYXJhbXMuZWQgfSkpXG4gICAgKTtcbiAgXG4gIGxldCBzdXBwbHlHdWlkZSA9IHBhbmVsLmFwcGVuZChcImdcIilcbiAgICAuY2FsbCh5R3VpZGUsIHhzLCB7IHE6IHF0U3RhciwgZXM6IHBhcmFtcy5lcyB9LCB5U2NhbGVyLCBcIiwuMWZcIik7XG4gIHN1cHBseUd1aWRlLnNlbGVjdChcInRleHRcIilcbiAgICAuc3R5bGUoXCJmaWxsXCIsIFwiI2IzYjNiM1wiKTtcbiAgXG4gIGxldCBkZW1hbmRHdWlkZXNUYXhlZCA9IHBhbmVsLmFwcGVuZChcImdcIilcbiAgICAuY2FsbCh5R3VpZGUsIG1kLCB7IHE6IHF0U3RhciwgZWQ6IHBhcmFtcy5lZCB9LCB5U2NhbGVyLCBcIiwuMWZcIilcbiAgICAuY2FsbCh4R3VpZGVzLCB4c3QsIHsgcTogcXRTdGFyLCBlczogcGFyYW1zLmVzLCB0OiBwYXJhbXMudCB9LCB5U2NhbGVyKTtcbiAgXG4gIGxldCBndWlkZXNFcSA9IHBhbmVsLmFwcGVuZChcImdcIilcbiAgICAuY2FsbCh5R3VpZGUsIHhzLCBwYXJhbXMsIHlTY2FsZXIsIFwiLC4xZlwiKVxuICAgIC5jYWxsKHhHdWlkZXMsIHhzLCBwYXJhbXMsIHlTY2FsZXIpO1xuXG4gIHBhbmVsLmNhbGwocGFuZWxBeGVzLCBheGlzVGl0bGVzKTtcbiAgICBcbiAgLy8gU2Nyb2xsIGFuaW1hdGlvbnNcbiAgXG4gIGNvbnN0IHB0cyA9IFtcbiAgICB7IHN0YXJ0OiAuMTI1LCBlbmQ6IC4xNDUgfSwgIC8vIDBcbiAgICB7IHN0YXJ0OiAuMjc1LCBlbmQ6IC4yOTUgfSwgIC8vIDFcbiAgICB7IHN0YXJ0OiAuNDMwLCBlbmQ6IC40NTAgfSwgIC8vIDJcbiAgICB7IHN0YXJ0OiAuNTkwLCBlbmQ6IC42MTAgfSwgIC8vIDNcbiAgICB7IHN0YXJ0OiAuNzQwLCBlbmQ6IC43NjAgfSwgIC8vIDRcbiAgICB7IHN0YXJ0OiAuODk1LCBlbmQ6IC45MTUgfSwgIC8vIDVcbiAgXTtcbiAgXG4gIGNzLnN0eWxlKFwib3BhY2l0eVwiLCAoKSA9PiB7XG4gICAgcmV0dXJuIGZhZGVPdXQocHRzWzBdKShwcm9nKTtcbiAgfSk7XG4gIFxuICBwcy5zdHlsZShcIm9wYWNpdHlcIiwgKCkgPT4ge1xuICAgIHJldHVybiBmYWRlT3V0KHB0c1swXSkocHJvZyk7XG4gIH0pO1xuICBcbiAgcmV2ZW51ZS5zdHlsZShcIm9wYWNpdHlcIiwgKCkgPT4ge1xuICAgIHJldHVybiBmYWRlT3V0KHB0c1sxXSkocHJvZyk7XG4gIH0pO1xuICBcbiAgZHdsUHJvZHVjZXIuc3R5bGUoXCJvcGFjaXR5XCIsICgpID0+IHtcbiAgICBpZiAocHJvZyA+PSBwdHNbMV0uc3RhcnQgJiYgcHJvZyA8IHB0c1szXS5zdGFydCkge1xuICAgICAgcmV0dXJuIGZhZGVPdXQocHRzWzFdKShwcm9nKTtcbiAgICB9IGVsc2UgaWYgKHByb2cgPj0gcHRzWzNdLnN0YXJ0ICYmIHByb2cgPCBwdHNbNF0uc3RhcnQpIHtcbiAgICAgIHJldHVybiBmYWRlSW4ocHRzWzNdKShwcm9nKTtcbiAgICB9IGVsc2UgaWYgKHByb2cgPj0gcHRzWzRdLnN0YXJ0KSB7XG4gICAgICByZXR1cm4gZmFkZU91dChwdHNbNF0pKHByb2cpO1xuICAgIH1cbiAgfSk7XG4gIFxuICBkd2xDb25zdW1lci5zdHlsZShcIm9wYWNpdHlcIiwgKCkgPT4ge1xuICAgIGlmIChwcm9nID49IHB0c1sxXS5zdGFydCAmJiBwcm9nIDwgcHRzWzRdLnN0YXJ0KSB7XG4gICAgICByZXR1cm4gZmFkZU91dChwdHNbMV0pKHByb2cpO1xuICAgIH0gZWxzZSBpZiAocHJvZyA+PSBwdHNbNF0uc3RhcnQpIHtcbiAgICAgIHJldHVybiBmYWRlSW4ocHRzWzRdKShwcm9nKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIDE7XG4gICAgfVxuICB9KTtcbiAgXG4gIGxvc3RTdXJwbHVzUmV2ZW51ZVN1cHBseS5zdHlsZShcIm9wYWNpdHlcIiwgKCkgPT4ge1xuICAgIGlmIChwcm9nID49IHB0c1sxXS5zdGFydCAmJiBwcm9nIDwgcHRzWzJdLnN0YXJ0KSB7XG4gICAgICByZXR1cm4gZmFkZUluKHB0c1sxXSkocHJvZyk7XG4gICAgfSBlbHNlIGlmIChwcm9nID49IHB0c1syXS5zdGFydCAmJiBwcm9nIDwgcHRzWzVdLnN0YXJ0KSB7XG4gICAgICByZXR1cm4gZmFkZU91dChwdHNbMl0pKHByb2cpO1xuICAgIH0gZWxzZSBpZiAocHJvZyA+PSBwdHNbNV0uc3RhcnQpIHtcbiAgICAgIHJldHVybiBmYWRlSW4ocHRzWzVdKShwcm9nKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIDA7XG4gICAgfVxuICB9KTtcbiAgXG4gIGxvc3RTdXJwbHVzUmV2ZW51ZURlbWFuZC5zdHlsZShcIm9wYWNpdHlcIiwgKCkgPT4ge1xuICAgIGlmIChwcm9nID49IHB0c1syXS5zdGFydCAmJiBwcm9nIDwgcHRzWzNdLnN0YXJ0KSB7XG4gICAgICByZXR1cm4gZmFkZUluKHB0c1syXSkocHJvZyk7XG4gICAgfSBlbHNlIGlmIChwcm9nID49IHB0c1szXS5zdGFydCkge1xuICAgICAgcmV0dXJuIGZhZGVPdXQocHRzWzNdKShwcm9nKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIDA7XG4gICAgfVxuICB9KTtcbiAgXG4gIHJldHVybiBjb250YWluZXIubm9kZSgpO1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC02IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiXG5wcm9nID0gY3JQcm9ncmVzc0Jsb2NrO1xuXG5kaW0gPSAoeyB3aWR0aDogNDAwLCBoZWlnaHQ6IDI4MCB9KTtcbnBhZGRpbmcgPSAoeyB0b3A6IDEwLCByaWdodDogMTAgfSk7XG5tYXJnaW4gPSAoeyB0b3A6IDUwLCByaWdodDogMTAwLCBib3R0b206IDQwLCBsZWZ0OiA3MCB9KTtcblxuYmx1ZSA9ICh7IFxuICBiYXNlOiBcIiM0ODg5YWJcIiwgXG4gIGR1bGw6IFwiI0EyQzREMlwiLCBcbiAgYmFzZVNlbGVjdDogXCIjMEM2MjkxXCIsIFxuICBkdWxsU2VsZWN0OiBcIiM2NjlEQjhcIlxufSk7XG5cbnJlZCA9ICh7IFxuICBiYXNlOiBcIiNDODVCODlcIiwgXG4gIGR1bGw6IFwiI0UyOUZCQ1wiLCBcbiAgYmFzZVNlbGVjdDogXCIjQjEzRDcwXCIsIFxuICBkdWxsU2VsZWN0OiBcIiNEMTcyOUFcIiBcbn0pO1xuXG5ncmVlbiA9ICh7IFxuICBiYXNlOiBcIiM3MUI3OTVcIiwgXG4gIGR1bGw6IFwiI0I0RDdDNlwiLCBcbiAgYmFzZVNlbGVjdDogXCIjNDE4NDYyXCIsIFxuICBkdWxsU2VsZWN0OiBcIiM3M0FBOEVcIiBcbn0pO1xuXG5ncmF5ID0gKHsgXG4gIGJhc2U6IFwiI0RERERERFwiLCBcbiAgZHVsbDogXCIjREREREREXCIsIFxuICBiYXNlU2VsZWN0OiBcIiNEMEQwRDBcIiwgXG4gIGR1bGxTZWxlY3Q6IFwiI0QwRDBEMFwiIFxufSk7XG5cbnRvb2x0aXAgPSBkMy5zZWxlY3QoXCJib2R5XCIpXG4gIC5hcHBlbmQoXCJkaXZcIilcbiAgLmF0dHIoXCJjbGFzc1wiLCBcInRvb2x0aXBcIik7XG5cbmxpbmUgPSBkMy5saW5lKCkuY3VydmUoZDMuY3VydmVCYXNpcyk7XG4gIFxueFNjYWxlciA9IGQzLnNjYWxlTGluZWFyKClcbiAgLmRvbWFpbihbMCwgbWF4LnFdKVxuICAucmFuZ2UoWzAsIGRpbS53aWR0aCAtIHBhZGRpbmcucmlnaHRdKTtcbiAgXG5mdW5jdGlvbiBkYXRhKGZ4biwgcGFyYW1zLCB5U2NhbGVyLCBzdGFydCA9IDAsIGVuZCA9IHBhcmFtcy5xKSB7XG5cbiAgY29uc3QgcSA9IHBhcmFtcy5xLCBcbiAgICBwID0gcGFyYW1zLnAsIFxuICAgIGVzID0gcGFyYW1zLmVzLFxuICAgIGVkID0gcGFyYW1zLmVkLFxuICAgIHQgPSBwYXJhbXMudDtcbiAgXG4gIHJldHVybiBBcnJheS5mcm9tKHsgbGVuZ3RoOiBlbmQgLSBzdGFydCArIDEgfSwgKF8sIGkpID0+IHtcbiAgICBjb25zdCBpbmRleCA9IGkgKyBzdGFydFxuICAgIGNvbnN0IHkgPSB5U2NhbGVyKGZ4bih7IHE6IGluZGV4LCBwLCBlcywgZWQsIHQgfSkpID8/IC01MDA7XG4gICAgY29uc3QgeCA9ICh5ID09IG51bGwpID8gbnVsbCA6IHhTY2FsZXIoaW5kZXgpO1xuICAgIHJldHVybiBbeCwgeV07XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBkYXRhTWF4KGZ4biwgcGFyYW1zLCB5U2NhbGVyKSB7XG5cbiAgY29uc3QgcSA9IG1heC5xLCBcbiAgICBwID0gcGFyYW1zLnAsIFxuICAgIGVzID0gcGFyYW1zLmVzLFxuICAgIGVkID0gcGFyYW1zLmVkLFxuICAgIHQgPSBwYXJhbXMudDtcblxuICByZXR1cm4gQXJyYXkuZnJvbSh7IGxlbmd0aDogcSArIDEgfSwgKF8sIGkpID0+IHtcbiAgICBjb25zdCB5ID0geVNjYWxlcihmeG4oeyBxOiBpLCBwLCBlcywgZWQsIHQgfSkpID8/IC01MDA7XG4gICAgY29uc3QgeCA9ICh5ID09IG51bGwpID8gbnVsbCA6IHhTY2FsZXIoaSk7XG4gICAgcmV0dXJuIFt4LCB5XTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIGZhZGVJbih7c3RhcnQsIGVuZH0pIHtcbiAgcmV0dXJuIGQzLnNjYWxlTGluZWFyKClcbiAgICAuZG9tYWluKFtzdGFydCwgZW5kXSlcbiAgICAucmFuZ2UoWzAsIDFdKVxuICAgIC5jbGFtcCh0cnVlKTtcbn1cblxuZnVuY3Rpb24gZmFkZU91dCh7c3RhcnQsIGVuZH0pIHtcbiAgcmV0dXJuIGQzLnNjYWxlTGluZWFyKClcbiAgICAuZG9tYWluKFtzdGFydCwgZW5kXSlcbiAgICAucmFuZ2UoWzEsIDBdKVxuICAgIC5jbGFtcCh0cnVlKTtcbn1cblxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC03IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiXG5tYXggPSAoeyBxOiA5NSwgcDogMjcgfSk7XG5jb25zdGFudCA9ICh7IGFzOiA1MCwgYWQ6IDc1MCwgYnM6IDMsIGJkOiAzIH0pO1xuXG5mdW5jdGlvbiBzdXBwbHlGeG4oeyBxLCBlcyB9ID0ge30pIHtcbiAgcmV0dXJuICgxIC8gY29uc3RhbnQuYXMpICogTWF0aC5wb3cocSwgZXMpICsgY29uc3RhbnQuYnM7XG59XG5cbmZ1bmN0aW9uIHN1cHBseVRheGVkRnhuKHsgcSwgZXMsIHQgfSA9IHt9KSB7XG4gIHJldHVybiAoMSArIHQpICogKCgxIC8gY29uc3RhbnQuYXMpICogTWF0aC5wb3cocSwgZXMpICsgY29uc3RhbnQuYnMpO1xufVxuXG5mdW5jdGlvbiBkZW1hbmRGeG4oeyBxLCBlZCB9ID0ge30pIHtcbiAgaWYgKHEgPT09IDApIHtcbiAgICByZXR1cm4gY29uc3RhbnQuYWQgKiAxMDtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gY29uc3RhbnQuYWQgKiBNYXRoLnBvdyhxLCBlZCkgKyBjb25zdGFudC5iZDtcbiAgfVxufVxuXG5mdW5jdGlvbiBxU3Rhcih7IGVzLCBlZCB9ID0ge30pIHtcbiAgY29uc3QgcmF3USA9IE1hdGgucG93KGNvbnN0YW50LmFzICogY29uc3RhbnQuYWQsIDEgLyAoZXMgLSBlZCkpO1xuICByZXR1cm4gTWF0aC5yb3VuZChyYXdRKTtcbn1cblxuZnVuY3Rpb24gcXRTdGFyKHsgZXMsIGVkIH0gPSB7fSkge1xuICBjb25zdCByYXdRID0gTWF0aC5wb3coY29uc3RhbnQuYXMgKiBjb25zdGFudC5hZCwgMSAvIChlcyAtIGVkKSk7XG4gIHJldHVybiBNYXRoLnJvdW5kKHJhd1EpO1xufVxuXG54cyA9ICh7IFxuICBmeG46IHN1cHBseUZ4biwgXG4gIGxhYmVsOiBcIkV4cG9ydCBzdXBwbHkgY3VydmVcIiwgXG4gIGFyZWFMYWJlbDogXCJGaXJtIHN1cnBsdXNcIixcbiAgaWQ6IFwieHMtY3VydmVcIiwgXG4gIHNjaGVtZTogZ3JlZW4gXG59KTtcblxueHN0ID0gKHsgXG4gIGZ4bjogc3VwcGx5VGF4ZWRGeG4sIFxuICBsYWJlbDogXCJTdXBwbHkgd2l0aCB0YXJpZmZcIiwgXG4gIGFyZWFMYWJlbDogbnVsbCxcbiAgaWQ6IFwieHN0LWN1cnZlXCIsIFxuICBzY2hlbWU6IHJlZCBcbn0pO1xuXG5tZCA9ICh7IFxuICBmeG46IGRlbWFuZEZ4biwgXG4gIGxhYmVsOiBcIkltcG9ydCBkZW1hbmQgY3VydmVcIiwgXG4gIGFyZWFMYWJlbDogXCJDb25zdW1lciBzdXJwbHVzXCIsXG4gIGlkOiBcIm1kLWN1cnZlXCIsIFxuICBzY2hlbWU6IGJsdWUgXG59KTtcblxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC04IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiXG5mdW5jdGlvbiBkcmF3QmFja2dyb3VuZChzZWxlY3Rpb24pIHtcblxuICBzZWxlY3Rpb24uYXBwZW5kKFwicmVjdFwiKVxuICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJiZ1wiKVxuICAgIC5hdHRyKFwieFwiLCAwKS5hdHRyKFwieVwiLCAwKVxuICAgIC5hdHRyKFwid2lkdGhcIiwgc2VsZWN0aW9uLmF0dHIoXCJ3aWR0aFwiKSlcbiAgICAuYXR0cihcImhlaWdodFwiLCBcIjEwMCVcIik7XG59XG5cbmZ1bmN0aW9uIGFkZEN1cnZlKHNlbGVjdGlvbiwgXG4gICAgICAgICAgICAgICAgICBpZCwgXG4gICAgICAgICAgICAgICAgICBmeG5JbmZvLCBcbiAgICAgICAgICAgICAgICAgIHBhcmFtcywgXG4gICAgICAgICAgICAgICAgICB5U2NhbGVyLCBcbiAgICAgICAgICAgICAgICAgIHN0YXJ0ID0gMCwgXG4gICAgICAgICAgICAgICAgICBlbmQgPSBwYXJhbXMucSkge1xuXG4gIGNvbnN0IHBvaW50ID0gZGF0YShmeG5JbmZvLmZ4biwgcGFyYW1zLCB5U2NhbGVyLCBzdGFydCwgZW5kKVtwYXJhbXMucV1cblxuICBjb25zdCBjdXJ2ZXMgPSBzZWxlY3Rpb24uYXBwZW5kKFwiZ1wiKVxuICAgIC5hdHRyKFwiaWRcIiwgYCR7IGZ4bkluZm8uaWQgfS0keyBpZCB9YClcbiAgICAuYXR0cihcInBvaW50ZXItZXZlbnRzXCIsIFwidmlzaWJsZVN0cm9rZVwiKVxuICBcbiAgLy8gTm9uLWhpZ2hsaWdodGVkIHBvcnRpb25cbiAgY3VydmVzLmFwcGVuZChcInBhdGhcIilcbiAgICAuYXR0cihcImNsYXNzXCIsIFwiY3VydmUgZHVsbGVkXCIpXG4gICAgLmF0dHIoXCJkXCIsIGxpbmUoZGF0YShmeG5JbmZvLmZ4biwgcGFyYW1zLCB5U2NhbGVyLCBzdGFydCwgbWF4LnEpKSlcbiAgICAuc3R5bGUoXCJzdHJva2VcIiwgZnhuSW5mby5zY2hlbWUuZHVsbCk7XG4gIFxuICAvLyBIaWdobGlnaHRlZCBwb3J0aW9uXG4gIGN1cnZlcy5hcHBlbmQoXCJwYXRoXCIpXG4gICAgLmF0dHIoXCJjbGFzc1wiLCBcImN1cnZlIGNvbG9yZWRcIilcbiAgICAuYXR0cihcImRcIiwgbGluZShkYXRhKGZ4bkluZm8uZnhuLCBwYXJhbXMsIHlTY2FsZXIsIHN0YXJ0LCBlbmQpKSlcbiAgICAuc3R5bGUoXCJzdHJva2VcIiwgZnhuSW5mby5zY2hlbWUuYmFzZSk7XG5cbiAgLy8gQWRkIGhvdmVyIGVmZmVjdHNcbiAgY3VydmVzXG4gICAgLm9uKFwibW91c2Vtb3ZlXCIsIChldmVudCkgPT4ge1xuXG4gICAgICBkMy5zZWxlY3RBbGwoYCMkeyBmeG5JbmZvLmlkIH0tJHsgaWQgfSAuY3VydmUuY29sb3JlZGApXG4gICAgICAgIC5jbGFzc2VkKFwiaG92ZXJlZFwiLCB0cnVlKVxuICAgICAgICAuc3R5bGUoXCJzdHJva2VcIiwgZnhuSW5mby5zY2hlbWUuYmFzZVNlbGVjdCk7XG5cbiAgICAgIGQzLnNlbGVjdEFsbChgIyR7IGZ4bkluZm8uaWQgfS0keyBpZCB9IC5jdXJ2ZS5kdWxsZWRgKVxuICAgICAgICAuY2xhc3NlZChcImhvdmVyZWRcIiwgdHJ1ZSlcbiAgICAgICAgLnN0eWxlKFwic3Ryb2tlXCIsIGZ4bkluZm8uc2NoZW1lLmR1bGxTZWxlY3QpO1xuXG4gICAgICB0b29sdGlwXG4gICAgICAgIC5zdHlsZShcImxlZnRcIiwgZXZlbnQucGFnZVggKyAxMCArIFwicHhcIilcbiAgICAgICAgLnN0eWxlKFwidG9wXCIsIGV2ZW50LnBhZ2VZICsgMTAgKyBcInB4XCIpXG4gICAgICAgIC5zdHlsZShcImRpc3BsYXlcIiwgXCJibG9ja1wiKVxuICAgICAgICAudGV4dChmeG5JbmZvLmxhYmVsKTtcbiAgICB9KVxuICAgIC5vbihcIm1vdXNlbGVhdmVcIiwgKGV2ZW50KSA9PiB7XG5cbiAgICAgIGQzLnNlbGVjdEFsbChgIyR7IGZ4bkluZm8uaWQgfS0keyBpZCB9IC5jdXJ2ZS5jb2xvcmVkYClcbiAgICAgICAgLmNsYXNzZWQoXCJob3ZlcmVkXCIsIGZhbHNlKVxuICAgICAgICAuc3R5bGUoXCJzdHJva2VcIiwgZnhuSW5mby5zY2hlbWUuYmFzZSk7XG5cbiAgICAgIGQzLnNlbGVjdEFsbChgIyR7IGZ4bkluZm8uaWQgfS0keyBpZCB9IC5jdXJ2ZS5kdWxsZWRgKVxuICAgICAgICAuY2xhc3NlZChcImhvdmVyZWRcIiwgZmFsc2UpXG4gICAgICAgIC5zdHlsZShcInN0cm9rZVwiLCBmeG5JbmZvLnNjaGVtZS5kdWxsKTtcblxuICAgICAgdG9vbHRpcC5zdHlsZShcImRpc3BsYXlcIiwgXCJub25lXCIpO1xuICAgIH0pO1xufVxuICBcbmZ1bmN0aW9uIGFkZEN1cnZlRnVsbChzZWxlY3Rpb24sIFxuICAgICAgICAgICAgICAgICAgICAgIGlkLCBcbiAgICAgICAgICAgICAgICAgICAgICBmeG5JbmZvLCBcbiAgICAgICAgICAgICAgICAgICAgICBwYXJhbXMsXG4gICAgICAgICAgICAgICAgICAgICAgeVNjYWxlciwgXG4gICAgICAgICAgICAgICAgICAgICAgc2NoZW1lID0gZnhuSW5mby5zY2hlbWUpIHtcbiAgXG4gIGNvbnN0IGN1cnZlcyA9IHNlbGVjdGlvbi5hcHBlbmQoXCJnXCIpXG4gICAgLmF0dHIoXCJpZFwiLCBgJHsgZnhuSW5mby5pZCB9LSR7IGlkIH1gKVxuICAgIC5hdHRyKFwicG9pbnRlci1ldmVudHNcIiwgXCJ2aXNpYmxlU3Ryb2tlXCIpO1xuICBcbiAgY3VydmVzLmFwcGVuZChcInBhdGhcIilcbiAgICAuYXR0cihcImNsYXNzXCIsIFwiY3VydmVcIilcbiAgICAuYXR0cihcImRcIiwgbGluZShkYXRhKGZ4bkluZm8uZnhuLCBwYXJhbXMsIHlTY2FsZXIsIDAsIG1heC5xKSkpXG4gICAgLnN0eWxlKFwic3Ryb2tlXCIsIHNjaGVtZS5iYXNlKTtcblxuICAvLyBBZGQgaG92ZXIgZWZmZWN0c1xuICBjdXJ2ZXNcbiAgICAub24oXCJtb3VzZW1vdmVcIiwgKGV2ZW50KSA9PiB7XG4gIFxuICAgICAgZDMuc2VsZWN0QWxsKGAjJHsgZnhuSW5mby5pZCB9LSR7IGlkIH0gLmN1cnZlYClcbiAgICAgICAgLmNsYXNzZWQoXCJob3ZlcmVkXCIsIHRydWUpXG4gICAgICAgIC5zdHlsZShcInN0cm9rZVwiLCBzY2hlbWUuYmFzZVNlbGVjdCk7XG4gIFxuICAgICAgdG9vbHRpcFxuICAgICAgICAuc3R5bGUoXCJsZWZ0XCIsIGV2ZW50LnBhZ2VYICsgMTggKyBcInB4XCIpXG4gICAgICAgIC5zdHlsZShcInRvcFwiLCBldmVudC5wYWdlWSArIDE4ICsgXCJweFwiKVxuICAgICAgICAuc3R5bGUoXCJkaXNwbGF5XCIsIFwiYmxvY2tcIilcbiAgICAgICAgLnRleHQoZnhuSW5mby5sYWJlbCk7XG4gIFxuICAgICAgZDMuc2VsZWN0KGV2ZW50LnRhcmdldCkuc3R5bGUoXCJjdXJzb3JcIiwgXCJwb2ludGVyXCIpO1xuICAgIH0pXG4gICAgLm9uKFwibW91c2VsZWF2ZVwiLCAoZXZlbnQpID0+IHtcbiAgXG4gICAgICBkMy5zZWxlY3RBbGwoYCMkeyBmeG5JbmZvLmlkIH0tJHsgaWQgfSAuY3VydmVgKVxuICAgICAgICAuY2xhc3NlZChcImhvdmVyZWRcIiwgZmFsc2UpXG4gICAgICAgIC5zdHlsZShcInN0cm9rZVwiLCBzY2hlbWUuYmFzZSk7XG4gIFxuICAgICAgdG9vbHRpcC5zdHlsZShcImRpc3BsYXlcIiwgXCJub25lXCIpO1xuICAgICAgZDMuc2VsZWN0KGV2ZW50LnRhcmdldCkuc3R5bGUoXCJjdXJzb3JcIiwgXCJkZWZhdWx0XCIpO1xuICAgIH0pO1xufVxuXG5mdW5jdGlvbiBhZGRBcmVhQm94KHNlbGVjdGlvbiwgaWQsIGluZm8sIGNvcm5lcnMpIHtcblxuICBpZiAoY29ybmVycy54MSA9PT0gdW5kZWZpbmVkKSBjb3JuZXJzLngxID0gMDtcbiAgaWYgKGNvcm5lcnMueDIgPT09IHVuZGVmaW5lZCkgY29ybmVycy54MiA9IDA7XG4gIGlmIChjb3JuZXJzLnkxID09PSB1bmRlZmluZWQpIGNvcm5lcnMueTEgPSAwO1xuICBpZiAoY29ybmVycy55MiA9PT0gdW5kZWZpbmVkKSBjb3JuZXJzLnkyID0gMDtcbiAgXG4gIGNvbnN0IGFyZWEgPSBzZWxlY3Rpb24uYXBwZW5kKFwicGF0aFwiKVxuICAgIC5hdHRyKFwiaWRcIiwgYGFyZWEtJHsgaW5mby5pZCB9LSR7IGlkIH1gKVxuICAgIC5hdHRyKFwiY2xhc3NcIiwgYGFyZWEgYXJlYS0keyBpbmZvLmlkIH1gKVxuICAgIC5hdHRyKFwiZFwiLCBkMy5saW5lKCkoWyBcbiAgICAgIFtjb3JuZXJzLngxLCBjb3JuZXJzLnkxXSwgXG4gICAgICBbY29ybmVycy54MiwgY29ybmVycy55MV0sXG4gICAgICBbY29ybmVycy54MiwgY29ybmVycy55Ml0sXG4gICAgICBbY29ybmVycy54MSwgY29ybmVycy55Ml1cbiAgICBdKSk7XG4gIFxuICAvLyBBZGQgaG92ZXIgZWZmZWN0c1xuICBhcmVhXG4gICAgLm9uKFwibW91c2Vtb3ZlXCIsIChldmVudCkgPT4ge1xuXG4gICAgICBkMy5zZWxlY3RBbGwoYCNhcmVhLSR7IGluZm8uaWQgfS0keyBpZCB9YClcbiAgICAgICAgLmNsYXNzZWQoXCJob3ZlcmVkXCIsIHRydWUpO1xuICBcbiAgICAgIHRvb2x0aXBcbiAgICAgICAgLnN0eWxlKFwibGVmdFwiLCBldmVudC5wYWdlWCArIDE4ICsgXCJweFwiKVxuICAgICAgICAuc3R5bGUoXCJ0b3BcIiwgZXZlbnQucGFnZVkgKyAxOCArIFwicHhcIilcbiAgICAgICAgLnN0eWxlKFwiZGlzcGxheVwiLCBcImJsb2NrXCIpXG4gICAgICAgIC50ZXh0KGluZm8ubGFiZWwpO1xuICBcbiAgICAgIGQzLnNlbGVjdChldmVudC50YXJnZXQpLnN0eWxlKFwiY3Vyc29yXCIsIFwicG9pbnRlclwiKTtcbiAgICB9KVxuICAgIC5vbihcIm1vdXNlbGVhdmVcIiwgKGV2ZW50KSA9PiB7XG4gIFxuICAgICAgZDMuc2VsZWN0QWxsKGAjYXJlYS0keyBpbmZvLmlkIH0tJHsgaWQgfWApXG4gICAgICAgIC5jbGFzc2VkKFwiaG92ZXJlZFwiLCBmYWxzZSk7XG4gIFxuICAgICAgdG9vbHRpcC5zdHlsZShcImRpc3BsYXlcIiwgXCJub25lXCIpO1xuICAgICAgZDMuc2VsZWN0KGV2ZW50LnRhcmdldCkuc3R5bGUoXCJjdXJzb3JcIiwgXCJkZWZhdWx0XCIpO1xuICAgIH0pO1xufVxuXG5mdW5jdGlvbiBhZGRBcmVhQ3VydmUoc2VsZWN0aW9uLCBcbiAgICAgICAgICAgICAgICAgICAgICBpZCwgXG4gICAgICAgICAgICAgICAgICAgICAgZnhuSW5mbywgXG4gICAgICAgICAgICAgICAgICAgICAgcGFyYW1zLCBcbiAgICAgICAgICAgICAgICAgICAgICB5U2NhbGVyLFxuICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0ID0gMCwgXG4gICAgICAgICAgICAgICAgICAgICAgZW5kID0gcGFyYW1zLnEpIHtcblxuICBjb25zdCBwYXJhbXNlbmQgPSB7IC4uLnBhcmFtcyB9O1xuICBwYXJhbXNlbmQucSA9IGVuZDtcbiAgY29uc3QgYXJlYSA9IHNlbGVjdGlvbi5hcHBlbmQoXCJwYXRoXCIpXG4gICAgLmF0dHIoXCJpZFwiLCBgYXJlYS0keyBmeG5JbmZvLmlkIH0tJHsgaWQgfWApXG4gICAgLmF0dHIoXCJjbGFzc1wiLCBcImFyZWEgYXJlYS1cIiArIGZ4bkluZm8uaWQpXG4gICAgLmF0dHIoXCJkXCIsIGBcbiAgICAgICR7IGxpbmUoZGF0YShmeG5JbmZvLmZ4biwgcGFyYW1zLCB5U2NhbGVyLCBzdGFydCwgZW5kKSkgfVxuICAgICAgTCAkeyB4U2NhbGVyKHN0YXJ0KSB9LCR7IHlTY2FsZXIoZnhuSW5mby5meG4ocGFyYW1zZW5kKSkgfSBaXG4gICAgYCk7XG4gIFxuICAvLyBBZGQgaG92ZXIgZWZmZWN0c1xuICBhcmVhXG4gICAgLm9uKFwibW91c2Vtb3ZlXCIsIChldmVudCkgPT4ge1xuICBcbiAgICAgIGQzLnNlbGVjdChgI2FyZWEtJHsgZnhuSW5mby5pZCB9LSR7IGlkIH1gKVxuICAgICAgICAuY2xhc3NlZChcImhvdmVyZWRcIiwgdHJ1ZSk7XG4gIFxuICAgICAgdG9vbHRpcFxuICAgICAgICAuc3R5bGUoXCJsZWZ0XCIsIGV2ZW50LnBhZ2VYICsgMTggKyBcInB4XCIpXG4gICAgICAgIC5zdHlsZShcInRvcFwiLCBldmVudC5wYWdlWSArIDE4ICsgXCJweFwiKVxuICAgICAgICAuc3R5bGUoXCJkaXNwbGF5XCIsIFwiYmxvY2tcIilcbiAgICAgICAgLnRleHQoZnhuSW5mby5hcmVhTGFiZWwpO1xuICBcbiAgICAgIGQzLnNlbGVjdChldmVudC50YXJnZXQpLnN0eWxlKFwiY3Vyc29yXCIsIFwicG9pbnRlclwiKTtcbiAgICB9KVxuICAgIC5vbihcIm1vdXNlbGVhdmVcIiwgKGV2ZW50KSA9PiB7XG4gIFxuICAgICAgZDMuc2VsZWN0QWxsKGAjYXJlYS0keyBmeG5JbmZvLmlkIH0tJHsgaWQgfWApXG4gICAgICAgIC5jbGFzc2VkKFwiaG92ZXJlZFwiLCBmYWxzZSk7XG4gIFxuICAgICAgdG9vbHRpcC5zdHlsZShcImRpc3BsYXlcIiwgXCJub25lXCIpO1xuICAgICAgZDMuc2VsZWN0KGV2ZW50LnRhcmdldCkuc3R5bGUoXCJjdXJzb3JcIiwgXCJkZWZhdWx0XCIpO1xuICAgIH0pO1xufVxuXG5mdW5jdGlvbiBhZGRBcmVhTG9zdFN1cnBsdXMoc2VsZWN0aW9uLCBpZCwgcGFyYW1zLCB5U2NhbGVyKSB7XG5cbiAgY29uc3QgcVN0YXIgPSA0NjtcbiAgY29uc3QgcXRTdGFyID0gMzM7XG4gIHBhcmFtcy5xID0gcVN0YXI7XG4gIGNvbnN0IHBhcmFtc3QgPSB7IC4uLnBhcmFtcyB9O1xuICBwYXJhbXN0LnEgPSBxdFN0YXI7XG4gIFxuICBjb25zdCBhcmVhID0gc2VsZWN0aW9uLmFwcGVuZChcImdcIilcbiAgICAuYXR0cihcImlkXCIsIGBhcmVhLWxvc3Qtc3VycGx1cy0ke2lkfWApXG4gICAgLmF0dHIoXCJjbGFzc1wiLCBcImFyZWEgYXJlYS1sb3N0LXN1cnBsdXNcIik7XG4gICAgXG4gIGNvbnN0IGFyZWFEZW1hbmREV0wgPSBhcmVhLmFwcGVuZChcInBhdGhcIilcbiAgICAuYXR0cihcImRcIiwgYFxuICAgICAgJHsgbGluZShkYXRhKGRlbWFuZEZ4biwgcGFyYW1zLCB5U2NhbGVyLCBxdFN0YXIsIHFTdGFyKSkgfVxuICAgICAgTCAkeyB4U2NhbGVyKHF0U3RhcikgfSwkeyB5U2NhbGVyKGRlbWFuZEZ4bihwYXJhbXMpKSB9IFpcbiAgICBgKTtcbiAgICBcbiAgY29uc3QgYXJlYVN1cHBseURXTCA9IGFyZWEuYXBwZW5kKFwicGF0aFwiKVxuICAgIC5hdHRyKFwiZFwiLCBgXG4gICAgICAkeyBsaW5lKGRhdGEoc3VwcGx5RnhuLCBwYXJhbXMsIHlTY2FsZXIsIHF0U3RhciwgcVN0YXIpKSB9XG4gICAgICBMICR7IHhTY2FsZXIocXRTdGFyKSB9LCR7IHlTY2FsZXIoc3VwcGx5RnhuKHBhcmFtcykpIH0gWlxuICAgIGApO1xuICBcbiAgY29uc3QgYXJlYVJldmVudWUgPSBhcmVhLmFwcGVuZChcInBhdGhcIilcbiAgICAuYXR0cihcImRcIiwgZDMubGluZSgpKFsgXG4gICAgICBbMCwgeVNjYWxlcihzdXBwbHlGeG4ocGFyYW1zdCkpXSwgXG4gICAgICBbeFNjYWxlcihxdFN0YXIpLCB5U2NhbGVyKHN1cHBseUZ4bihwYXJhbXN0KSldLFxuICAgICAgW3hTY2FsZXIocXRTdGFyKSwgeVNjYWxlcihkZW1hbmRGeG4ocGFyYW1zdCkpXSxcbiAgICAgIFswLCB5U2NhbGVyKGRlbWFuZEZ4bihwYXJhbXN0KSldXG4gICAgXSkpO1xufVxuXG5mdW5jdGlvbiBjbGlwKHNlbGVjdGlvbiwgaWQpIHtcbiAgICBcbiAgc2VsZWN0aW9uLmF0dHIoXCJjbGlwLXBhdGhcIiwgYHVybCgjY2xpcC0keyBpZCB9KWApO1xuICBcbiAgY29uc3QgY2xpcCA9IHNlbGVjdGlvbi5hcHBlbmQoXCJjbGlwUGF0aFwiKVxuICAgIC5hdHRyKFwiaWRcIiwgYGNsaXAtJHsgaWQgfWApO1xuXG4gIGNsaXAuYXBwZW5kKFwicmVjdFwiKVxuICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJjbGlwXCIpXG4gICAgLmF0dHIoXCJ4XCIsIDApXG4gICAgLmF0dHIoXCJ5XCIsIDApXG4gICAgLmF0dHIoXCJ3aWR0aFwiLCBkaW0ud2lkdGggKyBtYXJnaW4ucmlnaHQpXG4gICAgLmF0dHIoXCJoZWlnaHRcIiwgZGltLmhlaWdodCk7XG59XG5cbmZ1bmN0aW9uIGNsaXBXaWRlKHNlbGVjdGlvbiwgaWQpIHtcbiAgICBcbiAgc2VsZWN0aW9uLmF0dHIoXCJjbGlwLXBhdGhcIiwgYHVybCgjY2xpcC13aWRlLSR7aWR9KWApO1xuICBcbiAgY29uc3QgY2xpcCA9IHNlbGVjdGlvbi5hcHBlbmQoXCJjbGlwUGF0aFwiKVxuICAgIC5hdHRyKFwiaWRcIiwgYGNsaXAtd2lkZS0keyBpZCB9YCk7XG5cbiAgY2xpcC5hcHBlbmQoXCJyZWN0XCIpXG4gICAgLmF0dHIoXCJjbGFzc1wiLCBcImNsaXBcIilcbiAgICAuYXR0cihcInhcIiwgMClcbiAgICAuYXR0cihcInlcIiwgMClcbiAgICAuYXR0cihcIndpZHRoXCIsIGRpbS53aWR0aCArIG1hcmdpbi5yaWdodClcbiAgICAuYXR0cihcImhlaWdodFwiLCBkaW0uaGVpZ2h0KTtcblxuICBjbGlwLmFwcGVuZChcInJlY3RcIilcbiAgICAuYXR0cihcImNsYXNzXCIsIFwiY2xpcFwiKVxuICAgIC5hdHRyKFwieFwiLCAtbWFyZ2luLmxlZnQpXG4gICAgLmF0dHIoXCJ5XCIsIC0xMClcbiAgICAuYXR0cihcIndpZHRoXCIsIG1hcmdpbi5sZWZ0KVxuICAgIC5hdHRyKFwiaGVpZ2h0XCIsIGRpbS5oZWlnaHQgKyAyMCk7XG59XG5cbmZ1bmN0aW9uIHBhbmVsQXhlcyhzZWxlY3Rpb24sIHRpdGxlcykge1xuICBcbiAgY29uc3QgYXhlcyA9IHNlbGVjdGlvbi5hcHBlbmQoXCJnXCIpXG4gICAgLmF0dHIoXCJjbGFzc1wiLCBcImF4aXNcIik7XG4gIFxuICAvLyBBeGlzIGxpbmVzXG4gIGF4ZXMuYXBwZW5kKFwicGF0aFwiKVxuICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJheGlzLWxpbmVcIilcbiAgICAuYXR0cihcImRcIiwgZDMubGluZSgpKFtcbiAgICAgIFtkaW0ud2lkdGgsIGRpbS5oZWlnaHRdLCBcbiAgICAgIFswLCBkaW0uaGVpZ2h0XSwgWzAsIDBdXG4gICAgXSkpO1xuICBcbiAgLy8gQXhpcyB0aXRsZXMgICAgXG4gIGF4ZXMuYXBwZW5kKFwiZ1wiKVxuICAgIC5hcHBlbmQoXCJ0ZXh0XCIpXG4gICAgLmF0dHIoXCJjbGFzc1wiLCBcImF4aXMtdGV4dCBheGlzLXRleHQteFwiKVxuICAgIC50ZXh0KHRpdGxlcy54KVxuICAgIC5hdHRyKFwieFwiLCBkaW0ud2lkdGggKyAxMClcbiAgICAuYXR0cihcInlcIiwgZGltLmhlaWdodCk7XG4gIFxuICBheGVzLmFwcGVuZChcInRleHRcIilcbiAgICAuYXR0cihcImNsYXNzXCIsIFwiYXhpcy10ZXh0IGF4aXMtdGV4dC15XCIpXG4gICAgLnRleHQodGl0bGVzLnkpXG4gICAgLmF0dHIoXCJ4XCIsIDApXG4gICAgLmF0dHIoXCJ5XCIsIC0xNSk7XG59XG5cbmZ1bmN0aW9uIHhHdWlkZXMoc2VsZWN0aW9uLCBmeG5JbmZvLCBwYXJhbXMsIHlTY2FsZXIpIHtcbiAgICBcbiAgY29uc3QgcG9pbnQgPSBkYXRhKGZ4bkluZm8uZnhuLCBwYXJhbXMsIHlTY2FsZXIpW3BhcmFtcy5xXTtcbiAgY29uc3QgZ3VpZGUgPSBzZWxlY3Rpb24uYXBwZW5kKFwiZ1wiKVxuICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJndWlkZVwiKTtcbiAgXG4gIC8vIERhc2hlZCBsaW5lXG4gIGNvbnN0IGRhc2hlZExpbmUgPSBndWlkZS5hcHBlbmQoXCJwYXRoXCIpXG4gICAgLmF0dHIoXCJjbGFzc1wiLCBcImRhc2hlZC1saW5lXCIpXG4gICAgLmF0dHIoXCJkXCIsIGxpbmUoW1xuICAgICAgW3BvaW50WzBdLCBwb2ludFsxXV0sIFxuICAgICAgW3BvaW50WzBdLCBkaW0uaGVpZ2h0XVxuICAgIF0pKTtcbiAgXG4gIC8vIFRpY2tcbiAgY29uc3QgdGljayA9IGd1aWRlLmFwcGVuZChcInRleHRcIilcbiAgICAuYXR0cihcImNsYXNzXCIsIFwidGljayB0aWNrLXhcIilcbiAgICAudGV4dChkMy5mb3JtYXQoXCIsLjBmXCIpKHBhcmFtcy5xKSlcbiAgICAuYXR0cihcInhcIiwgeFNjYWxlcihwYXJhbXMucSkpXG4gICAgLmF0dHIoXCJ5XCIsIGRpbS5oZWlnaHQpO1xufVxuICAgIFxuZnVuY3Rpb24geUd1aWRlKHNlbGVjdGlvbiwgZnhuSW5mbywgcGFyYW1zLCB5U2NhbGVyLCBmb3JtYXQgPSBcIiwuMGZcIikge1xuICAgIFxuICBjb25zdCBwb2ludCA9IGRhdGEoZnhuSW5mby5meG4sIHBhcmFtcywgeVNjYWxlcilbcGFyYW1zLnFdO1xuICBjb25zdCBndWlkZSA9IHNlbGVjdGlvbi5hcHBlbmQoXCJnXCIpXG4gICAgLmF0dHIoXCJjbGFzc1wiLCBcImd1aWRlXCIpO1xuICBcbiAgLy8gRGFzaGVkIGxpbmVcbiAgZ3VpZGUuYXBwZW5kKFwicGF0aFwiKVxuICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJkYXNoZWQtbGluZVwiKVxuICAgIC5hdHRyKFwiZFwiLCBsaW5lKFtcbiAgICAgIFtwb2ludFswXSwgcG9pbnRbMV1dLCBcbiAgICAgIFswLCBwb2ludFsxXV1cbiAgICBdKSk7XG4gIFxuICAvLyBBeGlzIHRpY2tcbiAgZ3VpZGUuYXBwZW5kKFwidGV4dFwiKVxuICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJ0aWNrIHRpY2steVwiKVxuICAgIC50ZXh0KGQzLmZvcm1hdChmb3JtYXQpKGZ4bkluZm8uZnhuKHBhcmFtcykpKVxuICAgIC5hdHRyKFwieFwiLCAwKVxuICAgIC5hdHRyKFwieVwiLCBwb2ludFsxXSk7XG59XG5cbmZ1bmN0aW9uIGFkZExhYmVsKHNlbGVjdGlvbiwgbGFiZWwsIHgsIHksIGFuY2hvciA9IFwic3RhcnRcIikge1xuXG4gIHNlbGVjdGlvbi5hcHBlbmQoXCJ0ZXh0XCIpXG4gICAgLmF0dHIoXCJjbGFzc1wiLCBcImN1cnZlLWxhYmVsXCIpXG4gICAgLnRleHQobGFiZWwpXG4gICAgLmF0dHIoXCJ4XCIsIHgpXG4gICAgLmF0dHIoXCJ5XCIsIHkpXG4gICAgLmF0dHIoXCJ0ZXh0LWFuY2hvclwiLCBhbmNob3IpO1xufVxuXG5mdW5jdGlvbiBjdXJseUJyYWNlKHN0YXJ0LCBsZW5ndGgpIHtcblxuICBjb25zdCB4MCA9IHN0YXJ0WzBdO1xuICBjb25zdCB5MCA9IHN0YXJ0WzFdO1xuICBjb25zdCBzY2FsZSA9IDU7XG4gIGNvbnN0IHNlZ21lbnQgPSAobGVuZ3RoIC8gMikgLSAoc2NhbGUgKiAyKTtcbiAgXG4gIGNvbnN0IG0gPSBgTSAkeyB4MCB9LCR7IHkwIH1gO1xuICBjb25zdCBxMSA9IGBRICR7IHgwIC0gc2NhbGUgfSwkeyB5MCB9ICR7IHgwIC0gc2NhbGUgfSwkeyB5MCArIHNjYWxlIH1gO1xuICBjb25zdCBsMSA9IGBMICR7IHgwIC0gc2NhbGUgfSwkeyB5MCArIHNjYWxlICsgc2VnbWVudCB9YDtcbiAgXG4gIGNvbnN0IHAgPSBgXG4gICAgUSAkeyB4MCAtIHNjYWxlIH0sJHsgeTAgKyAyICogc2NhbGUgKyBzZWdtZW50IH1cbiAgICAgICR7IHgwIC0gMiAqIHNjYWxlIH0sJHsgeTAgKyAyICogc2NhbGUgKyBzZWdtZW50IH1cbiAgICBRICR7IHgwIC0gc2NhbGUgfSwkeyB5MCArIDIgKiBzY2FsZSArIHNlZ21lbnQgfVxuICAgICAgJHsgeDAgLSBzY2FsZSB9LCR7IHkwICsgMyAqIHNjYWxlICsgc2VnbWVudCB9YDtcbiAgXG4gIGNvbnN0IGwyID0gYEwgJHsgeDAgLSBzY2FsZSB9LCR7IHkwICsgMiAqIChzY2FsZSArIHNlZ21lbnQpICsgMiAqIHNjYWxlIH1gO1xuICBjb25zdCBxMiA9IGBRICR7IHgwIC0gc2NhbGUgfSwkeyB5MCArIDIgKiAoc2NhbGUgKyBzZWdtZW50KSArIDMgKiBzY2FsZSB9IFxuICAgICR7IHgwIH0sJHsgeTAgKyAyICogKHNjYWxlICsgc2VnbWVudCkgKyAzICogc2NhbGUgfWA7XG5cbiAgcmV0dXJuIGAke219ICR7cTF9ICR7bDF9ICR7cH0gJHtsMn0gJHtxMn1gO1xufVxuXG5mdW5jdGlvbiBsYWJlbHNUb2dnbGUoY29udGFpbmVyLCBpZCkge1xuXG4gIGNvbnN0IGZvcm0gPSBjb250YWluZXIuYXBwZW5kKFwiZm9ybVwiKVxuICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJ0b2dnbGUtbGFiZWxzXCIpO1xuXG4gIGZvcm0uYXBwZW5kKFwiaW5wdXRcIilcbiAgICAuYXR0cihcImNsYXNzXCIsIFwidG9nZ2xlLWNoZWNrYm94XCIpXG4gICAgLmF0dHIoXCJ0eXBlXCIsIFwiY2hlY2tib3hcIilcbiAgICAuYXR0cihcIm5hbWVcIiwgXCJ0b2dnbGUtbGFiZWxcIilcbiAgICAuYXR0cihcImlkXCIsIGBjaGVja2JveC0keyBpZCB9YClcbiAgICAucHJvcGVydHkoXCJjaGVja2VkXCIsIHRydWUpO1xuICBcbiAgZm9ybS5hcHBlbmQoXCJsYWJlbFwiKVxuICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJ0b2dnbGUtbGFiZWxcIilcbiAgICAuYXR0cihcImZvclwiLCBgY2hlY2tib3gtJHsgaWQgfWApXG4gICAgLnRleHQoXCJMYWJlbHNcIik7XG59XG4ifV19
</script>
<script type="module">
if (window.location.protocol === "file:") { alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."); }
window._ojs.paths.runtimeToDoc = "../../posts/2025-04-16-econ-tariffs";
window._ojs.paths.runtimeToRoot = "../..";
window._ojs.paths.docToRoot = "../..";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/twopoints\.blog");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">

<div class="cookie-consent-footer"><a href="#" id="open_preferences_center">Cookie Preferences</a></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>