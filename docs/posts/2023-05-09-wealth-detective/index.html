<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2023-05-09">

<title>The wealth detective – Two Points Make a Line</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../..//images/logo-icon.png" rel="icon" type="image/png">
<script src="../../site_libs/cookie-consent/cookie-consent.js"></script>
<link href="../../site_libs/cookie-consent/cookie-consent.css" rel="stylesheet">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-9fa50ab0619afc8daa582ba3d036cca2.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-EJMC44PZ56"></script>

<script type="text/plain" cookie-consent="tracking">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-EJMC44PZ56', { 'anonymize_ip': true});
</script>

<script type="text/javascript" charset="UTF-8">
document.addEventListener('DOMContentLoaded', function () {
cookieconsent.run({
  "notice_banner_type":"simple",
  "consent_type":"implied",
  "palette":"light",
  "language":"en",
  "page_load_consent_levels":["strictly-necessary","functionality","tracking","targeting"],
  "notice_banner_reject_button_hide":false,
  "preferences_center_close_button_hide":false,
  "website_name":""
  ,
"language":"en"
  });
});
</script> 
  
<script type="module" src="../../site_libs/quarto-ojs/quarto-ojs-runtime.js"></script>
<link href="../../site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">


<meta property="og:title" content="The wealth detective – Two Points Make a Line">
<meta property="og:description" content="This year’s John Bates Clark Medal has been awarded to Gabriel Zucman, maestro of tax data and scourge of the ultra wealthy. Here is a visual retrospective of his work.">
<meta property="og:image" content="https://twopoints.blog/posts/2023-05-09-wealth-detective/thumbnail.gif">
<meta property="og:site_name" content="Two Points Make a Line">
<meta name="twitter:title" content="The wealth detective – Two Points Make a Line">
<meta name="twitter:description" content="This year’s John Bates Clark Medal has been awarded to Gabriel Zucman, maestro of tax data and scourge of the ultra wealthy. Here is a visual retrospective of his work.">
<meta name="twitter:image" content="https://twopoints.blog/posts/2023-05-09-wealth-detective/thumbnail.gif">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../images/logo-icon-invert.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Two Points Make a Line</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <span class="nav-link">
<span class="menu-text">Telling stories through visualized data — by Kenneth S. Reyes</span>
    </span>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/ksreyes/twopoints"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">The wealth detective</h1>
<p class="subtitle lead">This year’s John Bates Clark Medal has been awarded to Gabriel Zucman, maestro of tax data and scourge of the ultra wealthy. Here is a visual retrospective of his work.</p>
  <div class="quarto-categories">
    <div class="quarto-category">python</div>
    <div class="quarto-category">D3/OJS</div>
  </div>
  </div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">May 9, 2023</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p>The French economist <a href="https://gabriel-zucman.eu/">Gabriel Zucman</a> has spent the last ten years calling out the shenanigans of the immensely rich. Profiled by <em>Bloomberg</em> as the <a href="https://www.bloomberg.com/news/features/2019-05-23/the-wealth-detective-who-finds-the-hidden-money-of-the-super-rich">“wealth detective”</a>, he and frequent collaborators Thomas Piketty and Emmanuel Saez have wielded microdata and spreadsheets to bring economic inequality to the forefront of popular discourse, especially in America. Zucman is no ivory-tower academic: he is an <a href="https://www.washingtonpost.com/outlook/wealth-taxes-often-failed-in-europe-they-wouldnt-here/2019/10/25/23a59cb0-f4ff-11e9-829d-87b12c2f85dd_story.html">unabashed activist</a> and a ferocious tweeter (though his tweets have recently been <a href="https://twitter.com/gabriel_zucman">purged</a>). His style has rubbed many the wrong way, not least the Harvard Kennedy School, whose president and provost <a href="https://www.nytimes.com/2020/02/21/us/politics/the-liberal-economists-behind-the-wealth-tax-debate.html">vetoed</a> his candidacy for tenure “partly over fears that Mr.&nbsp;Zucman’s research could not support the arguments he was making in the political arena.”</p>
<p>No wonder then that <a href="https://www.aeaweb.org/about-aea/honors-awards/bates-clark/gabriel-zucman">his receipt</a> of the 2023 John Bates Clark Medal — the second-most prestigious honor in economics after the <a href="https://twopoints.blog/posts/2023-03-03-nobel">Nobel</a> — was met with some grumbling. Coverage from <em>The Economist</em> focused as much on <a href="https://www.economist.com/finance-and-economics/2023/05/04/gabriel-zucman-a-controversial-john-bates-clark-medallist">his detractors</a> as on his body of work. “American Economics Association Reaches a New Low” <a href="https://www.econlib.org/american-economics-association-reaches-a-new-low/">wrote</a> David Henderson. And Tyler Cowen, a man who comments on everything, thought it <a href="https://marginalrevolution.com/marginalrevolution/2023/05/gabriel-zucman-wins-the-john-bates-clark-medal.html">not worthwhile</a> to comment on Zucman’s win.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://gabriel-zucman.eu/files/photos/PhotoGZ8.jpg" class="img-fluid figure-img"></p>
<figcaption>Gabriel Zucman, winner of the 2023 John Bates Clark Medal (image from gabriel-zucman.eu)</figcaption>
</figure>
</div>
<p>Yet for all the conservative ire he draws, Zucman merely follows the tradition of economist-crusaders like Milton Friedman. <a href="https://econjwatch.org/File+download/643/HendersonMay2013.pdf?mimetype=pdf">Lionized</a> by Henderson as “brilliant” and “first-rate”, Friedman did not shy away from using his academic stature to forward <a href="https://www.youtube.com/watch?v=Rls8H6MktrA">deeply</a> <a href="https://www.nytimes.com/1970/09/13/archives/a-friedman-doctrine-the-social-responsibility-of-business-is-to.html">opinionated</a> <a href="https://www.youtube.com/watch?v=QlY61ROMcoA">takes</a> on the economy, couched in language that would probably be too strong for your typical <a href="https://quoteinvestigator.com/2019/04/10/one-handed/">two-handed economist</a>. So too does Zucman, with the crucial addition of data. Heaps and heaps of it, in fact. While critics may quibble with his methods, his data ensures that debates can revolve around common ground.</p>
<p>This post looks at some of the major findings arising from his research so far. Let us start with the driving motivation behind much of his work, which is in documenting trends in inequality. Compared to GDP and other macroeconomic aggregates, inequality is much more challenging to measure due to the scarcity of data, particularly at the very top of the distribution. To this end, Piketty, Saez, and Zucman have provided an invaluable resource in the <a href="https://wid.world/">World Inequality Database</a>, which harmonizes national accounts with tax and survey data to produce an assortment of inequality statistics for numerous countries. Their <a href="https://gabriel-zucman.eu/files/PSZ2018QJE.pdf">methodology</a> is contestable; indeed, they refer to it as a “prototype”. But as Saez and Zucman <a href="https://gabriel-zucman.eu/files/SaezZucman2020JEP.pdf">write</a>:</p>
<blockquote class="blockquote">
<p>Economic statistics, like aggregate output or concentration of income, are not physical facts like mass or temperature. Instead, they are creations that reflect social, historical, and political contexts. How the data sources are assembled, what conceptual framework is used to combine them, what indicators are given prominence: all of these choices reflect objectives that must be made explicit and broadly discussed.</p>
</blockquote>
<p>The fruits of their work as applied to the United States has painted a stark picture of inequality in recent decades. The chart below plots the share of wealth controlled by the bottom 90% against the share controlled by the top 0.1% (about <a href="https://gabriel-zucman.eu/files/SaezZucman2016QJE.pdf">160,000 taxpayers</a> in 2012). From 8.3% in 1980, the top 0.1% now hold about 20% of all wealth in the U.S.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" data-startfrom="40" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 39;"><span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> dim <span class="op">=</span> ({ <span class="dt">width</span><span class="op">:</span> <span class="dv">790</span><span class="op">,</span> <span class="dt">height</span><span class="op">:</span> <span class="dv">550</span> })<span class="op">;</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> margin <span class="op">=</span> ({ <span class="dt">top</span><span class="op">:</span> <span class="dv">60</span><span class="op">,</span> <span class="dt">bottom</span><span class="op">:</span> <span class="dv">40</span><span class="op">,</span> <span class="dt">right</span><span class="op">:</span> <span class="dv">50</span><span class="op">,</span> <span class="dt">left</span><span class="op">:</span> <span class="dv">50</span> })<span class="op">;</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> inequality<span class="op">;</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> X <span class="op">=</span> d3<span class="op">.</span><span class="fu">map</span>(data<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">year</span>)<span class="op">;</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> Y <span class="op">=</span> d3<span class="op">.</span><span class="fu">map</span>(data<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">share</span>)<span class="op">;</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> Z <span class="op">=</span> d3<span class="op">.</span><span class="fu">map</span>(data<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">group</span>)<span class="op">;</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> I <span class="op">=</span> d3<span class="op">.</span><span class="fu">range</span>(X<span class="op">.</span><span class="at">length</span>)<span class="op">;</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> xValues <span class="op">=</span> [<span class="op">...</span><span class="kw">new</span> <span class="bu">Set</span>(X)]<span class="op">;</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> xScaler <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">1912</span><span class="op">,</span> <span class="dv">2030</span>])</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([margin<span class="op">.</span><span class="at">left</span><span class="op">,</span> dim<span class="op">.</span><span class="at">width</span> <span class="op">-</span> margin<span class="op">.</span><span class="at">right</span>])<span class="op">;</span></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yScaler <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="op">.</span><span class="dv">35</span>])</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([dim<span class="op">.</span><span class="at">height</span> <span class="op">-</span> margin<span class="op">.</span><span class="at">bottom</span><span class="op">,</span> margin<span class="op">.</span><span class="at">top</span>])<span class="op">;</span></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> line <span class="op">=</span> d3<span class="op">.</span><span class="fu">line</span>()</span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">curve</span>(d3<span class="op">.</span><span class="at">curveBasis</span>)</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">x</span>(i <span class="kw">=&gt;</span> <span class="fu">xScaler</span>(X[i]))</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">y</span>(i <span class="kw">=&gt;</span> <span class="fu">yScaler</span>(Y[i]))<span class="op">;</span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> container <span class="op">=</span> d3<span class="op">.</span><span class="fu">create</span>(<span class="st">"div"</span>)<span class="op">;</span></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Chart title //////////////////////////////////////////////////////////////</span></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>  container<span class="op">.</span><span class="fu">append</span>(<span class="st">"div"</span>)</span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"ojs-title"</span>)</span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">html</span>(<span class="vs">`To those who have, more shall be given`</span>)<span class="op">;</span></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>  container<span class="op">.</span><span class="fu">append</span>(<span class="st">"div"</span>)</span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"ojs-subtitle"</span>)</span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"margin-bottom"</span><span class="op">,</span> <span class="st">"1rem"</span>)</span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">html</span>(<span class="vs">`Distribution of wealth by percentile, United States, 1917–2019`</span>)<span class="op">;</span></span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Chart canvas /////////////////////////////////////////////////////////////</span></span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> container<span class="op">.</span><span class="fu">append</span>(<span class="st">"svg"</span>)</span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> dim<span class="op">.</span><span class="at">width</span>)</span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> dim<span class="op">.</span><span class="at">height</span>)</span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> dim<span class="op">.</span><span class="at">width</span><span class="op">,</span> dim<span class="op">.</span><span class="at">height</span>])</span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"style"</span><span class="op">,</span> <span class="st">"max-width: 100%; height: auto; height: intrinsic;"</span>)</span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">on</span>(<span class="st">"mouseenter"</span><span class="op">,</span> mouseentered)</span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">on</span>(<span class="st">"mousemove"</span><span class="op">,</span> mousemoved)</span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">on</span>(<span class="st">"mouseleave"</span><span class="op">,</span> mouseleft)<span class="op">;</span></span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> dim<span class="op">.</span><span class="at">width</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> dim<span class="op">.</span><span class="at">height</span>)</span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"#DCE7EB"</span>)</span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="op">.</span><span class="dv">6</span>)<span class="op">;</span></span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Axes /////////////////////////////////////////////////////////////////////</span></span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> xAxis <span class="op">=</span> d3<span class="op">.</span><span class="fu">axisBottom</span>(xScaler)</span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">tickValues</span>(<span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>({<span class="dt">length</span><span class="op">:</span> <span class="dv">11</span>}<span class="op">,</span> (_<span class="op">,</span> i) <span class="kw">=&gt;</span> <span class="dv">1920</span> <span class="op">+</span> i<span class="op">*</span><span class="dv">10</span>))</span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">tickFormat</span>(d3<span class="op">.</span><span class="fu">format</span>(<span class="st">".0f"</span>))</span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">tickSize</span>(<span class="dv">0</span>)</span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">tickPadding</span>([<span class="dv">10</span>])<span class="op">;</span></span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yAxis <span class="op">=</span> d3<span class="op">.</span><span class="fu">axisLeft</span>(yScaler)</span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">ticks</span>(<span class="dv">5</span><span class="op">,</span> <span class="st">".0%"</span>)</span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">tickSize</span>(<span class="dv">0</span>)</span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">tickPadding</span>([<span class="dv">10</span>])<span class="op">;;</span></span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(0,</span><span class="sc">${</span> dim<span class="op">.</span><span class="at">height</span> <span class="op">-</span> margin<span class="op">.</span><span class="at">bottom</span> <span class="sc">}</span><span class="vs">)`</span>)</span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">".8rem"</span>)</span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(xAxis)</span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(g <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">select</span>(<span class="st">".domain"</span>)<span class="op">.</span><span class="fu">remove</span>())</span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> d3<span class="op">.</span><span class="fu">line</span>()([[margin<span class="op">.</span><span class="at">left</span><span class="op">,</span> <span class="dv">0</span>]<span class="op">,</span> [dim<span class="op">.</span><span class="at">width</span> <span class="op">-</span> margin<span class="op">.</span><span class="at">right</span><span class="op">,</span> <span class="dv">0</span>]]))</span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"black"</span>)<span class="op">;</span></span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span> margin<span class="op">.</span><span class="at">left</span> <span class="sc">}</span><span class="vs">,0)`</span>)</span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">".8rem"</span>)</span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(yAxis)</span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(g <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">select</span>(<span class="st">".domain"</span>)<span class="op">.</span><span class="fu">remove</span>())</span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(g <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="op">-</span>margin<span class="op">.</span><span class="at">left</span>)</span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">25</span>)</span>
<span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"dx"</span><span class="op">,</span> <span class="dv">10</span>)</span>
<span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"black"</span>)</span>
<span id="cb1-128"><a href="#cb1-128" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"start"</span>)</span>
<span id="cb1-129"><a href="#cb1-129" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">".9rem"</span>)</span>
<span id="cb1-130"><a href="#cb1-130" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(<span class="st">"Share in total wealth"</span>))<span class="op">;</span></span>
<span id="cb1-131"><a href="#cb1-131" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-132"><a href="#cb1-132" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Lines and labels /////////////////////////////////////////////////////////</span></span>
<span id="cb1-133"><a href="#cb1-133" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-134"><a href="#cb1-134" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> panel <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb1-135"><a href="#cb1-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-136"><a href="#cb1-136" aria-hidden="true" tabindex="-1"></a>  panel<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb1-137"><a href="#cb1-137" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"path"</span>)</span>
<span id="cb1-138"><a href="#cb1-138" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">group</span>(I<span class="op">,</span> i <span class="kw">=&gt;</span> Z[i]))</span>
<span id="cb1-139"><a href="#cb1-139" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">join</span>(<span class="st">"path"</span>)</span>
<span id="cb1-140"><a href="#cb1-140" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb1-141"><a href="#cb1-141" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke"</span><span class="op">,</span> (d<span class="op">,</span> i) <span class="kw">=&gt;</span> i <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> colors<span class="op">.</span><span class="at">blue</span> <span class="op">:</span> colors<span class="op">.</span><span class="at">red</span>)</span>
<span id="cb1-142"><a href="#cb1-142" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="dv">3</span>)</span>
<span id="cb1-143"><a href="#cb1-143" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> ([<span class="op">,</span> I]) <span class="kw">=&gt;</span> <span class="fu">line</span>(I))<span class="op">;</span></span>
<span id="cb1-144"><a href="#cb1-144" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-145"><a href="#cb1-145" aria-hidden="true" tabindex="-1"></a>  panel<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb1-146"><a href="#cb1-146" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb1-147"><a href="#cb1-147" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="fu">xScaler</span>(<span class="dv">2020</span>))</span>
<span id="cb1-148"><a href="#cb1-148" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="fu">yScaler</span>(<span class="op">.</span><span class="dv">227</span>))</span>
<span id="cb1-149"><a href="#cb1-149" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"start"</span>)</span>
<span id="cb1-150"><a href="#cb1-150" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"alignment-baseline"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb1-151"><a href="#cb1-151" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">".9rem"</span>)</span>
<span id="cb1-152"><a href="#cb1-152" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">blue</span>)</span>
<span id="cb1-153"><a href="#cb1-153" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">"Bottom 90%"</span>)</span>
<span id="cb1-154"><a href="#cb1-154" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-155"><a href="#cb1-155" aria-hidden="true" tabindex="-1"></a>  panel<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb1-156"><a href="#cb1-156" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb1-157"><a href="#cb1-157" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="fu">xScaler</span>(<span class="dv">2020</span>))</span>
<span id="cb1-158"><a href="#cb1-158" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="fu">yScaler</span>(<span class="op">.</span><span class="dv">192</span>))</span>
<span id="cb1-159"><a href="#cb1-159" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"start"</span>)</span>
<span id="cb1-160"><a href="#cb1-160" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"alignment-baseline"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb1-161"><a href="#cb1-161" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">".9rem"</span>)</span>
<span id="cb1-162"><a href="#cb1-162" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">red</span>)</span>
<span id="cb1-163"><a href="#cb1-163" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">"Top 0.1%"</span>)</span>
<span id="cb1-164"><a href="#cb1-164" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-165"><a href="#cb1-165" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Hover labels /////////////////////////////////////////////////////////////</span></span>
<span id="cb1-166"><a href="#cb1-166" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-167"><a href="#cb1-167" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> marker <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb1-168"><a href="#cb1-168" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"display"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb1-169"><a href="#cb1-169" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-170"><a href="#cb1-170" aria-hidden="true" tabindex="-1"></a>  marker<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb1-171"><a href="#cb1-171" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> d3<span class="op">.</span><span class="fu">line</span>()([[<span class="dv">0</span><span class="op">,</span> margin<span class="op">.</span><span class="at">top</span>]<span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> dim<span class="op">.</span><span class="at">height</span> <span class="op">-</span> margin<span class="op">.</span><span class="at">bottom</span>]]))</span>
<span id="cb1-172"><a href="#cb1-172" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"black"</span>)</span>
<span id="cb1-173"><a href="#cb1-173" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="dv">1</span>)</span>
<span id="cb1-174"><a href="#cb1-174" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-175"><a href="#cb1-175" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">mouseentered</span>() {</span>
<span id="cb1-176"><a href="#cb1-176" aria-hidden="true" tabindex="-1"></a>    marker<span class="op">.</span><span class="fu">attr</span>(<span class="st">"display"</span><span class="op">,</span> <span class="kw">null</span>)<span class="op">;</span></span>
<span id="cb1-177"><a href="#cb1-177" aria-hidden="true" tabindex="-1"></a>    tooltip<span class="op">.</span><span class="fu">style</span>(<span class="st">"display"</span><span class="op">,</span> <span class="st">"block"</span>)<span class="op">;</span></span>
<span id="cb1-178"><a href="#cb1-178" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-179"><a href="#cb1-179" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-180"><a href="#cb1-180" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">mousemoved</span>(<span class="bu">event</span>) {</span>
<span id="cb1-181"><a href="#cb1-181" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> [xm<span class="op">,</span> ym] <span class="op">=</span> d3<span class="op">.</span><span class="fu">pointer</span>(<span class="bu">event</span>)<span class="op">;</span></span>
<span id="cb1-182"><a href="#cb1-182" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> x <span class="op">=</span> d3<span class="op">.</span><span class="fu">least</span>(xValues<span class="op">,</span> x <span class="kw">=&gt;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(<span class="fu">xScaler</span>(x) <span class="op">-</span> xm))<span class="op">;</span></span>
<span id="cb1-183"><a href="#cb1-183" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> i <span class="op">=</span> X<span class="op">.</span><span class="fu">map</span>((d<span class="op">,</span> i) <span class="kw">=&gt;</span> d <span class="op">===</span> x <span class="op">?</span> i <span class="op">:</span> <span class="st">""</span>)<span class="op">.</span><span class="fu">filter</span>(<span class="bu">String</span>)<span class="op">;</span></span>
<span id="cb1-184"><a href="#cb1-184" aria-hidden="true" tabindex="-1"></a>    marker<span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span> <span class="fu">xScaler</span>(x) <span class="sc">}</span><span class="vs">, 0)`</span>)<span class="op">;</span></span>
<span id="cb1-185"><a href="#cb1-185" aria-hidden="true" tabindex="-1"></a>    tooltip</span>
<span id="cb1-186"><a href="#cb1-186" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"left"</span><span class="op">,</span> <span class="bu">event</span><span class="op">.</span><span class="at">pageX</span> <span class="op">+</span> <span class="dv">18</span> <span class="op">+</span> <span class="st">"px"</span>)</span>
<span id="cb1-187"><a href="#cb1-187" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"top"</span><span class="op">,</span> <span class="bu">event</span><span class="op">.</span><span class="at">pageY</span> <span class="op">+</span> <span class="dv">18</span> <span class="op">+</span> <span class="st">"px"</span>)</span>
<span id="cb1-188"><a href="#cb1-188" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">html</span>(<span class="vs">`&lt;b&gt;</span><span class="sc">${</span>x<span class="sc">}</span><span class="vs">&lt;/b&gt;&lt;br&gt;Bottom 90%: </span><span class="sc">${</span> d3<span class="op">.</span><span class="fu">format</span>(<span class="st">",.1%"</span>)(Y[i[<span class="dv">0</span>]]) <span class="sc">}</span><span class="vs">&lt;br&gt;Top 0.1%: </span><span class="sc">${</span> d3<span class="op">.</span><span class="fu">format</span>(<span class="st">",.1%"</span>)(Y[i[<span class="dv">1</span>]]) <span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb1-189"><a href="#cb1-189" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-190"><a href="#cb1-190" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-191"><a href="#cb1-191" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">mouseleft</span>() {</span>
<span id="cb1-192"><a href="#cb1-192" aria-hidden="true" tabindex="-1"></a>    marker<span class="op">.</span><span class="fu">attr</span>(<span class="st">"display"</span><span class="op">,</span> <span class="st">"none"</span>)<span class="op">;</span></span>
<span id="cb1-193"><a href="#cb1-193" aria-hidden="true" tabindex="-1"></a>    tooltip<span class="op">.</span><span class="fu">style</span>(<span class="st">"display"</span><span class="op">,</span> <span class="st">"none"</span>)<span class="op">;</span></span>
<span id="cb1-194"><a href="#cb1-194" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-195"><a href="#cb1-195" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-196"><a href="#cb1-196" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Annotation ///////////////////////////////////////////////////////////////</span></span>
<span id="cb1-197"><a href="#cb1-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-198"><a href="#cb1-198" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb1-199"><a href="#cb1-199" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="st">"translate(640, 360)"</span>)</span>
<span id="cb1-200"><a href="#cb1-200" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb1-201"><a href="#cb1-201" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb1-202"><a href="#cb1-202" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">".9rem"</span>)</span>
<span id="cb1-203"><a href="#cb1-203" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"black"</span>)</span>
<span id="cb1-204"><a href="#cb1-204" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb1-205"><a href="#cb1-205" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"tspan"</span>)</span>
<span id="cb1-206"><a href="#cb1-206" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(<span class="st">"Wealth began to"</span>)</span>
<span id="cb1-207"><a href="#cb1-207" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb1-208"><a href="#cb1-208" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"tspan"</span>)</span>
<span id="cb1-209"><a href="#cb1-209" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(<span class="st">"concentrate in the 1980s"</span>)</span>
<span id="cb1-210"><a href="#cb1-210" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"dy"</span><span class="op">,</span> <span class="dv">20</span>)</span>
<span id="cb1-211"><a href="#cb1-211" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-212"><a href="#cb1-212" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"defs"</span>)</span>
<span id="cb1-213"><a href="#cb1-213" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"marker"</span>)</span>
<span id="cb1-214"><a href="#cb1-214" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"arrow-1"</span>)</span>
<span id="cb1-215"><a href="#cb1-215" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> <span class="st">"0 0 10 10"</span>)</span>
<span id="cb1-216"><a href="#cb1-216" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"refX"</span><span class="op">,</span> <span class="dv">8</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"refY"</span><span class="op">,</span> <span class="dv">5</span>)</span>
<span id="cb1-217"><a href="#cb1-217" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"markerWidth"</span><span class="op">,</span> <span class="dv">10</span>)</span>
<span id="cb1-218"><a href="#cb1-218" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"markerHeight"</span><span class="op">,</span> <span class="dv">10</span>)</span>
<span id="cb1-219"><a href="#cb1-219" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"orient"</span><span class="op">,</span> <span class="st">"auto"</span>)</span>
<span id="cb1-220"><a href="#cb1-220" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb1-221"><a href="#cb1-221" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="st">"M0,1 L9,5 L0,9"</span>)</span>
<span id="cb1-222"><a href="#cb1-222" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke-linejoin"</span><span class="op">,</span> <span class="st">"round"</span>)</span>
<span id="cb1-223"><a href="#cb1-223" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"black"</span>)</span>
<span id="cb1-224"><a href="#cb1-224" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="dv">1</span>)</span>
<span id="cb1-225"><a href="#cb1-225" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)<span class="op">;</span></span>
<span id="cb1-226"><a href="#cb1-226" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-227"><a href="#cb1-227" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb1-228"><a href="#cb1-228" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb1-229"><a href="#cb1-229" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb1-230"><a href="#cb1-230" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> path <span class="op">=</span> d3<span class="op">.</span><span class="fu">path</span>()<span class="op">;</span></span>
<span id="cb1-231"><a href="#cb1-231" aria-hidden="true" tabindex="-1"></a>      path<span class="op">.</span><span class="fu">moveTo</span>(<span class="dv">620</span><span class="op">,</span> <span class="dv">400</span>)<span class="op">;</span></span>
<span id="cb1-232"><a href="#cb1-232" aria-hidden="true" tabindex="-1"></a>      path<span class="op">.</span><span class="fu">quadraticCurveTo</span>(<span class="dv">550</span><span class="op">,</span> <span class="dv">500</span><span class="op">,</span> <span class="dv">480</span><span class="op">,</span> <span class="dv">410</span>)<span class="op">;</span></span>
<span id="cb1-233"><a href="#cb1-233" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> path<span class="op">;</span></span>
<span id="cb1-234"><a href="#cb1-234" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb1-235"><a href="#cb1-235" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"black"</span>)</span>
<span id="cb1-236"><a href="#cb1-236" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="dv">1</span>)</span>
<span id="cb1-237"><a href="#cb1-237" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb1-238"><a href="#cb1-238" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"marker-end"</span><span class="op">,</span> <span class="st">"url(#arrow-1)"</span>)<span class="op">;</span></span>
<span id="cb1-239"><a href="#cb1-239" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-240"><a href="#cb1-240" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Chart sources ////////////////////////////////////////////////////////////</span></span>
<span id="cb1-241"><a href="#cb1-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-242"><a href="#cb1-242" aria-hidden="true" tabindex="-1"></a>  container<span class="op">.</span><span class="fu">append</span>(<span class="st">"div"</span>)</span>
<span id="cb1-243"><a href="#cb1-243" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"ojs-source"</span>)</span>
<span id="cb1-244"><a href="#cb1-244" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"margin"</span><span class="op">,</span> <span class="st">".5rem 0"</span>)</span>
<span id="cb1-245"><a href="#cb1-245" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"line-height"</span><span class="op">,</span> <span class="fl">1.25</span>)</span>
<span id="cb1-246"><a href="#cb1-246" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">html</span>(<span class="vs">`Source: E. Saez and G. Zucman, "The Rise of Income and Wealth Inequality in America: Evidence from Distributional Macroeconomic Accounts", &lt;i&gt;Journal of Economic Perspectives&lt;/i&gt;, vol. 34, no. 4 (2020).`</span>)<span class="op">;</span></span>
<span id="cb1-247"><a href="#cb1-247" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-248"><a href="#cb1-248" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> container<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb1-249"><a href="#cb1-249" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="ojs-cell-1" data-nodetype="expression">

</div>
</div>
</div>
<p>Since data on wealth ownership is not directly collected in America, the statistics above hinge on using income data — more widely available due to surveys and tax filings — to infer asset ownership. The technique, called income capitalization, uses reported interest and dividend income to guess at holdings of bonds and equities. This indirect approach is rough and requires plenty of further adjustments. Nevertheless, by showing how their results are consistent with other data sources<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>, Zucman and company make a compelling case for their methodology.</p>
<p>A weakness in this approach is its reliance on income data, which are typically self-reported. These may not be accurate, especially for the rich, who, for the purposes of avoiding taxes, have the incentive, opportunity, and capability to severely under-report their income. Zucman himself has investigated this for the case of Denmark, Norway, and Sweden. In a creative use of information windfalls, he and his collaborators matched administrative records with documented cases of hidden wealth <a href="https://gabriel-zucman.eu/files/AJZ2019.pdf">as leaked in the Panama Papers</a>, among other sources. They were then able to estimate what share of their tax liabilities Scandinavians were evading, disaggregated by wealth percentile. The chart below confirms the received wisdom that it is the rich — the ultra rich, to be exact — who are the most notorious tax evaders.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2" data-startfrom="259" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 258;"><span id="cb2-259"><a href="#cb2-259" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb2-260"><a href="#cb2-260" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> dim <span class="op">=</span> ({ <span class="dt">width</span><span class="op">:</span> <span class="dv">790</span><span class="op">,</span> <span class="dt">height</span><span class="op">:</span> <span class="dv">550</span> })<span class="op">;</span></span>
<span id="cb2-261"><a href="#cb2-261" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> margin <span class="op">=</span> ({ <span class="dt">top</span><span class="op">:</span> <span class="dv">40</span><span class="op">,</span> <span class="dt">bottom</span><span class="op">:</span> <span class="dv">60</span><span class="op">,</span> <span class="dt">right</span><span class="op">:</span> <span class="dv">50</span><span class="op">,</span> <span class="dt">left</span><span class="op">:</span> <span class="dv">105</span> })<span class="op">;</span></span>
<span id="cb2-262"><a href="#cb2-262" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-263"><a href="#cb2-263" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> evasion<span class="op">;</span></span>
<span id="cb2-264"><a href="#cb2-264" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> X <span class="op">=</span> d3<span class="op">.</span><span class="fu">map</span>(data<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">evasion</span>)<span class="op">;</span></span>
<span id="cb2-265"><a href="#cb2-265" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> Y <span class="op">=</span> d3<span class="op">.</span><span class="fu">map</span>(data<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">percentile</span>)<span class="op">;</span></span>
<span id="cb2-266"><a href="#cb2-266" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-267"><a href="#cb2-267" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> xScaler <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb2-268"><a href="#cb2-268" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="op">.</span><span class="dv">30</span>])</span>
<span id="cb2-269"><a href="#cb2-269" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> dim<span class="op">.</span><span class="at">width</span> <span class="op">-</span> margin<span class="op">.</span><span class="at">left</span> <span class="op">-</span> margin<span class="op">.</span><span class="at">right</span>])</span>
<span id="cb2-270"><a href="#cb2-270" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-271"><a href="#cb2-271" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yScaler <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleBand</span>()</span>
<span id="cb2-272"><a href="#cb2-272" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>(Y)</span>
<span id="cb2-273"><a href="#cb2-273" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([dim<span class="op">.</span><span class="at">height</span> <span class="op">-</span> margin<span class="op">.</span><span class="at">bottom</span><span class="op">,</span> margin<span class="op">.</span><span class="at">top</span>])</span>
<span id="cb2-274"><a href="#cb2-274" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">padding</span>(<span class="op">.</span><span class="dv">25</span>)<span class="op">;</span></span>
<span id="cb2-275"><a href="#cb2-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-276"><a href="#cb2-276" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> container <span class="op">=</span> d3<span class="op">.</span><span class="fu">create</span>(<span class="st">"div"</span>)<span class="op">;</span></span>
<span id="cb2-277"><a href="#cb2-277" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-278"><a href="#cb2-278" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Chart title //////////////////////////////////////////////////////////////</span></span>
<span id="cb2-279"><a href="#cb2-279" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-280"><a href="#cb2-280" aria-hidden="true" tabindex="-1"></a>  container<span class="op">.</span><span class="fu">append</span>(<span class="st">"div"</span>)</span>
<span id="cb2-281"><a href="#cb2-281" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"ojs-title"</span>)</span>
<span id="cb2-282"><a href="#cb2-282" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">html</span>(<span class="vs">`Render unto Ceaser...`</span>)<span class="op">;</span></span>
<span id="cb2-283"><a href="#cb2-283" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-284"><a href="#cb2-284" aria-hidden="true" tabindex="-1"></a>  container<span class="op">.</span><span class="fu">append</span>(<span class="st">"div"</span>)</span>
<span id="cb2-285"><a href="#cb2-285" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"ojs-subtitle"</span>)</span>
<span id="cb2-286"><a href="#cb2-286" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"margin-bottom"</span><span class="op">,</span> <span class="st">"1rem"</span>)</span>
<span id="cb2-287"><a href="#cb2-287" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">html</span>(<span class="vs">`Taxes evaded as a share of taxes owed by wealth percentile, Denmark, Norway, and Sweden`</span>)<span class="op">;</span></span>
<span id="cb2-288"><a href="#cb2-288" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-289"><a href="#cb2-289" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Chart canvas /////////////////////////////////////////////////////////////</span></span>
<span id="cb2-290"><a href="#cb2-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-291"><a href="#cb2-291" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> container<span class="op">.</span><span class="fu">append</span>(<span class="st">"svg"</span>)</span>
<span id="cb2-292"><a href="#cb2-292" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> dim<span class="op">.</span><span class="at">width</span>)</span>
<span id="cb2-293"><a href="#cb2-293" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> dim<span class="op">.</span><span class="at">height</span>)</span>
<span id="cb2-294"><a href="#cb2-294" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> dim<span class="op">.</span><span class="at">width</span><span class="op">,</span> dim<span class="op">.</span><span class="at">height</span>])</span>
<span id="cb2-295"><a href="#cb2-295" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"style"</span><span class="op">,</span> <span class="st">"max-width: 100%; height: auto; height: intrinsic;"</span>)</span>
<span id="cb2-296"><a href="#cb2-296" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-297"><a href="#cb2-297" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb2-298"><a href="#cb2-298" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb2-299"><a href="#cb2-299" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb2-300"><a href="#cb2-300" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> dim<span class="op">.</span><span class="at">width</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> dim<span class="op">.</span><span class="at">height</span>)</span>
<span id="cb2-301"><a href="#cb2-301" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"#DCE7EB"</span>)</span>
<span id="cb2-302"><a href="#cb2-302" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="op">.</span><span class="dv">6</span>)<span class="op">;</span></span>
<span id="cb2-303"><a href="#cb2-303" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-304"><a href="#cb2-304" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Axes /////////////////////////////////////////////////////////////////////</span></span>
<span id="cb2-305"><a href="#cb2-305" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-306"><a href="#cb2-306" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> xAxis <span class="op">=</span> d3<span class="op">.</span><span class="fu">axisBottom</span>(xScaler)</span>
<span id="cb2-307"><a href="#cb2-307" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">ticks</span>(<span class="dv">5</span><span class="op">,</span> <span class="st">".0%"</span>)</span>
<span id="cb2-308"><a href="#cb2-308" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">tickSize</span>(<span class="dv">0</span>)</span>
<span id="cb2-309"><a href="#cb2-309" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">tickPadding</span>([<span class="dv">10</span>])<span class="op">;</span></span>
<span id="cb2-310"><a href="#cb2-310" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-311"><a href="#cb2-311" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yAxis <span class="op">=</span> d3<span class="op">.</span><span class="fu">axisLeft</span>(yScaler)</span>
<span id="cb2-312"><a href="#cb2-312" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">tickSize</span>(<span class="dv">0</span>)</span>
<span id="cb2-313"><a href="#cb2-313" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">tickPadding</span>([<span class="dv">10</span>])<span class="op">;</span></span>
<span id="cb2-314"><a href="#cb2-314" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-315"><a href="#cb2-315" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb2-316"><a href="#cb2-316" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span> margin<span class="op">.</span><span class="at">left</span> <span class="sc">}</span><span class="vs">,</span><span class="sc">${</span> dim<span class="op">.</span><span class="at">height</span> <span class="op">-</span> margin<span class="op">.</span><span class="at">bottom</span> <span class="sc">}</span><span class="vs">)`</span>)</span>
<span id="cb2-317"><a href="#cb2-317" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">".8rem"</span>)</span>
<span id="cb2-318"><a href="#cb2-318" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(xAxis)</span>
<span id="cb2-319"><a href="#cb2-319" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(g <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">select</span>(<span class="st">".domain"</span>)<span class="op">.</span><span class="fu">remove</span>())</span>
<span id="cb2-320"><a href="#cb2-320" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(g <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb2-321"><a href="#cb2-321" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> dim<span class="op">.</span><span class="at">width</span> <span class="op">-</span> margin<span class="op">.</span><span class="at">left</span>)</span>
<span id="cb2-322"><a href="#cb2-322" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb2-323"><a href="#cb2-323" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"dx"</span><span class="op">,</span> <span class="op">-</span><span class="dv">20</span>)</span>
<span id="cb2-324"><a href="#cb2-324" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"dy"</span><span class="op">,</span> <span class="dv">30</span>)</span>
<span id="cb2-325"><a href="#cb2-325" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"black"</span>)</span>
<span id="cb2-326"><a href="#cb2-326" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"end"</span>)</span>
<span id="cb2-327"><a href="#cb2-327" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"alignment-baseline"</span><span class="op">,</span> <span class="st">"hanging"</span>)</span>
<span id="cb2-328"><a href="#cb2-328" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">".9rem"</span>)</span>
<span id="cb2-329"><a href="#cb2-329" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(<span class="st">"Taxes evaded as a share of taxes owed"</span>))</span>
<span id="cb2-330"><a href="#cb2-330" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb2-331"><a href="#cb2-331" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> d3<span class="op">.</span><span class="fu">line</span>()([[<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span>]<span class="op">,</span> [dim<span class="op">.</span><span class="at">width</span> <span class="op">-</span> margin<span class="op">.</span><span class="at">left</span> <span class="op">-</span> margin<span class="op">.</span><span class="at">right</span><span class="op">,</span> <span class="dv">0</span>]]))</span>
<span id="cb2-332"><a href="#cb2-332" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb2-333"><a href="#cb2-333" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"black"</span>)<span class="op">;</span></span>
<span id="cb2-334"><a href="#cb2-334" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-335"><a href="#cb2-335" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb2-336"><a href="#cb2-336" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span> margin<span class="op">.</span><span class="at">left</span> <span class="sc">}</span><span class="vs">,0)`</span>)</span>
<span id="cb2-337"><a href="#cb2-337" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">".7rem"</span>)</span>
<span id="cb2-338"><a href="#cb2-338" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(yAxis)</span>
<span id="cb2-339"><a href="#cb2-339" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(g <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">select</span>(<span class="st">".domain"</span>)<span class="op">.</span><span class="fu">remove</span>())</span>
<span id="cb2-340"><a href="#cb2-340" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(g <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb2-341"><a href="#cb2-341" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="op">-</span>margin<span class="op">.</span><span class="at">left</span>)</span>
<span id="cb2-342"><a href="#cb2-342" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">30</span>)</span>
<span id="cb2-343"><a href="#cb2-343" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"dx"</span><span class="op">,</span> <span class="dv">15</span>)</span>
<span id="cb2-344"><a href="#cb2-344" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"black"</span>)</span>
<span id="cb2-345"><a href="#cb2-345" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"start"</span>)</span>
<span id="cb2-346"><a href="#cb2-346" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">".9rem"</span>)</span>
<span id="cb2-347"><a href="#cb2-347" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(<span class="st">"Wealth pecentile"</span>))<span class="op">;</span></span>
<span id="cb2-348"><a href="#cb2-348" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-349"><a href="#cb2-349" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Bars /////////////////////////////////////////////////////////////////////</span></span>
<span id="cb2-350"><a href="#cb2-350" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-351"><a href="#cb2-351" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb2-352"><a href="#cb2-352" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span> margin<span class="op">.</span><span class="at">left</span> <span class="sc">}</span><span class="vs">,0)`</span>)</span>
<span id="cb2-353"><a href="#cb2-353" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"rect"</span>)</span>
<span id="cb2-354"><a href="#cb2-354" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(data)</span>
<span id="cb2-355"><a href="#cb2-355" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">join</span>(<span class="st">"rect"</span>)</span>
<span id="cb2-356"><a href="#cb2-356" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"evasion-bars"</span>)</span>
<span id="cb2-357"><a href="#cb2-357" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="fu">xScaler</span>(<span class="dv">0</span>))</span>
<span id="cb2-358"><a href="#cb2-358" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> (d<span class="op">,</span> i) <span class="kw">=&gt;</span> <span class="fu">yScaler</span>(Y[i]))</span>
<span id="cb2-359"><a href="#cb2-359" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">xScaler</span>(d<span class="op">.</span><span class="at">evasion</span>))</span>
<span id="cb2-360"><a href="#cb2-360" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> yScaler<span class="op">.</span><span class="fu">bandwidth</span>())</span>
<span id="cb2-361"><a href="#cb2-361" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">blue</span>)</span>
<span id="cb2-362"><a href="#cb2-362" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">on</span>(<span class="st">"mousemove"</span><span class="op">,</span> mousemoved)</span>
<span id="cb2-363"><a href="#cb2-363" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">on</span>(<span class="st">"mouseleave"</span><span class="op">,</span> mouseleft)<span class="op">;</span></span>
<span id="cb2-364"><a href="#cb2-364" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-365"><a href="#cb2-365" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">mousemoved</span>(<span class="bu">event</span><span class="op">,</span> d) {</span>
<span id="cb2-366"><a href="#cb2-366" aria-hidden="true" tabindex="-1"></a>    d3<span class="op">.</span><span class="fu">select</span>(<span class="kw">this</span>)</span>
<span id="cb2-367"><a href="#cb2-367" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">transition</span>()<span class="op">.</span><span class="fu">duration</span>(<span class="dv">50</span>)</span>
<span id="cb2-368"><a href="#cb2-368" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">red</span>)<span class="op">;</span></span>
<span id="cb2-369"><a href="#cb2-369" aria-hidden="true" tabindex="-1"></a>    tooltip</span>
<span id="cb2-370"><a href="#cb2-370" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"display"</span><span class="op">,</span> <span class="st">"block"</span>)</span>
<span id="cb2-371"><a href="#cb2-371" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"left"</span><span class="op">,</span> <span class="bu">event</span><span class="op">.</span><span class="at">pageX</span> <span class="op">+</span> <span class="dv">18</span> <span class="op">+</span> <span class="st">"px"</span>)</span>
<span id="cb2-372"><a href="#cb2-372" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"top"</span><span class="op">,</span> <span class="bu">event</span><span class="op">.</span><span class="at">pageY</span> <span class="op">+</span> <span class="dv">18</span> <span class="op">+</span> <span class="st">"px"</span>)</span>
<span id="cb2-373"><a href="#cb2-373" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(d3<span class="op">.</span><span class="fu">format</span>(<span class="st">".1%"</span>)(d<span class="op">.</span><span class="at">evasion</span>))<span class="op">;</span></span>
<span id="cb2-374"><a href="#cb2-374" aria-hidden="true" tabindex="-1"></a>    d3<span class="op">.</span><span class="fu">select</span>(<span class="bu">event</span><span class="op">.</span><span class="at">target</span>)<span class="op">.</span><span class="fu">style</span>(<span class="st">"cursor"</span><span class="op">,</span> <span class="st">"pointer"</span>)<span class="op">;</span></span>
<span id="cb2-375"><a href="#cb2-375" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-376"><a href="#cb2-376" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-377"><a href="#cb2-377" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">mouseleft</span>(<span class="bu">event</span>) {</span>
<span id="cb2-378"><a href="#cb2-378" aria-hidden="true" tabindex="-1"></a>    d3<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"rect.evasion-bars"</span>)</span>
<span id="cb2-379"><a href="#cb2-379" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">transition</span>()<span class="op">.</span><span class="fu">duration</span>(<span class="dv">200</span>)</span>
<span id="cb2-380"><a href="#cb2-380" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">blue</span>)</span>
<span id="cb2-381"><a href="#cb2-381" aria-hidden="true" tabindex="-1"></a>    tooltip<span class="op">.</span><span class="fu">style</span>(<span class="st">"display"</span><span class="op">,</span> <span class="st">"none"</span>)<span class="op">;</span></span>
<span id="cb2-382"><a href="#cb2-382" aria-hidden="true" tabindex="-1"></a>    d3<span class="op">.</span><span class="fu">select</span>(<span class="bu">event</span><span class="op">.</span><span class="at">target</span>)<span class="op">.</span><span class="fu">style</span>(<span class="st">"cursor"</span><span class="op">,</span> <span class="st">"default"</span>)<span class="op">;</span></span>
<span id="cb2-383"><a href="#cb2-383" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-384"><a href="#cb2-384" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-385"><a href="#cb2-385" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Annotation ///////////////////////////////////////////////////////////////</span></span>
<span id="cb2-386"><a href="#cb2-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-387"><a href="#cb2-387" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb2-388"><a href="#cb2-388" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="st">"translate(500, 200)"</span>)</span>
<span id="cb2-389"><a href="#cb2-389" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb2-390"><a href="#cb2-390" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb2-391"><a href="#cb2-391" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">".9rem"</span>)</span>
<span id="cb2-392"><a href="#cb2-392" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"black"</span>)</span>
<span id="cb2-393"><a href="#cb2-393" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb2-394"><a href="#cb2-394" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"tspan"</span>)</span>
<span id="cb2-395"><a href="#cb2-395" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(<span class="st">"The top "</span>)</span>
<span id="cb2-396"><a href="#cb2-396" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb2-397"><a href="#cb2-397" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"tspan"</span>)</span>
<span id="cb2-398"><a href="#cb2-398" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(<span class="st">"0.01%"</span>)</span>
<span id="cb2-399"><a href="#cb2-399" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-weight"</span><span class="op">,</span> <span class="st">"bold"</span>)</span>
<span id="cb2-400"><a href="#cb2-400" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"tspan"</span>)</span>
<span id="cb2-401"><a href="#cb2-401" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(<span class="st">" evade "</span>)</span>
<span id="cb2-402"><a href="#cb2-402" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-weight"</span><span class="op">,</span> <span class="st">"normal"</span>)</span>
<span id="cb2-403"><a href="#cb2-403" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"tspan"</span>)</span>
<span id="cb2-404"><a href="#cb2-404" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(<span class="st">"26%"</span>)</span>
<span id="cb2-405"><a href="#cb2-405" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-weight"</span><span class="op">,</span> <span class="st">"bold"</span>)</span>
<span id="cb2-406"><a href="#cb2-406" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">red</span>)</span>
<span id="cb2-407"><a href="#cb2-407" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"tspan"</span>)</span>
<span id="cb2-408"><a href="#cb2-408" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(<span class="st">"of their tax obligations"</span>)</span>
<span id="cb2-409"><a href="#cb2-409" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"dy"</span><span class="op">,</span> <span class="dv">20</span>)</span>
<span id="cb2-410"><a href="#cb2-410" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-weight"</span><span class="op">,</span> <span class="st">"normal"</span>)</span>
<span id="cb2-411"><a href="#cb2-411" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"black"</span>)</span>
<span id="cb2-412"><a href="#cb2-412" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-413"><a href="#cb2-413" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"defs"</span>)</span>
<span id="cb2-414"><a href="#cb2-414" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"marker"</span>)</span>
<span id="cb2-415"><a href="#cb2-415" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"arrow-2"</span>)</span>
<span id="cb2-416"><a href="#cb2-416" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> <span class="st">"0 0 10 10"</span>)</span>
<span id="cb2-417"><a href="#cb2-417" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"refX"</span><span class="op">,</span> <span class="dv">8</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"refY"</span><span class="op">,</span> <span class="dv">5</span>)</span>
<span id="cb2-418"><a href="#cb2-418" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"markerWidth"</span><span class="op">,</span> <span class="dv">10</span>)</span>
<span id="cb2-419"><a href="#cb2-419" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"markerHeight"</span><span class="op">,</span> <span class="dv">10</span>)</span>
<span id="cb2-420"><a href="#cb2-420" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"orient"</span><span class="op">,</span> <span class="st">"auto"</span>)</span>
<span id="cb2-421"><a href="#cb2-421" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb2-422"><a href="#cb2-422" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="st">"M0,1 L9,5 L0,9"</span>)</span>
<span id="cb2-423"><a href="#cb2-423" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke-linejoin"</span><span class="op">,</span> <span class="st">"round"</span>)</span>
<span id="cb2-424"><a href="#cb2-424" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"black"</span>)</span>
<span id="cb2-425"><a href="#cb2-425" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="dv">1</span>)</span>
<span id="cb2-426"><a href="#cb2-426" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)<span class="op">;</span></span>
<span id="cb2-427"><a href="#cb2-427" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-428"><a href="#cb2-428" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb2-429"><a href="#cb2-429" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb2-430"><a href="#cb2-430" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb2-431"><a href="#cb2-431" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> path <span class="op">=</span> d3<span class="op">.</span><span class="fu">path</span>()<span class="op">;</span></span>
<span id="cb2-432"><a href="#cb2-432" aria-hidden="true" tabindex="-1"></a>      path<span class="op">.</span><span class="fu">moveTo</span>(<span class="dv">610</span><span class="op">,</span> <span class="dv">200</span>)<span class="op">;</span></span>
<span id="cb2-433"><a href="#cb2-433" aria-hidden="true" tabindex="-1"></a>      path<span class="op">.</span><span class="fu">quadraticCurveTo</span>(<span class="dv">700</span><span class="op">,</span> <span class="dv">170</span><span class="op">,</span> <span class="dv">650</span><span class="op">,</span> <span class="dv">90</span>)<span class="op">;</span></span>
<span id="cb2-434"><a href="#cb2-434" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> path<span class="op">;</span></span>
<span id="cb2-435"><a href="#cb2-435" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb2-436"><a href="#cb2-436" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"black"</span>)</span>
<span id="cb2-437"><a href="#cb2-437" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="dv">1</span>)</span>
<span id="cb2-438"><a href="#cb2-438" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb2-439"><a href="#cb2-439" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"marker-end"</span><span class="op">,</span> <span class="st">"url(#arrow-2)"</span>)<span class="op">;</span></span>
<span id="cb2-440"><a href="#cb2-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-441"><a href="#cb2-441" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Chart sources ////////////////////////////////////////////////////////////</span></span>
<span id="cb2-442"><a href="#cb2-442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-443"><a href="#cb2-443" aria-hidden="true" tabindex="-1"></a>  container<span class="op">.</span><span class="fu">append</span>(<span class="st">"div"</span>)</span>
<span id="cb2-444"><a href="#cb2-444" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"ojs-source"</span>)</span>
<span id="cb2-445"><a href="#cb2-445" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"margin"</span><span class="op">,</span> <span class="st">".5rem 0"</span>)</span>
<span id="cb2-446"><a href="#cb2-446" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"line-height"</span><span class="op">,</span> <span class="fl">1.25</span>)</span>
<span id="cb2-447"><a href="#cb2-447" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">html</span>(<span class="vs">`Source: A. Alstadsaeter, N. Johannesen, and G. Zucman, "Tax Evasion and Inequality", &lt;i&gt;American Economic Review&lt;/i&gt;, vol. 109, no. 6 (2019).`</span>)<span class="op">;</span></span>
<span id="cb2-448"><a href="#cb2-448" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-449"><a href="#cb2-449" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> container<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb2-450"><a href="#cb2-450" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="ojs-cell-2" data-nodetype="expression">

</div>
</div>
</div>
<p>But nevermind evasion: do existing tax rates even subject the rich to their fair share of taxes? Let us return to the United States and consider what has so far been Zucman’s most controversial finding during the most contentious period of his career.</p>
<p>In late 2019, he and Saez engaged in a publicity campaign for their book, <em>The Triumph of Injustice: How the Rich Dodge Taxes and How to Make Them Pay</em>. You can tell from the title alone that this is a political manifesto as much as a summary of their academic work. Pieces in <a href="https://www.nytimes.com/interactive/2019/10/06/opinion/income-tax-rate-wealthy.html"><em>The New York Times</em></a> and <a href="https://www.washingtonpost.com/business/2019/10/08/first-time-history-us-billionaires-paid-lower-tax-rate-than-working-class-last-year/"><em>The Washington Post</em></a> touted one of the book’s blockbuster claims, which is that the the very wealthiest of Americans — the top 0.00025% — today pay a lower share of their income in taxes than all other income groups. This came at the height of the Democratic primaries, where candidates like Bernie Sanders and Elizabeth Warren were competing for leadership of their party’s progressive wing. The Saez–Zucman claim naturally became a talking point.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3" data-startfrom="460" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 459;"><span id="cb3-460"><a href="#cb3-460" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb3-461"><a href="#cb3-461" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> dim <span class="op">=</span> ({ <span class="dt">width</span><span class="op">:</span> <span class="dv">790</span><span class="op">,</span> <span class="dt">height</span><span class="op">:</span> <span class="dv">550</span> })<span class="op">;</span></span>
<span id="cb3-462"><a href="#cb3-462" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> margin <span class="op">=</span> ({ <span class="dt">top</span><span class="op">:</span> <span class="dv">40</span><span class="op">,</span> <span class="dt">bottom</span><span class="op">:</span> <span class="dv">60</span><span class="op">,</span> <span class="dt">right</span><span class="op">:</span> <span class="dv">65</span><span class="op">,</span> <span class="dt">left</span><span class="op">:</span> <span class="dv">65</span> })<span class="op">;</span></span>
<span id="cb3-463"><a href="#cb3-463" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-464"><a href="#cb3-464" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> taxrate<span class="op">;</span></span>
<span id="cb3-465"><a href="#cb3-465" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> X <span class="op">=</span> d3<span class="op">.</span><span class="fu">map</span>(data<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">group</span>)<span class="op">;</span></span>
<span id="cb3-466"><a href="#cb3-466" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> Y <span class="op">=</span> d3<span class="op">.</span><span class="fu">map</span>(data<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">rate</span>)<span class="op">;</span></span>
<span id="cb3-467"><a href="#cb3-467" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> Z <span class="op">=</span> d3<span class="op">.</span><span class="fu">map</span>(data<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">year</span>)<span class="op">;</span></span>
<span id="cb3-468"><a href="#cb3-468" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> I <span class="op">=</span> d3<span class="op">.</span><span class="fu">range</span>(X<span class="op">.</span><span class="at">length</span>)<span class="op">;</span></span>
<span id="cb3-469"><a href="#cb3-469" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> xValues <span class="op">=</span> [<span class="op">...</span><span class="kw">new</span> <span class="bu">Set</span>(X)]<span class="op">;</span></span>
<span id="cb3-470"><a href="#cb3-470" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> n <span class="op">=</span> [<span class="op">...</span><span class="kw">new</span> <span class="bu">Set</span>(Z)]<span class="op">.</span><span class="at">length</span> <span class="op">-</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb3-471"><a href="#cb3-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-472"><a href="#cb3-472" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> xScaler <span class="op">=</span> d3<span class="op">.</span><span class="fu">scalePoint</span>()</span>
<span id="cb3-473"><a href="#cb3-473" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>(xValues)</span>
<span id="cb3-474"><a href="#cb3-474" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([margin<span class="op">.</span><span class="at">left</span><span class="op">,</span> dim<span class="op">.</span><span class="at">width</span> <span class="op">-</span> margin<span class="op">.</span><span class="at">right</span>])<span class="op">;</span></span>
<span id="cb3-475"><a href="#cb3-475" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-476"><a href="#cb3-476" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yScaler <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb3-477"><a href="#cb3-477" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="op">.</span><span class="dv">72</span>])</span>
<span id="cb3-478"><a href="#cb3-478" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([dim<span class="op">.</span><span class="at">height</span> <span class="op">-</span> margin<span class="op">.</span><span class="at">bottom</span><span class="op">,</span> margin<span class="op">.</span><span class="at">top</span>])<span class="op">;</span></span>
<span id="cb3-479"><a href="#cb3-479" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-480"><a href="#cb3-480" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> line <span class="op">=</span> d3<span class="op">.</span><span class="fu">line</span>()</span>
<span id="cb3-481"><a href="#cb3-481" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">curve</span>(d3<span class="op">.</span><span class="at">curveBasis</span>)</span>
<span id="cb3-482"><a href="#cb3-482" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">x</span>(i <span class="kw">=&gt;</span> <span class="fu">xScaler</span>(X[i]))</span>
<span id="cb3-483"><a href="#cb3-483" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">y</span>(i <span class="kw">=&gt;</span> <span class="fu">yScaler</span>(Y[i]))<span class="op">;</span></span>
<span id="cb3-484"><a href="#cb3-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-485"><a href="#cb3-485" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> container <span class="op">=</span> d3<span class="op">.</span><span class="fu">create</span>(<span class="st">"div"</span>)<span class="op">;</span></span>
<span id="cb3-486"><a href="#cb3-486" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-487"><a href="#cb3-487" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Chart title //////////////////////////////////////////////////////////////</span></span>
<span id="cb3-488"><a href="#cb3-488" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-489"><a href="#cb3-489" aria-hidden="true" tabindex="-1"></a>  container<span class="op">.</span><span class="fu">append</span>(<span class="st">"div"</span>)</span>
<span id="cb3-490"><a href="#cb3-490" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"ojs-title"</span>)</span>
<span id="cb3-491"><a href="#cb3-491" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">html</span>(<span class="vs">`My yoke is easy, my burden is light`</span>)<span class="op">;</span></span>
<span id="cb3-492"><a href="#cb3-492" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-493"><a href="#cb3-493" aria-hidden="true" tabindex="-1"></a>  container<span class="op">.</span><span class="fu">append</span>(<span class="st">"div"</span>)</span>
<span id="cb3-494"><a href="#cb3-494" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"ojs-subtitle"</span>)</span>
<span id="cb3-495"><a href="#cb3-495" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"margin-bottom"</span><span class="op">,</span> <span class="st">"1rem"</span>)</span>
<span id="cb3-496"><a href="#cb3-496" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">html</span>(<span class="vs">`Average tax rate by income group, United States, 1950–2018`</span>)<span class="op">;</span></span>
<span id="cb3-497"><a href="#cb3-497" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-498"><a href="#cb3-498" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Chart canvas /////////////////////////////////////////////////////////////</span></span>
<span id="cb3-499"><a href="#cb3-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-500"><a href="#cb3-500" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> container<span class="op">.</span><span class="fu">append</span>(<span class="st">"svg"</span>)</span>
<span id="cb3-501"><a href="#cb3-501" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> dim<span class="op">.</span><span class="at">width</span>)</span>
<span id="cb3-502"><a href="#cb3-502" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> dim<span class="op">.</span><span class="at">height</span>)</span>
<span id="cb3-503"><a href="#cb3-503" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> dim<span class="op">.</span><span class="at">width</span><span class="op">,</span> dim<span class="op">.</span><span class="at">height</span>])</span>
<span id="cb3-504"><a href="#cb3-504" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"style"</span><span class="op">,</span> <span class="st">"max-width: 100%; height: auto; height: intrinsic;"</span>)</span>
<span id="cb3-505"><a href="#cb3-505" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">on</span>(<span class="st">"mouseenter"</span><span class="op">,</span> mouseentered)</span>
<span id="cb3-506"><a href="#cb3-506" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">on</span>(<span class="st">"mousemove"</span><span class="op">,</span> mousemoved)</span>
<span id="cb3-507"><a href="#cb3-507" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">on</span>(<span class="st">"mouseleave"</span><span class="op">,</span> mouseleft)<span class="op">;</span></span>
<span id="cb3-508"><a href="#cb3-508" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-509"><a href="#cb3-509" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb3-510"><a href="#cb3-510" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb3-511"><a href="#cb3-511" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb3-512"><a href="#cb3-512" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> dim<span class="op">.</span><span class="at">width</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> dim<span class="op">.</span><span class="at">height</span>)</span>
<span id="cb3-513"><a href="#cb3-513" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"#DCE7EB"</span>)</span>
<span id="cb3-514"><a href="#cb3-514" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="op">.</span><span class="dv">6</span>)<span class="op">;</span></span>
<span id="cb3-515"><a href="#cb3-515" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-516"><a href="#cb3-516" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Axes /////////////////////////////////////////////////////////////////////</span></span>
<span id="cb3-517"><a href="#cb3-517" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-518"><a href="#cb3-518" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> xAxis <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb3-519"><a href="#cb3-519" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(0,</span><span class="sc">${</span> dim<span class="op">.</span><span class="at">height</span> <span class="op">-</span> margin<span class="op">.</span><span class="at">bottom</span> <span class="sc">}</span><span class="vs">)`</span>)</span>
<span id="cb3-520"><a href="#cb3-520" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb3-521"><a href="#cb3-521" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">".8rem"</span>)</span>
<span id="cb3-522"><a href="#cb3-522" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(g <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb3-523"><a href="#cb3-523" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(<span class="st">"10th"</span>)</span>
<span id="cb3-524"><a href="#cb3-524" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="fu">xScaler</span>(<span class="st">"P10-20"</span>))</span>
<span id="cb3-525"><a href="#cb3-525" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"dy"</span><span class="op">,</span> <span class="dv">20</span>))</span>
<span id="cb3-526"><a href="#cb3-526" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(g <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb3-527"><a href="#cb3-527" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(<span class="st">"50th"</span>)</span>
<span id="cb3-528"><a href="#cb3-528" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="fu">xScaler</span>(<span class="st">"P50-60"</span>))</span>
<span id="cb3-529"><a href="#cb3-529" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"dy"</span><span class="op">,</span> <span class="dv">20</span>))</span>
<span id="cb3-530"><a href="#cb3-530" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(g <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb3-531"><a href="#cb3-531" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(<span class="st">"90th"</span>)</span>
<span id="cb3-532"><a href="#cb3-532" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="fu">xScaler</span>(<span class="st">"P90-95"</span>))</span>
<span id="cb3-533"><a href="#cb3-533" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"dy"</span><span class="op">,</span> <span class="dv">20</span>))</span>
<span id="cb3-534"><a href="#cb3-534" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(g <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb3-535"><a href="#cb3-535" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(<span class="st">"99.99+"</span>)</span>
<span id="cb3-536"><a href="#cb3-536" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="fu">xScaler</span>(<span class="st">"P99.99-top 400"</span>))</span>
<span id="cb3-537"><a href="#cb3-537" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"dy"</span><span class="op">,</span> <span class="dv">20</span>))</span>
<span id="cb3-538"><a href="#cb3-538" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(g <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb3-539"><a href="#cb3-539" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> d3<span class="op">.</span><span class="fu">line</span>()([[margin<span class="op">.</span><span class="at">left</span><span class="op">,</span> <span class="dv">0</span>]<span class="op">,</span> [dim<span class="op">.</span><span class="at">width</span> <span class="op">-</span> margin<span class="op">.</span><span class="at">right</span><span class="op">,</span> <span class="dv">0</span>]]))</span>
<span id="cb3-540"><a href="#cb3-540" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb3-541"><a href="#cb3-541" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"black"</span>))</span>
<span id="cb3-542"><a href="#cb3-542" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(g <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb3-543"><a href="#cb3-543" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> (dim<span class="op">.</span><span class="at">width</span> <span class="op">-</span> margin<span class="op">.</span><span class="at">left</span> <span class="op">-</span> margin<span class="op">.</span><span class="at">right</span>) <span class="op">/</span> <span class="dv">2</span>)</span>
<span id="cb3-544"><a href="#cb3-544" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb3-545"><a href="#cb3-545" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"dy"</span><span class="op">,</span> <span class="dv">30</span>)</span>
<span id="cb3-546"><a href="#cb3-546" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"alignment-baseline"</span><span class="op">,</span> <span class="st">"hanging"</span>)</span>
<span id="cb3-547"><a href="#cb3-547" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">".9rem"</span>)</span>
<span id="cb3-548"><a href="#cb3-548" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(<span class="st">"Income percentile"</span>))<span class="op">;</span></span>
<span id="cb3-549"><a href="#cb3-549" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-550"><a href="#cb3-550" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yAxis <span class="op">=</span> d3<span class="op">.</span><span class="fu">axisLeft</span>(yScaler)</span>
<span id="cb3-551"><a href="#cb3-551" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">ticks</span>(<span class="dv">5</span><span class="op">,</span> <span class="st">".0%"</span>)</span>
<span id="cb3-552"><a href="#cb3-552" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">tickSize</span>(<span class="dv">0</span>)</span>
<span id="cb3-553"><a href="#cb3-553" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">tickPadding</span>([<span class="dv">20</span>])<span class="op">;</span></span>
<span id="cb3-554"><a href="#cb3-554" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-555"><a href="#cb3-555" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb3-556"><a href="#cb3-556" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span> margin<span class="op">.</span><span class="at">left</span> <span class="sc">}</span><span class="vs">,0)`</span>)</span>
<span id="cb3-557"><a href="#cb3-557" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">".8rem"</span>)</span>
<span id="cb3-558"><a href="#cb3-558" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(yAxis)</span>
<span id="cb3-559"><a href="#cb3-559" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(g <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">select</span>(<span class="st">".domain"</span>)<span class="op">.</span><span class="fu">remove</span>())</span>
<span id="cb3-560"><a href="#cb3-560" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(g <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb3-561"><a href="#cb3-561" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="op">-</span>margin<span class="op">.</span><span class="at">left</span>)</span>
<span id="cb3-562"><a href="#cb3-562" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">25</span>)</span>
<span id="cb3-563"><a href="#cb3-563" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"dx"</span><span class="op">,</span> <span class="dv">15</span>)</span>
<span id="cb3-564"><a href="#cb3-564" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"black"</span>)</span>
<span id="cb3-565"><a href="#cb3-565" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"start"</span>)</span>
<span id="cb3-566"><a href="#cb3-566" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">".9rem"</span>)</span>
<span id="cb3-567"><a href="#cb3-567" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(<span class="st">"Share of pre-tax income"</span>))<span class="op">;</span></span>
<span id="cb3-568"><a href="#cb3-568" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb3-569"><a href="#cb3-569" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Lines and labels /////////////////////////////////////////////////////////</span></span>
<span id="cb3-570"><a href="#cb3-570" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-571"><a href="#cb3-571" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> panel <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb3-572"><a href="#cb3-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-573"><a href="#cb3-573" aria-hidden="true" tabindex="-1"></a>  panel<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb3-574"><a href="#cb3-574" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"path"</span>)</span>
<span id="cb3-575"><a href="#cb3-575" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">group</span>(I<span class="op">,</span> i <span class="kw">=&gt;</span> Z[i]))</span>
<span id="cb3-576"><a href="#cb3-576" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">join</span>(<span class="st">"path"</span>)</span>
<span id="cb3-577"><a href="#cb3-577" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb3-578"><a href="#cb3-578" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke"</span><span class="op">,</span> (d<span class="op">,</span> i) <span class="kw">=&gt;</span> i <span class="op">===</span> n <span class="op">?</span> colors<span class="op">.</span><span class="at">red</span> <span class="op">:</span> colors<span class="op">.</span><span class="at">blueLight</span>)</span>
<span id="cb3-579"><a href="#cb3-579" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="dv">3</span>)</span>
<span id="cb3-580"><a href="#cb3-580" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> ([<span class="op">,</span> I]) <span class="kw">=&gt;</span> <span class="fu">line</span>(I))<span class="op">;</span></span>
<span id="cb3-581"><a href="#cb3-581" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-582"><a href="#cb3-582" aria-hidden="true" tabindex="-1"></a>  panel<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb3-583"><a href="#cb3-583" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"text"</span>)</span>
<span id="cb3-584"><a href="#cb3-584" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(data<span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">group</span> <span class="op">===</span> <span class="st">"Top 400"</span>))</span>
<span id="cb3-585"><a href="#cb3-585" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">join</span>(<span class="st">"text"</span>)</span>
<span id="cb3-586"><a href="#cb3-586" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">year</span>)</span>
<span id="cb3-587"><a href="#cb3-587" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">xScaler</span>(d<span class="op">.</span><span class="at">group</span>))</span>
<span id="cb3-588"><a href="#cb3-588" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">yScaler</span>(d<span class="op">.</span><span class="at">rate</span>))</span>
<span id="cb3-589"><a href="#cb3-589" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"dx"</span><span class="op">,</span> <span class="dv">10</span>)</span>
<span id="cb3-590"><a href="#cb3-590" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"alignment-baseline"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb3-591"><a href="#cb3-591" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">year</span> <span class="op">===</span> <span class="dv">2018</span> <span class="op">?</span> colors<span class="op">.</span><span class="at">red</span> <span class="op">:</span> colors<span class="op">.</span><span class="at">blue</span>)</span>
<span id="cb3-592"><a href="#cb3-592" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">year</span> <span class="op">===</span> <span class="dv">2018</span> <span class="op">?</span> <span class="st">".8rem"</span> <span class="op">:</span> <span class="st">".7rem"</span>)</span>
<span id="cb3-593"><a href="#cb3-593" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-weight"</span><span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">year</span> <span class="op">===</span> <span class="dv">2018</span> <span class="op">?</span> <span class="st">"bold"</span> <span class="op">:</span> <span class="st">"normal"</span>)</span>
<span id="cb3-594"><a href="#cb3-594" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-595"><a href="#cb3-595" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Hover labels /////////////////////////////////////////////////////////////</span></span>
<span id="cb3-596"><a href="#cb3-596" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-597"><a href="#cb3-597" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> marker <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb3-598"><a href="#cb3-598" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"display"</span><span class="op">,</span> <span class="st">"none"</span>)<span class="op">;</span></span>
<span id="cb3-599"><a href="#cb3-599" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-600"><a href="#cb3-600" aria-hidden="true" tabindex="-1"></a>  marker<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb3-601"><a href="#cb3-601" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> d3<span class="op">.</span><span class="fu">line</span>()([[<span class="dv">0</span><span class="op">,</span> margin<span class="op">.</span><span class="at">top</span>]<span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> dim<span class="op">.</span><span class="at">height</span> <span class="op">-</span> margin<span class="op">.</span><span class="at">bottom</span>]]))</span>
<span id="cb3-602"><a href="#cb3-602" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"black"</span>)</span>
<span id="cb3-603"><a href="#cb3-603" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb3-604"><a href="#cb3-604" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-605"><a href="#cb3-605" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">mouseentered</span>() {</span>
<span id="cb3-606"><a href="#cb3-606" aria-hidden="true" tabindex="-1"></a>    marker<span class="op">.</span><span class="fu">attr</span>(<span class="st">"display"</span><span class="op">,</span> <span class="kw">null</span>)<span class="op">;</span></span>
<span id="cb3-607"><a href="#cb3-607" aria-hidden="true" tabindex="-1"></a>    tooltip<span class="op">.</span><span class="fu">style</span>(<span class="st">"display"</span><span class="op">,</span> <span class="st">"block"</span>)<span class="op">;</span></span>
<span id="cb3-608"><a href="#cb3-608" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb3-609"><a href="#cb3-609" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-610"><a href="#cb3-610" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">mousemoved</span>(<span class="bu">event</span>) {</span>
<span id="cb3-611"><a href="#cb3-611" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> [xm<span class="op">,</span> ym] <span class="op">=</span> d3<span class="op">.</span><span class="fu">pointer</span>(<span class="bu">event</span>)<span class="op">;</span></span>
<span id="cb3-612"><a href="#cb3-612" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> x <span class="op">=</span> d3<span class="op">.</span><span class="fu">least</span>(xValues<span class="op">,</span> x <span class="kw">=&gt;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(<span class="fu">xScaler</span>(x) <span class="op">-</span> xm))<span class="op">;</span></span>
<span id="cb3-613"><a href="#cb3-613" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> i <span class="op">=</span> X<span class="op">.</span><span class="fu">map</span>((d<span class="op">,</span> i) <span class="kw">=&gt;</span> d <span class="op">===</span> x <span class="op">?</span> i <span class="op">:</span> <span class="st">""</span>)<span class="op">.</span><span class="fu">filter</span>(<span class="bu">String</span>)<span class="op">;</span></span>
<span id="cb3-614"><a href="#cb3-614" aria-hidden="true" tabindex="-1"></a>    marker<span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span> <span class="fu">xScaler</span>(x) <span class="sc">}</span><span class="vs">, 0)`</span>)<span class="op">;</span></span>
<span id="cb3-615"><a href="#cb3-615" aria-hidden="true" tabindex="-1"></a>    tooltip</span>
<span id="cb3-616"><a href="#cb3-616" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"left"</span><span class="op">,</span> <span class="bu">event</span><span class="op">.</span><span class="at">pageX</span> <span class="op">+</span> <span class="dv">18</span> <span class="op">+</span> <span class="st">"px"</span>)</span>
<span id="cb3-617"><a href="#cb3-617" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"top"</span><span class="op">,</span> <span class="bu">event</span><span class="op">.</span><span class="at">pageY</span> <span class="op">+</span> <span class="dv">18</span> <span class="op">+</span> <span class="st">"px"</span>)</span>
<span id="cb3-618"><a href="#cb3-618" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">html</span>(<span class="vs">`</span></span>
<span id="cb3-619"><a href="#cb3-619" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;b&gt;</span><span class="sc">${</span>x<span class="sc">}</span><span class="vs"> tax rate&lt;/b&gt;&lt;br&gt;</span></span>
<span id="cb3-620"><a href="#cb3-620" aria-hidden="true" tabindex="-1"></a><span class="vs">        1950: </span><span class="sc">${</span> d3<span class="op">.</span><span class="fu">format</span>(<span class="st">",.1%"</span>)(Y[i[<span class="dv">0</span>]]) <span class="sc">}</span><span class="vs">&lt;br&gt;</span></span>
<span id="cb3-621"><a href="#cb3-621" aria-hidden="true" tabindex="-1"></a><span class="vs">        1980: </span><span class="sc">${</span> d3<span class="op">.</span><span class="fu">format</span>(<span class="st">",.1%"</span>)(Y[i[<span class="dv">3</span>]]) <span class="sc">}</span><span class="vs">&lt;br&gt;</span></span>
<span id="cb3-622"><a href="#cb3-622" aria-hidden="true" tabindex="-1"></a><span class="vs">        2018: </span><span class="sc">${</span> d3<span class="op">.</span><span class="fu">format</span>(<span class="st">",.1%"</span>)(Y[i[n]]) <span class="sc">}</span></span>
<span id="cb3-623"><a href="#cb3-623" aria-hidden="true" tabindex="-1"></a><span class="vs">      `</span>)<span class="op">;</span></span>
<span id="cb3-624"><a href="#cb3-624" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb3-625"><a href="#cb3-625" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-626"><a href="#cb3-626" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">mouseleft</span>() {</span>
<span id="cb3-627"><a href="#cb3-627" aria-hidden="true" tabindex="-1"></a>    marker<span class="op">.</span><span class="fu">attr</span>(<span class="st">"display"</span><span class="op">,</span> <span class="st">"none"</span>)<span class="op">;</span></span>
<span id="cb3-628"><a href="#cb3-628" aria-hidden="true" tabindex="-1"></a>    tooltip<span class="op">.</span><span class="fu">style</span>(<span class="st">"display"</span><span class="op">,</span> <span class="st">"none"</span>)<span class="op">;</span></span>
<span id="cb3-629"><a href="#cb3-629" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb3-630"><a href="#cb3-630" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-631"><a href="#cb3-631" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Annotation ///////////////////////////////////////////////////////////////</span></span>
<span id="cb3-632"><a href="#cb3-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-633"><a href="#cb3-633" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb3-634"><a href="#cb3-634" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="st">"translate(410, 200)"</span>)</span>
<span id="cb3-635"><a href="#cb3-635" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb3-636"><a href="#cb3-636" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb3-637"><a href="#cb3-637" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">".9rem"</span>)</span>
<span id="cb3-638"><a href="#cb3-638" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"black"</span>)</span>
<span id="cb3-639"><a href="#cb3-639" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb3-640"><a href="#cb3-640" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"tspan"</span>)</span>
<span id="cb3-641"><a href="#cb3-641" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(<span class="st">"The ultra wealthy have seen an"</span>)</span>
<span id="cb3-642"><a href="#cb3-642" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb3-643"><a href="#cb3-643" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"tspan"</span>)</span>
<span id="cb3-644"><a href="#cb3-644" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(<span class="st">"apparent fall in their tax burden"</span>)</span>
<span id="cb3-645"><a href="#cb3-645" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"dy"</span><span class="op">,</span> <span class="dv">20</span>)</span>
<span id="cb3-646"><a href="#cb3-646" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"tspan"</span>)</span>
<span id="cb3-647"><a href="#cb3-647" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(<span class="st">"from "</span>)</span>
<span id="cb3-648"><a href="#cb3-648" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"dy"</span><span class="op">,</span> <span class="dv">40</span>)</span>
<span id="cb3-649"><a href="#cb3-649" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"tspan"</span>)</span>
<span id="cb3-650"><a href="#cb3-650" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(<span class="st">"70%"</span>)</span>
<span id="cb3-651"><a href="#cb3-651" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-weight"</span><span class="op">,</span> <span class="st">"bold"</span>)</span>
<span id="cb3-652"><a href="#cb3-652" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"tspan"</span>)</span>
<span id="cb3-653"><a href="#cb3-653" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(<span class="st">" in 1950 to "</span>)</span>
<span id="cb3-654"><a href="#cb3-654" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-weight"</span><span class="op">,</span> <span class="st">"normal"</span>)</span>
<span id="cb3-655"><a href="#cb3-655" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"black"</span>)</span>
<span id="cb3-656"><a href="#cb3-656" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"tspan"</span>)</span>
<span id="cb3-657"><a href="#cb3-657" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(<span class="st">"23%"</span>)</span>
<span id="cb3-658"><a href="#cb3-658" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-weight"</span><span class="op">,</span> <span class="st">"bold"</span>)</span>
<span id="cb3-659"><a href="#cb3-659" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">red</span>)</span>
<span id="cb3-660"><a href="#cb3-660" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"tspan"</span>)</span>
<span id="cb3-661"><a href="#cb3-661" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(<span class="st">" in 2018"</span>)</span>
<span id="cb3-662"><a href="#cb3-662" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-weight"</span><span class="op">,</span> <span class="st">"normal"</span>)</span>
<span id="cb3-663"><a href="#cb3-663" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"black"</span>)</span>
<span id="cb3-664"><a href="#cb3-664" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-665"><a href="#cb3-665" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"defs"</span>)</span>
<span id="cb3-666"><a href="#cb3-666" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"marker"</span>)</span>
<span id="cb3-667"><a href="#cb3-667" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"arrow-3"</span>)</span>
<span id="cb3-668"><a href="#cb3-668" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> <span class="st">"0 0 10 10"</span>)</span>
<span id="cb3-669"><a href="#cb3-669" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"refX"</span><span class="op">,</span> <span class="dv">8</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"refY"</span><span class="op">,</span> <span class="dv">5</span>)</span>
<span id="cb3-670"><a href="#cb3-670" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"markerWidth"</span><span class="op">,</span> <span class="dv">10</span>)</span>
<span id="cb3-671"><a href="#cb3-671" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"markerHeight"</span><span class="op">,</span> <span class="dv">10</span>)</span>
<span id="cb3-672"><a href="#cb3-672" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"orient"</span><span class="op">,</span> <span class="st">"auto"</span>)</span>
<span id="cb3-673"><a href="#cb3-673" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb3-674"><a href="#cb3-674" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="st">"M0,1 L9,5 L0,9"</span>)</span>
<span id="cb3-675"><a href="#cb3-675" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke-linejoin"</span><span class="op">,</span> <span class="st">"round"</span>)</span>
<span id="cb3-676"><a href="#cb3-676" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"black"</span>)</span>
<span id="cb3-677"><a href="#cb3-677" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="dv">1</span>)</span>
<span id="cb3-678"><a href="#cb3-678" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)<span class="op">;</span></span>
<span id="cb3-679"><a href="#cb3-679" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-680"><a href="#cb3-680" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb3-681"><a href="#cb3-681" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(g <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb3-682"><a href="#cb3-682" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb3-683"><a href="#cb3-683" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> path <span class="op">=</span> d3<span class="op">.</span><span class="fu">path</span>()<span class="op">;</span></span>
<span id="cb3-684"><a href="#cb3-684" aria-hidden="true" tabindex="-1"></a>        path<span class="op">.</span><span class="fu">moveTo</span>(<span class="dv">460</span><span class="op">,</span> <span class="dv">263</span>)<span class="op">;</span></span>
<span id="cb3-685"><a href="#cb3-685" aria-hidden="true" tabindex="-1"></a>        path<span class="op">.</span><span class="fu">quadraticCurveTo</span>(<span class="dv">500</span><span class="op">,</span> <span class="dv">450</span><span class="op">,</span> <span class="dv">700</span><span class="op">,</span> <span class="dv">360</span>)<span class="op">;</span></span>
<span id="cb3-686"><a href="#cb3-686" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> path<span class="op">;</span></span>
<span id="cb3-687"><a href="#cb3-687" aria-hidden="true" tabindex="-1"></a>    }))</span>
<span id="cb3-688"><a href="#cb3-688" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(g <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb3-689"><a href="#cb3-689" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb3-690"><a href="#cb3-690" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> path <span class="op">=</span> d3<span class="op">.</span><span class="fu">path</span>()<span class="op">;</span></span>
<span id="cb3-691"><a href="#cb3-691" aria-hidden="true" tabindex="-1"></a>        path<span class="op">.</span><span class="fu">moveTo</span>(<span class="dv">470</span><span class="op">,</span> <span class="dv">172</span>)<span class="op">;</span></span>
<span id="cb3-692"><a href="#cb3-692" aria-hidden="true" tabindex="-1"></a>        path<span class="op">.</span><span class="fu">quadraticCurveTo</span>(<span class="dv">550</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">685</span><span class="op">,</span> <span class="dv">40</span>)<span class="op">;</span></span>
<span id="cb3-693"><a href="#cb3-693" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> path<span class="op">;</span></span>
<span id="cb3-694"><a href="#cb3-694" aria-hidden="true" tabindex="-1"></a>    }))</span>
<span id="cb3-695"><a href="#cb3-695" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"black"</span>)</span>
<span id="cb3-696"><a href="#cb3-696" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="dv">1</span>)</span>
<span id="cb3-697"><a href="#cb3-697" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb3-698"><a href="#cb3-698" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"marker-end"</span><span class="op">,</span> <span class="st">"url(#arrow-3)"</span>)<span class="op">;</span></span>
<span id="cb3-699"><a href="#cb3-699" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-700"><a href="#cb3-700" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Chart sources ////////////////////////////////////////////////////////////</span></span>
<span id="cb3-701"><a href="#cb3-701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-702"><a href="#cb3-702" aria-hidden="true" tabindex="-1"></a>  container<span class="op">.</span><span class="fu">append</span>(<span class="st">"div"</span>)</span>
<span id="cb3-703"><a href="#cb3-703" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"ojs-source"</span>)</span>
<span id="cb3-704"><a href="#cb3-704" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"margin"</span><span class="op">,</span> <span class="st">".5rem 0"</span>)</span>
<span id="cb3-705"><a href="#cb3-705" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"line-height"</span><span class="op">,</span> <span class="fl">1.25</span>)</span>
<span id="cb3-706"><a href="#cb3-706" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">html</span>(<span class="vs">`Source: E. Saez and G. Zucman, &lt;i&gt;The Triumph of Injustice&lt;/i&gt;, 2019.`</span>)<span class="op">;</span></span>
<span id="cb3-707"><a href="#cb3-707" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-708"><a href="#cb3-708" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> container<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb3-709"><a href="#cb3-709" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="ojs-cell-3" data-nodetype="expression">

</div>
</div>
</div>
<p><a href="http://www.davidsplinter.com/Splinter-TaxesAreProgressive.pdf">But</a> <a href="https://twitter.com/wwwojtekk/status/1183953723825020928">then</a> <a href="https://www.aier.org/article/the-big-fib-about-the-rich-and-taxes/">came</a> <a href="https://www.vox.com/policy-and-politics/2019/11/4/20938229/zucman-saez-tax-rates-top-400">the</a> <a href="https://marginalrevolution.com/marginalrevolution/2019/10/what-is-the-incidence-of-the-corporate-income-tax.html">backlash</a>. The crux of the matter is the age-old question of tax incidence: who the tax is imposed on versus who ultimately pays for it. Particularly relevant here are corporate income taxes, which have fallen <a href="https://www.epi.org/publication/ib364-corporate-tax-rates-and-economic-growth">from over 50% in the 1950s to 35% today</a>. These are statutorily paid by shareholders (who tend to be wealthy), but, due to behavioral adjustments by investors and executives, they may also be borne by workers and owners of non-corporate capital (who tend to be less wealthy). The progressiveness of the U.S. tax system changes drastically depending on whether these behavioral adjustments are incorporated. Most economists believe they should be while Saez and Zucman are <a href="http://gabriel-zucman.eu/files/SaezZucman2019Incidence.pdf">arguing the other way</a>.</p>
<p>Which party is more scientifically sound? That is a very hard question to answer. This and all of Zucman’s works involve politically charged issues for which many commentators have long ago staked a philosophical stance. When <a href="https://www.econtalk.org/gabriel-zucman-on-inequality-growth-and-distributional-national-accounts">Zucman was a guest</a> in his <em>EconTalk</em> podcast back in 2017, Russ Roberts, who has done no work on measuring inequality but identifies strongly as a classical liberal, opened the conversation by saying, “I’m skeptical of these findings. I find them hard to believe.” Likewise, it may be no coincidence that supporters like <a href="https://archive.nytimes.com/krugman.blogs.nytimes.com/2014/03/24/american-patrimony">Paul Krugman</a> sit on Zucman’s side of the ideological spectrum.</p>
<p>I think too much has been made of Gabriel Zucman’s supposed heterodoxy. With publications in the <em>American Economic Review</em> and the <em>Quarterly Journal of Economics</em> and tenure at UC Berkeley, he remains very much within the mainstream of the profession. A French Ha-Joon Chang, he is not. And with a John Bates Clark Medal under his belt, he now joins the likes of — wouldn’t you know it — Milton Friedman. <img src="../../images/logo-icon.png" class="endmark img-fluid"></p>




<div id="quarto-appendix" class="default"><section id="data-and-cleaning-scripts" class="level2 appendix"><h2 class="anchored quarto-appendix-heading">Data and cleaning scripts</h2><div class="quarto-appendix-contents">

<ul>
<li><a href="https://gabriel-zucman.eu/files/AJZ2017.xlsx">AJZ2017.xlsx</a></li>
<li><a href="https://gabriel-zucman.eu/files/SaezZucman2020JEPData.xlsx">SaezZucman2020JEPData.xlsx</a></li>
<li><a href="../../datasets/zucman/clean.ipynb">clean.ipynb</a> / <a href="../../datasets/zucman/inequality.csv">inequality.csv</a>, <a href="../../datasets/zucman/evasion.csv">evasion.csv</a>, <a href="../../datasets/zucman/taxrate.csv">taxrate.csv</a></li>
</ul>
</div></section><section id="d3-observable-code" class="level2 appendix"><h2 class="anchored quarto-appendix-heading">D3 / Observable code</h2><div class="quarto-appendix-contents">

<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4" data-startfrom="731" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 730;"><span id="cb4-731"><a href="#cb4-731" aria-hidden="true" tabindex="-1"></a>inequality <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"../../datasets/zucman/inequality.csv"</span>)<span class="op">.</span><span class="fu">csv</span>({ <span class="dt">typed</span><span class="op">:</span> <span class="kw">true</span> })<span class="op">;</span></span>
<span id="cb4-732"><a href="#cb4-732" aria-hidden="true" tabindex="-1"></a>evasion <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"../../datasets/zucman/evasion.csv"</span>)<span class="op">.</span><span class="fu">csv</span>({ <span class="dt">typed</span><span class="op">:</span> <span class="kw">true</span> })<span class="op">;</span></span>
<span id="cb4-733"><a href="#cb4-733" aria-hidden="true" tabindex="-1"></a>taxrate <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"../../datasets/zucman/taxrate.csv"</span>)<span class="op">.</span><span class="fu">csv</span>({ <span class="dt">typed</span><span class="op">:</span> <span class="kw">true</span> })<span class="op">;</span></span>
<span id="cb4-734"><a href="#cb4-734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-735"><a href="#cb4-735" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> ({ <span class="dt">blue</span><span class="op">:</span> <span class="st">"#4889ab"</span><span class="op">,</span> <span class="dt">blueLight</span><span class="op">:</span> <span class="st">"#c0d7df"</span><span class="op">,</span> <span class="dt">red</span><span class="op">:</span> <span class="st">"#C85B89"</span> })</span>
<span id="cb4-736"><a href="#cb4-736" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-737"><a href="#cb4-737" aria-hidden="true" tabindex="-1"></a>tooltip <span class="op">=</span> d3<span class="op">.</span><span class="fu">select</span>(<span class="st">"body"</span>)</span>
<span id="cb4-738"><a href="#cb4-738" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">append</span>(<span class="st">"div"</span>)</span>
<span id="cb4-739"><a href="#cb4-739" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"toolTip"</span>)</span>
<span id="cb4-740"><a href="#cb4-740" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">style</span>(<span class="st">"display"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb4-741"><a href="#cb4-741" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">style</span>(<span class="st">"position"</span><span class="op">,</span> <span class="st">"absolute"</span>)</span>
<span id="cb4-742"><a href="#cb4-742" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">style</span>(<span class="st">"z-index"</span><span class="op">,</span> <span class="dv">999</span>)</span>
<span id="cb4-743"><a href="#cb4-743" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">style</span>(<span class="st">"width"</span><span class="op">,</span> <span class="dv">100</span>)</span>
<span id="cb4-744"><a href="#cb4-744" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">style</span>(<span class="st">"height"</span><span class="op">,</span> <span class="st">"auto"</span>)</span>
<span id="cb4-745"><a href="#cb4-745" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">style</span>(<span class="st">"background"</span><span class="op">,</span> <span class="st">"#f7f7f7"</span>)</span>
<span id="cb4-746"><a href="#cb4-746" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">style</span>(<span class="st">"border"</span><span class="op">,</span> <span class="st">"1px solid #cecece"</span>)</span>
<span id="cb4-747"><a href="#cb4-747" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">style</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="op">.</span><span class="dv">9</span>)</span>
<span id="cb4-748"><a href="#cb4-748" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">style</span>(<span class="st">"padding"</span><span class="op">,</span> <span class="st">".2em .45em"</span>)</span>
<span id="cb4-749"><a href="#cb4-749" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">".85rem"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-4-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-4-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-4-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-4-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-4-5" data-nodetype="declaration">

</div>
</div>
</div>
</div>


</div></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>One of these is the Fed’s own <a href="https://www.federalreserve.gov/releases/z1/dataviz/dfa/index.html">Distributional Financial Accounts statistics</a>, published beginning 2019. Trends here have so far been consistent with those of Zucman et al.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section></div></main> <!-- /main -->
<script type="ojs-module-contents">
eyJjb250ZW50cyI6W3sibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ilxue1xuICBjb25zdCBkaW0gPSAoeyB3aWR0aDogNzkwLCBoZWlnaHQ6IDU1MCB9KTtcbiAgY29uc3QgbWFyZ2luID0gKHsgdG9wOiA2MCwgYm90dG9tOiA0MCwgcmlnaHQ6IDUwLCBsZWZ0OiA1MCB9KTtcbiAgXG4gIGNvbnN0IGRhdGEgPSBpbmVxdWFsaXR5O1xuICBjb25zdCBYID0gZDMubWFwKGRhdGEsIGQgPT4gZC55ZWFyKTtcbiAgY29uc3QgWSA9IGQzLm1hcChkYXRhLCBkID0+IGQuc2hhcmUpO1xuICBjb25zdCBaID0gZDMubWFwKGRhdGEsIGQgPT4gZC5ncm91cCk7XG4gIGNvbnN0IEkgPSBkMy5yYW5nZShYLmxlbmd0aCk7XG4gIGNvbnN0IHhWYWx1ZXMgPSBbLi4ubmV3IFNldChYKV07XG5cbiAgY29uc3QgeFNjYWxlciA9IGQzLnNjYWxlTGluZWFyKClcbiAgICAuZG9tYWluKFsxOTEyLCAyMDMwXSlcbiAgICAucmFuZ2UoW21hcmdpbi5sZWZ0LCBkaW0ud2lkdGggLSBtYXJnaW4ucmlnaHRdKTtcbiAgXG4gIGNvbnN0IHlTY2FsZXIgPSBkMy5zY2FsZUxpbmVhcigpXG4gICAgLmRvbWFpbihbMCwgLjM1XSlcbiAgICAucmFuZ2UoW2RpbS5oZWlnaHQgLSBtYXJnaW4uYm90dG9tLCBtYXJnaW4udG9wXSk7XG4gIFxuICBjb25zdCBsaW5lID0gZDMubGluZSgpXG4gICAgLmN1cnZlKGQzLmN1cnZlQmFzaXMpXG4gICAgLngoaSA9PiB4U2NhbGVyKFhbaV0pKVxuICAgIC55KGkgPT4geVNjYWxlcihZW2ldKSk7XG4gIFxuICBjb25zdCBjb250YWluZXIgPSBkMy5jcmVhdGUoXCJkaXZcIik7XG4gIFxuICAvLyBDaGFydCB0aXRsZSAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICBcbiAgY29udGFpbmVyLmFwcGVuZChcImRpdlwiKVxuICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJvanMtdGl0bGVcIilcbiAgICAuaHRtbChgVG8gdGhvc2Ugd2hvIGhhdmUsIG1vcmUgc2hhbGwgYmUgZ2l2ZW5gKTtcbiAgICBcbiAgY29udGFpbmVyLmFwcGVuZChcImRpdlwiKVxuICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJvanMtc3VidGl0bGVcIilcbiAgICAuc3R5bGUoXCJtYXJnaW4tYm90dG9tXCIsIFwiMXJlbVwiKVxuICAgIC5odG1sKGBEaXN0cmlidXRpb24gb2Ygd2VhbHRoIGJ5IHBlcmNlbnRpbGUsIFVuaXRlZCBTdGF0ZXMsIDE5MTfigJMyMDE5YCk7XG4gIFxuICAvLyBDaGFydCBjYW52YXMgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gIGNvbnN0IHN2ZyA9IGNvbnRhaW5lci5hcHBlbmQoXCJzdmdcIilcbiAgICAuYXR0cihcIndpZHRoXCIsIGRpbS53aWR0aClcbiAgICAuYXR0cihcImhlaWdodFwiLCBkaW0uaGVpZ2h0KVxuICAgIC5hdHRyKFwidmlld0JveFwiLCBbMCwgMCwgZGltLndpZHRoLCBkaW0uaGVpZ2h0XSlcbiAgICAuYXR0cihcInN0eWxlXCIsIFwibWF4LXdpZHRoOiAxMDAlOyBoZWlnaHQ6IGF1dG87IGhlaWdodDogaW50cmluc2ljO1wiKVxuICAgIC5vbihcIm1vdXNlZW50ZXJcIiwgbW91c2VlbnRlcmVkKVxuICAgIC5vbihcIm1vdXNlbW92ZVwiLCBtb3VzZW1vdmVkKVxuICAgIC5vbihcIm1vdXNlbGVhdmVcIiwgbW91c2VsZWZ0KTtcbiAgXG4gIHN2Zy5hcHBlbmQoXCJnXCIpXG4gICAgLmFwcGVuZChcInJlY3RcIilcbiAgICAuYXR0cihcInhcIiwgMCkuYXR0cihcInlcIiwgMClcbiAgICAuYXR0cihcIndpZHRoXCIsIGRpbS53aWR0aCkuYXR0cihcImhlaWdodFwiLCBkaW0uaGVpZ2h0KVxuICAgIC5zdHlsZShcImZpbGxcIiwgXCIjRENFN0VCXCIpXG4gICAgLnN0eWxlKFwib3BhY2l0eVwiLCAuNik7XG4gIFxuICAvLyBBeGVzIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICBcbiAgY29uc3QgeEF4aXMgPSBkMy5heGlzQm90dG9tKHhTY2FsZXIpXG4gICAgLnRpY2tWYWx1ZXMoQXJyYXkuZnJvbSh7bGVuZ3RoOiAxMX0sIChfLCBpKSA9PiAxOTIwICsgaSoxMCkpXG4gICAgLnRpY2tGb3JtYXQoZDMuZm9ybWF0KFwiLjBmXCIpKVxuICAgIC50aWNrU2l6ZSgwKVxuICAgIC50aWNrUGFkZGluZyhbMTBdKTtcbiAgICBcbiAgY29uc3QgeUF4aXMgPSBkMy5heGlzTGVmdCh5U2NhbGVyKVxuICAgIC50aWNrcyg1LCBcIi4wJVwiKVxuICAgIC50aWNrU2l6ZSgwKVxuICAgIC50aWNrUGFkZGluZyhbMTBdKTs7XG4gIFxuICBzdmcuYXBwZW5kKFwiZ1wiKVxuICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGB0cmFuc2xhdGUoMCwkeyBkaW0uaGVpZ2h0IC0gbWFyZ2luLmJvdHRvbSB9KWApXG4gICAgLnN0eWxlKFwiZm9udC1zaXplXCIsIFwiLjhyZW1cIilcbiAgICAuY2FsbCh4QXhpcylcbiAgICAuY2FsbChnID0+IGcuc2VsZWN0KFwiLmRvbWFpblwiKS5yZW1vdmUoKSlcbiAgICAuYXBwZW5kKFwicGF0aFwiKVxuICAgIC5hdHRyKFwiZFwiLCBkMy5saW5lKCkoW1ttYXJnaW4ubGVmdCwgMF0sIFtkaW0ud2lkdGggLSBtYXJnaW4ucmlnaHQsIDBdXSkpXG4gICAgLnN0eWxlKFwiZmlsbFwiLCBcIm5vbmVcIilcbiAgICAuc3R5bGUoXCJzdHJva2VcIiwgXCJibGFja1wiKTtcbiAgXG4gIHN2Zy5hcHBlbmQoXCJnXCIpXG4gICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgYHRyYW5zbGF0ZSgkeyBtYXJnaW4ubGVmdCB9LDApYClcbiAgICAuc3R5bGUoXCJmb250LXNpemVcIiwgXCIuOHJlbVwiKVxuICAgIC5jYWxsKHlBeGlzKVxuICAgIC5jYWxsKGcgPT4gZy5zZWxlY3QoXCIuZG9tYWluXCIpLnJlbW92ZSgpKVxuICAgIC5jYWxsKGcgPT4gZy5hcHBlbmQoXCJ0ZXh0XCIpXG4gICAgICAuYXR0cihcInhcIiwgLW1hcmdpbi5sZWZ0KVxuICAgICAgLmF0dHIoXCJ5XCIsIDI1KVxuICAgICAgLmF0dHIoXCJkeFwiLCAxMClcbiAgICAgIC5hdHRyKFwiZmlsbFwiLCBcImJsYWNrXCIpXG4gICAgICAuYXR0cihcInRleHQtYW5jaG9yXCIsIFwic3RhcnRcIilcbiAgICAgIC5zdHlsZShcImZvbnQtc2l6ZVwiLCBcIi45cmVtXCIpXG4gICAgICAudGV4dChcIlNoYXJlIGluIHRvdGFsIHdlYWx0aFwiKSk7XG4gIFxuICAvLyBMaW5lcyBhbmQgbGFiZWxzIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICBcbiAgY29uc3QgcGFuZWwgPSBzdmcuYXBwZW5kKFwiZ1wiKVxuXG4gIHBhbmVsLmFwcGVuZChcImdcIilcbiAgICAuc2VsZWN0QWxsKFwicGF0aFwiKVxuICAgIC5kYXRhKGQzLmdyb3VwKEksIGkgPT4gWltpXSkpXG4gICAgLmpvaW4oXCJwYXRoXCIpXG4gICAgICAuc3R5bGUoXCJmaWxsXCIsIFwibm9uZVwiKVxuICAgICAgLnN0eWxlKFwic3Ryb2tlXCIsIChkLCBpKSA9PiBpID09PSAwID8gY29sb3JzLmJsdWUgOiBjb2xvcnMucmVkKVxuICAgICAgLnN0eWxlKFwic3Ryb2tlLXdpZHRoXCIsIDMpXG4gICAgICAuYXR0cihcImRcIiwgKFssIEldKSA9PiBsaW5lKEkpKTtcbiAgXG4gIHBhbmVsLmFwcGVuZChcImdcIilcbiAgICAuYXBwZW5kKFwidGV4dFwiKVxuICAgIC5hdHRyKFwieFwiLCB4U2NhbGVyKDIwMjApKVxuICAgIC5hdHRyKFwieVwiLCB5U2NhbGVyKC4yMjcpKVxuICAgIC5hdHRyKFwidGV4dC1hbmNob3JcIiwgXCJzdGFydFwiKVxuICAgIC5hdHRyKFwiYWxpZ25tZW50LWJhc2VsaW5lXCIsIFwibWlkZGxlXCIpXG4gICAgLnN0eWxlKFwiZm9udC1zaXplXCIsIFwiLjlyZW1cIilcbiAgICAuc3R5bGUoXCJmaWxsXCIsIGNvbG9ycy5ibHVlKVxuICAgIC50ZXh0KFwiQm90dG9tIDkwJVwiKVxuICAgIFxuICBwYW5lbC5hcHBlbmQoXCJnXCIpXG4gICAgLmFwcGVuZChcInRleHRcIilcbiAgICAuYXR0cihcInhcIiwgeFNjYWxlcigyMDIwKSlcbiAgICAuYXR0cihcInlcIiwgeVNjYWxlciguMTkyKSlcbiAgICAuYXR0cihcInRleHQtYW5jaG9yXCIsIFwic3RhcnRcIilcbiAgICAuYXR0cihcImFsaWdubWVudC1iYXNlbGluZVwiLCBcIm1pZGRsZVwiKVxuICAgIC5zdHlsZShcImZvbnQtc2l6ZVwiLCBcIi45cmVtXCIpXG4gICAgLnN0eWxlKFwiZmlsbFwiLCBjb2xvcnMucmVkKVxuICAgIC50ZXh0KFwiVG9wIDAuMSVcIilcbiAgXG4gIC8vIEhvdmVyIGxhYmVscyAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG4gIFxuICBjb25zdCBtYXJrZXIgPSBzdmcuYXBwZW5kKFwiZ1wiKVxuICAgIC5hdHRyKFwiZGlzcGxheVwiLCBcIm5vbmVcIilcbiAgXG4gIG1hcmtlci5hcHBlbmQoXCJwYXRoXCIpXG4gICAgLmF0dHIoXCJkXCIsIGQzLmxpbmUoKShbWzAsIG1hcmdpbi50b3BdLCBbMCwgZGltLmhlaWdodCAtIG1hcmdpbi5ib3R0b21dXSkpXG4gICAgLnN0eWxlKFwic3Ryb2tlXCIsIFwiYmxhY2tcIilcbiAgICAuc3R5bGUoXCJzdHJva2Utd2lkdGhcIiwgMSlcbiAgXG4gIGZ1bmN0aW9uIG1vdXNlZW50ZXJlZCgpIHtcbiAgICBtYXJrZXIuYXR0cihcImRpc3BsYXlcIiwgbnVsbCk7XG4gICAgdG9vbHRpcC5zdHlsZShcImRpc3BsYXlcIiwgXCJibG9ja1wiKTtcbiAgfVxuICAgIFxuICBmdW5jdGlvbiBtb3VzZW1vdmVkKGV2ZW50KSB7XG4gICAgY29uc3QgW3htLCB5bV0gPSBkMy5wb2ludGVyKGV2ZW50KTtcbiAgICBjb25zdCB4ID0gZDMubGVhc3QoeFZhbHVlcywgeCA9PiBNYXRoLmFicyh4U2NhbGVyKHgpIC0geG0pKTtcbiAgICBjb25zdCBpID0gWC5tYXAoKGQsIGkpID0+IGQgPT09IHggPyBpIDogXCJcIikuZmlsdGVyKFN0cmluZyk7XG4gICAgbWFya2VyLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgYHRyYW5zbGF0ZSgkeyB4U2NhbGVyKHgpIH0sIDApYCk7XG4gICAgdG9vbHRpcFxuICAgICAgLnN0eWxlKFwibGVmdFwiLCBldmVudC5wYWdlWCArIDE4ICsgXCJweFwiKVxuICAgICAgLnN0eWxlKFwidG9wXCIsIGV2ZW50LnBhZ2VZICsgMTggKyBcInB4XCIpXG4gICAgICAuaHRtbChgPGI+JHt4fTwvYj48YnI+Qm90dG9tIDkwJTogJHsgZDMuZm9ybWF0KFwiLC4xJVwiKShZW2lbMF1dKSB9PGJyPlRvcCAwLjElOiAkeyBkMy5mb3JtYXQoXCIsLjElXCIpKFlbaVsxXV0pIH1gKTtcbiAgfVxuICBcbiAgZnVuY3Rpb24gbW91c2VsZWZ0KCkge1xuICAgIG1hcmtlci5hdHRyKFwiZGlzcGxheVwiLCBcIm5vbmVcIik7XG4gICAgdG9vbHRpcC5zdHlsZShcImRpc3BsYXlcIiwgXCJub25lXCIpO1xuICB9XG4gIFxuICAvLyBBbm5vdGF0aW9uIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gIHN2Zy5hcHBlbmQoXCJnXCIpXG4gICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgXCJ0cmFuc2xhdGUoNjQwLCAzNjApXCIpXG4gICAgLmFwcGVuZChcInRleHRcIilcbiAgICAgIC5hdHRyKFwidGV4dC1hbmNob3JcIiwgXCJtaWRkbGVcIilcbiAgICAgIC5zdHlsZShcImZvbnQtc2l6ZVwiLCBcIi45cmVtXCIpXG4gICAgICAuc3R5bGUoXCJmaWxsXCIsIFwiYmxhY2tcIilcbiAgICAgIC5hdHRyKFwieFwiLCAwKS5hdHRyKFwieVwiLCAwKVxuICAgIC5hcHBlbmQoXCJ0c3BhblwiKVxuICAgICAgLnRleHQoXCJXZWFsdGggYmVnYW4gdG9cIilcbiAgICAgIC5hdHRyKFwieFwiLCAwKS5hdHRyKFwieVwiLCAwKVxuICAgIC5hcHBlbmQoXCJ0c3BhblwiKVxuICAgICAgLnRleHQoXCJjb25jZW50cmF0ZSBpbiB0aGUgMTk4MHNcIilcbiAgICAgIC5hdHRyKFwieFwiLCAwKS5hdHRyKFwieVwiLCAwKS5hdHRyKFwiZHlcIiwgMjApXG4gIFxuICBzdmcuYXBwZW5kKFwiZGVmc1wiKVxuICAgIC5hcHBlbmQoXCJtYXJrZXJcIilcbiAgICAgIC5hdHRyKFwiaWRcIiwgXCJhcnJvdy0xXCIpXG4gICAgICAuYXR0cihcInZpZXdCb3hcIiwgXCIwIDAgMTAgMTBcIilcbiAgICAgIC5hdHRyKFwicmVmWFwiLCA4KS5hdHRyKFwicmVmWVwiLCA1KVxuICAgICAgLmF0dHIoXCJtYXJrZXJXaWR0aFwiLCAxMClcbiAgICAgIC5hdHRyKFwibWFya2VySGVpZ2h0XCIsIDEwKVxuICAgICAgLmF0dHIoXCJvcmllbnRcIiwgXCJhdXRvXCIpXG4gICAgLmFwcGVuZChcInBhdGhcIilcbiAgICAgIC5hdHRyKFwiZFwiLCBcIk0wLDEgTDksNSBMMCw5XCIpXG4gICAgICAuc3R5bGUoXCJzdHJva2UtbGluZWpvaW5cIiwgXCJyb3VuZFwiKVxuICAgICAgLnN0eWxlKFwic3Ryb2tlXCIsIFwiYmxhY2tcIilcbiAgICAgIC5zdHlsZShcInN0cm9rZS13aWR0aFwiLCAxKVxuICAgICAgLnN0eWxlKFwiZmlsbFwiLCBcIm5vbmVcIik7XG4gICAgXG4gIHN2Zy5hcHBlbmQoXCJnXCIpXG4gICAgLmFwcGVuZChcInBhdGhcIilcbiAgICAuYXR0cihcImRcIiwgKCkgPT4ge1xuICAgICAgY29uc3QgcGF0aCA9IGQzLnBhdGgoKTtcbiAgICAgIHBhdGgubW92ZVRvKDYyMCwgNDAwKTtcbiAgICAgIHBhdGgucXVhZHJhdGljQ3VydmVUbyg1NTAsIDUwMCwgNDgwLCA0MTApO1xuICAgICAgcmV0dXJuIHBhdGg7XG4gICAgfSlcbiAgICAuc3R5bGUoXCJzdHJva2VcIiwgXCJibGFja1wiKVxuICAgIC5zdHlsZShcInN0cm9rZS13aWR0aFwiLCAxKVxuICAgIC5zdHlsZShcImZpbGxcIiwgXCJub25lXCIpXG4gICAgLmF0dHIoXCJtYXJrZXItZW5kXCIsIFwidXJsKCNhcnJvdy0xKVwiKTtcbiAgXG4gIC8vIENoYXJ0IHNvdXJjZXMgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgY29udGFpbmVyLmFwcGVuZChcImRpdlwiKVxuICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJvanMtc291cmNlXCIpXG4gICAgLnN0eWxlKFwibWFyZ2luXCIsIFwiLjVyZW0gMFwiKVxuICAgIC5zdHlsZShcImxpbmUtaGVpZ2h0XCIsIDEuMjUpXG4gICAgLmh0bWwoYFNvdXJjZTogRS4gU2FleiBhbmQgRy4gWnVjbWFuLCBcIlRoZSBSaXNlIG9mIEluY29tZSBhbmQgV2VhbHRoIEluZXF1YWxpdHkgaW4gQW1lcmljYTogRXZpZGVuY2UgZnJvbSBEaXN0cmlidXRpb25hbCBNYWNyb2Vjb25vbWljIEFjY291bnRzXCIsIDxpPkpvdXJuYWwgb2YgRWNvbm9taWMgUGVyc3BlY3RpdmVzPC9pPiwgdm9sLiAzNCwgbm8uIDQgKDIwMjApLmApO1xuICAgIFxuICByZXR1cm4gY29udGFpbmVyLm5vZGUoKTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ilxue1xuICBjb25zdCBkaW0gPSAoeyB3aWR0aDogNzkwLCBoZWlnaHQ6IDU1MCB9KTtcbiAgY29uc3QgbWFyZ2luID0gKHsgdG9wOiA0MCwgYm90dG9tOiA2MCwgcmlnaHQ6IDUwLCBsZWZ0OiAxMDUgfSk7XG4gIFxuICBjb25zdCBkYXRhID0gZXZhc2lvbjtcbiAgY29uc3QgWCA9IGQzLm1hcChkYXRhLCBkID0+IGQuZXZhc2lvbik7XG4gIGNvbnN0IFkgPSBkMy5tYXAoZGF0YSwgZCA9PiBkLnBlcmNlbnRpbGUpO1xuICBcbiAgY29uc3QgeFNjYWxlciA9IGQzLnNjYWxlTGluZWFyKClcbiAgICAuZG9tYWluKFswLCAuMzBdKVxuICAgIC5yYW5nZShbMCwgZGltLndpZHRoIC0gbWFyZ2luLmxlZnQgLSBtYXJnaW4ucmlnaHRdKVxuICAgIFxuICBjb25zdCB5U2NhbGVyID0gZDMuc2NhbGVCYW5kKClcbiAgICAuZG9tYWluKFkpXG4gICAgLnJhbmdlKFtkaW0uaGVpZ2h0IC0gbWFyZ2luLmJvdHRvbSwgbWFyZ2luLnRvcF0pXG4gICAgLnBhZGRpbmcoLjI1KTtcblxuICBjb25zdCBjb250YWluZXIgPSBkMy5jcmVhdGUoXCJkaXZcIik7XG4gIFxuICAvLyBDaGFydCB0aXRsZSAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICBcbiAgY29udGFpbmVyLmFwcGVuZChcImRpdlwiKVxuICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJvanMtdGl0bGVcIilcbiAgICAuaHRtbChgUmVuZGVyIHVudG8gQ2Vhc2VyLi4uYCk7XG4gICAgXG4gIGNvbnRhaW5lci5hcHBlbmQoXCJkaXZcIilcbiAgICAuYXR0cihcImNsYXNzXCIsIFwib2pzLXN1YnRpdGxlXCIpXG4gICAgLnN0eWxlKFwibWFyZ2luLWJvdHRvbVwiLCBcIjFyZW1cIilcbiAgICAuaHRtbChgVGF4ZXMgZXZhZGVkIGFzIGEgc2hhcmUgb2YgdGF4ZXMgb3dlZCBieSB3ZWFsdGggcGVyY2VudGlsZSwgRGVubWFyaywgTm9yd2F5LCBhbmQgU3dlZGVuYCk7XG4gIFxuICAvLyBDaGFydCBjYW52YXMgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gIGNvbnN0IHN2ZyA9IGNvbnRhaW5lci5hcHBlbmQoXCJzdmdcIilcbiAgICAuYXR0cihcIndpZHRoXCIsIGRpbS53aWR0aClcbiAgICAuYXR0cihcImhlaWdodFwiLCBkaW0uaGVpZ2h0KVxuICAgIC5hdHRyKFwidmlld0JveFwiLCBbMCwgMCwgZGltLndpZHRoLCBkaW0uaGVpZ2h0XSlcbiAgICAuYXR0cihcInN0eWxlXCIsIFwibWF4LXdpZHRoOiAxMDAlOyBoZWlnaHQ6IGF1dG87IGhlaWdodDogaW50cmluc2ljO1wiKVxuICBcbiAgc3ZnLmFwcGVuZChcImdcIilcbiAgICAuYXBwZW5kKFwicmVjdFwiKVxuICAgIC5hdHRyKFwieFwiLCAwKS5hdHRyKFwieVwiLCAwKVxuICAgIC5hdHRyKFwid2lkdGhcIiwgZGltLndpZHRoKS5hdHRyKFwiaGVpZ2h0XCIsIGRpbS5oZWlnaHQpXG4gICAgLnN0eWxlKFwiZmlsbFwiLCBcIiNEQ0U3RUJcIilcbiAgICAuc3R5bGUoXCJvcGFjaXR5XCIsIC42KTtcbiAgXG4gIC8vIEF4ZXMgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG4gIFxuICBjb25zdCB4QXhpcyA9IGQzLmF4aXNCb3R0b20oeFNjYWxlcilcbiAgICAudGlja3MoNSwgXCIuMCVcIilcbiAgICAudGlja1NpemUoMClcbiAgICAudGlja1BhZGRpbmcoWzEwXSk7XG4gICAgXG4gIGNvbnN0IHlBeGlzID0gZDMuYXhpc0xlZnQoeVNjYWxlcilcbiAgICAudGlja1NpemUoMClcbiAgICAudGlja1BhZGRpbmcoWzEwXSk7XG4gIFxuICBzdmcuYXBwZW5kKFwiZ1wiKVxuICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGB0cmFuc2xhdGUoJHsgbWFyZ2luLmxlZnQgfSwkeyBkaW0uaGVpZ2h0IC0gbWFyZ2luLmJvdHRvbSB9KWApXG4gICAgLnN0eWxlKFwiZm9udC1zaXplXCIsIFwiLjhyZW1cIilcbiAgICAuY2FsbCh4QXhpcylcbiAgICAuY2FsbChnID0+IGcuc2VsZWN0KFwiLmRvbWFpblwiKS5yZW1vdmUoKSlcbiAgICAuY2FsbChnID0+IGcuYXBwZW5kKFwidGV4dFwiKVxuICAgICAgLmF0dHIoXCJ4XCIsIGRpbS53aWR0aCAtIG1hcmdpbi5sZWZ0KVxuICAgICAgLmF0dHIoXCJ5XCIsIDApXG4gICAgICAuYXR0cihcImR4XCIsIC0yMClcbiAgICAgIC5hdHRyKFwiZHlcIiwgMzApXG4gICAgICAuYXR0cihcImZpbGxcIiwgXCJibGFja1wiKVxuICAgICAgLmF0dHIoXCJ0ZXh0LWFuY2hvclwiLCBcImVuZFwiKVxuICAgICAgLmF0dHIoXCJhbGlnbm1lbnQtYmFzZWxpbmVcIiwgXCJoYW5naW5nXCIpXG4gICAgICAuc3R5bGUoXCJmb250LXNpemVcIiwgXCIuOXJlbVwiKVxuICAgICAgLnRleHQoXCJUYXhlcyBldmFkZWQgYXMgYSBzaGFyZSBvZiB0YXhlcyBvd2VkXCIpKVxuICAgIC5hcHBlbmQoXCJwYXRoXCIpXG4gICAgICAuYXR0cihcImRcIiwgZDMubGluZSgpKFtbMCwgMF0sIFtkaW0ud2lkdGggLSBtYXJnaW4ubGVmdCAtIG1hcmdpbi5yaWdodCwgMF1dKSlcbiAgICAgIC5zdHlsZShcImZpbGxcIiwgXCJub25lXCIpXG4gICAgICAuc3R5bGUoXCJzdHJva2VcIiwgXCJibGFja1wiKTtcbiAgXG4gIHN2Zy5hcHBlbmQoXCJnXCIpXG4gICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgYHRyYW5zbGF0ZSgkeyBtYXJnaW4ubGVmdCB9LDApYClcbiAgICAuc3R5bGUoXCJmb250LXNpemVcIiwgXCIuN3JlbVwiKVxuICAgIC5jYWxsKHlBeGlzKVxuICAgIC5jYWxsKGcgPT4gZy5zZWxlY3QoXCIuZG9tYWluXCIpLnJlbW92ZSgpKVxuICAgIC5jYWxsKGcgPT4gZy5hcHBlbmQoXCJ0ZXh0XCIpXG4gICAgICAuYXR0cihcInhcIiwgLW1hcmdpbi5sZWZ0KVxuICAgICAgLmF0dHIoXCJ5XCIsIDMwKVxuICAgICAgLmF0dHIoXCJkeFwiLCAxNSlcbiAgICAgIC5hdHRyKFwiZmlsbFwiLCBcImJsYWNrXCIpXG4gICAgICAuYXR0cihcInRleHQtYW5jaG9yXCIsIFwic3RhcnRcIilcbiAgICAgIC5zdHlsZShcImZvbnQtc2l6ZVwiLCBcIi45cmVtXCIpXG4gICAgICAudGV4dChcIldlYWx0aCBwZWNlbnRpbGVcIikpO1xuICBcbiAgLy8gQmFycyAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgXG4gIHN2Zy5hcHBlbmQoXCJnXCIpXG4gICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgYHRyYW5zbGF0ZSgkeyBtYXJnaW4ubGVmdCB9LDApYClcbiAgICAuc2VsZWN0QWxsKFwicmVjdFwiKVxuICAgIC5kYXRhKGRhdGEpXG4gICAgLmpvaW4oXCJyZWN0XCIpXG4gICAgLmF0dHIoXCJjbGFzc1wiLCBcImV2YXNpb24tYmFyc1wiKVxuICAgIC5hdHRyKFwieFwiLCB4U2NhbGVyKDApKVxuICAgIC5hdHRyKFwieVwiLCAoZCwgaSkgPT4geVNjYWxlcihZW2ldKSlcbiAgICAuYXR0cihcIndpZHRoXCIsIGQgPT4geFNjYWxlcihkLmV2YXNpb24pKVxuICAgIC5hdHRyKFwiaGVpZ2h0XCIsIHlTY2FsZXIuYmFuZHdpZHRoKCkpXG4gICAgLnN0eWxlKFwiZmlsbFwiLCBjb2xvcnMuYmx1ZSlcbiAgICAub24oXCJtb3VzZW1vdmVcIiwgbW91c2Vtb3ZlZClcbiAgICAub24oXCJtb3VzZWxlYXZlXCIsIG1vdXNlbGVmdCk7XG4gIFxuICBmdW5jdGlvbiBtb3VzZW1vdmVkKGV2ZW50LCBkKSB7XG4gICAgZDMuc2VsZWN0KHRoaXMpXG4gICAgICAudHJhbnNpdGlvbigpLmR1cmF0aW9uKDUwKVxuICAgICAgLnN0eWxlKFwiZmlsbFwiLCBjb2xvcnMucmVkKTtcbiAgICB0b29sdGlwXG4gICAgICAuc3R5bGUoXCJkaXNwbGF5XCIsIFwiYmxvY2tcIilcbiAgICAgIC5zdHlsZShcImxlZnRcIiwgZXZlbnQucGFnZVggKyAxOCArIFwicHhcIilcbiAgICAgIC5zdHlsZShcInRvcFwiLCBldmVudC5wYWdlWSArIDE4ICsgXCJweFwiKVxuICAgICAgLnRleHQoZDMuZm9ybWF0KFwiLjElXCIpKGQuZXZhc2lvbikpO1xuICAgIGQzLnNlbGVjdChldmVudC50YXJnZXQpLnN0eWxlKFwiY3Vyc29yXCIsIFwicG9pbnRlclwiKTtcbiAgfVxuICBcbiAgZnVuY3Rpb24gbW91c2VsZWZ0KGV2ZW50KSB7XG4gICAgZDMuc2VsZWN0QWxsKFwicmVjdC5ldmFzaW9uLWJhcnNcIilcbiAgICAgIC50cmFuc2l0aW9uKCkuZHVyYXRpb24oMjAwKVxuICAgICAgLnN0eWxlKFwiZmlsbFwiLCBjb2xvcnMuYmx1ZSlcbiAgICB0b29sdGlwLnN0eWxlKFwiZGlzcGxheVwiLCBcIm5vbmVcIik7XG4gICAgZDMuc2VsZWN0KGV2ZW50LnRhcmdldCkuc3R5bGUoXCJjdXJzb3JcIiwgXCJkZWZhdWx0XCIpO1xuICB9XG4gIFxuICAvLyBBbm5vdGF0aW9uIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gIHN2Zy5hcHBlbmQoXCJnXCIpXG4gICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgXCJ0cmFuc2xhdGUoNTAwLCAyMDApXCIpXG4gICAgLmFwcGVuZChcInRleHRcIilcbiAgICAgIC5hdHRyKFwidGV4dC1hbmNob3JcIiwgXCJtaWRkbGVcIilcbiAgICAgIC5zdHlsZShcImZvbnQtc2l6ZVwiLCBcIi45cmVtXCIpXG4gICAgICAuc3R5bGUoXCJmaWxsXCIsIFwiYmxhY2tcIilcbiAgICAgIC5hdHRyKFwieFwiLCAwKS5hdHRyKFwieVwiLCAwKVxuICAgIC5hcHBlbmQoXCJ0c3BhblwiKVxuICAgICAgLnRleHQoXCJUaGUgdG9wIFwiKVxuICAgICAgLmF0dHIoXCJ4XCIsIDApLmF0dHIoXCJ5XCIsIDApXG4gICAgLmFwcGVuZChcInRzcGFuXCIpXG4gICAgICAudGV4dChcIjAuMDElXCIpXG4gICAgICAuc3R5bGUoXCJmb250LXdlaWdodFwiLCBcImJvbGRcIilcbiAgICAuYXBwZW5kKFwidHNwYW5cIilcbiAgICAgIC50ZXh0KFwiIGV2YWRlIFwiKVxuICAgICAgLnN0eWxlKFwiZm9udC13ZWlnaHRcIiwgXCJub3JtYWxcIilcbiAgICAuYXBwZW5kKFwidHNwYW5cIilcbiAgICAgIC50ZXh0KFwiMjYlXCIpXG4gICAgICAuc3R5bGUoXCJmb250LXdlaWdodFwiLCBcImJvbGRcIilcbiAgICAgIC5zdHlsZShcImZpbGxcIiwgY29sb3JzLnJlZClcbiAgICAuYXBwZW5kKFwidHNwYW5cIilcbiAgICAgIC50ZXh0KFwib2YgdGhlaXIgdGF4IG9ibGlnYXRpb25zXCIpXG4gICAgICAuYXR0cihcInhcIiwgMCkuYXR0cihcInlcIiwgMCkuYXR0cihcImR5XCIsIDIwKVxuICAgICAgLnN0eWxlKFwiZm9udC13ZWlnaHRcIiwgXCJub3JtYWxcIilcbiAgICAgIC5zdHlsZShcImZpbGxcIiwgXCJibGFja1wiKVxuICBcbiAgc3ZnLmFwcGVuZChcImRlZnNcIilcbiAgICAuYXBwZW5kKFwibWFya2VyXCIpXG4gICAgICAuYXR0cihcImlkXCIsIFwiYXJyb3ctMlwiKVxuICAgICAgLmF0dHIoXCJ2aWV3Qm94XCIsIFwiMCAwIDEwIDEwXCIpXG4gICAgICAuYXR0cihcInJlZlhcIiwgOCkuYXR0cihcInJlZllcIiwgNSlcbiAgICAgIC5hdHRyKFwibWFya2VyV2lkdGhcIiwgMTApXG4gICAgICAuYXR0cihcIm1hcmtlckhlaWdodFwiLCAxMClcbiAgICAgIC5hdHRyKFwib3JpZW50XCIsIFwiYXV0b1wiKVxuICAgIC5hcHBlbmQoXCJwYXRoXCIpXG4gICAgICAuYXR0cihcImRcIiwgXCJNMCwxIEw5LDUgTDAsOVwiKVxuICAgICAgLnN0eWxlKFwic3Ryb2tlLWxpbmVqb2luXCIsIFwicm91bmRcIilcbiAgICAgIC5zdHlsZShcInN0cm9rZVwiLCBcImJsYWNrXCIpXG4gICAgICAuc3R5bGUoXCJzdHJva2Utd2lkdGhcIiwgMSlcbiAgICAgIC5zdHlsZShcImZpbGxcIiwgXCJub25lXCIpO1xuICAgIFxuICBzdmcuYXBwZW5kKFwiZ1wiKVxuICAgIC5hcHBlbmQoXCJwYXRoXCIpXG4gICAgLmF0dHIoXCJkXCIsICgpID0+IHtcbiAgICAgIGNvbnN0IHBhdGggPSBkMy5wYXRoKCk7XG4gICAgICBwYXRoLm1vdmVUbyg2MTAsIDIwMCk7XG4gICAgICBwYXRoLnF1YWRyYXRpY0N1cnZlVG8oNzAwLCAxNzAsIDY1MCwgOTApO1xuICAgICAgcmV0dXJuIHBhdGg7XG4gICAgfSlcbiAgICAuc3R5bGUoXCJzdHJva2VcIiwgXCJibGFja1wiKVxuICAgIC5zdHlsZShcInN0cm9rZS13aWR0aFwiLCAxKVxuICAgIC5zdHlsZShcImZpbGxcIiwgXCJub25lXCIpXG4gICAgLmF0dHIoXCJtYXJrZXItZW5kXCIsIFwidXJsKCNhcnJvdy0yKVwiKTtcblxuICAvLyBDaGFydCBzb3VyY2VzIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gIGNvbnRhaW5lci5hcHBlbmQoXCJkaXZcIilcbiAgICAuYXR0cihcImNsYXNzXCIsIFwib2pzLXNvdXJjZVwiKVxuICAgIC5zdHlsZShcIm1hcmdpblwiLCBcIi41cmVtIDBcIilcbiAgICAuc3R5bGUoXCJsaW5lLWhlaWdodFwiLCAxLjI1KVxuICAgIC5odG1sKGBTb3VyY2U6IEEuIEFsc3RhZHNhZXRlciwgTi4gSm9oYW5uZXNlbiwgYW5kIEcuIFp1Y21hbiwgXCJUYXggRXZhc2lvbiBhbmQgSW5lcXVhbGl0eVwiLCA8aT5BbWVyaWNhbiBFY29ub21pYyBSZXZpZXc8L2k+LCB2b2wuIDEwOSwgbm8uIDYgKDIwMTkpLmApO1xuICAgIFxuICByZXR1cm4gY29udGFpbmVyLm5vZGUoKTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ilxue1xuICBjb25zdCBkaW0gPSAoeyB3aWR0aDogNzkwLCBoZWlnaHQ6IDU1MCB9KTtcbiAgY29uc3QgbWFyZ2luID0gKHsgdG9wOiA0MCwgYm90dG9tOiA2MCwgcmlnaHQ6IDY1LCBsZWZ0OiA2NSB9KTtcbiAgXG4gIGNvbnN0IGRhdGEgPSB0YXhyYXRlO1xuICBjb25zdCBYID0gZDMubWFwKGRhdGEsIGQgPT4gZC5ncm91cCk7XG4gIGNvbnN0IFkgPSBkMy5tYXAoZGF0YSwgZCA9PiBkLnJhdGUpO1xuICBjb25zdCBaID0gZDMubWFwKGRhdGEsIGQgPT4gZC55ZWFyKTtcbiAgY29uc3QgSSA9IGQzLnJhbmdlKFgubGVuZ3RoKTtcbiAgY29uc3QgeFZhbHVlcyA9IFsuLi5uZXcgU2V0KFgpXTtcbiAgY29uc3QgbiA9IFsuLi5uZXcgU2V0KFopXS5sZW5ndGggLSAxO1xuXG4gIGNvbnN0IHhTY2FsZXIgPSBkMy5zY2FsZVBvaW50KClcbiAgICAuZG9tYWluKHhWYWx1ZXMpXG4gICAgLnJhbmdlKFttYXJnaW4ubGVmdCwgZGltLndpZHRoIC0gbWFyZ2luLnJpZ2h0XSk7XG4gIFxuICBjb25zdCB5U2NhbGVyID0gZDMuc2NhbGVMaW5lYXIoKVxuICAgIC5kb21haW4oWzAsIC43Ml0pXG4gICAgLnJhbmdlKFtkaW0uaGVpZ2h0IC0gbWFyZ2luLmJvdHRvbSwgbWFyZ2luLnRvcF0pO1xuICBcbiAgY29uc3QgbGluZSA9IGQzLmxpbmUoKVxuICAgIC5jdXJ2ZShkMy5jdXJ2ZUJhc2lzKVxuICAgIC54KGkgPT4geFNjYWxlcihYW2ldKSlcbiAgICAueShpID0+IHlTY2FsZXIoWVtpXSkpO1xuXG4gIGNvbnN0IGNvbnRhaW5lciA9IGQzLmNyZWF0ZShcImRpdlwiKTtcbiAgXG4gIC8vIENoYXJ0IHRpdGxlIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG4gIFxuICBjb250YWluZXIuYXBwZW5kKFwiZGl2XCIpXG4gICAgLmF0dHIoXCJjbGFzc1wiLCBcIm9qcy10aXRsZVwiKVxuICAgIC5odG1sKGBNeSB5b2tlIGlzIGVhc3ksIG15IGJ1cmRlbiBpcyBsaWdodGApO1xuICAgIFxuICBjb250YWluZXIuYXBwZW5kKFwiZGl2XCIpXG4gICAgLmF0dHIoXCJjbGFzc1wiLCBcIm9qcy1zdWJ0aXRsZVwiKVxuICAgIC5zdHlsZShcIm1hcmdpbi1ib3R0b21cIiwgXCIxcmVtXCIpXG4gICAgLmh0bWwoYEF2ZXJhZ2UgdGF4IHJhdGUgYnkgaW5jb21lIGdyb3VwLCBVbml0ZWQgU3RhdGVzLCAxOTUw4oCTMjAxOGApO1xuICBcbiAgLy8gQ2hhcnQgY2FudmFzIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuICBjb25zdCBzdmcgPSBjb250YWluZXIuYXBwZW5kKFwic3ZnXCIpXG4gICAgLmF0dHIoXCJ3aWR0aFwiLCBkaW0ud2lkdGgpXG4gICAgLmF0dHIoXCJoZWlnaHRcIiwgZGltLmhlaWdodClcbiAgICAuYXR0cihcInZpZXdCb3hcIiwgWzAsIDAsIGRpbS53aWR0aCwgZGltLmhlaWdodF0pXG4gICAgLmF0dHIoXCJzdHlsZVwiLCBcIm1heC13aWR0aDogMTAwJTsgaGVpZ2h0OiBhdXRvOyBoZWlnaHQ6IGludHJpbnNpYztcIilcbiAgICAub24oXCJtb3VzZWVudGVyXCIsIG1vdXNlZW50ZXJlZClcbiAgICAub24oXCJtb3VzZW1vdmVcIiwgbW91c2Vtb3ZlZClcbiAgICAub24oXCJtb3VzZWxlYXZlXCIsIG1vdXNlbGVmdCk7XG4gIFxuICBzdmcuYXBwZW5kKFwiZ1wiKVxuICAgIC5hcHBlbmQoXCJyZWN0XCIpXG4gICAgLmF0dHIoXCJ4XCIsIDApLmF0dHIoXCJ5XCIsIDApXG4gICAgLmF0dHIoXCJ3aWR0aFwiLCBkaW0ud2lkdGgpLmF0dHIoXCJoZWlnaHRcIiwgZGltLmhlaWdodClcbiAgICAuc3R5bGUoXCJmaWxsXCIsIFwiI0RDRTdFQlwiKVxuICAgIC5zdHlsZShcIm9wYWNpdHlcIiwgLjYpO1xuICBcbiAgLy8gQXhlcyAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgXG4gIGNvbnN0IHhBeGlzID0gc3ZnLmFwcGVuZChcImdcIilcbiAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBgdHJhbnNsYXRlKDAsJHsgZGltLmhlaWdodCAtIG1hcmdpbi5ib3R0b20gfSlgKVxuICAgIC5hdHRyKFwidGV4dC1hbmNob3JcIiwgXCJtaWRkbGVcIilcbiAgICAuc3R5bGUoXCJmb250LXNpemVcIiwgXCIuOHJlbVwiKVxuICAgIC5jYWxsKGcgPT4gZy5hcHBlbmQoXCJ0ZXh0XCIpXG4gICAgICAudGV4dChcIjEwdGhcIilcbiAgICAgIC5hdHRyKFwieFwiLCB4U2NhbGVyKFwiUDEwLTIwXCIpKVxuICAgICAgLmF0dHIoXCJ5XCIsIDApLmF0dHIoXCJkeVwiLCAyMCkpXG4gICAgLmNhbGwoZyA9PiBnLmFwcGVuZChcInRleHRcIilcbiAgICAgIC50ZXh0KFwiNTB0aFwiKVxuICAgICAgLmF0dHIoXCJ4XCIsIHhTY2FsZXIoXCJQNTAtNjBcIikpXG4gICAgICAuYXR0cihcInlcIiwgMCkuYXR0cihcImR5XCIsIDIwKSlcbiAgICAuY2FsbChnID0+IGcuYXBwZW5kKFwidGV4dFwiKVxuICAgICAgLnRleHQoXCI5MHRoXCIpXG4gICAgICAuYXR0cihcInhcIiwgeFNjYWxlcihcIlA5MC05NVwiKSlcbiAgICAgIC5hdHRyKFwieVwiLCAwKS5hdHRyKFwiZHlcIiwgMjApKVxuICAgIC5jYWxsKGcgPT4gZy5hcHBlbmQoXCJ0ZXh0XCIpXG4gICAgICAudGV4dChcIjk5Ljk5K1wiKVxuICAgICAgLmF0dHIoXCJ4XCIsIHhTY2FsZXIoXCJQOTkuOTktdG9wIDQwMFwiKSlcbiAgICAgIC5hdHRyKFwieVwiLCAwKS5hdHRyKFwiZHlcIiwgMjApKVxuICAgIC5jYWxsKGcgPT4gZy5hcHBlbmQoXCJwYXRoXCIpXG4gICAgICAuYXR0cihcImRcIiwgZDMubGluZSgpKFtbbWFyZ2luLmxlZnQsIDBdLCBbZGltLndpZHRoIC0gbWFyZ2luLnJpZ2h0LCAwXV0pKVxuICAgICAgLnN0eWxlKFwiZmlsbFwiLCBcIm5vbmVcIilcbiAgICAgIC5zdHlsZShcInN0cm9rZVwiLCBcImJsYWNrXCIpKVxuICAgIC5jYWxsKGcgPT4gZy5hcHBlbmQoXCJ0ZXh0XCIpXG4gICAgICAuYXR0cihcInhcIiwgbWFyZ2luLmxlZnQgKyAoZGltLndpZHRoIC0gbWFyZ2luLmxlZnQgLSBtYXJnaW4ucmlnaHQpIC8gMilcbiAgICAgIC5hdHRyKFwieVwiLCAwKVxuICAgICAgLmF0dHIoXCJkeVwiLCAzMClcbiAgICAgIC5hdHRyKFwiYWxpZ25tZW50LWJhc2VsaW5lXCIsIFwiaGFuZ2luZ1wiKVxuICAgICAgLnN0eWxlKFwiZm9udC1zaXplXCIsIFwiLjlyZW1cIilcbiAgICAgIC50ZXh0KFwiSW5jb21lIHBlcmNlbnRpbGVcIikpO1xuICBcbiAgY29uc3QgeUF4aXMgPSBkMy5heGlzTGVmdCh5U2NhbGVyKVxuICAgIC50aWNrcyg1LCBcIi4wJVwiKVxuICAgIC50aWNrU2l6ZSgwKVxuICAgIC50aWNrUGFkZGluZyhbMjBdKTtcbiAgICBcbiAgc3ZnLmFwcGVuZChcImdcIilcbiAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBgdHJhbnNsYXRlKCR7IG1hcmdpbi5sZWZ0IH0sMClgKVxuICAgIC5zdHlsZShcImZvbnQtc2l6ZVwiLCBcIi44cmVtXCIpXG4gICAgLmNhbGwoeUF4aXMpXG4gICAgLmNhbGwoZyA9PiBnLnNlbGVjdChcIi5kb21haW5cIikucmVtb3ZlKCkpXG4gICAgLmNhbGwoZyA9PiBnLmFwcGVuZChcInRleHRcIilcbiAgICAgIC5hdHRyKFwieFwiLCAtbWFyZ2luLmxlZnQpXG4gICAgICAuYXR0cihcInlcIiwgMjUpXG4gICAgICAuYXR0cihcImR4XCIsIDE1KVxuICAgICAgLmF0dHIoXCJmaWxsXCIsIFwiYmxhY2tcIilcbiAgICAgIC5hdHRyKFwidGV4dC1hbmNob3JcIiwgXCJzdGFydFwiKVxuICAgICAgLnN0eWxlKFwiZm9udC1zaXplXCIsIFwiLjlyZW1cIilcbiAgICAgIC50ZXh0KFwiU2hhcmUgb2YgcHJlLXRheCBpbmNvbWVcIikpO1xuICAgICAgXG4gIC8vIExpbmVzIGFuZCBsYWJlbHMgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG4gIFxuICBjb25zdCBwYW5lbCA9IHN2Zy5hcHBlbmQoXCJnXCIpXG5cbiAgcGFuZWwuYXBwZW5kKFwiZ1wiKVxuICAgIC5zZWxlY3RBbGwoXCJwYXRoXCIpXG4gICAgLmRhdGEoZDMuZ3JvdXAoSSwgaSA9PiBaW2ldKSlcbiAgICAuam9pbihcInBhdGhcIilcbiAgICAgIC5zdHlsZShcImZpbGxcIiwgXCJub25lXCIpXG4gICAgICAuc3R5bGUoXCJzdHJva2VcIiwgKGQsIGkpID0+IGkgPT09IG4gPyBjb2xvcnMucmVkIDogY29sb3JzLmJsdWVMaWdodClcbiAgICAgIC5zdHlsZShcInN0cm9rZS13aWR0aFwiLCAzKVxuICAgICAgLmF0dHIoXCJkXCIsIChbLCBJXSkgPT4gbGluZShJKSk7XG4gICAgXG4gIHBhbmVsLmFwcGVuZChcImdcIilcbiAgICAuc2VsZWN0QWxsKFwidGV4dFwiKVxuICAgIC5kYXRhKGRhdGEuZmlsdGVyKGQgPT4gZC5ncm91cCA9PT0gXCJUb3AgNDAwXCIpKVxuICAgIC5qb2luKFwidGV4dFwiKVxuICAgIC50ZXh0KGQgPT4gZC55ZWFyKVxuICAgIC5hdHRyKFwieFwiLCBkID0+IHhTY2FsZXIoZC5ncm91cCkpXG4gICAgLmF0dHIoXCJ5XCIsIGQgPT4geVNjYWxlcihkLnJhdGUpKVxuICAgIC5hdHRyKFwiZHhcIiwgMTApXG4gICAgLmF0dHIoXCJhbGlnbm1lbnQtYmFzZWxpbmVcIiwgXCJtaWRkbGVcIilcbiAgICAuc3R5bGUoXCJmaWxsXCIsIGQgPT4gZC55ZWFyID09PSAyMDE4ID8gY29sb3JzLnJlZCA6IGNvbG9ycy5ibHVlKVxuICAgIC5zdHlsZShcImZvbnQtc2l6ZVwiLCBkID0+IGQueWVhciA9PT0gMjAxOCA/IFwiLjhyZW1cIiA6IFwiLjdyZW1cIilcbiAgICAuc3R5bGUoXCJmb250LXdlaWdodFwiLCBkID0+IGQueWVhciA9PT0gMjAxOCA/IFwiYm9sZFwiIDogXCJub3JtYWxcIilcbiAgXG4gIC8vIEhvdmVyIGxhYmVscyAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG4gIFxuICBjb25zdCBtYXJrZXIgPSBzdmcuYXBwZW5kKFwiZ1wiKVxuICAgIC5hdHRyKFwiZGlzcGxheVwiLCBcIm5vbmVcIik7XG4gIFxuICBtYXJrZXIuYXBwZW5kKFwicGF0aFwiKVxuICAgIC5hdHRyKFwiZFwiLCBkMy5saW5lKCkoW1swLCBtYXJnaW4udG9wXSwgWzAsIGRpbS5oZWlnaHQgLSBtYXJnaW4uYm90dG9tXV0pKVxuICAgIC5zdHlsZShcInN0cm9rZVwiLCBcImJsYWNrXCIpXG4gICAgLnN0eWxlKFwic3Ryb2tlLXdpZHRoXCIsIDEpO1xuICBcbiAgZnVuY3Rpb24gbW91c2VlbnRlcmVkKCkge1xuICAgIG1hcmtlci5hdHRyKFwiZGlzcGxheVwiLCBudWxsKTtcbiAgICB0b29sdGlwLnN0eWxlKFwiZGlzcGxheVwiLCBcImJsb2NrXCIpO1xuICB9O1xuICAgIFxuICBmdW5jdGlvbiBtb3VzZW1vdmVkKGV2ZW50KSB7XG4gICAgY29uc3QgW3htLCB5bV0gPSBkMy5wb2ludGVyKGV2ZW50KTtcbiAgICBjb25zdCB4ID0gZDMubGVhc3QoeFZhbHVlcywgeCA9PiBNYXRoLmFicyh4U2NhbGVyKHgpIC0geG0pKTtcbiAgICBjb25zdCBpID0gWC5tYXAoKGQsIGkpID0+IGQgPT09IHggPyBpIDogXCJcIikuZmlsdGVyKFN0cmluZyk7XG4gICAgbWFya2VyLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgYHRyYW5zbGF0ZSgkeyB4U2NhbGVyKHgpIH0sIDApYCk7XG4gICAgdG9vbHRpcFxuICAgICAgLnN0eWxlKFwibGVmdFwiLCBldmVudC5wYWdlWCArIDE4ICsgXCJweFwiKVxuICAgICAgLnN0eWxlKFwidG9wXCIsIGV2ZW50LnBhZ2VZICsgMTggKyBcInB4XCIpXG4gICAgICAuaHRtbChgXG4gICAgICAgIDxiPiR7eH0gdGF4IHJhdGU8L2I+PGJyPlxuICAgICAgICAxOTUwOiAkeyBkMy5mb3JtYXQoXCIsLjElXCIpKFlbaVswXV0pIH08YnI+XG4gICAgICAgIDE5ODA6ICR7IGQzLmZvcm1hdChcIiwuMSVcIikoWVtpWzNdXSkgfTxicj5cbiAgICAgICAgMjAxODogJHsgZDMuZm9ybWF0KFwiLC4xJVwiKShZW2lbbl1dKSB9XG4gICAgICBgKTtcbiAgfTtcbiAgXG4gIGZ1bmN0aW9uIG1vdXNlbGVmdCgpIHtcbiAgICBtYXJrZXIuYXR0cihcImRpc3BsYXlcIiwgXCJub25lXCIpO1xuICAgIHRvb2x0aXAuc3R5bGUoXCJkaXNwbGF5XCIsIFwibm9uZVwiKTtcbiAgfTtcbiAgXG4gIC8vIEFubm90YXRpb24gLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgc3ZnLmFwcGVuZChcImdcIilcbiAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBcInRyYW5zbGF0ZSg0MTAsIDIwMClcIilcbiAgICAuYXBwZW5kKFwidGV4dFwiKVxuICAgICAgLmF0dHIoXCJ0ZXh0LWFuY2hvclwiLCBcIm1pZGRsZVwiKVxuICAgICAgLnN0eWxlKFwiZm9udC1zaXplXCIsIFwiLjlyZW1cIilcbiAgICAgIC5zdHlsZShcImZpbGxcIiwgXCJibGFja1wiKVxuICAgICAgLmF0dHIoXCJ4XCIsIDApLmF0dHIoXCJ5XCIsIDApXG4gICAgLmFwcGVuZChcInRzcGFuXCIpXG4gICAgICAudGV4dChcIlRoZSB1bHRyYSB3ZWFsdGh5IGhhdmUgc2VlbiBhblwiKVxuICAgICAgLmF0dHIoXCJ4XCIsIDApLmF0dHIoXCJ5XCIsIDApXG4gICAgLmFwcGVuZChcInRzcGFuXCIpXG4gICAgICAudGV4dChcImFwcGFyZW50IGZhbGwgaW4gdGhlaXIgdGF4IGJ1cmRlblwiKVxuICAgICAgLmF0dHIoXCJ4XCIsIDApLmF0dHIoXCJ5XCIsIDApLmF0dHIoXCJkeVwiLCAyMClcbiAgICAuYXBwZW5kKFwidHNwYW5cIilcbiAgICAgIC50ZXh0KFwiZnJvbSBcIilcbiAgICAgIC5hdHRyKFwieFwiLCAwKS5hdHRyKFwieVwiLCAwKS5hdHRyKFwiZHlcIiwgNDApXG4gICAgLmFwcGVuZChcInRzcGFuXCIpXG4gICAgICAudGV4dChcIjcwJVwiKVxuICAgICAgLnN0eWxlKFwiZm9udC13ZWlnaHRcIiwgXCJib2xkXCIpXG4gICAgLmFwcGVuZChcInRzcGFuXCIpXG4gICAgICAudGV4dChcIiBpbiAxOTUwIHRvIFwiKVxuICAgICAgLnN0eWxlKFwiZm9udC13ZWlnaHRcIiwgXCJub3JtYWxcIilcbiAgICAgIC5zdHlsZShcImZpbGxcIiwgXCJibGFja1wiKVxuICAgIC5hcHBlbmQoXCJ0c3BhblwiKVxuICAgICAgLnRleHQoXCIyMyVcIilcbiAgICAgIC5zdHlsZShcImZvbnQtd2VpZ2h0XCIsIFwiYm9sZFwiKVxuICAgICAgLnN0eWxlKFwiZmlsbFwiLCBjb2xvcnMucmVkKVxuICAgIC5hcHBlbmQoXCJ0c3BhblwiKVxuICAgICAgLnRleHQoXCIgaW4gMjAxOFwiKVxuICAgICAgLnN0eWxlKFwiZm9udC13ZWlnaHRcIiwgXCJub3JtYWxcIilcbiAgICAgIC5zdHlsZShcImZpbGxcIiwgXCJibGFja1wiKVxuICBcbiAgc3ZnLmFwcGVuZChcImRlZnNcIilcbiAgICAuYXBwZW5kKFwibWFya2VyXCIpXG4gICAgICAuYXR0cihcImlkXCIsIFwiYXJyb3ctM1wiKVxuICAgICAgLmF0dHIoXCJ2aWV3Qm94XCIsIFwiMCAwIDEwIDEwXCIpXG4gICAgICAuYXR0cihcInJlZlhcIiwgOCkuYXR0cihcInJlZllcIiwgNSlcbiAgICAgIC5hdHRyKFwibWFya2VyV2lkdGhcIiwgMTApXG4gICAgICAuYXR0cihcIm1hcmtlckhlaWdodFwiLCAxMClcbiAgICAgIC5hdHRyKFwib3JpZW50XCIsIFwiYXV0b1wiKVxuICAgIC5hcHBlbmQoXCJwYXRoXCIpXG4gICAgICAuYXR0cihcImRcIiwgXCJNMCwxIEw5LDUgTDAsOVwiKVxuICAgICAgLnN0eWxlKFwic3Ryb2tlLWxpbmVqb2luXCIsIFwicm91bmRcIilcbiAgICAgIC5zdHlsZShcInN0cm9rZVwiLCBcImJsYWNrXCIpXG4gICAgICAuc3R5bGUoXCJzdHJva2Utd2lkdGhcIiwgMSlcbiAgICAgIC5zdHlsZShcImZpbGxcIiwgXCJub25lXCIpO1xuICBcbiAgc3ZnLmFwcGVuZChcImdcIilcbiAgICAuY2FsbChnID0+IGcuYXBwZW5kKFwicGF0aFwiKVxuICAgICAgLmF0dHIoXCJkXCIsICgpID0+IHtcbiAgICAgICAgY29uc3QgcGF0aCA9IGQzLnBhdGgoKTtcbiAgICAgICAgcGF0aC5tb3ZlVG8oNDYwLCAyNjMpO1xuICAgICAgICBwYXRoLnF1YWRyYXRpY0N1cnZlVG8oNTAwLCA0NTAsIDcwMCwgMzYwKTtcbiAgICAgICAgcmV0dXJuIHBhdGg7XG4gICAgfSkpXG4gICAgLmNhbGwoZyA9PiBnLmFwcGVuZChcInBhdGhcIilcbiAgICAgIC5hdHRyKFwiZFwiLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHBhdGggPSBkMy5wYXRoKCk7XG4gICAgICAgIHBhdGgubW92ZVRvKDQ3MCwgMTcyKTtcbiAgICAgICAgcGF0aC5xdWFkcmF0aWNDdXJ2ZVRvKDU1MCwgMCwgNjg1LCA0MCk7XG4gICAgICAgIHJldHVybiBwYXRoO1xuICAgIH0pKVxuICAgIC5zdHlsZShcInN0cm9rZVwiLCBcImJsYWNrXCIpXG4gICAgLnN0eWxlKFwic3Ryb2tlLXdpZHRoXCIsIDEpXG4gICAgLnN0eWxlKFwiZmlsbFwiLCBcIm5vbmVcIilcbiAgICAuYXR0cihcIm1hcmtlci1lbmRcIiwgXCJ1cmwoI2Fycm93LTMpXCIpO1xuICAgIFxuICAvLyBDaGFydCBzb3VyY2VzIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gIGNvbnRhaW5lci5hcHBlbmQoXCJkaXZcIilcbiAgICAuYXR0cihcImNsYXNzXCIsIFwib2pzLXNvdXJjZVwiKVxuICAgIC5zdHlsZShcIm1hcmdpblwiLCBcIi41cmVtIDBcIilcbiAgICAuc3R5bGUoXCJsaW5lLWhlaWdodFwiLCAxLjI1KVxuICAgIC5odG1sKGBTb3VyY2U6IEUuIFNhZXogYW5kIEcuIFp1Y21hbiwgPGk+VGhlIFRyaXVtcGggb2YgSW5qdXN0aWNlPC9pPiwgMjAxOS5gKTtcbiAgICBcbiAgcmV0dXJuIGNvbnRhaW5lci5ub2RlKCk7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTQiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJcbmluZXF1YWxpdHkgPSBGaWxlQXR0YWNobWVudChcIi4uLy4uL2RhdGFzZXRzL3p1Y21hbi9pbmVxdWFsaXR5LmNzdlwiKS5jc3YoeyB0eXBlZDogdHJ1ZSB9KTtcbmV2YXNpb24gPSBGaWxlQXR0YWNobWVudChcIi4uLy4uL2RhdGFzZXRzL3p1Y21hbi9ldmFzaW9uLmNzdlwiKS5jc3YoeyB0eXBlZDogdHJ1ZSB9KTtcbnRheHJhdGUgPSBGaWxlQXR0YWNobWVudChcIi4uLy4uL2RhdGFzZXRzL3p1Y21hbi90YXhyYXRlLmNzdlwiKS5jc3YoeyB0eXBlZDogdHJ1ZSB9KTtcblxuY29sb3JzID0gKHsgYmx1ZTogXCIjNDg4OWFiXCIsIGJsdWVMaWdodDogXCIjYzBkN2RmXCIsIHJlZDogXCIjQzg1Qjg5XCIgfSlcblxudG9vbHRpcCA9IGQzLnNlbGVjdChcImJvZHlcIilcbiAgLmFwcGVuZChcImRpdlwiKVxuICAuYXR0cihcImNsYXNzXCIsIFwidG9vbFRpcFwiKVxuICAuc3R5bGUoXCJkaXNwbGF5XCIsIFwibm9uZVwiKVxuICAuc3R5bGUoXCJwb3NpdGlvblwiLCBcImFic29sdXRlXCIpXG4gIC5zdHlsZShcInotaW5kZXhcIiwgOTk5KVxuICAuc3R5bGUoXCJ3aWR0aFwiLCAxMDApXG4gIC5zdHlsZShcImhlaWdodFwiLCBcImF1dG9cIilcbiAgLnN0eWxlKFwiYmFja2dyb3VuZFwiLCBcIiNmN2Y3ZjdcIilcbiAgLnN0eWxlKFwiYm9yZGVyXCIsIFwiMXB4IHNvbGlkICNjZWNlY2VcIilcbiAgLnN0eWxlKFwib3BhY2l0eVwiLCAuOSlcbiAgLnN0eWxlKFwicGFkZGluZ1wiLCBcIi4yZW0gLjQ1ZW1cIilcbiAgLnN0eWxlKFwiZm9udC1zaXplXCIsIFwiLjg1cmVtXCIpO1xuIn1dfQ==
</script>
<script type="module">
if (window.location.protocol === "file:") { alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."); }
window._ojs.paths.runtimeToDoc = "../../posts/2023-05-09-wealth-detective";
window._ojs.paths.runtimeToRoot = "../..";
window._ojs.paths.docToRoot = "../..";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/twopoints\.blog");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">

<div class="cookie-consent-footer"><a href="#" id="open_preferences_center">Cookie Preferences</a></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>