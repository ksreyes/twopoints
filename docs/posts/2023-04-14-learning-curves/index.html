<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2023-04-14">

<title>Learning curves – Two Points Make a Line</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../..//images/logo-icon.png" rel="icon" type="image/png">
<script src="../../site_libs/cookie-consent/cookie-consent.js"></script>
<link href="../../site_libs/cookie-consent/cookie-consent.css" rel="stylesheet">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-1935dcbd43814f6b9d0e02a660e21e63.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-EJMC44PZ56"></script>

<script type="text/plain" cookie-consent="tracking">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-EJMC44PZ56', { 'anonymize_ip': true});
</script>

<script type="text/javascript" charset="UTF-8">
document.addEventListener('DOMContentLoaded', function () {
cookieconsent.run({
  "notice_banner_type":"simple",
  "consent_type":"implied",
  "palette":"light",
  "language":"en",
  "page_load_consent_levels":["strictly-necessary","functionality","tracking","targeting"],
  "notice_banner_reject_button_hide":false,
  "preferences_center_close_button_hide":false,
  "website_name":""
  ,
"language":"en"
  });
});
</script> 
  
<style>
span.animate {
  display: inline-block;
  padding: 0 .4em;
  animation: shake 1s infinite;
}

@keyframes shake {
  0% { transform: translateX(0) }
  25% { transform: translateX(.25em) }
  50% { transform: translateX(-.25em) }
  75% { transform: translateX(.25em) }
  100% { transform: translateX(0) }
}

</style>
<script type="module" src="../../site_libs/quarto-ojs/quarto-ojs-runtime.js"></script>
<link href="../../site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<meta property="og:title" content="Learning curves – Two Points Make a Line">
<meta property="og:description" content="Charts have been aiding — and confusing — students of economics for generations. Give them a fresh twist by adding interactivity.">
<meta property="og:image" content="https://twopoints.blog/posts/2023-04-14-learning-curves/thumbnail.gif">
<meta property="og:site_name" content="Two Points Make a Line">
<meta name="twitter:title" content="Learning curves – Two Points Make a Line">
<meta name="twitter:description" content="Charts have been aiding — and confusing — students of economics for generations. Give them a fresh twist by adding interactivity.">
<meta name="twitter:image" content="https://twopoints.blog/posts/2023-04-14-learning-curves/thumbnail.gif">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../images/logo-icon-invert.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Two Points Make a Line</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <span class="nav-link">
<span class="menu-text">Telling stories through visualized data — by Kenneth S. Reyes</span>
    </span>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/ksreyes/twopoints"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Learning curves</h1>
<p class="subtitle lead">Charts have been aiding — and confusing — students of economics for generations. Give them a fresh twist by adding interactivity.</p>
  <div class="quarto-categories">
    <div class="quarto-category">D3/OJS</div>
  </div>
  </div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">April 14, 2023</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p>Economics is a strange field, a social science with pretensions of a natural science that manages to annoy both. I have been its student and its teacher and I can tell you that it’s weird inside and out. Many a night have I spent working through the mathematics of a world where people are immortal and shops sell 0.000001 of anything. Yet for all its peculiarities, I do think everyone can profit from a little economic knowledge. Economics, to me, is about clarifying trade-offs given a set of goals and rules over how the world works. Notice that this definition doesn’t actually include <em>the</em> economy (over which economics courses dwell astonishingly little!) but focuses rather on an economic <em>way</em> of thinking. Econ 101 may not teach you much about stocks, taxes, or running a business, but it does train you to tackle problems methodically, systematically.</p>
<p>Anyone who’s taken an undergraduate economics course knows that the subject is taught mainly through charts. From my experience, these are both the boon and bane of the would-be student. Charts are great — we here at <em>Two Points Make a Line</em> are big fans — but working through them can be challenging. The problem is that students typically see charts as frozen images, whereas their power is in visualizing the interrelations among variables in a dynamic sense. Whenever charts are discussed, there is always talk of moving along the curve, or shifting the curve, or pivoting the curve. Students are expected to hallucinate movement where there is none.</p>
<p>Take this cost curve diagram from Hal Varian’s popular microeconomics textbook.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="varian.png" class="img-fluid figure-img"></p>
<figcaption>Cost curves from Hal Varian’s <em>Intermediate Microeconomics</em> (8th ed., p.&nbsp;404)</figcaption>
</figure>
</div>
<p>Nevermind for now what it means; suppose I simply asked you to imagine how the shaded rectangle would change if you moved <span class="math inline">\(p^*\)</span> down, moved <span class="math inline">\(y^*\)</span> to the left, and shifted the AC curve up. Too easy? Now reverse that and compare the two pictures. Such exercises quickly become a headache. And this neat textbook chart is the best-case scenario too: many have to make do with the hand-drawn, <a href="https://youtu.be/aPiZloqtlnc?t=407">Basquiat-looking</a> diagrams their professors etch on the blackboard.</p>
<p>Given that more and more students are consuming their learning materials digitally, it is opportune to embrace interactivity in economics diagrams. By this I mean charts that the student can actually manipulate in a guided setting, shifting mental resources away from hallucinating movement and towards understanding the concepts conveyed. This blog post serves as something of a proof-of-concept for how an interactive module can be done. I’ll be covering cost curves, one of the major stumbling blocks in an Econ 101 course.</p>
<section id="firm-foundations" class="level2">
<h2 class="anchored" data-anchor-id="firm-foundations">Firm foundations</h2>
<p>Economists model the economy as having two types of entities: households and firms. Households maximize their utility by buying goods and services from firms, with money they earn by working for firms. Firms maximize profits by buying inputs from households, turning them into goods and services, and then selling them back to households.</p>
<p>Let’s zoom in on a firm in a particular market. Its behavior proceeds in two steps. First, it looks at its technological capabilities and decides on the best (i.e.&nbsp;cheapest) mix of inputs to purchase for every possible level of output. This results in a cost function <span class="math inline">\(C(q)\)</span>, which gives the costs associated with producting <span class="math inline">\(q\)</span> units of output. Armed with this, it moves on to the second step, where it decides on the level of output that maximizes its profits.</p>
<p>We’ll skip the first step here and assume the firm has already derived its cost function. It would typically be something of the following form:</p>
<p><span class="math display">\[
\text{Cost}(q, \text{FixedCosts}) = aq^3 - bq^2 + cq + \text{FixedCosts}
\]</span></p>
<p>You don’t have to worry so much about the math, but pay attention to the fact that total cost is composed of a fixed cost (does not change with <span class="math inline">\(q\)</span>) and a variable cost (varies with <span class="math inline">\(q\)</span>). This cost function is plotted below.</p>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" data-startfrom="56" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 55;"><span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>viewof q0 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> qMax]<span class="op">,</span> { <span class="dt">label</span><span class="op">:</span> <span class="st">"Output"</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">50</span> })</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>viewof fc0 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> fcMax]<span class="op">,</span> { <span class="dt">label</span><span class="op">:</span> <span class="st">"Fixed cost"</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">250</span> })</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> params <span class="op">=</span> ({ <span class="dt">q</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">fc</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">p</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">c</span><span class="op">:</span> <span class="kw">null</span> })<span class="op">;</span></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>  params<span class="op">.</span><span class="at">q</span> <span class="op">=</span> q0<span class="op">;</span></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>  params<span class="op">.</span><span class="at">fc</span> <span class="op">=</span> fc0<span class="op">;</span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> id <span class="op">=</span> d3<span class="op">.</span><span class="fu">randomInt</span>(<span class="dv">100000</span><span class="op">,</span> <span class="dv">1000000</span>)()<span class="op">;</span></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> axisTitles <span class="op">=</span> ({ <span class="dt">x</span><span class="op">:</span> <span class="st">"Output"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="st">"$"</span> })<span class="op">;</span></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yScaler <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="fu">costFxn</span>({ <span class="dt">q</span><span class="op">:</span> qMax<span class="op">,</span> <span class="dt">fc</span><span class="op">:</span> fcMax })])</span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([panelHeight<span class="op">,</span> <span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> container <span class="op">=</span> d3<span class="op">.</span><span class="fu">create</span>(<span class="st">"div"</span>)</span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"style"</span><span class="op">,</span> <span class="st">"display: flex; justify-content: center"</span>)<span class="op">;</span></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> container<span class="op">.</span><span class="fu">append</span>(<span class="st">"svg"</span>)</span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> width <span class="op">+</span> margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">right</span>)</span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> panelHeight <span class="op">+</span> margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">bottom</span>)</span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> width <span class="op">+</span> margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">right</span><span class="op">,</span> panelHeight <span class="op">+</span> margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">bottom</span>])</span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"style"</span><span class="op">,</span> <span class="st">"max-width: 100%; height: auto; height: intrinsic;"</span>)</span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(background)</span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(labelsToggle<span class="op">,</span> id)<span class="op">;</span></span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> panel <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>margin<span class="op">.</span><span class="at">left</span><span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>margin<span class="op">.</span><span class="at">top</span><span class="sc">}</span><span class="vs">)`</span>)</span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>  panel<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clipWide<span class="op">,</span> id)</span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurve<span class="op">,</span> id<span class="op">,</span> cost<span class="op">,</span> params<span class="op">,</span> yScaler)</span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(yGuide<span class="op">,</span> cost<span class="op">,</span> params<span class="op">,</span> yScaler)<span class="op">;</span></span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>  panel<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(panelAxes<span class="op">,</span> axisTitles)</span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(xGuides<span class="op">,</span> cost<span class="op">,</span> params<span class="op">,</span> yScaler<span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a>  panel<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="vs">`labels-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clipWide<span class="op">,</span> id)</span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addLabel<span class="op">,</span> <span class="st">"Cost"</span><span class="op">,</span> <span class="fu">xScaler</span>(<span class="dv">85</span>) <span class="op">+</span> <span class="dv">10</span><span class="op">,</span> <span class="fu">yScaler</span>(<span class="fu">costFxn</span>({ <span class="dt">q</span><span class="op">:</span> <span class="dv">85</span><span class="op">,</span> <span class="dt">fc</span><span class="op">:</span> params<span class="op">.</span><span class="at">fc</span> })) <span class="op">+</span> <span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Toggle event listener ////////////////////////////////////////////////////////////////////////</span></span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cb <span class="op">=</span> svg<span class="op">.</span><span class="fu">select</span>(<span class="st">"foreignObject"</span>)<span class="op">.</span><span class="fu">select</span>(<span class="vs">`input#checkbox-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a>  cb<span class="op">.</span><span class="fu">on</span>(<span class="st">"click"</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> isChecked <span class="op">=</span> cb<span class="op">.</span><span class="fu">property</span>(<span class="st">"checked"</span>)<span class="op">;</span></span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> chartLabels <span class="op">=</span> svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="vs">`g#labels-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a>    isChecked <span class="op">?</span> chartLabels<span class="op">.</span><span class="fu">style</span>(<span class="st">"visibility"</span><span class="op">,</span> <span class="st">"visible"</span>) <span class="op">:</span> chartLabels<span class="op">.</span><span class="fu">style</span>(<span class="st">"visibility"</span><span class="op">,</span> <span class="st">"hidden"</span>)<span class="op">;</span></span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> container<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a><span class="fu">html</span><span class="vs">`&lt;div class="ojs-caption"&gt;The checkbox at the corner toggles whether labels are visible, a feature that will be useful later as our charts get more crowded. You can always hover over a curve to see its name.&lt;/div&gt;`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell quarto-layout-panel" data-layout="[[1, 1], [1]]">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="ojs-cell-1-1" data-nodetype="declaration">

</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="ojs-cell-1-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="ojs-cell-1-3" data-nodetype="expression">

</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="ojs-cell-1-4" data-nodetype="expression">

</div>
</div>
</div>
</div>
<p>Notice that the <span class="highlight"><strong>cost curve</strong></span> has a vague S shape. This captures the idea that at a small enough scale, costs don’t rise all that quickly with output. Imagine you started a food truck business. Your initial outlays for the truck, the stove, the ingredients, and so on will comprise the bulk of your total costs, and any extra burger, taco, or kebab you produce won’t raise this by a lot. As you expand however, you start hitting the limits of your capacity and each extra unit of output becomes more and more expensive to produce. Thus we see the cost curve growing steeper and steeper.</p>
<p>Play around with the sliders to see how changing output and fixed costs changes the chart. Observe that as long as there are fixed costs, we can never bring total costs down to zero, even with zero output. Also observe that raising fixed costs shifts the whole curve up, so that costs are higher for all levels of output. <span class="highlight">In the long run, fixed costs approach zero</span> since all inputs can be varied given a long enough time frame.</p>
<p>Our goal as the firm is to figure out what the optimal level of output is from a profit-maximizing standpoint. To do this, we’ll need to look at things from a per unit perspective. The charts below introduce three useful curves: the average cost curve, the average variable cost curve, and the marginal cost curve.</p>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2" data-startfrom="124" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 123;"><span id="cb2-124"><a href="#cb2-124" aria-hidden="true" tabindex="-1"></a>viewof q1 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> qMax]<span class="op">,</span> { <span class="dt">label</span><span class="op">:</span> <span class="st">"Output"</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">50</span> })</span>
<span id="cb2-125"><a href="#cb2-125" aria-hidden="true" tabindex="-1"></a>viewof fc1 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> fcMax]<span class="op">,</span> { <span class="dt">label</span><span class="op">:</span> <span class="st">"Fixed cost"</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">250</span> })</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell quarto-layout-panel" data-layout="[[1, 1]]">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="ojs-cell-2-1" data-nodetype="declaration">

</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="ojs-cell-2-2" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">Average cost</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Average variable cost</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false">Marginal cost</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3" data-startfrom="133" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 132;"><span id="cb3-133"><a href="#cb3-133" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb3-134"><a href="#cb3-134" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> params <span class="op">=</span> ({ <span class="dt">q</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">fc</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">p</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">c</span><span class="op">:</span> <span class="kw">null</span> })<span class="op">;</span></span>
<span id="cb3-135"><a href="#cb3-135" aria-hidden="true" tabindex="-1"></a>  params<span class="op">.</span><span class="at">q</span> <span class="op">=</span> q1<span class="op">;</span></span>
<span id="cb3-136"><a href="#cb3-136" aria-hidden="true" tabindex="-1"></a>  params<span class="op">.</span><span class="at">fc</span> <span class="op">=</span> fc1<span class="op">;</span></span>
<span id="cb3-137"><a href="#cb3-137" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> id <span class="op">=</span> d3<span class="op">.</span><span class="fu">randomInt</span>(<span class="dv">100000</span><span class="op">,</span> <span class="dv">1000000</span>)()<span class="op">;</span></span>
<span id="cb3-138"><a href="#cb3-138" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> axisTitlesTop <span class="op">=</span> ({ <span class="dt">x</span><span class="op">:</span> <span class="st">"Output"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="st">"$"</span> })<span class="op">;</span></span>
<span id="cb3-139"><a href="#cb3-139" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> axisTitlesBottom <span class="op">=</span> ({ <span class="dt">x</span><span class="op">:</span> <span class="st">"Output"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="st">"$/unit"</span> })<span class="op">;</span></span>
<span id="cb3-140"><a href="#cb3-140" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-141"><a href="#cb3-141" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yScalerTop <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb3-142"><a href="#cb3-142" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="fu">costFxn</span>({ <span class="dt">q</span><span class="op">:</span> qMax<span class="op">,</span> <span class="dt">fc</span><span class="op">:</span> fcMax })])</span>
<span id="cb3-143"><a href="#cb3-143" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([panelHeight<span class="op">,</span> <span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb3-144"><a href="#cb3-144" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-145"><a href="#cb3-145" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yScalerBottom <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb3-146"><a href="#cb3-146" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="fu">acFxn</span>({ <span class="dt">q</span><span class="op">:</span> qMax<span class="op">,</span> <span class="dt">fc</span><span class="op">:</span> fcMax })])</span>
<span id="cb3-147"><a href="#cb3-147" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([panelHeight<span class="op">,</span> <span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb3-148"><a href="#cb3-148" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-149"><a href="#cb3-149" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> container <span class="op">=</span> d3<span class="op">.</span><span class="fu">create</span>(<span class="st">"div"</span>)</span>
<span id="cb3-150"><a href="#cb3-150" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"style"</span><span class="op">,</span> <span class="st">"display: flex; justify-content: center"</span>)<span class="op">;</span></span>
<span id="cb3-151"><a href="#cb3-151" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-152"><a href="#cb3-152" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> container<span class="op">.</span><span class="fu">append</span>(<span class="st">"svg"</span>)</span>
<span id="cb3-153"><a href="#cb3-153" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> width <span class="op">+</span> margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">right</span>)</span>
<span id="cb3-154"><a href="#cb3-154" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> height <span class="op">+</span> margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">bottom</span>)</span>
<span id="cb3-155"><a href="#cb3-155" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> width <span class="op">+</span> margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">right</span><span class="op">,</span> height <span class="op">+</span> margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">bottom</span>])</span>
<span id="cb3-156"><a href="#cb3-156" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"style"</span><span class="op">,</span> <span class="st">"max-width: 100%; height: auto; height: intrinsic;"</span>)</span>
<span id="cb3-157"><a href="#cb3-157" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(background)</span>
<span id="cb3-158"><a href="#cb3-158" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(labelsToggle<span class="op">,</span> id)<span class="op">;</span></span>
<span id="cb3-159"><a href="#cb3-159" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-160"><a href="#cb3-160" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Top panel ////////////////////////////////////////////////////////////////////////////////////</span></span>
<span id="cb3-161"><a href="#cb3-161" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-162"><a href="#cb3-162" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> panelTop <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb3-163"><a href="#cb3-163" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>margin<span class="op">.</span><span class="at">left</span><span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>margin<span class="op">.</span><span class="at">top</span><span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb3-164"><a href="#cb3-164" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-165"><a href="#cb3-165" aria-hidden="true" tabindex="-1"></a>  panelTop<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb3-166"><a href="#cb3-166" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clipWide<span class="op">,</span> id)</span>
<span id="cb3-167"><a href="#cb3-167" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurve<span class="op">,</span> id<span class="op">,</span> cost<span class="op">,</span> params<span class="op">,</span> yScalerTop)</span>
<span id="cb3-168"><a href="#cb3-168" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(yGuide<span class="op">,</span> cost<span class="op">,</span> params<span class="op">,</span> yScalerTop)<span class="op">;</span></span>
<span id="cb3-169"><a href="#cb3-169" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-170"><a href="#cb3-170" aria-hidden="true" tabindex="-1"></a>  panelTop<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb3-171"><a href="#cb3-171" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(panelAxes<span class="op">,</span> axisTitlesTop)</span>
<span id="cb3-172"><a href="#cb3-172" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(xGuides<span class="op">,</span> cost<span class="op">,</span> params<span class="op">,</span> yScalerTop)<span class="op">;</span></span>
<span id="cb3-173"><a href="#cb3-173" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-174"><a href="#cb3-174" aria-hidden="true" tabindex="-1"></a>  panelTop<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb3-175"><a href="#cb3-175" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="vs">`labels-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb3-176"><a href="#cb3-176" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clipWide<span class="op">,</span> id)</span>
<span id="cb3-177"><a href="#cb3-177" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addLabel<span class="op">,</span> <span class="st">"Cost"</span><span class="op">,</span> <span class="fu">xScaler</span>(<span class="dv">85</span>) <span class="op">+</span> <span class="dv">10</span><span class="op">,</span> <span class="fu">yScalerTop</span>(<span class="fu">costFxn</span>({ <span class="dt">q</span><span class="op">:</span> <span class="dv">85</span><span class="op">,</span> <span class="dt">fc</span><span class="op">:</span> params<span class="op">.</span><span class="at">fc</span> })) <span class="op">+</span> <span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb3-178"><a href="#cb3-178" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-179"><a href="#cb3-179" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Bottom panel /////////////////////////////////////////////////////////////////////////////////</span></span>
<span id="cb3-180"><a href="#cb3-180" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-181"><a href="#cb3-181" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> panelBottom <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb3-182"><a href="#cb3-182" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>margin<span class="op">.</span><span class="at">left</span><span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> panelHeight <span class="op">+</span> margin<span class="op">.</span><span class="at">between</span><span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb3-183"><a href="#cb3-183" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-184"><a href="#cb3-184" aria-hidden="true" tabindex="-1"></a>  panelBottom<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb3-185"><a href="#cb3-185" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clip<span class="op">,</span> id)</span>
<span id="cb3-186"><a href="#cb3-186" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurve<span class="op">,</span> id<span class="op">,</span> ac<span class="op">,</span> params<span class="op">,</span> yScalerBottom)</span>
<span id="cb3-187"><a href="#cb3-187" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-188"><a href="#cb3-188" aria-hidden="true" tabindex="-1"></a>  panelBottom<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb3-189"><a href="#cb3-189" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clipWide<span class="op">,</span> id)</span>
<span id="cb3-190"><a href="#cb3-190" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(yGuide<span class="op">,</span> ac<span class="op">,</span> params<span class="op">,</span> yScalerBottom)<span class="op">;</span></span>
<span id="cb3-191"><a href="#cb3-191" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-192"><a href="#cb3-192" aria-hidden="true" tabindex="-1"></a>  panelBottom<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb3-193"><a href="#cb3-193" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(panelAxes<span class="op">,</span> axisTitlesBottom)<span class="op">;</span></span>
<span id="cb3-194"><a href="#cb3-194" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-195"><a href="#cb3-195" aria-hidden="true" tabindex="-1"></a>  panelBottom<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb3-196"><a href="#cb3-196" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="vs">`labels-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb3-197"><a href="#cb3-197" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addLabel<span class="op">,</span> <span class="st">"AC"</span><span class="op">,</span> <span class="fu">xScaler</span>(<span class="dv">95</span>) <span class="op">-</span> <span class="dv">10</span><span class="op">,</span> <span class="fu">yScalerBottom</span>(<span class="fu">acFxn</span>({ <span class="dt">q</span><span class="op">:</span> <span class="dv">95</span><span class="op">,</span> <span class="dt">fc</span><span class="op">:</span> params<span class="op">.</span><span class="at">fc</span> })) <span class="op">-</span> <span class="dv">10</span><span class="op">,</span> <span class="st">"end"</span>)<span class="op">;</span></span>
<span id="cb3-198"><a href="#cb3-198" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-199"><a href="#cb3-199" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Toggle event listener ////////////////////////////////////////////////////////////////////////</span></span>
<span id="cb3-200"><a href="#cb3-200" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-201"><a href="#cb3-201" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cb <span class="op">=</span> svg<span class="op">.</span><span class="fu">select</span>(<span class="st">"foreignObject"</span>)<span class="op">.</span><span class="fu">select</span>(<span class="vs">`input#checkbox-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb3-202"><a href="#cb3-202" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-203"><a href="#cb3-203" aria-hidden="true" tabindex="-1"></a>  cb<span class="op">.</span><span class="fu">on</span>(<span class="st">"click"</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb3-204"><a href="#cb3-204" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> isChecked <span class="op">=</span> cb<span class="op">.</span><span class="fu">property</span>(<span class="st">"checked"</span>)<span class="op">;</span></span>
<span id="cb3-205"><a href="#cb3-205" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> chartLabels <span class="op">=</span> svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="vs">`g#labels-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb3-206"><a href="#cb3-206" aria-hidden="true" tabindex="-1"></a>    isChecked <span class="op">?</span> chartLabels<span class="op">.</span><span class="fu">style</span>(<span class="st">"visibility"</span><span class="op">,</span> <span class="st">"visible"</span>) <span class="op">:</span> chartLabels<span class="op">.</span><span class="fu">style</span>(<span class="st">"visibility"</span><span class="op">,</span> <span class="st">"hidden"</span>)<span class="op">;</span></span>
<span id="cb3-207"><a href="#cb3-207" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb3-208"><a href="#cb3-208" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-209"><a href="#cb3-209" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> container<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb3-210"><a href="#cb3-210" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="ojs-cell-3" data-nodetype="expression">

</div>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4" data-startfrom="217" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 216;"><span id="cb4-217"><a href="#cb4-217" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb4-218"><a href="#cb4-218" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> params <span class="op">=</span> ({ <span class="dt">q</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">fc</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">p</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">c</span><span class="op">:</span> <span class="kw">null</span> })<span class="op">;</span></span>
<span id="cb4-219"><a href="#cb4-219" aria-hidden="true" tabindex="-1"></a>  params<span class="op">.</span><span class="at">q</span> <span class="op">=</span> q1<span class="op">;</span></span>
<span id="cb4-220"><a href="#cb4-220" aria-hidden="true" tabindex="-1"></a>  params<span class="op">.</span><span class="at">fc</span> <span class="op">=</span> fc1<span class="op">;</span></span>
<span id="cb4-221"><a href="#cb4-221" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> id <span class="op">=</span> d3<span class="op">.</span><span class="fu">randomInt</span>(<span class="dv">100000</span><span class="op">,</span> <span class="dv">1000000</span>)()<span class="op">;</span></span>
<span id="cb4-222"><a href="#cb4-222" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> axisTitlesTop <span class="op">=</span> ({ <span class="dt">x</span><span class="op">:</span> <span class="st">"Output"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="st">"$"</span> })<span class="op">;</span></span>
<span id="cb4-223"><a href="#cb4-223" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> axisTitlesBottom <span class="op">=</span> ({ <span class="dt">x</span><span class="op">:</span> <span class="st">"Output"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="st">"$/unit"</span> })<span class="op">;</span></span>
<span id="cb4-224"><a href="#cb4-224" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-225"><a href="#cb4-225" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yScalerTop <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb4-226"><a href="#cb4-226" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="fu">costFxn</span>({ <span class="dt">q</span><span class="op">:</span> qMax<span class="op">,</span> <span class="dt">fc</span><span class="op">:</span> fcMax })])</span>
<span id="cb4-227"><a href="#cb4-227" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([panelHeight<span class="op">,</span> <span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb4-228"><a href="#cb4-228" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-229"><a href="#cb4-229" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yScalerBottom <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb4-230"><a href="#cb4-230" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="fu">acFxn</span>({ <span class="dt">q</span><span class="op">:</span> qMax<span class="op">,</span> <span class="dt">fc</span><span class="op">:</span> fcMax })])</span>
<span id="cb4-231"><a href="#cb4-231" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([panelHeight<span class="op">,</span> <span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb4-232"><a href="#cb4-232" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-233"><a href="#cb4-233" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> container <span class="op">=</span> d3<span class="op">.</span><span class="fu">create</span>(<span class="st">"div"</span>)</span>
<span id="cb4-234"><a href="#cb4-234" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"style"</span><span class="op">,</span> <span class="st">"display: flex; justify-content: center"</span>)<span class="op">;</span></span>
<span id="cb4-235"><a href="#cb4-235" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-236"><a href="#cb4-236" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> container<span class="op">.</span><span class="fu">append</span>(<span class="st">"svg"</span>)</span>
<span id="cb4-237"><a href="#cb4-237" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> width <span class="op">+</span> margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">right</span>)</span>
<span id="cb4-238"><a href="#cb4-238" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> height <span class="op">+</span> margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">bottom</span>)</span>
<span id="cb4-239"><a href="#cb4-239" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> width <span class="op">+</span> margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">right</span><span class="op">,</span> height <span class="op">+</span> margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">bottom</span>])</span>
<span id="cb4-240"><a href="#cb4-240" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"style"</span><span class="op">,</span> <span class="st">"max-width: 100%; height: auto; height: intrinsic;"</span>)</span>
<span id="cb4-241"><a href="#cb4-241" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(background)</span>
<span id="cb4-242"><a href="#cb4-242" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(labelsToggle<span class="op">,</span> id)<span class="op">;</span></span>
<span id="cb4-243"><a href="#cb4-243" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-244"><a href="#cb4-244" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Top panel ////////////////////////////////////////////////////////////////////////////////////</span></span>
<span id="cb4-245"><a href="#cb4-245" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-246"><a href="#cb4-246" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> panelTop <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb4-247"><a href="#cb4-247" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>margin<span class="op">.</span><span class="at">left</span><span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>margin<span class="op">.</span><span class="at">top</span><span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb4-248"><a href="#cb4-248" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-249"><a href="#cb4-249" aria-hidden="true" tabindex="-1"></a>  panelTop<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb4-250"><a href="#cb4-250" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clipWide<span class="op">,</span> id)</span>
<span id="cb4-251"><a href="#cb4-251" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurve<span class="op">,</span> id<span class="op">,</span> cost<span class="op">,</span> params<span class="op">,</span> yScalerTop)</span>
<span id="cb4-252"><a href="#cb4-252" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(yGuide<span class="op">,</span> cost<span class="op">,</span> params<span class="op">,</span> yScalerTop)<span class="op">;</span></span>
<span id="cb4-253"><a href="#cb4-253" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-254"><a href="#cb4-254" aria-hidden="true" tabindex="-1"></a>  panelTop<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb4-255"><a href="#cb4-255" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(panelAxes<span class="op">,</span> axisTitlesTop)</span>
<span id="cb4-256"><a href="#cb4-256" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(xGuides<span class="op">,</span> cost<span class="op">,</span> params<span class="op">,</span> yScalerTop)<span class="op">;</span></span>
<span id="cb4-257"><a href="#cb4-257" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-258"><a href="#cb4-258" aria-hidden="true" tabindex="-1"></a>  panelTop<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb4-259"><a href="#cb4-259" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="vs">`labels-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb4-260"><a href="#cb4-260" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clipWide<span class="op">,</span> id)</span>
<span id="cb4-261"><a href="#cb4-261" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addLabel<span class="op">,</span> <span class="st">"Cost"</span><span class="op">,</span> <span class="fu">xScaler</span>(<span class="dv">85</span>) <span class="op">+</span> <span class="dv">10</span><span class="op">,</span> <span class="fu">yScalerTop</span>(<span class="fu">costFxn</span>({ <span class="dt">q</span><span class="op">:</span> <span class="dv">85</span><span class="op">,</span> <span class="dt">fc</span><span class="op">:</span> params<span class="op">.</span><span class="at">fc</span> })) <span class="op">+</span> <span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb4-262"><a href="#cb4-262" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-263"><a href="#cb4-263" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Bottom panel /////////////////////////////////////////////////////////////////////////////////</span></span>
<span id="cb4-264"><a href="#cb4-264" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-265"><a href="#cb4-265" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> panelBottom <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb4-266"><a href="#cb4-266" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>margin<span class="op">.</span><span class="at">left</span><span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> panelHeight <span class="op">+</span> margin<span class="op">.</span><span class="at">between</span><span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb4-267"><a href="#cb4-267" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-268"><a href="#cb4-268" aria-hidden="true" tabindex="-1"></a>  panelBottom<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb4-269"><a href="#cb4-269" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clip<span class="op">,</span> id)</span>
<span id="cb4-270"><a href="#cb4-270" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurveFull<span class="op">,</span> id<span class="op">,</span> ac<span class="op">,</span> params<span class="op">,</span> yScalerBottom<span class="op">,</span> gray)</span>
<span id="cb4-271"><a href="#cb4-271" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurve<span class="op">,</span> id<span class="op">,</span> avc<span class="op">,</span> params<span class="op">,</span> yScalerBottom)</span>
<span id="cb4-272"><a href="#cb4-272" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-273"><a href="#cb4-273" aria-hidden="true" tabindex="-1"></a>  panelBottom<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb4-274"><a href="#cb4-274" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clipWide<span class="op">,</span> id)</span>
<span id="cb4-275"><a href="#cb4-275" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(yGuide<span class="op">,</span> avc<span class="op">,</span> params<span class="op">,</span> yScalerBottom)<span class="op">;</span></span>
<span id="cb4-276"><a href="#cb4-276" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-277"><a href="#cb4-277" aria-hidden="true" tabindex="-1"></a>  panelBottom<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb4-278"><a href="#cb4-278" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(panelAxes<span class="op">,</span> axisTitlesBottom)<span class="op">;</span></span>
<span id="cb4-279"><a href="#cb4-279" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-280"><a href="#cb4-280" aria-hidden="true" tabindex="-1"></a>  panelBottom<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb4-281"><a href="#cb4-281" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="vs">`labels-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb4-282"><a href="#cb4-282" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addLabel<span class="op">,</span> <span class="st">"AC"</span><span class="op">,</span> <span class="fu">xScaler</span>(<span class="dv">95</span>) <span class="op">-</span> <span class="dv">10</span><span class="op">,</span> <span class="fu">yScalerBottom</span>(<span class="fu">acFxn</span>({ <span class="dt">q</span><span class="op">:</span> <span class="dv">95</span><span class="op">,</span> <span class="dt">fc</span><span class="op">:</span> params<span class="op">.</span><span class="at">fc</span> })) <span class="op">-</span> <span class="dv">10</span><span class="op">,</span> <span class="st">"end"</span>)</span>
<span id="cb4-283"><a href="#cb4-283" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addLabel<span class="op">,</span> <span class="st">"AVC"</span><span class="op">,</span> <span class="fu">xScaler</span>(<span class="dv">95</span>) <span class="op">+</span> <span class="dv">10</span><span class="op">,</span> <span class="fu">yScalerBottom</span>(<span class="fu">avcFxn</span>({ <span class="dt">q</span><span class="op">:</span> <span class="dv">95</span> })) <span class="op">+</span> <span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb4-284"><a href="#cb4-284" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-285"><a href="#cb4-285" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Toggle event listener ////////////////////////////////////////////////////////////////////////</span></span>
<span id="cb4-286"><a href="#cb4-286" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-287"><a href="#cb4-287" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cb <span class="op">=</span> svg<span class="op">.</span><span class="fu">select</span>(<span class="st">"foreignObject"</span>)<span class="op">.</span><span class="fu">select</span>(<span class="vs">`input#checkbox-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb4-288"><a href="#cb4-288" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-289"><a href="#cb4-289" aria-hidden="true" tabindex="-1"></a>  cb<span class="op">.</span><span class="fu">on</span>(<span class="st">"click"</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb4-290"><a href="#cb4-290" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> isChecked <span class="op">=</span> cb<span class="op">.</span><span class="fu">property</span>(<span class="st">"checked"</span>)<span class="op">;</span></span>
<span id="cb4-291"><a href="#cb4-291" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> chartLabels <span class="op">=</span> svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="vs">`g#labels-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb4-292"><a href="#cb4-292" aria-hidden="true" tabindex="-1"></a>    isChecked <span class="op">?</span> chartLabels<span class="op">.</span><span class="fu">style</span>(<span class="st">"visibility"</span><span class="op">,</span> <span class="st">"visible"</span>) <span class="op">:</span> chartLabels<span class="op">.</span><span class="fu">style</span>(<span class="st">"visibility"</span><span class="op">,</span> <span class="st">"hidden"</span>)<span class="op">;</span></span>
<span id="cb4-293"><a href="#cb4-293" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb4-294"><a href="#cb4-294" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> container<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb4-295"><a href="#cb4-295" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="ojs-cell-4" data-nodetype="expression">

</div>
</div>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5" data-startfrom="302" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 301;"><span id="cb5-302"><a href="#cb5-302" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb5-303"><a href="#cb5-303" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> params <span class="op">=</span> ({ <span class="dt">q</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">fc</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">p</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">c</span><span class="op">:</span> <span class="kw">null</span> })<span class="op">;</span></span>
<span id="cb5-304"><a href="#cb5-304" aria-hidden="true" tabindex="-1"></a>  params<span class="op">.</span><span class="at">q</span> <span class="op">=</span> q1<span class="op">;</span></span>
<span id="cb5-305"><a href="#cb5-305" aria-hidden="true" tabindex="-1"></a>  params<span class="op">.</span><span class="at">fc</span> <span class="op">=</span> fc1<span class="op">;</span></span>
<span id="cb5-306"><a href="#cb5-306" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> id <span class="op">=</span> d3<span class="op">.</span><span class="fu">randomInt</span>(<span class="dv">100000</span><span class="op">,</span> <span class="dv">1000000</span>)()<span class="op">;</span></span>
<span id="cb5-307"><a href="#cb5-307" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> axisTitlesTop <span class="op">=</span> ({ <span class="dt">x</span><span class="op">:</span> <span class="st">"Output"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="st">"$"</span> })<span class="op">;</span></span>
<span id="cb5-308"><a href="#cb5-308" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> axisTitlesBottom <span class="op">=</span> ({ <span class="dt">x</span><span class="op">:</span> <span class="st">"Output"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="st">"$/unit"</span> })<span class="op">;</span></span>
<span id="cb5-309"><a href="#cb5-309" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-310"><a href="#cb5-310" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yScalerTop <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb5-311"><a href="#cb5-311" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="fu">costFxn</span>({ <span class="dt">q</span><span class="op">:</span> qMax<span class="op">,</span> <span class="dt">fc</span><span class="op">:</span> fcMax })])</span>
<span id="cb5-312"><a href="#cb5-312" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([panelHeight<span class="op">,</span> <span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb5-313"><a href="#cb5-313" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-314"><a href="#cb5-314" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yScalerBottom <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb5-315"><a href="#cb5-315" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="fu">acFxn</span>({ <span class="dt">q</span><span class="op">:</span> qMax<span class="op">,</span> <span class="dt">fc</span><span class="op">:</span> fcMax })])</span>
<span id="cb5-316"><a href="#cb5-316" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([panelHeight<span class="op">,</span> <span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb5-317"><a href="#cb5-317" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-318"><a href="#cb5-318" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> container <span class="op">=</span> d3<span class="op">.</span><span class="fu">create</span>(<span class="st">"div"</span>)</span>
<span id="cb5-319"><a href="#cb5-319" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"style"</span><span class="op">,</span> <span class="st">"display: flex; justify-content: center"</span>)<span class="op">;</span></span>
<span id="cb5-320"><a href="#cb5-320" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb5-321"><a href="#cb5-321" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> container<span class="op">.</span><span class="fu">append</span>(<span class="st">"svg"</span>)</span>
<span id="cb5-322"><a href="#cb5-322" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> width <span class="op">+</span> margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">right</span>)</span>
<span id="cb5-323"><a href="#cb5-323" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> height <span class="op">+</span> margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">bottom</span>)</span>
<span id="cb5-324"><a href="#cb5-324" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> width <span class="op">+</span> margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">right</span><span class="op">,</span> height <span class="op">+</span> margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">bottom</span>])</span>
<span id="cb5-325"><a href="#cb5-325" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"style"</span><span class="op">,</span> <span class="st">"max-width: 100%; height: auto; height: intrinsic;"</span>)</span>
<span id="cb5-326"><a href="#cb5-326" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(background)</span>
<span id="cb5-327"><a href="#cb5-327" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(labelsToggle<span class="op">,</span> id)<span class="op">;</span></span>
<span id="cb5-328"><a href="#cb5-328" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-329"><a href="#cb5-329" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Top panel ////////////////////////////////////////////////////////////////////////////////////</span></span>
<span id="cb5-330"><a href="#cb5-330" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-331"><a href="#cb5-331" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> panelTop <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb5-332"><a href="#cb5-332" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>margin<span class="op">.</span><span class="at">left</span><span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>margin<span class="op">.</span><span class="at">top</span><span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb5-333"><a href="#cb5-333" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-334"><a href="#cb5-334" aria-hidden="true" tabindex="-1"></a>  panelTop<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb5-335"><a href="#cb5-335" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clipWide<span class="op">,</span> id)</span>
<span id="cb5-336"><a href="#cb5-336" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurve<span class="op">,</span> id<span class="op">,</span> cost<span class="op">,</span> params<span class="op">,</span> yScalerTop)</span>
<span id="cb5-337"><a href="#cb5-337" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(yGuide<span class="op">,</span> cost<span class="op">,</span> params<span class="op">,</span> yScalerTop)<span class="op">;</span></span>
<span id="cb5-338"><a href="#cb5-338" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-339"><a href="#cb5-339" aria-hidden="true" tabindex="-1"></a>  panelTop<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb5-340"><a href="#cb5-340" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(panelAxes<span class="op">,</span> axisTitlesTop)</span>
<span id="cb5-341"><a href="#cb5-341" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(xGuides<span class="op">,</span> cost<span class="op">,</span> params<span class="op">,</span> yScalerTop)<span class="op">;</span></span>
<span id="cb5-342"><a href="#cb5-342" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-343"><a href="#cb5-343" aria-hidden="true" tabindex="-1"></a>  panelTop<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb5-344"><a href="#cb5-344" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="vs">`labels-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb5-345"><a href="#cb5-345" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clipWide<span class="op">,</span> id)</span>
<span id="cb5-346"><a href="#cb5-346" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addLabel<span class="op">,</span> <span class="st">"Cost"</span><span class="op">,</span> <span class="fu">xScaler</span>(<span class="dv">85</span>) <span class="op">+</span> <span class="dv">10</span><span class="op">,</span> <span class="fu">yScalerTop</span>(<span class="fu">costFxn</span>({ <span class="dt">q</span><span class="op">:</span> <span class="dv">85</span><span class="op">,</span> <span class="dt">fc</span><span class="op">:</span> params<span class="op">.</span><span class="at">fc</span> })) <span class="op">+</span> <span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb5-347"><a href="#cb5-347" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-348"><a href="#cb5-348" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Bottom panel /////////////////////////////////////////////////////////////////////////////////</span></span>
<span id="cb5-349"><a href="#cb5-349" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-350"><a href="#cb5-350" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> panelBottom <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb5-351"><a href="#cb5-351" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>margin<span class="op">.</span><span class="at">left</span><span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> panelHeight <span class="op">+</span> margin<span class="op">.</span><span class="at">between</span><span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb5-352"><a href="#cb5-352" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-353"><a href="#cb5-353" aria-hidden="true" tabindex="-1"></a>  panelBottom<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb5-354"><a href="#cb5-354" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clip<span class="op">,</span> id)</span>
<span id="cb5-355"><a href="#cb5-355" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurveFull<span class="op">,</span> id<span class="op">,</span> ac<span class="op">,</span> params<span class="op">,</span> yScalerBottom<span class="op">,</span> gray)</span>
<span id="cb5-356"><a href="#cb5-356" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurveFull<span class="op">,</span> id<span class="op">,</span> avc<span class="op">,</span> params<span class="op">,</span> yScalerBottom<span class="op">,</span> gray)</span>
<span id="cb5-357"><a href="#cb5-357" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurve<span class="op">,</span> id<span class="op">,</span> mc<span class="op">,</span> params<span class="op">,</span> yScalerBottom)</span>
<span id="cb5-358"><a href="#cb5-358" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-359"><a href="#cb5-359" aria-hidden="true" tabindex="-1"></a>  panelBottom<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb5-360"><a href="#cb5-360" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clipWide<span class="op">,</span> id)</span>
<span id="cb5-361"><a href="#cb5-361" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(yGuide<span class="op">,</span> mc<span class="op">,</span> params<span class="op">,</span> yScalerBottom)<span class="op">;</span></span>
<span id="cb5-362"><a href="#cb5-362" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-363"><a href="#cb5-363" aria-hidden="true" tabindex="-1"></a>  panelBottom<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb5-364"><a href="#cb5-364" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(panelAxes<span class="op">,</span> axisTitlesBottom)<span class="op">;</span></span>
<span id="cb5-365"><a href="#cb5-365" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-366"><a href="#cb5-366" aria-hidden="true" tabindex="-1"></a>  panelBottom<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb5-367"><a href="#cb5-367" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="vs">`labels-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb5-368"><a href="#cb5-368" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addLabel<span class="op">,</span> <span class="st">"AC"</span><span class="op">,</span> <span class="fu">xScaler</span>(<span class="dv">95</span>) <span class="op">-</span> <span class="dv">10</span><span class="op">,</span> <span class="fu">yScalerBottom</span>(<span class="fu">acFxn</span>({ <span class="dt">q</span><span class="op">:</span> <span class="dv">95</span><span class="op">,</span> <span class="dt">fc</span><span class="op">:</span> params<span class="op">.</span><span class="at">fc</span> })) <span class="op">-</span> <span class="dv">10</span><span class="op">,</span> <span class="st">"end"</span>)</span>
<span id="cb5-369"><a href="#cb5-369" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addLabel<span class="op">,</span> <span class="st">"AVC"</span><span class="op">,</span> <span class="fu">xScaler</span>(<span class="dv">95</span>) <span class="op">+</span> <span class="dv">10</span><span class="op">,</span> <span class="fu">yScalerBottom</span>(<span class="fu">avcFxn</span>({ <span class="dt">q</span><span class="op">:</span> <span class="dv">95</span> })) <span class="op">+</span> <span class="dv">10</span>)</span>
<span id="cb5-370"><a href="#cb5-370" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addLabel<span class="op">,</span> <span class="st">"MC"</span><span class="op">,</span> <span class="fu">xScaler</span>(<span class="dv">63</span>) <span class="op">+</span> <span class="dv">10</span><span class="op">,</span> <span class="fu">yScalerBottom</span>(<span class="fu">mcFxn</span>({ <span class="dt">q</span><span class="op">:</span> <span class="dv">63</span> })) <span class="op">+</span> <span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb5-371"><a href="#cb5-371" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-372"><a href="#cb5-372" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Toggle event listener ////////////////////////////////////////////////////////////////////////</span></span>
<span id="cb5-373"><a href="#cb5-373" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-374"><a href="#cb5-374" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cb <span class="op">=</span> svg<span class="op">.</span><span class="fu">select</span>(<span class="st">"foreignObject"</span>)<span class="op">.</span><span class="fu">select</span>(<span class="vs">`input#checkbox-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb5-375"><a href="#cb5-375" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-376"><a href="#cb5-376" aria-hidden="true" tabindex="-1"></a>  cb<span class="op">.</span><span class="fu">on</span>(<span class="st">"click"</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb5-377"><a href="#cb5-377" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> isChecked <span class="op">=</span> cb<span class="op">.</span><span class="fu">property</span>(<span class="st">"checked"</span>)<span class="op">;</span></span>
<span id="cb5-378"><a href="#cb5-378" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> chartLabels <span class="op">=</span> svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="vs">`g#labels-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb5-379"><a href="#cb5-379" aria-hidden="true" tabindex="-1"></a>    isChecked <span class="op">?</span> chartLabels<span class="op">.</span><span class="fu">style</span>(<span class="st">"visibility"</span><span class="op">,</span> <span class="st">"visible"</span>) <span class="op">:</span> chartLabels<span class="op">.</span><span class="fu">style</span>(<span class="st">"visibility"</span><span class="op">,</span> <span class="st">"hidden"</span>)<span class="op">;</span></span>
<span id="cb5-380"><a href="#cb5-380" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb5-381"><a href="#cb5-381" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-382"><a href="#cb5-382" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> container<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb5-383"><a href="#cb5-383" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="ojs-cell-5" data-nodetype="expression">

</div>
</div>
</div>
</div>
</div>
</div>
<p>The average cost or <span class="highlight"><strong>AC curve</strong></span> simply plots total costs divided by output. It is U-shaped, shooting up at both very low and very high output levels. In fact, in the presence of fixed costs, AC goes to infinity as output approaches zero. Notice that this no longer happens if we set fixed costs to zero.</p>
<p>The second panel plots the average variable cost or <span class="highlight"><strong>AVC curve</strong></span>. This is just the AC curve minus the fixed costs component. The AVC curve is also U-shaped, but it doesn’t shoot to infinity when output is zero. As output gets larger and larger, the share of fixed costs in total costs gets smaller and smaller; thus we see the AC and AVC curves converging. Setting fixed costs to zero merges the AC and AVC curves, which is to say, the AC and AVC curves are only distinct quantities in the short run.</p>
<p>The marginal cost or <span class="highlight"><strong>MC curve</strong></span> is on the third panel. Of the three, it is probably the trickiest to grasp, but as marginalist reasoning abounds in economics, it’s worthwhile to really think it through. The MC curve plots the <em>incremental</em> change in total cost given one additional unit of output. It is not an average quantity. It is also U-shaped, but it is a much thinner U than either AC or AVC. This is because it tracks incremental change and is not bogged down by the running tally of costs like AC and AVC are. The slope of the MC curve goes from downward to upward at the precise moment the total cost curve turns from flattening to steepening.</p>
<p>Here’s a useful tip: every time two curves intersect in economics, make note of it. More often than not, something special is happening. In this case, notice how the <span class="highlight">MC curve crosses AVC and AC at the point when they are at their minimum</span>. In other words, the intersection with MC marks the point where they go from downward-sloping to upward-sloping. That is no coincidence. The reason is that as long as MC is below AC/AVC, then the incremental change in costs is lower than the running average, which pulls the average down. Conversely, if MC is above AC/AVC, then it is pulling the average up. By analogy, suppose your average grade from three exams is 80. If your fourth exam is lower than 80, then it will pull your average down, but if it is higher than 80, it will pull your average up. The same principle is at work in our cost curves.</p>
</section>
<section id="deriving-the-supply-curve" class="level2">
<h2 class="anchored" data-anchor-id="deriving-the-supply-curve">Deriving the supply curve</h2>
<p>With a good understanding of AC, AVC, and MC, let’s move on to how they’re used to get the firm’s optimal output level. We will be assuming that the market is perfectly competitive, which means that the <span class="highlight">firm is a price-taker</span>. Later we will explore what happens when this assumption breaks down. For now, let’s say the price the firm is facing is $17. Profits are computed straightforwardly as revenues (price times quantity) minus costs; in the per unit panel, this is represented by the shaded rectangle. Move the output slider around until you find the profit-maximizing level.</p>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6" data-startfrom="405" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 404;"><span id="cb6-405"><a href="#cb6-405" aria-hidden="true" tabindex="-1"></a>viewof q2 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> qMax]<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"Output"</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">50</span>})</span>
<span id="cb6-406"><a href="#cb6-406" aria-hidden="true" tabindex="-1"></a>viewof fc2 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> fcMax]<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"Fixed cost"</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">250</span><span class="op">,</span> <span class="dt">disabled</span><span class="op">:</span> <span class="kw">true</span>})</span>
<span id="cb6-407"><a href="#cb6-407" aria-hidden="true" tabindex="-1"></a>viewof p2 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> pMax]<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"Price"</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="op">.</span><span class="dv">1</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">17</span><span class="op">,</span> <span class="dt">disabled</span><span class="op">:</span> <span class="kw">true</span>})</span>
<span id="cb6-408"><a href="#cb6-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-409"><a href="#cb6-409" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb6-410"><a href="#cb6-410" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> params <span class="op">=</span> ({ <span class="dt">q</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">fc</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">p</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">c</span><span class="op">:</span> <span class="kw">null</span> })<span class="op">;</span></span>
<span id="cb6-411"><a href="#cb6-411" aria-hidden="true" tabindex="-1"></a>  params<span class="op">.</span><span class="at">q</span> <span class="op">=</span> q2<span class="op">;</span></span>
<span id="cb6-412"><a href="#cb6-412" aria-hidden="true" tabindex="-1"></a>  params<span class="op">.</span><span class="at">fc</span> <span class="op">=</span> fc2<span class="op">;</span></span>
<span id="cb6-413"><a href="#cb6-413" aria-hidden="true" tabindex="-1"></a>  params<span class="op">.</span><span class="at">p</span> <span class="op">=</span> p2<span class="op">;</span></span>
<span id="cb6-414"><a href="#cb6-414" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> id <span class="op">=</span> d3<span class="op">.</span><span class="fu">randomInt</span>(<span class="dv">100000</span><span class="op">,</span> <span class="dv">1000000</span>)()<span class="op">;</span></span>
<span id="cb6-415"><a href="#cb6-415" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> axisTitlesTop <span class="op">=</span> ({ <span class="dt">x</span><span class="op">:</span> <span class="st">"Output"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="st">"$"</span> })<span class="op">;</span></span>
<span id="cb6-416"><a href="#cb6-416" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> axisTitlesBottom <span class="op">=</span> ({ <span class="dt">x</span><span class="op">:</span> <span class="st">"Output"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="st">"$/unit"</span> })<span class="op">;</span></span>
<span id="cb6-417"><a href="#cb6-417" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-418"><a href="#cb6-418" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yScalerTop <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb6-419"><a href="#cb6-419" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="op">-</span><span class="dv">800</span><span class="op">,</span> <span class="dv">800</span>])</span>
<span id="cb6-420"><a href="#cb6-420" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([panelHeight<span class="op">,</span> <span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb6-421"><a href="#cb6-421" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yScalerBottom <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb6-422"><a href="#cb6-422" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="fu">acFxn</span>({ <span class="dt">q</span><span class="op">:</span> qMax<span class="op">,</span> <span class="dt">fc</span><span class="op">:</span> fcMax })])</span>
<span id="cb6-423"><a href="#cb6-423" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([panelHeight<span class="op">,</span> <span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb6-424"><a href="#cb6-424" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-425"><a href="#cb6-425" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> corners <span class="op">=</span> ({ <span class="dt">x1</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">y1</span><span class="op">:</span> <span class="fu">yScalerBottom</span>(params<span class="op">.</span><span class="at">p</span>)<span class="op">,</span> <span class="dt">x2</span><span class="op">:</span> <span class="fu">xScaler</span>(params<span class="op">.</span><span class="at">q</span>)<span class="op">,</span> <span class="dt">y2</span><span class="op">:</span> <span class="fu">yScalerBottom</span>(<span class="fu">acFxn</span>(params)) })<span class="op">;</span></span>
<span id="cb6-426"><a href="#cb6-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-427"><a href="#cb6-427" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> container <span class="op">=</span> d3<span class="op">.</span><span class="fu">create</span>(<span class="st">"div"</span>)</span>
<span id="cb6-428"><a href="#cb6-428" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"style"</span><span class="op">,</span> <span class="st">"display: flex; justify-content: center"</span>)<span class="op">;</span></span>
<span id="cb6-429"><a href="#cb6-429" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-430"><a href="#cb6-430" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> container<span class="op">.</span><span class="fu">append</span>(<span class="st">"svg"</span>)</span>
<span id="cb6-431"><a href="#cb6-431" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> width <span class="op">+</span> margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">right</span>)</span>
<span id="cb6-432"><a href="#cb6-432" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> height <span class="op">+</span> margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">bottom</span>)</span>
<span id="cb6-433"><a href="#cb6-433" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> width <span class="op">+</span> margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">right</span><span class="op">,</span> height <span class="op">+</span> margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">bottom</span>])</span>
<span id="cb6-434"><a href="#cb6-434" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"style"</span><span class="op">,</span> <span class="st">"max-width: 100%; height: auto; height: intrinsic;"</span>)</span>
<span id="cb6-435"><a href="#cb6-435" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(background)</span>
<span id="cb6-436"><a href="#cb6-436" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(labelsToggle<span class="op">,</span> id)<span class="op">;</span></span>
<span id="cb6-437"><a href="#cb6-437" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-438"><a href="#cb6-438" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Top panel ////////////////////////////////////////////////////////////////////////////////////</span></span>
<span id="cb6-439"><a href="#cb6-439" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-440"><a href="#cb6-440" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> panelTop <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb6-441"><a href="#cb6-441" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>margin<span class="op">.</span><span class="at">left</span><span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>margin<span class="op">.</span><span class="at">top</span><span class="sc">}</span><span class="vs">)`</span>)</span>
<span id="cb6-442"><a href="#cb6-442" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-443"><a href="#cb6-443" aria-hidden="true" tabindex="-1"></a>  panelTop<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb6-444"><a href="#cb6-444" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clipWide<span class="op">,</span> id)</span>
<span id="cb6-445"><a href="#cb6-445" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurve<span class="op">,</span> id<span class="op">,</span> profit<span class="op">,</span> params<span class="op">,</span> yScalerTop)</span>
<span id="cb6-446"><a href="#cb6-446" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(yGuide<span class="op">,</span> profit<span class="op">,</span> params<span class="op">,</span> yScalerTop)<span class="op">;</span></span>
<span id="cb6-447"><a href="#cb6-447" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-448"><a href="#cb6-448" aria-hidden="true" tabindex="-1"></a>  panelTop<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb6-449"><a href="#cb6-449" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(panelAxesT<span class="op">,</span> axisTitlesTop<span class="op">,</span> yScalerTop)</span>
<span id="cb6-450"><a href="#cb6-450" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(xGuides<span class="op">,</span> profit<span class="op">,</span> params<span class="op">,</span> yScalerTop)<span class="op">;</span></span>
<span id="cb6-451"><a href="#cb6-451" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-452"><a href="#cb6-452" aria-hidden="true" tabindex="-1"></a>  panelTop<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb6-453"><a href="#cb6-453" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="vs">`labels-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb6-454"><a href="#cb6-454" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clipWide<span class="op">,</span> id)</span>
<span id="cb6-455"><a href="#cb6-455" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addLabel<span class="op">,</span> <span class="st">"Profit"</span><span class="op">,</span> <span class="fu">xScaler</span>(<span class="dv">70</span>) <span class="op">+</span> <span class="dv">10</span><span class="op">,</span> <span class="fu">yScalerTop</span>(<span class="fu">profitFxn</span>({ <span class="dt">q</span><span class="op">:</span> <span class="dv">70</span><span class="op">,</span> <span class="dt">p</span><span class="op">:</span> params<span class="op">.</span><span class="at">p</span><span class="op">,</span> <span class="dt">fc</span><span class="op">:</span> params<span class="op">.</span><span class="at">fc</span> })) <span class="op">-</span> <span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb6-456"><a href="#cb6-456" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-457"><a href="#cb6-457" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Bottom panel /////////////////////////////////////////////////////////////////////////////////</span></span>
<span id="cb6-458"><a href="#cb6-458" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-459"><a href="#cb6-459" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> panelBottom <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb6-460"><a href="#cb6-460" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>margin<span class="op">.</span><span class="at">left</span><span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> panelHeight <span class="op">+</span> margin<span class="op">.</span><span class="at">between</span><span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb6-461"><a href="#cb6-461" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-462"><a href="#cb6-462" aria-hidden="true" tabindex="-1"></a>  panelBottom<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb6-463"><a href="#cb6-463" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clipWide<span class="op">,</span> id)</span>
<span id="cb6-464"><a href="#cb6-464" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addArea<span class="op">,</span> id<span class="op">,</span> profit<span class="op">,</span> corners)</span>
<span id="cb6-465"><a href="#cb6-465" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">select</span>(<span class="st">"path"</span>)</span>
<span id="cb6-466"><a href="#cb6-466" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> corners<span class="op">.</span><span class="at">y1</span> <span class="op">&lt;</span> corners<span class="op">.</span><span class="at">y2</span> <span class="op">?</span> <span class="st">"#7fc6a4"</span> <span class="op">:</span> <span class="st">"#f697bb"</span>)<span class="op">;</span></span>
<span id="cb6-467"><a href="#cb6-467" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-468"><a href="#cb6-468" aria-hidden="true" tabindex="-1"></a>  panelBottom<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb6-469"><a href="#cb6-469" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clip<span class="op">,</span> id)</span>
<span id="cb6-470"><a href="#cb6-470" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurve<span class="op">,</span> id<span class="op">,</span> avc<span class="op">,</span> params<span class="op">,</span> yScalerBottom)</span>
<span id="cb6-471"><a href="#cb6-471" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurve<span class="op">,</span> id<span class="op">,</span> mc<span class="op">,</span> params<span class="op">,</span> yScalerBottom)</span>
<span id="cb6-472"><a href="#cb6-472" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurve<span class="op">,</span> id<span class="op">,</span> ac<span class="op">,</span> params<span class="op">,</span> yScalerBottom)</span>
<span id="cb6-473"><a href="#cb6-473" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-474"><a href="#cb6-474" aria-hidden="true" tabindex="-1"></a>  panelBottom<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb6-475"><a href="#cb6-475" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clipWide<span class="op">,</span> id)</span>
<span id="cb6-476"><a href="#cb6-476" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(yGuide<span class="op">,</span> price<span class="op">,</span> params<span class="op">,</span> yScalerBottom)</span>
<span id="cb6-477"><a href="#cb6-477" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurveFull<span class="op">,</span> id<span class="op">,</span> price<span class="op">,</span> params<span class="op">,</span> yScalerBottom)</span>
<span id="cb6-478"><a href="#cb6-478" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(yGuide<span class="op">,</span> ac<span class="op">,</span> params<span class="op">,</span> yScalerBottom)<span class="op">;</span></span>
<span id="cb6-479"><a href="#cb6-479" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-480"><a href="#cb6-480" aria-hidden="true" tabindex="-1"></a>  panelBottom<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb6-481"><a href="#cb6-481" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(panelAxes<span class="op">,</span> axisTitlesBottom)</span>
<span id="cb6-482"><a href="#cb6-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-483"><a href="#cb6-483" aria-hidden="true" tabindex="-1"></a>  panelBottom<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb6-484"><a href="#cb6-484" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="vs">`labels-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb6-485"><a href="#cb6-485" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addLabel<span class="op">,</span> <span class="st">"Price"</span><span class="op">,</span> width <span class="op">+</span> <span class="dv">10</span><span class="op">,</span> <span class="fu">yScalerBottom</span>(params<span class="op">.</span><span class="at">p</span>))</span>
<span id="cb6-486"><a href="#cb6-486" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addLabel<span class="op">,</span> <span class="st">"AC"</span><span class="op">,</span> <span class="fu">xScaler</span>(<span class="dv">95</span>) <span class="op">-</span> <span class="dv">10</span><span class="op">,</span> <span class="fu">yScalerBottom</span>(<span class="fu">acFxn</span>({ <span class="dt">q</span><span class="op">:</span> <span class="dv">95</span><span class="op">,</span> <span class="dt">fc</span><span class="op">:</span> params<span class="op">.</span><span class="at">fc</span> })) <span class="op">-</span> <span class="dv">10</span><span class="op">,</span> <span class="st">"end"</span>)</span>
<span id="cb6-487"><a href="#cb6-487" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addLabel<span class="op">,</span> <span class="st">"AVC"</span><span class="op">,</span> <span class="fu">xScaler</span>(<span class="dv">95</span>) <span class="op">+</span> <span class="dv">10</span><span class="op">,</span> <span class="fu">yScalerBottom</span>(<span class="fu">avcFxn</span>({ <span class="dt">q</span><span class="op">:</span> <span class="dv">95</span> })) <span class="op">+</span> <span class="dv">10</span>)</span>
<span id="cb6-488"><a href="#cb6-488" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addLabel<span class="op">,</span> <span class="st">"MC"</span><span class="op">,</span> <span class="fu">xScaler</span>(<span class="dv">63</span>) <span class="op">+</span> <span class="dv">10</span><span class="op">,</span> <span class="fu">yScalerBottom</span>(<span class="fu">mcFxn</span>({ <span class="dt">q</span><span class="op">:</span> <span class="dv">63</span> })) <span class="op">+</span> <span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb6-489"><a href="#cb6-489" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-490"><a href="#cb6-490" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Toggle event listener ////////////////////////////////////////////////////////////////////////</span></span>
<span id="cb6-491"><a href="#cb6-491" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-492"><a href="#cb6-492" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cb <span class="op">=</span> svg<span class="op">.</span><span class="fu">select</span>(<span class="st">"foreignObject"</span>)<span class="op">.</span><span class="fu">select</span>(<span class="vs">`input#checkbox-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb6-493"><a href="#cb6-493" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-494"><a href="#cb6-494" aria-hidden="true" tabindex="-1"></a>  cb<span class="op">.</span><span class="fu">on</span>(<span class="st">"click"</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb6-495"><a href="#cb6-495" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> isChecked <span class="op">=</span> cb<span class="op">.</span><span class="fu">property</span>(<span class="st">"checked"</span>)<span class="op">;</span></span>
<span id="cb6-496"><a href="#cb6-496" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> chartLabels <span class="op">=</span> svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="vs">`g#labels-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb6-497"><a href="#cb6-497" aria-hidden="true" tabindex="-1"></a>    isChecked <span class="op">?</span> chartLabels<span class="op">.</span><span class="fu">style</span>(<span class="st">"visibility"</span><span class="op">,</span> <span class="st">"visible"</span>) <span class="op">:</span> chartLabels<span class="op">.</span><span class="fu">style</span>(<span class="st">"visibility"</span><span class="op">,</span> <span class="st">"hidden"</span>)<span class="op">;</span></span>
<span id="cb6-498"><a href="#cb6-498" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb6-499"><a href="#cb6-499" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-500"><a href="#cb6-500" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> container<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb6-501"><a href="#cb6-501" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell quarto-layout-panel" data-layout="[[1, 1], [1], [1]]">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="ojs-cell-6-1" data-nodetype="declaration">

</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="ojs-cell-6-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="ojs-cell-6-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="ojs-cell-6-4" data-nodetype="expression">

</div>
</div>
</div>
</div>
<p>We see that an output of about 59 units maximizes profits.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> Notice anything interesting? This level of <span class="math inline">\(q\)</span> just so happens to be the point where the price line intersects the MC curve! <img src="../../images/pikachu.png" class="endmark img-fluid"> This is a key insight in economics. It says that at the optimum, the last additional unit of output you produce should yield you as much revenue as the costs it incurs. This is best understood by considering the alternatives. If we’ve chosen an output level such that MC is below price, then producing one more unit should give us more revenue than costs, and thus increase our profits. Conversely, if MC is above price, then cutting back production by one unit reduces costs more than it reduces revenues, which again increases profits. The state of optimality is reached when price is equal to MC, or, stated more generally, when <span class="highlight">marginal revenue is equal to marginal costs</span>.</p>
<p>Well, a small caveat: notice that the price line actually intersects MC on two points, first in its downward-sloping region and second in its upward-sloping region. Setting output where price crosses MC at its downward-sloping region actually <em>minimizes</em> profits. Naturally, if MC is below price and is falling, then we’d want to keep expanding output. Let’s clarify then that the optimal output level is where price meets the MC curve in its upward-sloping region.</p>
<p>Does our rule still work when the price is so low that profits are negative no matter what output level we choose? Let’s investigate. The chart below sets the price at $10.</p>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7" data-startfrom="514" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 513;"><span id="cb7-514"><a href="#cb7-514" aria-hidden="true" tabindex="-1"></a>viewof q3 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> qMax]<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"Output"</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">50</span>})</span>
<span id="cb7-515"><a href="#cb7-515" aria-hidden="true" tabindex="-1"></a>viewof fc3 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> fcMax]<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"Fixed cost"</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">250</span><span class="op">,</span> <span class="dt">disabled</span><span class="op">:</span> <span class="kw">true</span> })</span>
<span id="cb7-516"><a href="#cb7-516" aria-hidden="true" tabindex="-1"></a>viewof p3 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> pMax]<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"Price"</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="op">.</span><span class="dv">1</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dt">disabled</span><span class="op">:</span> <span class="kw">true</span> })</span>
<span id="cb7-517"><a href="#cb7-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-518"><a href="#cb7-518" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb7-519"><a href="#cb7-519" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> params <span class="op">=</span> ({ <span class="dt">q</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">fc</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">p</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">c</span><span class="op">:</span> <span class="kw">null</span> })<span class="op">;</span></span>
<span id="cb7-520"><a href="#cb7-520" aria-hidden="true" tabindex="-1"></a>  params<span class="op">.</span><span class="at">q</span> <span class="op">=</span> q3<span class="op">;</span></span>
<span id="cb7-521"><a href="#cb7-521" aria-hidden="true" tabindex="-1"></a>  params<span class="op">.</span><span class="at">p</span> <span class="op">=</span> p3<span class="op">;</span></span>
<span id="cb7-522"><a href="#cb7-522" aria-hidden="true" tabindex="-1"></a>  params<span class="op">.</span><span class="at">fc</span> <span class="op">=</span> fc3<span class="op">;</span></span>
<span id="cb7-523"><a href="#cb7-523" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> id <span class="op">=</span> d3<span class="op">.</span><span class="fu">randomInt</span>(<span class="dv">100000</span><span class="op">,</span> <span class="dv">1000000</span>)()<span class="op">;</span></span>
<span id="cb7-524"><a href="#cb7-524" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> axisTitlesTop <span class="op">=</span> ({ <span class="dt">x</span><span class="op">:</span> <span class="st">"Output"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="st">"$"</span> })<span class="op">;</span></span>
<span id="cb7-525"><a href="#cb7-525" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> axisTitlesBottom <span class="op">=</span> ({ <span class="dt">x</span><span class="op">:</span> <span class="st">"Output"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="st">"$/unit"</span> })<span class="op">;</span></span>
<span id="cb7-526"><a href="#cb7-526" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-527"><a href="#cb7-527" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yScalerTop <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb7-528"><a href="#cb7-528" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="op">-</span><span class="dv">800</span><span class="op">,</span> <span class="dv">800</span>])</span>
<span id="cb7-529"><a href="#cb7-529" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([panelHeight<span class="op">,</span> <span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb7-530"><a href="#cb7-530" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yScalerBottom <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb7-531"><a href="#cb7-531" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="fu">acFxn</span>({ <span class="dt">q</span><span class="op">:</span> qMax<span class="op">,</span> <span class="dt">fc</span><span class="op">:</span> fcMax })])</span>
<span id="cb7-532"><a href="#cb7-532" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([panelHeight<span class="op">,</span> <span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb7-533"><a href="#cb7-533" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-534"><a href="#cb7-534" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> corners <span class="op">=</span> ({ <span class="dt">x1</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">y1</span><span class="op">:</span> <span class="fu">yScalerBottom</span>(params<span class="op">.</span><span class="at">p</span>)<span class="op">,</span> <span class="dt">x2</span><span class="op">:</span> <span class="fu">xScaler</span>(params<span class="op">.</span><span class="at">q</span>)<span class="op">,</span> <span class="dt">y2</span><span class="op">:</span> <span class="fu">yScalerBottom</span>(<span class="fu">acFxn</span>(params)) })<span class="op">;</span></span>
<span id="cb7-535"><a href="#cb7-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-536"><a href="#cb7-536" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> container <span class="op">=</span> d3<span class="op">.</span><span class="fu">create</span>(<span class="st">"div"</span>)</span>
<span id="cb7-537"><a href="#cb7-537" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"style"</span><span class="op">,</span> <span class="st">"display: flex; justify-content: center"</span>)<span class="op">;</span></span>
<span id="cb7-538"><a href="#cb7-538" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-539"><a href="#cb7-539" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> container<span class="op">.</span><span class="fu">append</span>(<span class="st">"svg"</span>)</span>
<span id="cb7-540"><a href="#cb7-540" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> width <span class="op">+</span> margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">right</span>)</span>
<span id="cb7-541"><a href="#cb7-541" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> height <span class="op">+</span> margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">bottom</span>)</span>
<span id="cb7-542"><a href="#cb7-542" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> width <span class="op">+</span> margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">right</span><span class="op">,</span> height <span class="op">+</span> margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">bottom</span>])</span>
<span id="cb7-543"><a href="#cb7-543" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"style"</span><span class="op">,</span> <span class="st">"max-width: 100%; height: auto; height: intrinsic;"</span>)</span>
<span id="cb7-544"><a href="#cb7-544" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(background)</span>
<span id="cb7-545"><a href="#cb7-545" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(labelsToggle<span class="op">,</span> id)<span class="op">;</span></span>
<span id="cb7-546"><a href="#cb7-546" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-547"><a href="#cb7-547" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Top panel ////////////////////////////////////////////////////////////////////////////////////</span></span>
<span id="cb7-548"><a href="#cb7-548" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-549"><a href="#cb7-549" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> panelTop <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb7-550"><a href="#cb7-550" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>margin<span class="op">.</span><span class="at">left</span><span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>margin<span class="op">.</span><span class="at">top</span><span class="sc">}</span><span class="vs">)`</span>)</span>
<span id="cb7-551"><a href="#cb7-551" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-552"><a href="#cb7-552" aria-hidden="true" tabindex="-1"></a>  panelTop<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb7-553"><a href="#cb7-553" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clipWide<span class="op">,</span> id)</span>
<span id="cb7-554"><a href="#cb7-554" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurve<span class="op">,</span> id<span class="op">,</span> profit<span class="op">,</span> params<span class="op">,</span> yScalerTop)</span>
<span id="cb7-555"><a href="#cb7-555" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(yGuide<span class="op">,</span> profit<span class="op">,</span> params<span class="op">,</span> yScalerTop)<span class="op">;</span></span>
<span id="cb7-556"><a href="#cb7-556" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-557"><a href="#cb7-557" aria-hidden="true" tabindex="-1"></a>  panelTop<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb7-558"><a href="#cb7-558" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(panelAxesT<span class="op">,</span> axisTitlesTop<span class="op">,</span> yScalerTop)</span>
<span id="cb7-559"><a href="#cb7-559" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(xGuides<span class="op">,</span> profit<span class="op">,</span> params<span class="op">,</span> yScalerTop)<span class="op">;</span></span>
<span id="cb7-560"><a href="#cb7-560" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-561"><a href="#cb7-561" aria-hidden="true" tabindex="-1"></a>  panelTop<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb7-562"><a href="#cb7-562" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="vs">`labels-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb7-563"><a href="#cb7-563" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clipWide<span class="op">,</span> id)</span>
<span id="cb7-564"><a href="#cb7-564" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addLabel<span class="op">,</span> <span class="st">"Profit"</span><span class="op">,</span> <span class="fu">xScaler</span>(<span class="dv">70</span>) <span class="op">+</span> <span class="dv">10</span><span class="op">,</span> <span class="fu">yScalerTop</span>(<span class="fu">profitFxn</span>({ <span class="dt">q</span><span class="op">:</span> <span class="dv">70</span><span class="op">,</span> <span class="dt">p</span><span class="op">:</span> params<span class="op">.</span><span class="at">p</span><span class="op">,</span> <span class="dt">fc</span><span class="op">:</span> params<span class="op">.</span><span class="at">fc</span> })) <span class="op">-</span> <span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb7-565"><a href="#cb7-565" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-566"><a href="#cb7-566" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Bottom panel /////////////////////////////////////////////////////////////////////////////////</span></span>
<span id="cb7-567"><a href="#cb7-567" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-568"><a href="#cb7-568" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> panelBottom <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb7-569"><a href="#cb7-569" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>margin<span class="op">.</span><span class="at">left</span><span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> panelHeight <span class="op">+</span> margin<span class="op">.</span><span class="at">between</span><span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb7-570"><a href="#cb7-570" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-571"><a href="#cb7-571" aria-hidden="true" tabindex="-1"></a>  panelBottom<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb7-572"><a href="#cb7-572" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clipWide<span class="op">,</span> id)</span>
<span id="cb7-573"><a href="#cb7-573" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addArea<span class="op">,</span> id<span class="op">,</span> profit<span class="op">,</span> corners)</span>
<span id="cb7-574"><a href="#cb7-574" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">select</span>(<span class="st">"path"</span>)</span>
<span id="cb7-575"><a href="#cb7-575" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> corners<span class="op">.</span><span class="at">y1</span> <span class="op">&lt;</span> corners<span class="op">.</span><span class="at">y2</span> <span class="op">?</span> <span class="st">"#7fc6a4"</span> <span class="op">:</span> <span class="st">"#f697bb"</span>)<span class="op">;</span></span>
<span id="cb7-576"><a href="#cb7-576" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-577"><a href="#cb7-577" aria-hidden="true" tabindex="-1"></a>  panelBottom<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb7-578"><a href="#cb7-578" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clip<span class="op">,</span> id)</span>
<span id="cb7-579"><a href="#cb7-579" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurveFull<span class="op">,</span> id<span class="op">,</span> avc<span class="op">,</span> params<span class="op">,</span> yScalerBottom<span class="op">,</span> gray)</span>
<span id="cb7-580"><a href="#cb7-580" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurveFull<span class="op">,</span> id<span class="op">,</span> ac<span class="op">,</span> params<span class="op">,</span> yScalerBottom<span class="op">,</span> gray)</span>
<span id="cb7-581"><a href="#cb7-581" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurve<span class="op">,</span> id<span class="op">,</span> mc<span class="op">,</span> params<span class="op">,</span> yScalerBottom)</span>
<span id="cb7-582"><a href="#cb7-582" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-583"><a href="#cb7-583" aria-hidden="true" tabindex="-1"></a>  panelBottom<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb7-584"><a href="#cb7-584" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clipWide<span class="op">,</span> id)</span>
<span id="cb7-585"><a href="#cb7-585" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(yGuide<span class="op">,</span> mr<span class="op">,</span> params<span class="op">,</span> yScalerBottom)</span>
<span id="cb7-586"><a href="#cb7-586" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurveFull<span class="op">,</span> id<span class="op">,</span> mr<span class="op">,</span> params<span class="op">,</span> yScalerBottom)</span>
<span id="cb7-587"><a href="#cb7-587" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(yGuide<span class="op">,</span> ac<span class="op">,</span> params<span class="op">,</span> yScalerBottom)<span class="op">;</span></span>
<span id="cb7-588"><a href="#cb7-588" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-589"><a href="#cb7-589" aria-hidden="true" tabindex="-1"></a>  panelBottom<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb7-590"><a href="#cb7-590" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(panelAxes<span class="op">,</span> axisTitlesBottom)</span>
<span id="cb7-591"><a href="#cb7-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-592"><a href="#cb7-592" aria-hidden="true" tabindex="-1"></a>  panelBottom<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb7-593"><a href="#cb7-593" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="vs">`labels-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb7-594"><a href="#cb7-594" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addLabel<span class="op">,</span> <span class="st">"Price"</span><span class="op">,</span> width <span class="op">+</span> <span class="dv">10</span><span class="op">,</span> <span class="fu">yScalerBottom</span>(params<span class="op">.</span><span class="at">p</span>))</span>
<span id="cb7-595"><a href="#cb7-595" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addLabel<span class="op">,</span> <span class="st">"AC"</span><span class="op">,</span> <span class="fu">xScaler</span>(<span class="dv">95</span>) <span class="op">-</span> <span class="dv">10</span><span class="op">,</span> <span class="fu">yScalerBottom</span>(<span class="fu">acFxn</span>({ <span class="dt">q</span><span class="op">:</span> <span class="dv">95</span><span class="op">,</span> <span class="dt">fc</span><span class="op">:</span> params<span class="op">.</span><span class="at">fc</span> })) <span class="op">-</span> <span class="dv">10</span><span class="op">,</span> <span class="st">"end"</span>)</span>
<span id="cb7-596"><a href="#cb7-596" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addLabel<span class="op">,</span> <span class="st">"AVC"</span><span class="op">,</span> <span class="fu">xScaler</span>(<span class="dv">95</span>) <span class="op">+</span> <span class="dv">10</span><span class="op">,</span> <span class="fu">yScalerBottom</span>(<span class="fu">avcFxn</span>({ <span class="dt">q</span><span class="op">:</span> <span class="dv">95</span> })) <span class="op">+</span> <span class="dv">10</span>)</span>
<span id="cb7-597"><a href="#cb7-597" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addLabel<span class="op">,</span> <span class="st">"MC"</span><span class="op">,</span> <span class="fu">xScaler</span>(<span class="dv">63</span>) <span class="op">+</span> <span class="dv">10</span><span class="op">,</span> <span class="fu">yScalerBottom</span>(<span class="fu">mcFxn</span>({ <span class="dt">q</span><span class="op">:</span> <span class="dv">63</span> })) <span class="op">+</span> <span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb7-598"><a href="#cb7-598" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-599"><a href="#cb7-599" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Toggle event listener ////////////////////////////////////////////////////////////////////////</span></span>
<span id="cb7-600"><a href="#cb7-600" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-601"><a href="#cb7-601" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cb <span class="op">=</span> svg<span class="op">.</span><span class="fu">select</span>(<span class="st">"foreignObject"</span>)<span class="op">.</span><span class="fu">select</span>(<span class="vs">`input#checkbox-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb7-602"><a href="#cb7-602" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-603"><a href="#cb7-603" aria-hidden="true" tabindex="-1"></a>  cb<span class="op">.</span><span class="fu">on</span>(<span class="st">"click"</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb7-604"><a href="#cb7-604" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> isChecked <span class="op">=</span> cb<span class="op">.</span><span class="fu">property</span>(<span class="st">"checked"</span>)<span class="op">;</span></span>
<span id="cb7-605"><a href="#cb7-605" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> chartLabels <span class="op">=</span> svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="vs">`g#labels-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb7-606"><a href="#cb7-606" aria-hidden="true" tabindex="-1"></a>    isChecked <span class="op">?</span> chartLabels<span class="op">.</span><span class="fu">style</span>(<span class="st">"visibility"</span><span class="op">,</span> <span class="st">"visible"</span>) <span class="op">:</span> chartLabels<span class="op">.</span><span class="fu">style</span>(<span class="st">"visibility"</span><span class="op">,</span> <span class="st">"hidden"</span>)<span class="op">;</span></span>
<span id="cb7-607"><a href="#cb7-607" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb7-608"><a href="#cb7-608" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-609"><a href="#cb7-609" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> container<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb7-610"><a href="#cb7-610" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell quarto-layout-panel" data-layout="[[1, 1], [1], [1]]">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="ojs-cell-7-1" data-nodetype="declaration">

</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="ojs-cell-7-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="ojs-cell-7-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="ojs-cell-7-4" data-nodetype="expression">

</div>
</div>
</div>
</div>
<p>This time, the <span class="math inline">\(MR=MC\)</span> condition gives us an output level of about 51 and profits of –$99. If my profits are going to be negative, why don’t I just produce zero and call it a day? Well, if you tried to set <span class="math inline">\(q=0\)</span>, you’ll see that it yields profits of –$250, which is more negative than at the optimal level. The number 250, of course, is our fixed costs, and the insight here is that since we have to pay for fixed costs anyway, it’s better to produce something rather than nothing, even if we never do earn positive profits.</p>
<p>The price can be so low, however, that it does make more sense to quit production altogether. As an exercise, use the chart below to try and find prices for which the optimal output level is zero. Formulate a rule for what these prices must be.</p>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8" data-startfrom="621" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 620;"><span id="cb8-621"><a href="#cb8-621" aria-hidden="true" tabindex="-1"></a>viewof q4 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> qMax]<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"Output"</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">50</span> })</span>
<span id="cb8-622"><a href="#cb8-622" aria-hidden="true" tabindex="-1"></a>viewof fc4 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> fcMax]<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"Fixed cost"</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">250</span><span class="op">,</span> <span class="dt">disabled</span><span class="op">:</span> <span class="kw">true</span> })</span>
<span id="cb8-623"><a href="#cb8-623" aria-hidden="true" tabindex="-1"></a>viewof p4 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> pMax]<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"Price"</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="op">.</span><span class="dv">1</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">15</span> })</span>
<span id="cb8-624"><a href="#cb8-624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-625"><a href="#cb8-625" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb8-626"><a href="#cb8-626" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> params <span class="op">=</span> ({ <span class="dt">q</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">fc</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">p</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">c</span><span class="op">:</span> <span class="kw">null</span> })<span class="op">;</span></span>
<span id="cb8-627"><a href="#cb8-627" aria-hidden="true" tabindex="-1"></a>  params<span class="op">.</span><span class="at">q</span> <span class="op">=</span> q4<span class="op">;</span></span>
<span id="cb8-628"><a href="#cb8-628" aria-hidden="true" tabindex="-1"></a>  params<span class="op">.</span><span class="at">p</span> <span class="op">=</span> p4<span class="op">;</span></span>
<span id="cb8-629"><a href="#cb8-629" aria-hidden="true" tabindex="-1"></a>  params<span class="op">.</span><span class="at">fc</span> <span class="op">=</span> fc4<span class="op">;</span></span>
<span id="cb8-630"><a href="#cb8-630" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> id <span class="op">=</span> d3<span class="op">.</span><span class="fu">randomInt</span>(<span class="dv">100000</span><span class="op">,</span> <span class="dv">1000000</span>)()<span class="op">;</span></span>
<span id="cb8-631"><a href="#cb8-631" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> axisTitlesTop <span class="op">=</span> ({ <span class="dt">x</span><span class="op">:</span> <span class="st">"Output"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="st">"$"</span> })<span class="op">;</span></span>
<span id="cb8-632"><a href="#cb8-632" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> axisTitlesBottom <span class="op">=</span> ({ <span class="dt">x</span><span class="op">:</span> <span class="st">"Output"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="st">"$/unit"</span> })<span class="op">;</span></span>
<span id="cb8-633"><a href="#cb8-633" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-634"><a href="#cb8-634" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yScalerTop <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb8-635"><a href="#cb8-635" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="op">-</span><span class="dv">800</span><span class="op">,</span> <span class="dv">800</span>])</span>
<span id="cb8-636"><a href="#cb8-636" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([panelHeight<span class="op">,</span> <span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb8-637"><a href="#cb8-637" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yScalerBottom <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb8-638"><a href="#cb8-638" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="fu">acFxn</span>({ <span class="dt">q</span><span class="op">:</span> qMax<span class="op">,</span> <span class="dt">fc</span><span class="op">:</span> fcMax })])</span>
<span id="cb8-639"><a href="#cb8-639" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([panelHeight<span class="op">,</span> <span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb8-640"><a href="#cb8-640" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-641"><a href="#cb8-641" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> corners <span class="op">=</span> ({ <span class="dt">x1</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">y1</span><span class="op">:</span> <span class="fu">yScalerBottom</span>(params<span class="op">.</span><span class="at">p</span>)<span class="op">,</span> <span class="dt">x2</span><span class="op">:</span> <span class="fu">xScaler</span>(params<span class="op">.</span><span class="at">q</span>)<span class="op">,</span> <span class="dt">y2</span><span class="op">:</span> <span class="fu">yScalerBottom</span>(<span class="fu">acFxn</span>(params)) })<span class="op">;</span></span>
<span id="cb8-642"><a href="#cb8-642" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-643"><a href="#cb8-643" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> container <span class="op">=</span> d3<span class="op">.</span><span class="fu">create</span>(<span class="st">"div"</span>)</span>
<span id="cb8-644"><a href="#cb8-644" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"style"</span><span class="op">,</span> <span class="st">"display: flex; justify-content: center"</span>)<span class="op">;</span></span>
<span id="cb8-645"><a href="#cb8-645" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-646"><a href="#cb8-646" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> container<span class="op">.</span><span class="fu">append</span>(<span class="st">"svg"</span>)</span>
<span id="cb8-647"><a href="#cb8-647" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> width <span class="op">+</span> margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">right</span>)</span>
<span id="cb8-648"><a href="#cb8-648" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> height <span class="op">+</span> margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">bottom</span>)</span>
<span id="cb8-649"><a href="#cb8-649" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> width <span class="op">+</span> margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">right</span><span class="op">,</span> height <span class="op">+</span> margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">bottom</span>])</span>
<span id="cb8-650"><a href="#cb8-650" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"style"</span><span class="op">,</span> <span class="st">"max-width: 100%; height: auto; height: intrinsic;"</span>)</span>
<span id="cb8-651"><a href="#cb8-651" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(background)</span>
<span id="cb8-652"><a href="#cb8-652" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(labelsToggle<span class="op">,</span> id)<span class="op">;</span></span>
<span id="cb8-653"><a href="#cb8-653" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-654"><a href="#cb8-654" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Top panel ////////////////////////////////////////////////////////////////////////////////////</span></span>
<span id="cb8-655"><a href="#cb8-655" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-656"><a href="#cb8-656" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> panelTop <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb8-657"><a href="#cb8-657" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>margin<span class="op">.</span><span class="at">left</span><span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>margin<span class="op">.</span><span class="at">top</span><span class="sc">}</span><span class="vs">)`</span>)</span>
<span id="cb8-658"><a href="#cb8-658" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-659"><a href="#cb8-659" aria-hidden="true" tabindex="-1"></a>  panelTop<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb8-660"><a href="#cb8-660" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clipWide<span class="op">,</span> id)</span>
<span id="cb8-661"><a href="#cb8-661" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurve<span class="op">,</span> id<span class="op">,</span> profit<span class="op">,</span> params<span class="op">,</span> yScalerTop)</span>
<span id="cb8-662"><a href="#cb8-662" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(yGuide<span class="op">,</span> profit<span class="op">,</span> params<span class="op">,</span> yScalerTop)<span class="op">;</span></span>
<span id="cb8-663"><a href="#cb8-663" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-664"><a href="#cb8-664" aria-hidden="true" tabindex="-1"></a>  panelTop<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb8-665"><a href="#cb8-665" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(panelAxesT<span class="op">,</span> axisTitlesTop<span class="op">,</span> yScalerTop)</span>
<span id="cb8-666"><a href="#cb8-666" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(xGuides<span class="op">,</span> profit<span class="op">,</span> params<span class="op">,</span> yScalerTop)<span class="op">;</span></span>
<span id="cb8-667"><a href="#cb8-667" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-668"><a href="#cb8-668" aria-hidden="true" tabindex="-1"></a>  panelTop<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb8-669"><a href="#cb8-669" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="vs">`labels-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb8-670"><a href="#cb8-670" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clipWide<span class="op">,</span> id)</span>
<span id="cb8-671"><a href="#cb8-671" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addLabel<span class="op">,</span> <span class="st">"Profit"</span><span class="op">,</span> <span class="fu">xScaler</span>(<span class="dv">70</span>) <span class="op">+</span> <span class="dv">10</span><span class="op">,</span> <span class="fu">yScalerTop</span>(<span class="fu">profitFxn</span>({ <span class="dt">q</span><span class="op">:</span> <span class="dv">70</span><span class="op">,</span> <span class="dt">p</span><span class="op">:</span> params<span class="op">.</span><span class="at">p</span><span class="op">,</span> <span class="dt">fc</span><span class="op">:</span> params<span class="op">.</span><span class="at">fc</span> })) <span class="op">-</span> <span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb8-672"><a href="#cb8-672" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-673"><a href="#cb8-673" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Bottom panel /////////////////////////////////////////////////////////////////////////////////</span></span>
<span id="cb8-674"><a href="#cb8-674" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-675"><a href="#cb8-675" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> panelBottom <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb8-676"><a href="#cb8-676" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>margin<span class="op">.</span><span class="at">left</span><span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> panelHeight <span class="op">+</span> margin<span class="op">.</span><span class="at">between</span><span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb8-677"><a href="#cb8-677" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-678"><a href="#cb8-678" aria-hidden="true" tabindex="-1"></a>  panelBottom<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb8-679"><a href="#cb8-679" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clipWide<span class="op">,</span> id)</span>
<span id="cb8-680"><a href="#cb8-680" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addArea<span class="op">,</span> id<span class="op">,</span> profit<span class="op">,</span> corners)</span>
<span id="cb8-681"><a href="#cb8-681" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">select</span>(<span class="st">"path"</span>)</span>
<span id="cb8-682"><a href="#cb8-682" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> corners<span class="op">.</span><span class="at">y1</span> <span class="op">&lt;</span> corners<span class="op">.</span><span class="at">y2</span> <span class="op">?</span> <span class="st">"#7fc6a4"</span> <span class="op">:</span> <span class="st">"#f697bb"</span>)<span class="op">;</span></span>
<span id="cb8-683"><a href="#cb8-683" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-684"><a href="#cb8-684" aria-hidden="true" tabindex="-1"></a>  panelBottom<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb8-685"><a href="#cb8-685" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clip<span class="op">,</span> id)</span>
<span id="cb8-686"><a href="#cb8-686" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurveFull<span class="op">,</span> id<span class="op">,</span> avc<span class="op">,</span> params<span class="op">,</span> yScalerBottom<span class="op">,</span> gray)</span>
<span id="cb8-687"><a href="#cb8-687" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurveFull<span class="op">,</span> id<span class="op">,</span> ac<span class="op">,</span> params<span class="op">,</span> yScalerBottom<span class="op">,</span> gray)</span>
<span id="cb8-688"><a href="#cb8-688" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurve<span class="op">,</span> id<span class="op">,</span> mc<span class="op">,</span> params<span class="op">,</span> yScalerBottom)</span>
<span id="cb8-689"><a href="#cb8-689" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-690"><a href="#cb8-690" aria-hidden="true" tabindex="-1"></a>  panelBottom<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb8-691"><a href="#cb8-691" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clipWide<span class="op">,</span> id)</span>
<span id="cb8-692"><a href="#cb8-692" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(yGuide<span class="op">,</span> mr<span class="op">,</span> params<span class="op">,</span> yScalerBottom)</span>
<span id="cb8-693"><a href="#cb8-693" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurveFull<span class="op">,</span> id<span class="op">,</span> mr<span class="op">,</span> params<span class="op">,</span> yScalerBottom)</span>
<span id="cb8-694"><a href="#cb8-694" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(yGuide<span class="op">,</span> ac<span class="op">,</span> params<span class="op">,</span> yScalerBottom)<span class="op">;</span></span>
<span id="cb8-695"><a href="#cb8-695" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-696"><a href="#cb8-696" aria-hidden="true" tabindex="-1"></a>  panelBottom<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb8-697"><a href="#cb8-697" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(panelAxes<span class="op">,</span> axisTitlesBottom)</span>
<span id="cb8-698"><a href="#cb8-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-699"><a href="#cb8-699" aria-hidden="true" tabindex="-1"></a>  panelBottom<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb8-700"><a href="#cb8-700" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="vs">`labels-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb8-701"><a href="#cb8-701" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addLabel<span class="op">,</span> <span class="st">"Price"</span><span class="op">,</span> width <span class="op">+</span> <span class="dv">10</span><span class="op">,</span> <span class="fu">yScalerBottom</span>(params<span class="op">.</span><span class="at">p</span>))</span>
<span id="cb8-702"><a href="#cb8-702" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addLabel<span class="op">,</span> <span class="st">"AC"</span><span class="op">,</span> <span class="fu">xScaler</span>(<span class="dv">95</span>) <span class="op">-</span> <span class="dv">10</span><span class="op">,</span> <span class="fu">yScalerBottom</span>(<span class="fu">acFxn</span>({ <span class="dt">q</span><span class="op">:</span> <span class="dv">95</span><span class="op">,</span> <span class="dt">fc</span><span class="op">:</span> params<span class="op">.</span><span class="at">fc</span> })) <span class="op">-</span> <span class="dv">10</span><span class="op">,</span> <span class="st">"end"</span>)</span>
<span id="cb8-703"><a href="#cb8-703" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addLabel<span class="op">,</span> <span class="st">"AVC"</span><span class="op">,</span> <span class="fu">xScaler</span>(<span class="dv">95</span>) <span class="op">+</span> <span class="dv">10</span><span class="op">,</span> <span class="fu">yScalerBottom</span>(<span class="fu">avcFxn</span>({ <span class="dt">q</span><span class="op">:</span> <span class="dv">95</span> })) <span class="op">+</span> <span class="dv">10</span>)</span>
<span id="cb8-704"><a href="#cb8-704" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addLabel<span class="op">,</span> <span class="st">"MC"</span><span class="op">,</span> <span class="fu">xScaler</span>(<span class="dv">63</span>) <span class="op">+</span> <span class="dv">10</span><span class="op">,</span> <span class="fu">yScalerBottom</span>(<span class="fu">mcFxn</span>({ <span class="dt">q</span><span class="op">:</span> <span class="dv">63</span> })) <span class="op">+</span> <span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb8-705"><a href="#cb8-705" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-706"><a href="#cb8-706" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Shutdown point</span></span>
<span id="cb8-707"><a href="#cb8-707" aria-hidden="true" tabindex="-1"></a>  panelBottom<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb8-708"><a href="#cb8-708" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"circle"</span>)</span>
<span id="cb8-709"><a href="#cb8-709" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cx"</span><span class="op">,</span> <span class="fu">xScaler</span>(<span class="dv">36</span>))</span>
<span id="cb8-710"><a href="#cb8-710" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cy"</span><span class="op">,</span> <span class="fu">yScalerBottom</span>(<span class="fu">mcFxn</span>({ <span class="dt">q</span><span class="op">:</span> <span class="dv">36</span> })))</span>
<span id="cb8-711"><a href="#cb8-711" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-712"><a href="#cb8-712" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Toggle event listener ////////////////////////////////////////////////////////////////////////</span></span>
<span id="cb8-713"><a href="#cb8-713" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-714"><a href="#cb8-714" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cb <span class="op">=</span> svg<span class="op">.</span><span class="fu">select</span>(<span class="st">"foreignObject"</span>)<span class="op">.</span><span class="fu">select</span>(<span class="vs">`input#checkbox-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb8-715"><a href="#cb8-715" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-716"><a href="#cb8-716" aria-hidden="true" tabindex="-1"></a>  cb<span class="op">.</span><span class="fu">on</span>(<span class="st">"click"</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb8-717"><a href="#cb8-717" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> isChecked <span class="op">=</span> cb<span class="op">.</span><span class="fu">property</span>(<span class="st">"checked"</span>)<span class="op">;</span></span>
<span id="cb8-718"><a href="#cb8-718" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> chartLabels <span class="op">=</span> svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="vs">`g#labels-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb8-719"><a href="#cb8-719" aria-hidden="true" tabindex="-1"></a>    isChecked <span class="op">?</span> chartLabels<span class="op">.</span><span class="fu">style</span>(<span class="st">"visibility"</span><span class="op">,</span> <span class="st">"visible"</span>) <span class="op">:</span> chartLabels<span class="op">.</span><span class="fu">style</span>(<span class="st">"visibility"</span><span class="op">,</span> <span class="st">"hidden"</span>)<span class="op">;</span></span>
<span id="cb8-720"><a href="#cb8-720" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb8-721"><a href="#cb8-721" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-722"><a href="#cb8-722" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> container<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb8-723"><a href="#cb8-723" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell quarto-layout-panel" data-layout="[[1, 1], [1], [1]]">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="ojs-cell-8-1" data-nodetype="declaration">

</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="ojs-cell-8-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="ojs-cell-8-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="ojs-cell-8-4" data-nodetype="expression">

</div>
</div>
</div>
</div>
<p>The rule is that any price below the AVC curve makes zero output optimal. In these cases, each unit of output you produce cannot even pay for itself, much less your fixed costs. It is better for you to shut your business down; the point where MC and AVC intersect is known as the <span class="highlight"><strong>shutdown point</strong></span>.</p>
<p>To recap what we have established:</p>
<ol type="1">
<li>Given a price, the firm will choose the output level that corresponds to where the price line intersects with the upward-sloping region of the MC curve.</li>
<li>Negative profits can still be optimal if the price is enough to pay for average variable costs.</li>
<li>The firm will not produce anything for any price below the AVC curve.</li>
</ol>
<p>These conditions trace out our firm’s <span class="highlight"><strong>supply curve</strong></span>, which gives its optimal output decision for every conceivable price level. In the chart below, move the price slider around to see how output changes. You can also vary fixed costs to see how this does <em>not</em> affect the firm’s decision, though it does affect realized profits.</p>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9" data-startfrom="740" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 739;"><span id="cb9-740"><a href="#cb9-740" aria-hidden="true" tabindex="-1"></a>viewof p5 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> pMax]<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"Price"</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="op">.</span><span class="dv">1</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">15</span> })</span>
<span id="cb9-741"><a href="#cb9-741" aria-hidden="true" tabindex="-1"></a>viewof fc5 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> fcMax]<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"Fixed cost"</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">250</span> })</span>
<span id="cb9-742"><a href="#cb9-742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-743"><a href="#cb9-743" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb9-744"><a href="#cb9-744" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> params <span class="op">=</span> ({ <span class="dt">q</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">fc</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">p</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">c</span><span class="op">:</span> <span class="kw">null</span> })<span class="op">;</span></span>
<span id="cb9-745"><a href="#cb9-745" aria-hidden="true" tabindex="-1"></a>  params<span class="op">.</span><span class="at">p</span> <span class="op">=</span> p5<span class="op">;</span></span>
<span id="cb9-746"><a href="#cb9-746" aria-hidden="true" tabindex="-1"></a>  params<span class="op">.</span><span class="at">fc</span> <span class="op">=</span> fc5<span class="op">;</span></span>
<span id="cb9-747"><a href="#cb9-747" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-748"><a href="#cb9-748" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> qShutDown <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(<span class="op">.</span><span class="dv">56</span> <span class="op">/</span> (<span class="op">.</span><span class="bn">006</span> <span class="op">*</span> <span class="dv">2</span>))<span class="op">;</span></span>
<span id="cb9-749"><a href="#cb9-749" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> q <span class="op">=</span> (p) <span class="kw">=&gt;</span> {</span>
<span id="cb9-750"><a href="#cb9-750" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (p <span class="op">&lt;</span> <span class="fu">avcFxn</span>({ <span class="dt">q</span><span class="op">:</span> qShutDown })) <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb9-751"><a href="#cb9-751" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>((<span class="fl">1.12</span> <span class="op">+</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">pow</span>(<span class="op">.</span><span class="bn">072</span> <span class="op">*</span> p <span class="op">-</span> <span class="op">.</span><span class="dv">1856</span><span class="op">,</span> <span class="op">.</span><span class="dv">5</span>)) <span class="op">/</span> <span class="op">.</span><span class="bn">036</span>)<span class="op">;</span></span>
<span id="cb9-752"><a href="#cb9-752" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb9-753"><a href="#cb9-753" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-754"><a href="#cb9-754" aria-hidden="true" tabindex="-1"></a>  params<span class="op">.</span><span class="at">q</span> <span class="op">=</span> <span class="fu">q</span>(p5)<span class="op">;</span></span>
<span id="cb9-755"><a href="#cb9-755" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> id <span class="op">=</span> d3<span class="op">.</span><span class="fu">randomInt</span>(<span class="dv">100000</span><span class="op">,</span> <span class="dv">1000000</span>)()<span class="op">;</span></span>
<span id="cb9-756"><a href="#cb9-756" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> axisTitlesTop <span class="op">=</span> ({ <span class="dt">x</span><span class="op">:</span> <span class="st">"Output"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="st">"$"</span> })<span class="op">;</span></span>
<span id="cb9-757"><a href="#cb9-757" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> axisTitlesBottom <span class="op">=</span> ({ <span class="dt">x</span><span class="op">:</span> <span class="st">"Output"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="st">"$/unit"</span> })<span class="op">;</span></span>
<span id="cb9-758"><a href="#cb9-758" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-759"><a href="#cb9-759" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yScalerTop <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb9-760"><a href="#cb9-760" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="op">-</span><span class="dv">800</span><span class="op">,</span> <span class="dv">800</span>])</span>
<span id="cb9-761"><a href="#cb9-761" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([panelHeight<span class="op">,</span> <span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb9-762"><a href="#cb9-762" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yScalerBottom <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb9-763"><a href="#cb9-763" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="fu">acFxn</span>({ <span class="dt">q</span><span class="op">:</span> qMax<span class="op">,</span> <span class="dt">fc</span><span class="op">:</span> fcMax })])</span>
<span id="cb9-764"><a href="#cb9-764" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([panelHeight<span class="op">,</span> <span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb9-765"><a href="#cb9-765" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-766"><a href="#cb9-766" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> corners <span class="op">=</span> ({ <span class="dt">x1</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">y1</span><span class="op">:</span> <span class="fu">yScalerBottom</span>(params<span class="op">.</span><span class="at">p</span>)<span class="op">,</span> <span class="dt">x2</span><span class="op">:</span> <span class="fu">xScaler</span>(params<span class="op">.</span><span class="at">q</span>)<span class="op">,</span> <span class="dt">y2</span><span class="op">:</span> <span class="fu">yScalerBottom</span>(<span class="fu">acFxn</span>(params)) })<span class="op">;</span></span>
<span id="cb9-767"><a href="#cb9-767" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-768"><a href="#cb9-768" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> container <span class="op">=</span> d3<span class="op">.</span><span class="fu">create</span>(<span class="st">"div"</span>)</span>
<span id="cb9-769"><a href="#cb9-769" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"style"</span><span class="op">,</span> <span class="st">"display: flex; justify-content: center"</span>)<span class="op">;</span></span>
<span id="cb9-770"><a href="#cb9-770" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-771"><a href="#cb9-771" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> container<span class="op">.</span><span class="fu">append</span>(<span class="st">"svg"</span>)</span>
<span id="cb9-772"><a href="#cb9-772" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> width <span class="op">+</span> margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">right</span>)</span>
<span id="cb9-773"><a href="#cb9-773" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> height <span class="op">+</span> margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">bottom</span>)</span>
<span id="cb9-774"><a href="#cb9-774" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> width <span class="op">+</span> margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">right</span><span class="op">,</span> height <span class="op">+</span> margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">bottom</span>])</span>
<span id="cb9-775"><a href="#cb9-775" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"style"</span><span class="op">,</span> <span class="st">"max-width: 100%; height: auto; height: intrinsic;"</span>)</span>
<span id="cb9-776"><a href="#cb9-776" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(background)</span>
<span id="cb9-777"><a href="#cb9-777" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(labelsToggle<span class="op">,</span> id)<span class="op">;</span></span>
<span id="cb9-778"><a href="#cb9-778" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-779"><a href="#cb9-779" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Top panel ////////////////////////////////////////////////////////////////////////////////////</span></span>
<span id="cb9-780"><a href="#cb9-780" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-781"><a href="#cb9-781" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> panelTop <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb9-782"><a href="#cb9-782" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>margin<span class="op">.</span><span class="at">left</span><span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>margin<span class="op">.</span><span class="at">top</span><span class="sc">}</span><span class="vs">)`</span>)</span>
<span id="cb9-783"><a href="#cb9-783" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-784"><a href="#cb9-784" aria-hidden="true" tabindex="-1"></a>  panelTop<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb9-785"><a href="#cb9-785" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clipWide<span class="op">,</span> id)</span>
<span id="cb9-786"><a href="#cb9-786" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurve<span class="op">,</span> id<span class="op">,</span> profit<span class="op">,</span> params<span class="op">,</span> yScalerTop)</span>
<span id="cb9-787"><a href="#cb9-787" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(yGuide<span class="op">,</span> profit<span class="op">,</span> params<span class="op">,</span> yScalerTop)<span class="op">;</span></span>
<span id="cb9-788"><a href="#cb9-788" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-789"><a href="#cb9-789" aria-hidden="true" tabindex="-1"></a>  panelTop<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb9-790"><a href="#cb9-790" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(panelAxesT<span class="op">,</span> axisTitlesTop<span class="op">,</span> yScalerTop)</span>
<span id="cb9-791"><a href="#cb9-791" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(xGuides<span class="op">,</span> profit<span class="op">,</span> params<span class="op">,</span> yScalerTop)<span class="op">;</span></span>
<span id="cb9-792"><a href="#cb9-792" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-793"><a href="#cb9-793" aria-hidden="true" tabindex="-1"></a>  panelTop<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb9-794"><a href="#cb9-794" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="vs">`labels-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb9-795"><a href="#cb9-795" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clipWide<span class="op">,</span> id)</span>
<span id="cb9-796"><a href="#cb9-796" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addLabel<span class="op">,</span> <span class="st">"Profit"</span><span class="op">,</span> <span class="fu">xScaler</span>(<span class="dv">70</span>) <span class="op">+</span> <span class="dv">10</span><span class="op">,</span> <span class="fu">yScalerTop</span>(<span class="fu">profitFxn</span>({ <span class="dt">q</span><span class="op">:</span> <span class="dv">70</span><span class="op">,</span> <span class="dt">p</span><span class="op">:</span> params<span class="op">.</span><span class="at">p</span><span class="op">,</span> <span class="dt">fc</span><span class="op">:</span> params<span class="op">.</span><span class="at">fc</span> })) <span class="op">-</span> <span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb9-797"><a href="#cb9-797" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-798"><a href="#cb9-798" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Bottom panel /////////////////////////////////////////////////////////////////////////////////</span></span>
<span id="cb9-799"><a href="#cb9-799" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-800"><a href="#cb9-800" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> panelBottom <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb9-801"><a href="#cb9-801" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>margin<span class="op">.</span><span class="at">left</span><span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> panelHeight <span class="op">+</span> margin<span class="op">.</span><span class="at">between</span><span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb9-802"><a href="#cb9-802" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-803"><a href="#cb9-803" aria-hidden="true" tabindex="-1"></a>  panelBottom<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb9-804"><a href="#cb9-804" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clipWide<span class="op">,</span> id)</span>
<span id="cb9-805"><a href="#cb9-805" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addArea<span class="op">,</span> id<span class="op">,</span> profit<span class="op">,</span> corners)</span>
<span id="cb9-806"><a href="#cb9-806" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">select</span>(<span class="st">"path"</span>)</span>
<span id="cb9-807"><a href="#cb9-807" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> corners<span class="op">.</span><span class="at">y1</span> <span class="op">&lt;</span> corners<span class="op">.</span><span class="at">y2</span> <span class="op">?</span> <span class="st">"#7fc6a4"</span> <span class="op">:</span> <span class="st">"#f697bb"</span>)<span class="op">;</span></span>
<span id="cb9-808"><a href="#cb9-808" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-809"><a href="#cb9-809" aria-hidden="true" tabindex="-1"></a>  panelBottom<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb9-810"><a href="#cb9-810" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clip<span class="op">,</span> id)</span>
<span id="cb9-811"><a href="#cb9-811" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurveFull<span class="op">,</span> id<span class="op">,</span> avc<span class="op">,</span> params<span class="op">,</span> yScalerBottom<span class="op">,</span> gray)</span>
<span id="cb9-812"><a href="#cb9-812" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurveFull<span class="op">,</span> id<span class="op">,</span> ac<span class="op">,</span> params<span class="op">,</span> yScalerBottom<span class="op">,</span> gray)</span>
<span id="cb9-813"><a href="#cb9-813" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurveFull<span class="op">,</span> id<span class="op">,</span> mc<span class="op">,</span> params<span class="op">,</span> yScalerBottom<span class="op">,</span> gray)</span>
<span id="cb9-814"><a href="#cb9-814" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-815"><a href="#cb9-815" aria-hidden="true" tabindex="-1"></a>   panelBottom<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb9-816"><a href="#cb9-816" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clipWide<span class="op">,</span> id)</span>
<span id="cb9-817"><a href="#cb9-817" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(yGuide<span class="op">,</span> mr<span class="op">,</span> params<span class="op">,</span> yScalerBottom)</span>
<span id="cb9-818"><a href="#cb9-818" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurveFull<span class="op">,</span> id<span class="op">,</span> mr<span class="op">,</span> params<span class="op">,</span> yScalerBottom)</span>
<span id="cb9-819"><a href="#cb9-819" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurve<span class="op">,</span> id<span class="op">,</span> supply<span class="op">,</span> params<span class="op">,</span> yScalerBottom)</span>
<span id="cb9-820"><a href="#cb9-820" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(yGuide<span class="op">,</span> ac<span class="op">,</span> params<span class="op">,</span> yScalerBottom)</span>
<span id="cb9-821"><a href="#cb9-821" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-822"><a href="#cb9-822" aria-hidden="true" tabindex="-1"></a>  panelBottom<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb9-823"><a href="#cb9-823" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(panelAxes<span class="op">,</span> axisTitlesBottom)</span>
<span id="cb9-824"><a href="#cb9-824" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-825"><a href="#cb9-825" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Vertical portion of supply curve</span></span>
<span id="cb9-826"><a href="#cb9-826" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-827"><a href="#cb9-827" aria-hidden="true" tabindex="-1"></a>  panelBottom<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb9-828"><a href="#cb9-828" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>supply<span class="op">.</span><span class="at">id</span><span class="sc">}</span><span class="vs">-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb9-829"><a href="#cb9-829" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"pointer-events"</span><span class="op">,</span> <span class="st">"visibleStroke"</span>)</span>
<span id="cb9-830"><a href="#cb9-830" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clipWide<span class="op">,</span> id)</span>
<span id="cb9-831"><a href="#cb9-831" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb9-832"><a href="#cb9-832" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"curve colored"</span>)</span>
<span id="cb9-833"><a href="#cb9-833" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">line</span>([[<span class="dv">0</span><span class="op">,</span> panelHeight]<span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="fu">yScalerBottom</span>(<span class="fu">avcFxn</span>({ <span class="dt">q</span><span class="op">:</span> qShutDown }))]<span class="op">,</span> [<span class="dv">1</span><span class="op">,</span> <span class="fu">yScalerBottom</span>(<span class="fu">avcFxn</span>({ <span class="dt">q</span><span class="op">:</span> qShutDown }))]]))</span>
<span id="cb9-834"><a href="#cb9-834" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb9-835"><a href="#cb9-835" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke"</span><span class="op">,</span> blue<span class="op">.</span><span class="at">base</span>)</span>
<span id="cb9-836"><a href="#cb9-836" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke-width"</span><span class="op">,</span> strokeWidth)</span>
<span id="cb9-837"><a href="#cb9-837" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">on</span>(<span class="st">"mousemove"</span><span class="op">,</span> (<span class="bu">event</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb9-838"><a href="#cb9-838" aria-hidden="true" tabindex="-1"></a>      d3<span class="op">.</span><span class="fu">selectAll</span>(<span class="vs">`#</span><span class="sc">${</span>supply<span class="op">.</span><span class="at">id</span><span class="sc">}</span><span class="vs">-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs"> .curve`</span>)</span>
<span id="cb9-839"><a href="#cb9-839" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">transition</span>()<span class="op">.</span><span class="fu">duration</span>(<span class="dv">50</span>)</span>
<span id="cb9-840"><a href="#cb9-840" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke-width"</span><span class="op">,</span> strokeWidth <span class="op">+</span> <span class="dv">2</span>)</span>
<span id="cb9-841"><a href="#cb9-841" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke"</span><span class="op">,</span> supply<span class="op">.</span><span class="at">scheme</span><span class="op">.</span><span class="at">baseSelect</span>)<span class="op">;</span></span>
<span id="cb9-842"><a href="#cb9-842" aria-hidden="true" tabindex="-1"></a>      tooltip</span>
<span id="cb9-843"><a href="#cb9-843" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"left"</span><span class="op">,</span> <span class="bu">event</span><span class="op">.</span><span class="at">pageX</span> <span class="op">+</span> <span class="dv">18</span> <span class="op">+</span> <span class="st">"px"</span>)</span>
<span id="cb9-844"><a href="#cb9-844" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"top"</span><span class="op">,</span> <span class="bu">event</span><span class="op">.</span><span class="at">pageY</span> <span class="op">+</span> <span class="dv">18</span> <span class="op">+</span> <span class="st">"px"</span>)</span>
<span id="cb9-845"><a href="#cb9-845" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"display"</span><span class="op">,</span> <span class="st">"block"</span>)</span>
<span id="cb9-846"><a href="#cb9-846" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">text</span>(supply<span class="op">.</span><span class="at">label</span>)<span class="op">;</span></span>
<span id="cb9-847"><a href="#cb9-847" aria-hidden="true" tabindex="-1"></a>      d3<span class="op">.</span><span class="fu">select</span>(<span class="bu">event</span><span class="op">.</span><span class="at">target</span>)<span class="op">.</span><span class="fu">style</span>(<span class="st">"cursor"</span><span class="op">,</span> <span class="st">"pointer"</span>)<span class="op">;</span></span>
<span id="cb9-848"><a href="#cb9-848" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb9-849"><a href="#cb9-849" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">on</span>(<span class="st">"mouseleave"</span><span class="op">,</span> (<span class="bu">event</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb9-850"><a href="#cb9-850" aria-hidden="true" tabindex="-1"></a>      d3<span class="op">.</span><span class="fu">selectAll</span>(<span class="vs">`#</span><span class="sc">${</span>supply<span class="op">.</span><span class="at">id</span><span class="sc">}</span><span class="vs">-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs"> .curve`</span>)</span>
<span id="cb9-851"><a href="#cb9-851" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">transition</span>()<span class="op">.</span><span class="fu">duration</span>(<span class="dv">100</span>)</span>
<span id="cb9-852"><a href="#cb9-852" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke-width"</span><span class="op">,</span> strokeWidth)</span>
<span id="cb9-853"><a href="#cb9-853" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke"</span><span class="op">,</span> supply<span class="op">.</span><span class="at">scheme</span><span class="op">.</span><span class="at">base</span>)<span class="op">;</span></span>
<span id="cb9-854"><a href="#cb9-854" aria-hidden="true" tabindex="-1"></a>      tooltip<span class="op">.</span><span class="fu">style</span>(<span class="st">"display"</span><span class="op">,</span> <span class="st">"none"</span>)<span class="op">;</span></span>
<span id="cb9-855"><a href="#cb9-855" aria-hidden="true" tabindex="-1"></a>      d3<span class="op">.</span><span class="fu">select</span>(<span class="bu">event</span><span class="op">.</span><span class="at">target</span>)<span class="op">.</span><span class="fu">style</span>(<span class="st">"cursor"</span><span class="op">,</span> <span class="st">"default"</span>)<span class="op">;</span></span>
<span id="cb9-856"><a href="#cb9-856" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb9-857"><a href="#cb9-857" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-858"><a href="#cb9-858" aria-hidden="true" tabindex="-1"></a>  panelBottom<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb9-859"><a href="#cb9-859" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="vs">`labels-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb9-860"><a href="#cb9-860" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addLabel<span class="op">,</span> <span class="st">"Price"</span><span class="op">,</span> width <span class="op">+</span> <span class="dv">10</span><span class="op">,</span> <span class="fu">yScalerBottom</span>(params<span class="op">.</span><span class="at">p</span>))</span>
<span id="cb9-861"><a href="#cb9-861" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addLabel<span class="op">,</span> <span class="st">"AC"</span><span class="op">,</span> <span class="fu">xScaler</span>(<span class="dv">95</span>) <span class="op">-</span> <span class="dv">10</span><span class="op">,</span> <span class="fu">yScalerBottom</span>(<span class="fu">acFxn</span>({ <span class="dt">q</span><span class="op">:</span> <span class="dv">95</span><span class="op">,</span> <span class="dt">fc</span><span class="op">:</span> params<span class="op">.</span><span class="at">fc</span> })) <span class="op">-</span> <span class="dv">10</span><span class="op">,</span> <span class="st">"end"</span>)</span>
<span id="cb9-862"><a href="#cb9-862" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addLabel<span class="op">,</span> <span class="st">"AVC"</span><span class="op">,</span> <span class="fu">xScaler</span>(<span class="dv">95</span>) <span class="op">+</span> <span class="dv">10</span><span class="op">,</span> <span class="fu">yScalerBottom</span>(<span class="fu">avcFxn</span>({ <span class="dt">q</span><span class="op">:</span> <span class="dv">95</span> })) <span class="op">+</span> <span class="dv">10</span>)</span>
<span id="cb9-863"><a href="#cb9-863" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addLabel<span class="op">,</span> <span class="st">"Supply"</span><span class="op">,</span> <span class="fu">xScaler</span>(<span class="dv">69</span>) <span class="op">+</span> <span class="dv">5</span><span class="op">,</span> <span class="fu">yScalerBottom</span>(<span class="fu">mcFxn</span>({ <span class="dt">q</span><span class="op">:</span> <span class="dv">69</span> })) <span class="op">-</span> <span class="dv">25</span><span class="op">,</span> <span class="st">"middle"</span>)<span class="op">;</span></span>
<span id="cb9-864"><a href="#cb9-864" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-865"><a href="#cb9-865" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Toggle event listener ////////////////////////////////////////////////////////////////////////</span></span>
<span id="cb9-866"><a href="#cb9-866" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-867"><a href="#cb9-867" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cb <span class="op">=</span> svg<span class="op">.</span><span class="fu">select</span>(<span class="st">"foreignObject"</span>)<span class="op">.</span><span class="fu">select</span>(<span class="vs">`input#checkbox-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb9-868"><a href="#cb9-868" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-869"><a href="#cb9-869" aria-hidden="true" tabindex="-1"></a>  cb<span class="op">.</span><span class="fu">on</span>(<span class="st">"click"</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb9-870"><a href="#cb9-870" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> isChecked <span class="op">=</span> cb<span class="op">.</span><span class="fu">property</span>(<span class="st">"checked"</span>)<span class="op">;</span></span>
<span id="cb9-871"><a href="#cb9-871" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> chartLabels <span class="op">=</span> svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="vs">`g#labels-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb9-872"><a href="#cb9-872" aria-hidden="true" tabindex="-1"></a>    isChecked <span class="op">?</span> chartLabels<span class="op">.</span><span class="fu">style</span>(<span class="st">"visibility"</span><span class="op">,</span> <span class="st">"visible"</span>) <span class="op">:</span> chartLabels<span class="op">.</span><span class="fu">style</span>(<span class="st">"visibility"</span><span class="op">,</span> <span class="st">"hidden"</span>)<span class="op">;</span></span>
<span id="cb9-873"><a href="#cb9-873" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb9-874"><a href="#cb9-874" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-875"><a href="#cb9-875" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> container<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb9-876"><a href="#cb9-876" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell quarto-layout-panel" data-layout="[[1, 1], [1]]">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="ojs-cell-9-1" data-nodetype="declaration">

</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="ojs-cell-9-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="ojs-cell-9-3" data-nodetype="expression">

</div>
</div>
</div>
</div>
<p>In the long run, fixed costs reach zero and the AC and AVC curves converge. This would imply that profits cannot be negative in the long run — firms are either participating in the market with positive profits or else have shut down their business (use the chart above to verify). This actually extends to a broader and more surprising prediction: in the long run, profits can neither be positive nor negative. They must always be zero! <img src="../../images/pikachu.png" class="endmark img-fluid"></p>
</section>
<section id="in-the-room-the-firms-come-and-go" class="level2">
<h2 class="anchored" data-anchor-id="in-the-room-the-firms-come-and-go">In the room the firms come and go</h2>
<p>This prediction stems from the assumption that without the hindrance of fixed costs, <span class="highlight">firms can freely enter and exit the market</span>. Any market where participating firms are enjoying positive profits will attract the entry of more firms, which increases supply and drives down the price. Firms will keep entering until it makes no more economic sense to do so, which is the point when prevailing profits have reached zero. Likewise, firms will exit markets where profits are negative, reducing supply and raising prices until profits are brought to zero. The chart below depicts the long-run equilibrium for a firm in our perfectly competitive market.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10" data-startfrom="886" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 885;"><span id="cb10-886"><a href="#cb10-886" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb10-887"><a href="#cb10-887" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> params <span class="op">=</span> ({ <span class="dt">q</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">fc</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">p</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">c</span><span class="op">:</span> <span class="kw">null</span> })<span class="op">;</span></span>
<span id="cb10-888"><a href="#cb10-888" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> qShutDown <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(<span class="op">.</span><span class="dv">56</span> <span class="op">/</span> (<span class="op">.</span><span class="bn">006</span> <span class="op">*</span> <span class="dv">2</span>))<span class="op">;</span></span>
<span id="cb10-889"><a href="#cb10-889" aria-hidden="true" tabindex="-1"></a>  params<span class="op">.</span><span class="at">p</span> <span class="op">=</span> <span class="fl">6.9</span><span class="op">;</span></span>
<span id="cb10-890"><a href="#cb10-890" aria-hidden="true" tabindex="-1"></a>  params<span class="op">.</span><span class="at">fc</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb10-891"><a href="#cb10-891" aria-hidden="true" tabindex="-1"></a>  params<span class="op">.</span><span class="at">q</span> <span class="op">=</span> <span class="dv">46</span><span class="op">;</span></span>
<span id="cb10-892"><a href="#cb10-892" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> id <span class="op">=</span> d3<span class="op">.</span><span class="fu">randomInt</span>(<span class="dv">100000</span><span class="op">,</span> <span class="dv">1000000</span>)()<span class="op">;</span></span>
<span id="cb10-893"><a href="#cb10-893" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> axisTitlesTop <span class="op">=</span> ({ <span class="dt">x</span><span class="op">:</span> <span class="st">"Output"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="st">"$"</span> })<span class="op">;</span></span>
<span id="cb10-894"><a href="#cb10-894" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> axisTitlesBottom <span class="op">=</span> ({ <span class="dt">x</span><span class="op">:</span> <span class="st">"Output"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="st">"$/unit"</span> })<span class="op">;</span></span>
<span id="cb10-895"><a href="#cb10-895" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-896"><a href="#cb10-896" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yScalerTop <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb10-897"><a href="#cb10-897" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="op">-</span><span class="dv">800</span><span class="op">,</span> <span class="dv">800</span>])</span>
<span id="cb10-898"><a href="#cb10-898" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([panelHeight<span class="op">,</span> <span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb10-899"><a href="#cb10-899" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yScalerBottom <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb10-900"><a href="#cb10-900" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="fu">acFxn</span>({ <span class="dt">q</span><span class="op">:</span> qMax<span class="op">,</span> <span class="dt">fc</span><span class="op">:</span> fcMax })])</span>
<span id="cb10-901"><a href="#cb10-901" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([panelHeight<span class="op">,</span> <span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb10-902"><a href="#cb10-902" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-903"><a href="#cb10-903" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> corners <span class="op">=</span> ({ <span class="dt">x1</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">y1</span><span class="op">:</span> <span class="fu">yScalerBottom</span>(params<span class="op">.</span><span class="at">p</span>)<span class="op">,</span> <span class="dt">x2</span><span class="op">:</span> <span class="fu">xScaler</span>(params<span class="op">.</span><span class="at">q</span>)<span class="op">,</span> <span class="dt">y2</span><span class="op">:</span> <span class="fu">yScalerBottom</span>(<span class="fu">acFxn</span>(params)) })<span class="op">;</span></span>
<span id="cb10-904"><a href="#cb10-904" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-905"><a href="#cb10-905" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> container <span class="op">=</span> d3<span class="op">.</span><span class="fu">create</span>(<span class="st">"div"</span>)</span>
<span id="cb10-906"><a href="#cb10-906" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"style"</span><span class="op">,</span> <span class="st">"display: flex; justify-content: center"</span>)<span class="op">;</span></span>
<span id="cb10-907"><a href="#cb10-907" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-908"><a href="#cb10-908" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> container<span class="op">.</span><span class="fu">append</span>(<span class="st">"svg"</span>)</span>
<span id="cb10-909"><a href="#cb10-909" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> width <span class="op">+</span> margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">right</span>)</span>
<span id="cb10-910"><a href="#cb10-910" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> height <span class="op">+</span> margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">bottom</span>)</span>
<span id="cb10-911"><a href="#cb10-911" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> width <span class="op">+</span> margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">right</span><span class="op">,</span> height <span class="op">+</span> margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">bottom</span>])</span>
<span id="cb10-912"><a href="#cb10-912" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"style"</span><span class="op">,</span> <span class="st">"max-width: 100%; height: auto; height: intrinsic;"</span>)</span>
<span id="cb10-913"><a href="#cb10-913" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(background)</span>
<span id="cb10-914"><a href="#cb10-914" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(labelsToggle<span class="op">,</span> id)<span class="op">;</span></span>
<span id="cb10-915"><a href="#cb10-915" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-916"><a href="#cb10-916" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Top panel ////////////////////////////////////////////////////////////////////////////////////</span></span>
<span id="cb10-917"><a href="#cb10-917" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-918"><a href="#cb10-918" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> panelTop <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb10-919"><a href="#cb10-919" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>margin<span class="op">.</span><span class="at">left</span><span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>margin<span class="op">.</span><span class="at">top</span><span class="sc">}</span><span class="vs">)`</span>)</span>
<span id="cb10-920"><a href="#cb10-920" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-921"><a href="#cb10-921" aria-hidden="true" tabindex="-1"></a>  panelTop<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb10-922"><a href="#cb10-922" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clipWide<span class="op">,</span> id)</span>
<span id="cb10-923"><a href="#cb10-923" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurve<span class="op">,</span> id<span class="op">,</span> profit<span class="op">,</span> params<span class="op">,</span> yScalerTop)</span>
<span id="cb10-924"><a href="#cb10-924" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-925"><a href="#cb10-925" aria-hidden="true" tabindex="-1"></a>  panelTop<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb10-926"><a href="#cb10-926" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(panelAxesT<span class="op">,</span> axisTitlesTop<span class="op">,</span> yScalerTop)</span>
<span id="cb10-927"><a href="#cb10-927" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(xGuides<span class="op">,</span> profit<span class="op">,</span> params<span class="op">,</span> yScalerTop)<span class="op">;</span></span>
<span id="cb10-928"><a href="#cb10-928" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-929"><a href="#cb10-929" aria-hidden="true" tabindex="-1"></a>  panelTop<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb10-930"><a href="#cb10-930" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="vs">`labels-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb10-931"><a href="#cb10-931" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clipWide<span class="op">,</span> id)</span>
<span id="cb10-932"><a href="#cb10-932" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addLabel<span class="op">,</span> <span class="st">"Profit"</span><span class="op">,</span> <span class="fu">xScaler</span>(<span class="dv">70</span>) <span class="op">+</span> <span class="dv">10</span><span class="op">,</span> <span class="fu">yScalerTop</span>(<span class="fu">profitFxn</span>({ <span class="dt">q</span><span class="op">:</span> <span class="dv">70</span><span class="op">,</span> <span class="dt">p</span><span class="op">:</span> params<span class="op">.</span><span class="at">p</span><span class="op">,</span> <span class="dt">fc</span><span class="op">:</span> params<span class="op">.</span><span class="at">fc</span> })) <span class="op">-</span> <span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb10-933"><a href="#cb10-933" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-934"><a href="#cb10-934" aria-hidden="true" tabindex="-1"></a>  panelTop<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb10-935"><a href="#cb10-935" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb10-936"><a href="#cb10-936" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="dv">0</span>)</span>
<span id="cb10-937"><a href="#cb10-937" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb10-938"><a href="#cb10-938" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="fu">data</span>(profit<span class="op">.</span><span class="at">fxn</span><span class="op">,</span> params<span class="op">,</span> yScalerTop)[params<span class="op">.</span><span class="at">q</span>][<span class="dv">1</span>])</span>
<span id="cb10-939"><a href="#cb10-939" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"dx"</span><span class="op">,</span> <span class="op">-</span><span class="dv">10</span>)</span>
<span id="cb10-940"><a href="#cb10-940" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"end"</span>)</span>
<span id="cb10-941"><a href="#cb10-941" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"alignment-baseline"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb10-942"><a href="#cb10-942" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"black"</span>)</span>
<span id="cb10-943"><a href="#cb10-943" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">".9rem"</span>)<span class="op">;</span></span>
<span id="cb10-944"><a href="#cb10-944" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-945"><a href="#cb10-945" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Bottom panel /////////////////////////////////////////////////////////////////////////////////</span></span>
<span id="cb10-946"><a href="#cb10-946" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-947"><a href="#cb10-947" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> panelBottom <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb10-948"><a href="#cb10-948" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>margin<span class="op">.</span><span class="at">left</span><span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> panelHeight <span class="op">+</span> margin<span class="op">.</span><span class="at">between</span><span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb10-949"><a href="#cb10-949" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-950"><a href="#cb10-950" aria-hidden="true" tabindex="-1"></a>  panelBottom<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb10-951"><a href="#cb10-951" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clipWide<span class="op">,</span> id)</span>
<span id="cb10-952"><a href="#cb10-952" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addArea<span class="op">,</span> id<span class="op">,</span> profit<span class="op">,</span> corners)</span>
<span id="cb10-953"><a href="#cb10-953" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">select</span>(<span class="st">"path"</span>)</span>
<span id="cb10-954"><a href="#cb10-954" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> corners<span class="op">.</span><span class="at">y1</span> <span class="op">&lt;</span> corners<span class="op">.</span><span class="at">y2</span> <span class="op">?</span> <span class="st">"#7fc6a4"</span> <span class="op">:</span> <span class="st">"#f697bb"</span>)<span class="op">;</span></span>
<span id="cb10-955"><a href="#cb10-955" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-956"><a href="#cb10-956" aria-hidden="true" tabindex="-1"></a>  panelBottom<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb10-957"><a href="#cb10-957" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clip<span class="op">,</span> id)</span>
<span id="cb10-958"><a href="#cb10-958" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurveFull<span class="op">,</span> id<span class="op">,</span> ac<span class="op">,</span> params<span class="op">,</span> yScalerBottom<span class="op">,</span> gray)</span>
<span id="cb10-959"><a href="#cb10-959" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurveFull<span class="op">,</span> id<span class="op">,</span> mc<span class="op">,</span> params<span class="op">,</span> yScalerBottom<span class="op">,</span> gray)</span>
<span id="cb10-960"><a href="#cb10-960" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-961"><a href="#cb10-961" aria-hidden="true" tabindex="-1"></a>  panelBottom<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb10-962"><a href="#cb10-962" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clipWide<span class="op">,</span> id)</span>
<span id="cb10-963"><a href="#cb10-963" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(yGuide<span class="op">,</span> mr<span class="op">,</span> params<span class="op">,</span> yScalerBottom)</span>
<span id="cb10-964"><a href="#cb10-964" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurveFull<span class="op">,</span> id<span class="op">,</span> mr<span class="op">,</span> params<span class="op">,</span> yScalerBottom)</span>
<span id="cb10-965"><a href="#cb10-965" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurve<span class="op">,</span> id<span class="op">,</span> supply<span class="op">,</span> params<span class="op">,</span> yScalerBottom)</span>
<span id="cb10-966"><a href="#cb10-966" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-967"><a href="#cb10-967" aria-hidden="true" tabindex="-1"></a>  panelBottom<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb10-968"><a href="#cb10-968" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(panelAxes<span class="op">,</span> axisTitlesBottom)</span>
<span id="cb10-969"><a href="#cb10-969" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-970"><a href="#cb10-970" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Vertical portion of supply curve</span></span>
<span id="cb10-971"><a href="#cb10-971" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-972"><a href="#cb10-972" aria-hidden="true" tabindex="-1"></a>  panelBottom<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb10-973"><a href="#cb10-973" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>supply<span class="op">.</span><span class="at">id</span><span class="sc">}</span><span class="vs">-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb10-974"><a href="#cb10-974" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"pointer-events"</span><span class="op">,</span> <span class="st">"visibleStroke"</span>)</span>
<span id="cb10-975"><a href="#cb10-975" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clipWide<span class="op">,</span> id)</span>
<span id="cb10-976"><a href="#cb10-976" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb10-977"><a href="#cb10-977" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"curve colored"</span>)</span>
<span id="cb10-978"><a href="#cb10-978" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">line</span>([[<span class="dv">0</span><span class="op">,</span> panelHeight]<span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="fu">yScalerBottom</span>(<span class="fu">avcFxn</span>({ <span class="dt">q</span><span class="op">:</span> qShutDown }))]<span class="op">,</span> [<span class="dv">1</span><span class="op">,</span> <span class="fu">yScalerBottom</span>(<span class="fu">avcFxn</span>({ <span class="dt">q</span><span class="op">:</span> qShutDown }))]]))</span>
<span id="cb10-979"><a href="#cb10-979" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb10-980"><a href="#cb10-980" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke"</span><span class="op">,</span> blue<span class="op">.</span><span class="at">base</span>)</span>
<span id="cb10-981"><a href="#cb10-981" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke-width"</span><span class="op">,</span> strokeWidth)</span>
<span id="cb10-982"><a href="#cb10-982" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">on</span>(<span class="st">"mousemove"</span><span class="op">,</span> (<span class="bu">event</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb10-983"><a href="#cb10-983" aria-hidden="true" tabindex="-1"></a>      d3<span class="op">.</span><span class="fu">selectAll</span>(<span class="vs">`#</span><span class="sc">${</span>supply<span class="op">.</span><span class="at">id</span><span class="sc">}</span><span class="vs">-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs"> .curve`</span>)</span>
<span id="cb10-984"><a href="#cb10-984" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">transition</span>()<span class="op">.</span><span class="fu">duration</span>(<span class="dv">50</span>)</span>
<span id="cb10-985"><a href="#cb10-985" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke-width"</span><span class="op">,</span> strokeWidth <span class="op">+</span> <span class="dv">2</span>)</span>
<span id="cb10-986"><a href="#cb10-986" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke"</span><span class="op">,</span> supply<span class="op">.</span><span class="at">scheme</span><span class="op">.</span><span class="at">baseSelect</span>)<span class="op">;</span></span>
<span id="cb10-987"><a href="#cb10-987" aria-hidden="true" tabindex="-1"></a>      tooltip</span>
<span id="cb10-988"><a href="#cb10-988" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"left"</span><span class="op">,</span> <span class="bu">event</span><span class="op">.</span><span class="at">pageX</span> <span class="op">+</span> <span class="dv">18</span> <span class="op">+</span> <span class="st">"px"</span>)</span>
<span id="cb10-989"><a href="#cb10-989" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"top"</span><span class="op">,</span> <span class="bu">event</span><span class="op">.</span><span class="at">pageY</span> <span class="op">+</span> <span class="dv">18</span> <span class="op">+</span> <span class="st">"px"</span>)</span>
<span id="cb10-990"><a href="#cb10-990" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"display"</span><span class="op">,</span> <span class="st">"block"</span>)</span>
<span id="cb10-991"><a href="#cb10-991" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">text</span>(supply<span class="op">.</span><span class="at">label</span>)<span class="op">;</span></span>
<span id="cb10-992"><a href="#cb10-992" aria-hidden="true" tabindex="-1"></a>      d3<span class="op">.</span><span class="fu">select</span>(<span class="bu">event</span><span class="op">.</span><span class="at">target</span>)<span class="op">.</span><span class="fu">style</span>(<span class="st">"cursor"</span><span class="op">,</span> <span class="st">"pointer"</span>)<span class="op">;</span></span>
<span id="cb10-993"><a href="#cb10-993" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb10-994"><a href="#cb10-994" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">on</span>(<span class="st">"mouseleave"</span><span class="op">,</span> (<span class="bu">event</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb10-995"><a href="#cb10-995" aria-hidden="true" tabindex="-1"></a>      d3<span class="op">.</span><span class="fu">selectAll</span>(<span class="vs">`#</span><span class="sc">${</span>supply<span class="op">.</span><span class="at">id</span><span class="sc">}</span><span class="vs">-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs"> .curve`</span>)</span>
<span id="cb10-996"><a href="#cb10-996" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">transition</span>()<span class="op">.</span><span class="fu">duration</span>(<span class="dv">100</span>)</span>
<span id="cb10-997"><a href="#cb10-997" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke-width"</span><span class="op">,</span> strokeWidth)</span>
<span id="cb10-998"><a href="#cb10-998" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke"</span><span class="op">,</span> supply<span class="op">.</span><span class="at">scheme</span><span class="op">.</span><span class="at">base</span>)<span class="op">;</span></span>
<span id="cb10-999"><a href="#cb10-999" aria-hidden="true" tabindex="-1"></a>      tooltip<span class="op">.</span><span class="fu">style</span>(<span class="st">"display"</span><span class="op">,</span> <span class="st">"none"</span>)<span class="op">;</span></span>
<span id="cb10-1000"><a href="#cb10-1000" aria-hidden="true" tabindex="-1"></a>      d3<span class="op">.</span><span class="fu">select</span>(<span class="bu">event</span><span class="op">.</span><span class="at">target</span>)<span class="op">.</span><span class="fu">style</span>(<span class="st">"cursor"</span><span class="op">,</span> <span class="st">"default"</span>)<span class="op">;</span></span>
<span id="cb10-1001"><a href="#cb10-1001" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb10-1002"><a href="#cb10-1002" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1003"><a href="#cb10-1003" aria-hidden="true" tabindex="-1"></a>  panelBottom<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb10-1004"><a href="#cb10-1004" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="vs">`labels-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb10-1005"><a href="#cb10-1005" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addLabel<span class="op">,</span> <span class="st">"Price"</span><span class="op">,</span> width <span class="op">+</span> <span class="dv">10</span><span class="op">,</span> <span class="fu">yScalerBottom</span>(params<span class="op">.</span><span class="at">p</span>))</span>
<span id="cb10-1006"><a href="#cb10-1006" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addLabel<span class="op">,</span> <span class="st">"AC"</span><span class="op">,</span> <span class="fu">xScaler</span>(<span class="dv">95</span>) <span class="op">-</span> <span class="dv">10</span><span class="op">,</span> <span class="fu">yScalerBottom</span>(<span class="fu">acFxn</span>({ <span class="dt">q</span><span class="op">:</span> <span class="dv">95</span><span class="op">,</span> <span class="dt">fc</span><span class="op">:</span> params<span class="op">.</span><span class="at">fc</span> })) <span class="op">-</span> <span class="dv">10</span><span class="op">,</span> <span class="st">"end"</span>)</span>
<span id="cb10-1007"><a href="#cb10-1007" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addLabel<span class="op">,</span> <span class="st">"Supply"</span><span class="op">,</span> <span class="fu">xScaler</span>(<span class="dv">69</span>) <span class="op">+</span> <span class="dv">5</span><span class="op">,</span> <span class="fu">yScalerBottom</span>(<span class="fu">mcFxn</span>({ <span class="dt">q</span><span class="op">:</span> <span class="dv">69</span> })) <span class="op">-</span> <span class="dv">25</span><span class="op">,</span> <span class="st">"middle"</span>)<span class="op">;</span></span>
<span id="cb10-1008"><a href="#cb10-1008" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-1009"><a href="#cb10-1009" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Toggle event listener ////////////////////////////////////////////////////////////////////////</span></span>
<span id="cb10-1010"><a href="#cb10-1010" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-1011"><a href="#cb10-1011" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cb <span class="op">=</span> svg<span class="op">.</span><span class="fu">select</span>(<span class="st">"foreignObject"</span>)<span class="op">.</span><span class="fu">select</span>(<span class="vs">`input#checkbox-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb10-1012"><a href="#cb10-1012" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-1013"><a href="#cb10-1013" aria-hidden="true" tabindex="-1"></a>  cb<span class="op">.</span><span class="fu">on</span>(<span class="st">"click"</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb10-1014"><a href="#cb10-1014" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> isChecked <span class="op">=</span> cb<span class="op">.</span><span class="fu">property</span>(<span class="st">"checked"</span>)<span class="op">;</span></span>
<span id="cb10-1015"><a href="#cb10-1015" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> chartLabels <span class="op">=</span> svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="vs">`g#labels-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb10-1016"><a href="#cb10-1016" aria-hidden="true" tabindex="-1"></a>    isChecked <span class="op">?</span> chartLabels<span class="op">.</span><span class="fu">style</span>(<span class="st">"visibility"</span><span class="op">,</span> <span class="st">"visible"</span>) <span class="op">:</span> chartLabels<span class="op">.</span><span class="fu">style</span>(<span class="st">"visibility"</span><span class="op">,</span> <span class="st">"hidden"</span>)<span class="op">;</span></span>
<span id="cb10-1017"><a href="#cb10-1017" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb10-1018"><a href="#cb10-1018" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-1019"><a href="#cb10-1019" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> container<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb10-1020"><a href="#cb10-1020" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="ojs-cell-10" data-nodetype="expression">

</div>
</div>
</div>
<p>It’s important to clarify a couple of things with regard to interpretation. “Costs” here are understood broadly, meaning they include the wages that businessowners pay to themselves. It’s better to think of “zero” profits in a normalized sense, as in firms are not making any outsized profits relative to what firms on average can make.</p>
<p>Second, this result only applies to perfectly competitive markets, which are idealized scenarios that do not describe anything found in reality. The key assumption here is that firms are numerous enough and small enough that their actions have no influence on prevailing prices. But this seldom holds. Let’s now turn to the opposite extreme, the case where the market is dominated by just a single seller.</p>
</section>
<section id="the-only-game-in-town" class="level2">
<h2 class="anchored" data-anchor-id="the-only-game-in-town">The only game in town</h2>
<p>Facing no competitors, a <span class="highlight"><strong>monopoly</strong></span> exercises full control over its price. Of course, this doesn’t mean it can <em>force</em> people to buy its product, so there’s still an optimality decision to be made. Given its cost structure and the demand it faces, how much and at what price should it produce so as to maximize profits?</p>
<p>Let’s first look at how price-setting power can be included in our model. In the chart below, the first panel shows what we have been working with. This actually reflects a special case where the demand curve, the MR curve, and the price line all coincide, such that no matter what output level the firm operates at, demand, marginal revenue, and price will all remain the same.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11" data-startfrom="1035" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1034;"><span id="cb11-1035"><a href="#cb11-1035" aria-hidden="true" tabindex="-1"></a>viewof q6 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> qMax]<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"Output"</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">50</span> })<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="ojs-cell-11" data-nodetype="declaration">

</div>
</div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">Price-taker</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">Price-setter</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12" data-startfrom="1044" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1043;"><span id="cb12-1044"><a href="#cb12-1044" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb12-1045"><a href="#cb12-1045" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> params <span class="op">=</span> ({ <span class="dt">q</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">fc</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">p</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">c</span><span class="op">:</span> <span class="kw">null</span> })<span class="op">;</span></span>
<span id="cb12-1046"><a href="#cb12-1046" aria-hidden="true" tabindex="-1"></a>  params<span class="op">.</span><span class="at">q</span> <span class="op">=</span> q6<span class="op">;</span></span>
<span id="cb12-1047"><a href="#cb12-1047" aria-hidden="true" tabindex="-1"></a>  params<span class="op">.</span><span class="at">p</span> <span class="op">=</span> <span class="dv">15</span><span class="op">;</span></span>
<span id="cb12-1048"><a href="#cb12-1048" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> id <span class="op">=</span> d3<span class="op">.</span><span class="fu">randomInt</span>(<span class="dv">100000</span><span class="op">,</span> <span class="dv">1000000</span>)()<span class="op">;</span></span>
<span id="cb12-1049"><a href="#cb12-1049" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> axisTitles <span class="op">=</span> ({ <span class="dt">x</span><span class="op">:</span> <span class="st">"Output"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="st">"$"</span> })<span class="op">;</span></span>
<span id="cb12-1050"><a href="#cb12-1050" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1051"><a href="#cb12-1051" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yScaler <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb12-1052"><a href="#cb12-1052" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="fu">acFxn</span>({ <span class="dt">q</span><span class="op">:</span> qMax<span class="op">,</span> <span class="dt">fc</span><span class="op">:</span> fcMax })])</span>
<span id="cb12-1053"><a href="#cb12-1053" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([panelHeight<span class="op">,</span> <span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb12-1054"><a href="#cb12-1054" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-1055"><a href="#cb12-1055" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> container <span class="op">=</span> d3<span class="op">.</span><span class="fu">create</span>(<span class="st">"div"</span>)</span>
<span id="cb12-1056"><a href="#cb12-1056" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"style"</span><span class="op">,</span> <span class="st">"display: flex; justify-content: center"</span>)<span class="op">;</span></span>
<span id="cb12-1057"><a href="#cb12-1057" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb12-1058"><a href="#cb12-1058" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> container<span class="op">.</span><span class="fu">append</span>(<span class="st">"svg"</span>)</span>
<span id="cb12-1059"><a href="#cb12-1059" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> width <span class="op">+</span> margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">right</span>)</span>
<span id="cb12-1060"><a href="#cb12-1060" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> panelHeight <span class="op">+</span> margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">bottom</span>)</span>
<span id="cb12-1061"><a href="#cb12-1061" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> width <span class="op">+</span> margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">right</span><span class="op">,</span> panelHeight <span class="op">+</span> margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">bottom</span>])</span>
<span id="cb12-1062"><a href="#cb12-1062" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"style"</span><span class="op">,</span> <span class="st">"max-width: 100%; height: auto; height: intrinsic;"</span>)</span>
<span id="cb12-1063"><a href="#cb12-1063" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(background)</span>
<span id="cb12-1064"><a href="#cb12-1064" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(labelsToggle<span class="op">,</span> id)<span class="op">;</span></span>
<span id="cb12-1065"><a href="#cb12-1065" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-1066"><a href="#cb12-1066" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> panel <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb12-1067"><a href="#cb12-1067" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>margin<span class="op">.</span><span class="at">left</span><span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>margin<span class="op">.</span><span class="at">top</span><span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb12-1068"><a href="#cb12-1068" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-1069"><a href="#cb12-1069" aria-hidden="true" tabindex="-1"></a>  panel<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb12-1070"><a href="#cb12-1070" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(panelAxes<span class="op">,</span> axisTitles)</span>
<span id="cb12-1071"><a href="#cb12-1071" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(yGuide<span class="op">,</span> mr<span class="op">,</span> params<span class="op">,</span> yScaler)</span>
<span id="cb12-1072"><a href="#cb12-1072" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(xGuides<span class="op">,</span> mr<span class="op">,</span> params<span class="op">,</span> yScaler<span class="op">,</span> <span class="dv">1</span>)</span>
<span id="cb12-1073"><a href="#cb12-1073" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurve<span class="op">,</span> id<span class="op">,</span> mr<span class="op">,</span> params<span class="op">,</span> yScaler)<span class="op">;</span></span>
<span id="cb12-1074"><a href="#cb12-1074" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-1075"><a href="#cb12-1075" aria-hidden="true" tabindex="-1"></a>  panel<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb12-1076"><a href="#cb12-1076" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="vs">`labels-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb12-1077"><a href="#cb12-1077" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addLabel<span class="op">,</span> <span class="st">"Price = Demand = MR"</span><span class="op">,</span> <span class="fu">xScaler</span>(<span class="dv">55</span>)<span class="op">,</span> <span class="fu">yScaler</span>(params<span class="op">.</span><span class="at">p</span>) <span class="op">-</span> <span class="dv">20</span>)<span class="op">;</span></span>
<span id="cb12-1078"><a href="#cb12-1078" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb12-1079"><a href="#cb12-1079" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Toggle event listener ////////////////////////////////////////////////////////////////////////</span></span>
<span id="cb12-1080"><a href="#cb12-1080" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-1081"><a href="#cb12-1081" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cb <span class="op">=</span> svg<span class="op">.</span><span class="fu">select</span>(<span class="st">"foreignObject"</span>)<span class="op">.</span><span class="fu">select</span>(<span class="vs">`input#checkbox-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb12-1082"><a href="#cb12-1082" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-1083"><a href="#cb12-1083" aria-hidden="true" tabindex="-1"></a>  cb<span class="op">.</span><span class="fu">on</span>(<span class="st">"click"</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb12-1084"><a href="#cb12-1084" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> isChecked <span class="op">=</span> cb<span class="op">.</span><span class="fu">property</span>(<span class="st">"checked"</span>)<span class="op">;</span></span>
<span id="cb12-1085"><a href="#cb12-1085" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> chartLabels <span class="op">=</span> svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="vs">`g#labels-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb12-1086"><a href="#cb12-1086" aria-hidden="true" tabindex="-1"></a>    isChecked <span class="op">?</span> chartLabels<span class="op">.</span><span class="fu">style</span>(<span class="st">"visibility"</span><span class="op">,</span> <span class="st">"visible"</span>) <span class="op">:</span> chartLabels<span class="op">.</span><span class="fu">style</span>(<span class="st">"visibility"</span><span class="op">,</span> <span class="st">"hidden"</span>)<span class="op">;</span></span>
<span id="cb12-1087"><a href="#cb12-1087" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb12-1088"><a href="#cb12-1088" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-1089"><a href="#cb12-1089" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> container<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb12-1090"><a href="#cb12-1090" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="ojs-cell-12" data-nodetype="expression">

</div>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13" data-startfrom="1097" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1096;"><span id="cb13-1097"><a href="#cb13-1097" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb13-1098"><a href="#cb13-1098" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> params <span class="op">=</span> ({ <span class="dt">q</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">fc</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">p</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">c</span><span class="op">:</span> <span class="kw">null</span> })<span class="op">;</span></span>
<span id="cb13-1099"><a href="#cb13-1099" aria-hidden="true" tabindex="-1"></a>  params<span class="op">.</span><span class="at">q</span> <span class="op">=</span> q6<span class="op">;</span></span>
<span id="cb13-1100"><a href="#cb13-1100" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> p6 <span class="op">=</span> <span class="fu">demandMonoFxn</span>({ <span class="dt">q</span><span class="op">:</span> q6 })<span class="op">;</span></span>
<span id="cb13-1101"><a href="#cb13-1101" aria-hidden="true" tabindex="-1"></a>  params<span class="op">.</span><span class="at">p</span> <span class="op">=</span> p6<span class="op">;</span></span>
<span id="cb13-1102"><a href="#cb13-1102" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> id <span class="op">=</span> d3<span class="op">.</span><span class="fu">randomInt</span>(<span class="dv">100000</span><span class="op">,</span> <span class="dv">1000000</span>)()<span class="op">;</span></span>
<span id="cb13-1103"><a href="#cb13-1103" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> axisTitles <span class="op">=</span> ({ <span class="dt">x</span><span class="op">:</span> <span class="st">"Output"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="st">"$"</span> })<span class="op">;</span></span>
<span id="cb13-1104"><a href="#cb13-1104" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-1105"><a href="#cb13-1105" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yScaler <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb13-1106"><a href="#cb13-1106" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="fu">acFxn</span>({ <span class="dt">q</span><span class="op">:</span> qMax<span class="op">,</span> <span class="dt">fc</span><span class="op">:</span> fcMax })])</span>
<span id="cb13-1107"><a href="#cb13-1107" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([panelHeight<span class="op">,</span> <span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb13-1108"><a href="#cb13-1108" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-1109"><a href="#cb13-1109" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> container <span class="op">=</span> d3<span class="op">.</span><span class="fu">create</span>(<span class="st">"div"</span>)</span>
<span id="cb13-1110"><a href="#cb13-1110" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"style"</span><span class="op">,</span> <span class="st">"display: flex; justify-content: center"</span>)<span class="op">;</span></span>
<span id="cb13-1111"><a href="#cb13-1111" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-1112"><a href="#cb13-1112" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> container<span class="op">.</span><span class="fu">append</span>(<span class="st">"svg"</span>)</span>
<span id="cb13-1113"><a href="#cb13-1113" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> width <span class="op">+</span> margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">right</span>)</span>
<span id="cb13-1114"><a href="#cb13-1114" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> panelHeight <span class="op">+</span> margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">bottom</span>)</span>
<span id="cb13-1115"><a href="#cb13-1115" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> width <span class="op">+</span> margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">right</span><span class="op">,</span> panelHeight <span class="op">+</span> margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">bottom</span>])</span>
<span id="cb13-1116"><a href="#cb13-1116" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"style"</span><span class="op">,</span> <span class="st">"max-width: 100%; height: auto; height: intrinsic;"</span>)</span>
<span id="cb13-1117"><a href="#cb13-1117" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(background)</span>
<span id="cb13-1118"><a href="#cb13-1118" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(labelsToggle<span class="op">,</span> id)<span class="op">;</span></span>
<span id="cb13-1119"><a href="#cb13-1119" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-1120"><a href="#cb13-1120" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> panel <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb13-1121"><a href="#cb13-1121" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>margin<span class="op">.</span><span class="at">left</span><span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>margin<span class="op">.</span><span class="at">top</span><span class="sc">}</span><span class="vs">)`</span>)</span>
<span id="cb13-1122"><a href="#cb13-1122" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-1123"><a href="#cb13-1123" aria-hidden="true" tabindex="-1"></a>  panel<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb13-1124"><a href="#cb13-1124" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clipWide<span class="op">,</span> id)</span>
<span id="cb13-1125"><a href="#cb13-1125" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(yGuide<span class="op">,</span> mrMono<span class="op">,</span> params<span class="op">,</span> yScaler)</span>
<span id="cb13-1126"><a href="#cb13-1126" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(yGuide<span class="op">,</span> demandMono<span class="op">,</span> params<span class="op">,</span> yScaler)<span class="op">;</span></span>
<span id="cb13-1127"><a href="#cb13-1127" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-1128"><a href="#cb13-1128" aria-hidden="true" tabindex="-1"></a>  panel<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb13-1129"><a href="#cb13-1129" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clip<span class="op">,</span> id)</span>
<span id="cb13-1130"><a href="#cb13-1130" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurveFull<span class="op">,</span> id<span class="op">,</span> mr<span class="op">,</span> params<span class="op">,</span> yScaler<span class="op">,</span> gray)</span>
<span id="cb13-1131"><a href="#cb13-1131" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurve<span class="op">,</span> id<span class="op">,</span> mrMono<span class="op">,</span> params<span class="op">,</span> yScaler)</span>
<span id="cb13-1132"><a href="#cb13-1132" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurve<span class="op">,</span> id<span class="op">,</span> demandMono<span class="op">,</span> params<span class="op">,</span> yScaler)</span>
<span id="cb13-1133"><a href="#cb13-1133" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-1134"><a href="#cb13-1134" aria-hidden="true" tabindex="-1"></a>  panel<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb13-1135"><a href="#cb13-1135" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(panelAxes<span class="op">,</span> axisTitles)</span>
<span id="cb13-1136"><a href="#cb13-1136" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(xGuides<span class="op">,</span> demandMono<span class="op">,</span> params<span class="op">,</span> yScaler<span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb13-1137"><a href="#cb13-1137" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-1138"><a href="#cb13-1138" aria-hidden="true" tabindex="-1"></a>  panel<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb13-1139"><a href="#cb13-1139" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="vs">`labels-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb13-1140"><a href="#cb13-1140" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clipWide<span class="op">,</span> id)</span>
<span id="cb13-1141"><a href="#cb13-1141" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addLabel<span class="op">,</span> <span class="st">"Price"</span><span class="op">,</span> width <span class="op">+</span> <span class="dv">10</span><span class="op">,</span> <span class="fu">yScaler</span>(params<span class="op">.</span><span class="at">p</span>))</span>
<span id="cb13-1142"><a href="#cb13-1142" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addLabel<span class="op">,</span> <span class="st">"Demand"</span><span class="op">,</span> <span class="fu">xScaler</span>(<span class="dv">66</span>) <span class="op">+</span> <span class="dv">10</span><span class="op">,</span> <span class="fu">yScaler</span>(<span class="fu">demandMonoFxn</span>({ <span class="dt">q</span><span class="op">:</span> <span class="dv">66</span> })) <span class="op">-</span> <span class="dv">10</span>)</span>
<span id="cb13-1143"><a href="#cb13-1143" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addLabel<span class="op">,</span> <span class="st">"MR"</span><span class="op">,</span> <span class="fu">xScaler</span>(<span class="dv">33</span>) <span class="op">+</span> <span class="dv">10</span><span class="op">,</span> <span class="fu">yScaler</span>(<span class="fu">mrMonoFxn</span>({ <span class="dt">q</span><span class="op">:</span> <span class="dv">33</span> })) <span class="op">-</span> <span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb13-1144"><a href="#cb13-1144" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb13-1145"><a href="#cb13-1145" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Toggle event listener ////////////////////////////////////////////////////////////////////////</span></span>
<span id="cb13-1146"><a href="#cb13-1146" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-1147"><a href="#cb13-1147" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cb <span class="op">=</span> svg<span class="op">.</span><span class="fu">select</span>(<span class="st">"foreignObject"</span>)<span class="op">.</span><span class="fu">select</span>(<span class="vs">`input#checkbox-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb13-1148"><a href="#cb13-1148" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-1149"><a href="#cb13-1149" aria-hidden="true" tabindex="-1"></a>  cb<span class="op">.</span><span class="fu">on</span>(<span class="st">"click"</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb13-1150"><a href="#cb13-1150" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> isChecked <span class="op">=</span> cb<span class="op">.</span><span class="fu">property</span>(<span class="st">"checked"</span>)<span class="op">;</span></span>
<span id="cb13-1151"><a href="#cb13-1151" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> chartLabels <span class="op">=</span> svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="vs">`g#labels-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb13-1152"><a href="#cb13-1152" aria-hidden="true" tabindex="-1"></a>    isChecked <span class="op">?</span> chartLabels<span class="op">.</span><span class="fu">style</span>(<span class="st">"visibility"</span><span class="op">,</span> <span class="st">"visible"</span>) <span class="op">:</span> chartLabels<span class="op">.</span><span class="fu">style</span>(<span class="st">"visibility"</span><span class="op">,</span> <span class="st">"hidden"</span>)<span class="op">;</span></span>
<span id="cb13-1153"><a href="#cb13-1153" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb13-1154"><a href="#cb13-1154" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-1155"><a href="#cb13-1155" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> container<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb13-1156"><a href="#cb13-1156" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="ojs-cell-13" data-nodetype="expression">

</div>
</div>
</div>
</div>
</div>
</div>
<p>The second panel depicts what would happen if the firm was influential enough to affect demand. Faced with downward-sloping demand, its output decision now has an impact on price: more output depresses it, less output increases it. The MR curve is now also downward-sloping, with a rate of change that is twice as fast as demand.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
<p>Let’s now combine our new demand and MR curves with our cost curves. Take a deep breath — the chart below may look quite complicated at first. But if you’ve made it this far, you already have all the tools you need to understand it.</p>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14" data-startfrom="1170" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1169;"><span id="cb14-1170"><a href="#cb14-1170" aria-hidden="true" tabindex="-1"></a>viewof p7 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> pMax]<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"Price"</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="op">.</span><span class="dv">1</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">15</span> })</span>
<span id="cb14-1171"><a href="#cb14-1171" aria-hidden="true" tabindex="-1"></a>viewof fc7 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> fcMax]<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"Fixed cost"</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">180</span> })</span>
<span id="cb14-1172"><a href="#cb14-1172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1173"><a href="#cb14-1173" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb14-1174"><a href="#cb14-1174" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> params <span class="op">=</span> ({ <span class="dt">q</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">fc</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">p</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">c</span><span class="op">:</span> <span class="kw">null</span> })<span class="op">;</span></span>
<span id="cb14-1175"><a href="#cb14-1175" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> q <span class="op">=</span> (p) <span class="kw">=&gt;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>((<span class="dv">27</span> <span class="op">-</span> p) <span class="op">/</span> (<span class="dv">27</span><span class="op">/</span><span class="dv">95</span>))<span class="op">;</span></span>
<span id="cb14-1176"><a href="#cb14-1176" aria-hidden="true" tabindex="-1"></a>  params<span class="op">.</span><span class="at">q</span> <span class="op">=</span> <span class="fu">q</span>(p7)<span class="op">;</span></span>
<span id="cb14-1177"><a href="#cb14-1177" aria-hidden="true" tabindex="-1"></a>  params<span class="op">.</span><span class="at">p</span> <span class="op">=</span> p7<span class="op">;</span></span>
<span id="cb14-1178"><a href="#cb14-1178" aria-hidden="true" tabindex="-1"></a>  params<span class="op">.</span><span class="at">fc</span> <span class="op">=</span> fc7<span class="op">;</span></span>
<span id="cb14-1179"><a href="#cb14-1179" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-1180"><a href="#cb14-1180" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> id <span class="op">=</span> d3<span class="op">.</span><span class="fu">randomInt</span>(<span class="dv">100000</span><span class="op">,</span> <span class="dv">1000000</span>)()<span class="op">;</span></span>
<span id="cb14-1181"><a href="#cb14-1181" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> axisTitlesTop <span class="op">=</span> ({ <span class="dt">x</span><span class="op">:</span> <span class="st">"Output"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="st">"$"</span> })<span class="op">;</span></span>
<span id="cb14-1182"><a href="#cb14-1182" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> axisTitlesBottom <span class="op">=</span> ({ <span class="dt">x</span><span class="op">:</span> <span class="st">"Output"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="st">"$/unit"</span> })<span class="op">;</span></span>
<span id="cb14-1183"><a href="#cb14-1183" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-1184"><a href="#cb14-1184" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yScalerTop <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb14-1185"><a href="#cb14-1185" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="op">-</span><span class="dv">1000</span><span class="op">,</span> <span class="dv">400</span>])</span>
<span id="cb14-1186"><a href="#cb14-1186" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([panelHeight<span class="op">,</span> <span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb14-1187"><a href="#cb14-1187" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yScalerBottom <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb14-1188"><a href="#cb14-1188" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="fu">acFxn</span>({ <span class="dt">q</span><span class="op">:</span> qMax<span class="op">,</span> <span class="dt">fc</span><span class="op">:</span> fcMax })])</span>
<span id="cb14-1189"><a href="#cb14-1189" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([panelHeight<span class="op">,</span> <span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb14-1190"><a href="#cb14-1190" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-1191"><a href="#cb14-1191" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> corners <span class="op">=</span> ({ <span class="dt">x1</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">y1</span><span class="op">:</span> <span class="fu">yScalerBottom</span>(params<span class="op">.</span><span class="at">p</span>)<span class="op">,</span> <span class="dt">x2</span><span class="op">:</span> <span class="fu">xScaler</span>(params<span class="op">.</span><span class="at">q</span>)<span class="op">,</span> <span class="dt">y2</span><span class="op">:</span> <span class="fu">yScalerBottom</span>(<span class="fu">acFxn</span>(params)) })<span class="op">;</span></span>
<span id="cb14-1192"><a href="#cb14-1192" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-1193"><a href="#cb14-1193" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> container <span class="op">=</span> d3<span class="op">.</span><span class="fu">create</span>(<span class="st">"div"</span>)</span>
<span id="cb14-1194"><a href="#cb14-1194" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"style"</span><span class="op">,</span> <span class="st">"display: flex; justify-content: center"</span>)<span class="op">;</span></span>
<span id="cb14-1195"><a href="#cb14-1195" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-1196"><a href="#cb14-1196" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> container<span class="op">.</span><span class="fu">append</span>(<span class="st">"svg"</span>)</span>
<span id="cb14-1197"><a href="#cb14-1197" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> width <span class="op">+</span> margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">right</span>)</span>
<span id="cb14-1198"><a href="#cb14-1198" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> height <span class="op">+</span> margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">bottom</span>)</span>
<span id="cb14-1199"><a href="#cb14-1199" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> width <span class="op">+</span> margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">right</span><span class="op">,</span> height <span class="op">+</span> margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">bottom</span>])</span>
<span id="cb14-1200"><a href="#cb14-1200" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"style"</span><span class="op">,</span> <span class="st">"max-width: 100%; height: auto; height: intrinsic;"</span>)</span>
<span id="cb14-1201"><a href="#cb14-1201" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(background)</span>
<span id="cb14-1202"><a href="#cb14-1202" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(labelsToggle<span class="op">,</span> id)<span class="op">;</span></span>
<span id="cb14-1203"><a href="#cb14-1203" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-1204"><a href="#cb14-1204" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Top panel ////////////////////////////////////////////////////////////////////////////////////</span></span>
<span id="cb14-1205"><a href="#cb14-1205" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-1206"><a href="#cb14-1206" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> panelTop <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb14-1207"><a href="#cb14-1207" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>margin<span class="op">.</span><span class="at">left</span><span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>margin<span class="op">.</span><span class="at">top</span><span class="sc">}</span><span class="vs">)`</span>)</span>
<span id="cb14-1208"><a href="#cb14-1208" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-1209"><a href="#cb14-1209" aria-hidden="true" tabindex="-1"></a>  panelTop<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb14-1210"><a href="#cb14-1210" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clipWide<span class="op">,</span> id)</span>
<span id="cb14-1211"><a href="#cb14-1211" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurve<span class="op">,</span> id<span class="op">,</span> profitMono<span class="op">,</span> params<span class="op">,</span> yScalerTop)</span>
<span id="cb14-1212"><a href="#cb14-1212" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(yGuide<span class="op">,</span> profitMono<span class="op">,</span> params<span class="op">,</span> yScalerTop)<span class="op">;</span></span>
<span id="cb14-1213"><a href="#cb14-1213" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-1214"><a href="#cb14-1214" aria-hidden="true" tabindex="-1"></a>  panelTop<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb14-1215"><a href="#cb14-1215" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(panelAxesT<span class="op">,</span> axisTitlesTop<span class="op">,</span> yScalerTop)</span>
<span id="cb14-1216"><a href="#cb14-1216" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(xGuides<span class="op">,</span> profitMono<span class="op">,</span> params<span class="op">,</span> yScalerTop)<span class="op">;</span></span>
<span id="cb14-1217"><a href="#cb14-1217" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-1218"><a href="#cb14-1218" aria-hidden="true" tabindex="-1"></a>  panelTop<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb14-1219"><a href="#cb14-1219" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="vs">`labels-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb14-1220"><a href="#cb14-1220" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clipWide<span class="op">,</span> id)</span>
<span id="cb14-1221"><a href="#cb14-1221" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addLabel<span class="op">,</span> <span class="st">"Profit"</span><span class="op">,</span> <span class="fu">xScaler</span>(<span class="dv">70</span>) <span class="op">+</span> <span class="dv">10</span><span class="op">,</span> <span class="fu">yScalerTop</span>(<span class="fu">profitMonoFxn</span>({ <span class="dt">q</span><span class="op">:</span> <span class="dv">70</span><span class="op">,</span> <span class="dt">fc</span><span class="op">:</span> params<span class="op">.</span><span class="at">fc</span> })) <span class="op">-</span> <span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb14-1222"><a href="#cb14-1222" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-1223"><a href="#cb14-1223" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Bottom panel /////////////////////////////////////////////////////////////////////////////////</span></span>
<span id="cb14-1224"><a href="#cb14-1224" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-1225"><a href="#cb14-1225" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> panelBottom <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb14-1226"><a href="#cb14-1226" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>margin<span class="op">.</span><span class="at">left</span><span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> panelHeight <span class="op">+</span> margin<span class="op">.</span><span class="at">between</span><span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb14-1227"><a href="#cb14-1227" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-1228"><a href="#cb14-1228" aria-hidden="true" tabindex="-1"></a>  panelBottom<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb14-1229"><a href="#cb14-1229" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clipWide<span class="op">,</span> id)</span>
<span id="cb14-1230"><a href="#cb14-1230" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addArea<span class="op">,</span> id<span class="op">,</span> profitMono<span class="op">,</span> corners)</span>
<span id="cb14-1231"><a href="#cb14-1231" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">select</span>(<span class="st">"path"</span>)</span>
<span id="cb14-1232"><a href="#cb14-1232" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> corners<span class="op">.</span><span class="at">y1</span> <span class="op">&lt;</span> corners<span class="op">.</span><span class="at">y2</span> <span class="op">?</span> <span class="st">"#7fc6a4"</span> <span class="op">:</span> <span class="st">"#f697bb"</span>)<span class="op">;</span></span>
<span id="cb14-1233"><a href="#cb14-1233" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-1234"><a href="#cb14-1234" aria-hidden="true" tabindex="-1"></a>  panelBottom<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb14-1235"><a href="#cb14-1235" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clip<span class="op">,</span> id)</span>
<span id="cb14-1236"><a href="#cb14-1236" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurveFull<span class="op">,</span> id<span class="op">,</span> mr<span class="op">,</span> params<span class="op">,</span> yScalerBottom<span class="op">,</span> gray)</span>
<span id="cb14-1237"><a href="#cb14-1237" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurve<span class="op">,</span> id<span class="op">,</span> ac<span class="op">,</span> params<span class="op">,</span> yScalerBottom)</span>
<span id="cb14-1238"><a href="#cb14-1238" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurve<span class="op">,</span> id<span class="op">,</span> mc<span class="op">,</span> params<span class="op">,</span> yScalerBottom)</span>
<span id="cb14-1239"><a href="#cb14-1239" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurve<span class="op">,</span> id<span class="op">,</span> demandMono<span class="op">,</span> params<span class="op">,</span> yScalerBottom)</span>
<span id="cb14-1240"><a href="#cb14-1240" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurve<span class="op">,</span> id<span class="op">,</span> mrMono<span class="op">,</span> params<span class="op">,</span> yScalerBottom)</span>
<span id="cb14-1241"><a href="#cb14-1241" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-1242"><a href="#cb14-1242" aria-hidden="true" tabindex="-1"></a>  panelBottom<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb14-1243"><a href="#cb14-1243" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clipWide<span class="op">,</span> id)</span>
<span id="cb14-1244"><a href="#cb14-1244" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(yGuide<span class="op">,</span> ac<span class="op">,</span> params<span class="op">,</span> yScalerBottom)</span>
<span id="cb14-1245"><a href="#cb14-1245" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(yGuide<span class="op">,</span> mc<span class="op">,</span> params<span class="op">,</span> yScalerBottom)</span>
<span id="cb14-1246"><a href="#cb14-1246" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(yGuide<span class="op">,</span> mrMono<span class="op">,</span> params<span class="op">,</span> yScalerBottom)</span>
<span id="cb14-1247"><a href="#cb14-1247" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(yGuide<span class="op">,</span> demandMono<span class="op">,</span> params<span class="op">,</span> yScalerBottom)<span class="op">;</span></span>
<span id="cb14-1248"><a href="#cb14-1248" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-1249"><a href="#cb14-1249" aria-hidden="true" tabindex="-1"></a>  panelBottom<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb14-1250"><a href="#cb14-1250" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(panelAxes<span class="op">,</span> axisTitlesBottom)</span>
<span id="cb14-1251"><a href="#cb14-1251" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-1252"><a href="#cb14-1252" aria-hidden="true" tabindex="-1"></a>  panelBottom<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb14-1253"><a href="#cb14-1253" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="vs">`labels-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb14-1254"><a href="#cb14-1254" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addLabel<span class="op">,</span> <span class="st">"Price"</span><span class="op">,</span> width <span class="op">+</span> <span class="dv">10</span><span class="op">,</span> <span class="fu">yScalerBottom</span>(params<span class="op">.</span><span class="at">p</span>))</span>
<span id="cb14-1255"><a href="#cb14-1255" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addLabel<span class="op">,</span> <span class="st">"AC"</span><span class="op">,</span> <span class="fu">xScaler</span>(<span class="dv">95</span>) <span class="op">-</span> <span class="dv">10</span><span class="op">,</span> <span class="fu">yScalerBottom</span>(<span class="fu">acFxn</span>({ <span class="dt">q</span><span class="op">:</span> <span class="dv">95</span><span class="op">,</span> <span class="dt">fc</span><span class="op">:</span> params<span class="op">.</span><span class="at">fc</span> })) <span class="op">-</span> <span class="dv">10</span><span class="op">,</span> <span class="st">"end"</span>)</span>
<span id="cb14-1256"><a href="#cb14-1256" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addLabel<span class="op">,</span> <span class="st">"MC"</span><span class="op">,</span> <span class="fu">xScaler</span>(<span class="dv">63</span>) <span class="op">+</span> <span class="dv">10</span><span class="op">,</span> <span class="fu">yScalerBottom</span>(<span class="fu">mcFxn</span>({ <span class="dt">q</span><span class="op">:</span> <span class="dv">63</span> })) <span class="op">+</span> <span class="dv">10</span>)</span>
<span id="cb14-1257"><a href="#cb14-1257" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addLabel<span class="op">,</span> <span class="st">"Demand"</span><span class="op">,</span> <span class="fu">xScaler</span>(<span class="dv">84</span>) <span class="op">+</span> <span class="dv">10</span><span class="op">,</span> <span class="fu">yScalerBottom</span>(<span class="fu">demandMonoFxn</span>({ <span class="dt">q</span><span class="op">:</span> <span class="dv">84</span> })) <span class="op">-</span> <span class="dv">10</span>)</span>
<span id="cb14-1258"><a href="#cb14-1258" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addLabel<span class="op">,</span> <span class="st">"MR"</span><span class="op">,</span> <span class="fu">xScaler</span>(<span class="dv">45</span>) <span class="op">+</span> <span class="dv">10</span><span class="op">,</span> <span class="fu">yScalerBottom</span>(<span class="fu">mrMonoFxn</span>({ <span class="dt">q</span><span class="op">:</span> <span class="dv">45</span> })) <span class="op">-</span> <span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb14-1259"><a href="#cb14-1259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1260"><a href="#cb14-1260" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Toggle event listener ////////////////////////////////////////////////////////////////////////</span></span>
<span id="cb14-1261"><a href="#cb14-1261" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-1262"><a href="#cb14-1262" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cb <span class="op">=</span> svg<span class="op">.</span><span class="fu">select</span>(<span class="st">"foreignObject"</span>)<span class="op">.</span><span class="fu">select</span>(<span class="vs">`input#checkbox-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb14-1263"><a href="#cb14-1263" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-1264"><a href="#cb14-1264" aria-hidden="true" tabindex="-1"></a>  cb<span class="op">.</span><span class="fu">on</span>(<span class="st">"click"</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb14-1265"><a href="#cb14-1265" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> isChecked <span class="op">=</span> cb<span class="op">.</span><span class="fu">property</span>(<span class="st">"checked"</span>)<span class="op">;</span></span>
<span id="cb14-1266"><a href="#cb14-1266" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> chartLabels <span class="op">=</span> svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="vs">`g#labels-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb14-1267"><a href="#cb14-1267" aria-hidden="true" tabindex="-1"></a>    isChecked <span class="op">?</span> chartLabels<span class="op">.</span><span class="fu">style</span>(<span class="st">"visibility"</span><span class="op">,</span> <span class="st">"visible"</span>) <span class="op">:</span> chartLabels<span class="op">.</span><span class="fu">style</span>(<span class="st">"visibility"</span><span class="op">,</span> <span class="st">"hidden"</span>)<span class="op">;</span></span>
<span id="cb14-1268"><a href="#cb14-1268" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb14-1269"><a href="#cb14-1269" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-1270"><a href="#cb14-1270" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> container<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb14-1271"><a href="#cb14-1271" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell quarto-layout-panel" data-layout="[[1, 1], [1]]">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="ojs-cell-14-1" data-nodetype="declaration">

</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="ojs-cell-14-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="ojs-cell-14-3" data-nodetype="expression">

</div>
</div>
</div>
</div>
<p>Start by playing around with the price level. How does it affect profits? Recall that in the perfectly competitive case, we found that maximum profits are attained at the output level that equates marginal revenue with marginal cost. Can we find the same condition here? It turns out yes! Maximum profits in the monopoly case are still attained when <span class="math inline">\(MR = MC\)</span>, except this time, prices are set at the point where output meets the demand curve.</p>
<p>Here is the big difference with a monopoly: <span class="highlight">the equilibrium price is set above marginal cost</span>. Moreover, since there is no free entry and exit, there is no mechanism by which the profits of a monopoly can be brought down to zero. Barring any non-market intervention like regulation, these profits are just something monopolies can keep forever.</p>
<p>What’s wrong with all this? It’s beyond the scope of this humble blog post, but to give the broad strokes, economic theory suggests that it is socially optimal for the prices of goods and services to be set as close as possible to the marginal cost of producing those goods and services. Whenever prices are above marginal costs, there is an efficiency loss in the economy. The chart below illustrates this for the case of a monopoly. Toggle between the monopoly outcome and the social optimum to see that monopolies result in lower output at higher prices.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15" data-startfrom="1281" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1280;"><span id="cb15-1281"><a href="#cb15-1281" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb15-1282"><a href="#cb15-1282" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> params <span class="op">=</span> ({ <span class="dt">q</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">fc</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">p</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">c</span><span class="op">:</span> <span class="kw">null</span> })<span class="op">;</span></span>
<span id="cb15-1283"><a href="#cb15-1283" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> q <span class="op">=</span> (p) <span class="kw">=&gt;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>((<span class="dv">27</span> <span class="op">-</span> p) <span class="op">/</span> (<span class="dv">27</span><span class="op">/</span><span class="dv">95</span>))<span class="op">;</span></span>
<span id="cb15-1284"><a href="#cb15-1284" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> pMonopoly <span class="op">=</span> <span class="fl">15.5</span><span class="op">;</span></span>
<span id="cb15-1285"><a href="#cb15-1285" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> pCompetitive <span class="op">=</span> <span class="fl">11.5</span><span class="op">;</span></span>
<span id="cb15-1286"><a href="#cb15-1286" aria-hidden="true" tabindex="-1"></a>  params<span class="op">.</span><span class="at">fc</span> <span class="op">=</span> <span class="dv">180</span><span class="op">;</span></span>
<span id="cb15-1287"><a href="#cb15-1287" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-1288"><a href="#cb15-1288" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> id <span class="op">=</span> d3<span class="op">.</span><span class="fu">randomInt</span>(<span class="dv">100000</span><span class="op">,</span> <span class="dv">1000000</span>)()<span class="op">;</span></span>
<span id="cb15-1289"><a href="#cb15-1289" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> axisTitlesTop <span class="op">=</span> ({ <span class="dt">x</span><span class="op">:</span> <span class="st">"Output"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="st">"$"</span> })<span class="op">;</span></span>
<span id="cb15-1290"><a href="#cb15-1290" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> axisTitlesBottom <span class="op">=</span> ({ <span class="dt">x</span><span class="op">:</span> <span class="st">"Output"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="st">"$/unit"</span> })<span class="op">;</span></span>
<span id="cb15-1291"><a href="#cb15-1291" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-1292"><a href="#cb15-1292" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yScalerTop <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb15-1293"><a href="#cb15-1293" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="op">-</span><span class="dv">1000</span><span class="op">,</span> <span class="dv">400</span>])</span>
<span id="cb15-1294"><a href="#cb15-1294" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([panelHeight<span class="op">,</span> <span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb15-1295"><a href="#cb15-1295" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yScalerBottom <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb15-1296"><a href="#cb15-1296" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="fu">acFxn</span>({ <span class="dt">q</span><span class="op">:</span> qMax<span class="op">,</span> <span class="dt">fc</span><span class="op">:</span> fcMax })])</span>
<span id="cb15-1297"><a href="#cb15-1297" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([panelHeight<span class="op">,</span> <span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb15-1298"><a href="#cb15-1298" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-1299"><a href="#cb15-1299" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> container <span class="op">=</span> d3<span class="op">.</span><span class="fu">create</span>(<span class="st">"div"</span>)</span>
<span id="cb15-1300"><a href="#cb15-1300" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"style"</span><span class="op">,</span> <span class="st">"display: flex; justify-content: center"</span>)<span class="op">;</span></span>
<span id="cb15-1301"><a href="#cb15-1301" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-1302"><a href="#cb15-1302" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> container<span class="op">.</span><span class="fu">append</span>(<span class="st">"svg"</span>)</span>
<span id="cb15-1303"><a href="#cb15-1303" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> width <span class="op">+</span> margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">right</span>)</span>
<span id="cb15-1304"><a href="#cb15-1304" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> height <span class="op">+</span> margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">bottom</span>)</span>
<span id="cb15-1305"><a href="#cb15-1305" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> width <span class="op">+</span> margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">right</span><span class="op">,</span> height <span class="op">+</span> margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">bottom</span>])</span>
<span id="cb15-1306"><a href="#cb15-1306" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"style"</span><span class="op">,</span> <span class="st">"max-width: 100%; height: auto; height: intrinsic;"</span>)</span>
<span id="cb15-1307"><a href="#cb15-1307" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(background)</span>
<span id="cb15-1308"><a href="#cb15-1308" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(labelsToggle<span class="op">,</span> id)<span class="op">;</span></span>
<span id="cb15-1309"><a href="#cb15-1309" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-1310"><a href="#cb15-1310" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Top panel ////////////////////////////////////////////////////////////////////////////////////</span></span>
<span id="cb15-1311"><a href="#cb15-1311" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-1312"><a href="#cb15-1312" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> panelTop <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb15-1313"><a href="#cb15-1313" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>margin<span class="op">.</span><span class="at">left</span><span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>margin<span class="op">.</span><span class="at">top</span><span class="sc">}</span><span class="vs">)`</span>)</span>
<span id="cb15-1314"><a href="#cb15-1314" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-1315"><a href="#cb15-1315" aria-hidden="true" tabindex="-1"></a>  panelTop<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb15-1316"><a href="#cb15-1316" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clipWide<span class="op">,</span> id)</span>
<span id="cb15-1317"><a href="#cb15-1317" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurveFull<span class="op">,</span> id<span class="op">,</span> profitMono<span class="op">,</span> params<span class="op">,</span> yScalerTop)<span class="op">;</span></span>
<span id="cb15-1318"><a href="#cb15-1318" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-1319"><a href="#cb15-1319" aria-hidden="true" tabindex="-1"></a>  panelTop<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb15-1320"><a href="#cb15-1320" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(panelAxesT<span class="op">,</span> axisTitlesTop<span class="op">,</span> yScalerTop)</span>
<span id="cb15-1321"><a href="#cb15-1321" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-1322"><a href="#cb15-1322" aria-hidden="true" tabindex="-1"></a>  panelTop<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb15-1323"><a href="#cb15-1323" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="vs">`labels-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb15-1324"><a href="#cb15-1324" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clipWide<span class="op">,</span> id)</span>
<span id="cb15-1325"><a href="#cb15-1325" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addLabel<span class="op">,</span> <span class="st">"Profit"</span><span class="op">,</span> <span class="fu">xScaler</span>(<span class="dv">70</span>) <span class="op">+</span> <span class="dv">10</span><span class="op">,</span> <span class="fu">yScalerTop</span>(<span class="fu">profitMonoFxn</span>({ <span class="dt">q</span><span class="op">:</span> <span class="dv">70</span><span class="op">,</span> <span class="dt">fc</span><span class="op">:</span> params<span class="op">.</span><span class="at">fc</span> })) <span class="op">-</span> <span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb15-1326"><a href="#cb15-1326" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-1327"><a href="#cb15-1327" aria-hidden="true" tabindex="-1"></a>  panelTop<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb15-1328"><a href="#cb15-1328" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="vs">`guides-monopoly-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb15-1329"><a href="#cb15-1329" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(yGuide<span class="op">,</span> profitMono<span class="op">,</span> ({ <span class="dt">q</span><span class="op">:</span> <span class="fu">q</span>(pMonopoly)<span class="op">,</span> <span class="dt">fc</span><span class="op">:</span> <span class="dv">180</span><span class="op">,</span> <span class="dt">p</span><span class="op">:</span> pMonopoly })<span class="op">,</span> yScalerTop)</span>
<span id="cb15-1330"><a href="#cb15-1330" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(xGuides<span class="op">,</span> profitMono<span class="op">,</span> ({ <span class="dt">q</span><span class="op">:</span> <span class="fu">q</span>(pMonopoly)<span class="op">,</span> <span class="dt">fc</span><span class="op">:</span> <span class="dv">180</span><span class="op">,</span> <span class="dt">p</span><span class="op">:</span> pMonopoly })<span class="op">,</span> yScalerTop)<span class="op">;</span></span>
<span id="cb15-1331"><a href="#cb15-1331" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-1332"><a href="#cb15-1332" aria-hidden="true" tabindex="-1"></a>  panelTop<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb15-1333"><a href="#cb15-1333" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="vs">`guides-competitive-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb15-1334"><a href="#cb15-1334" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(yGuide<span class="op">,</span> profitMono<span class="op">,</span> ({ <span class="dt">q</span><span class="op">:</span> <span class="fu">q</span>(pCompetitive)<span class="op">,</span> <span class="dt">fc</span><span class="op">:</span> <span class="dv">180</span><span class="op">,</span> <span class="dt">p</span><span class="op">:</span> pCompetitive })<span class="op">,</span> yScalerTop)</span>
<span id="cb15-1335"><a href="#cb15-1335" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(xGuides<span class="op">,</span> profitMono<span class="op">,</span> ({ <span class="dt">q</span><span class="op">:</span> <span class="fu">q</span>(pCompetitive)<span class="op">,</span> <span class="dt">fc</span><span class="op">:</span> <span class="dv">180</span><span class="op">,</span> <span class="dt">p</span><span class="op">:</span> pCompetitive })<span class="op">,</span> yScalerTop)<span class="op">;</span></span>
<span id="cb15-1336"><a href="#cb15-1336" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-1337"><a href="#cb15-1337" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Bottom panel /////////////////////////////////////////////////////////////////////////////////</span></span>
<span id="cb15-1338"><a href="#cb15-1338" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-1339"><a href="#cb15-1339" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> panelBottom <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb15-1340"><a href="#cb15-1340" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>margin<span class="op">.</span><span class="at">left</span><span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> panelHeight <span class="op">+</span> margin<span class="op">.</span><span class="at">between</span><span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb15-1341"><a href="#cb15-1341" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-1342"><a href="#cb15-1342" aria-hidden="true" tabindex="-1"></a>  panelBottom<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb15-1343"><a href="#cb15-1343" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clip<span class="op">,</span> id)</span>
<span id="cb15-1344"><a href="#cb15-1344" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurveFull<span class="op">,</span> id<span class="op">,</span> mc<span class="op">,</span> params<span class="op">,</span> yScalerBottom)</span>
<span id="cb15-1345"><a href="#cb15-1345" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurveFull<span class="op">,</span> id<span class="op">,</span> demandMono<span class="op">,</span> params<span class="op">,</span> yScalerBottom)</span>
<span id="cb15-1346"><a href="#cb15-1346" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurveFull<span class="op">,</span> id<span class="op">,</span> mrMono<span class="op">,</span> params<span class="op">,</span> yScalerBottom)<span class="op">;</span></span>
<span id="cb15-1347"><a href="#cb15-1347" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-1348"><a href="#cb15-1348" aria-hidden="true" tabindex="-1"></a>  panelBottom<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb15-1349"><a href="#cb15-1349" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(panelAxes<span class="op">,</span> axisTitlesBottom)<span class="op">;</span></span>
<span id="cb15-1350"><a href="#cb15-1350" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-1351"><a href="#cb15-1351" aria-hidden="true" tabindex="-1"></a>  panelBottom<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb15-1352"><a href="#cb15-1352" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="vs">`labels-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb15-1353"><a href="#cb15-1353" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addLabel<span class="op">,</span> <span class="st">"MC"</span><span class="op">,</span> <span class="fu">xScaler</span>(<span class="dv">63</span>) <span class="op">+</span> <span class="dv">10</span><span class="op">,</span> <span class="fu">yScalerBottom</span>(<span class="fu">mcFxn</span>({ <span class="dt">q</span><span class="op">:</span> <span class="dv">63</span> })) <span class="op">+</span> <span class="dv">10</span>)</span>
<span id="cb15-1354"><a href="#cb15-1354" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addLabel<span class="op">,</span> <span class="st">"Demand"</span><span class="op">,</span> <span class="fu">xScaler</span>(<span class="dv">84</span>) <span class="op">+</span> <span class="dv">10</span><span class="op">,</span> <span class="fu">yScalerBottom</span>(<span class="fu">demandMonoFxn</span>({ <span class="dt">q</span><span class="op">:</span> <span class="dv">84</span> })) <span class="op">-</span> <span class="dv">10</span>)</span>
<span id="cb15-1355"><a href="#cb15-1355" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addLabel<span class="op">,</span> <span class="st">"MR"</span><span class="op">,</span> <span class="fu">xScaler</span>(<span class="dv">45</span>) <span class="op">+</span> <span class="dv">10</span><span class="op">,</span> <span class="fu">yScalerBottom</span>(<span class="fu">mrMonoFxn</span>({ <span class="dt">q</span><span class="op">:</span> <span class="dv">45</span> })) <span class="op">-</span> <span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb15-1356"><a href="#cb15-1356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-1357"><a href="#cb15-1357" aria-hidden="true" tabindex="-1"></a>  panelBottom<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb15-1358"><a href="#cb15-1358" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="vs">`guides-monopoly-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb15-1359"><a href="#cb15-1359" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(yGuide<span class="op">,</span> demandMono<span class="op">,</span> ({ <span class="dt">q</span><span class="op">:</span> <span class="fu">q</span>(pMonopoly)<span class="op">,</span> <span class="dt">fc</span><span class="op">:</span> <span class="dv">180</span><span class="op">,</span> <span class="dt">p</span><span class="op">:</span> pMonopoly })<span class="op">,</span> yScalerBottom)<span class="op">;</span></span>
<span id="cb15-1360"><a href="#cb15-1360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-1361"><a href="#cb15-1361" aria-hidden="true" tabindex="-1"></a>  panelBottom<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb15-1362"><a href="#cb15-1362" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="vs">`guides-competitive-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb15-1363"><a href="#cb15-1363" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(yGuide<span class="op">,</span> demandMono<span class="op">,</span> ({ <span class="dt">q</span><span class="op">:</span> <span class="fu">q</span>(pCompetitive)<span class="op">,</span> <span class="dt">fc</span><span class="op">:</span> <span class="dv">180</span><span class="op">,</span> <span class="dt">p</span><span class="op">:</span> pCompetitive })<span class="op">,</span> yScalerBottom)<span class="op">;</span></span>
<span id="cb15-1364"><a href="#cb15-1364" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-1365"><a href="#cb15-1365" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Toggle event listener ////////////////////////////////////////////////////////////////////////</span></span>
<span id="cb15-1366"><a href="#cb15-1366" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-1367"><a href="#cb15-1367" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cb <span class="op">=</span> svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"foreignObject"</span>)<span class="op">.</span><span class="fu">select</span>(<span class="vs">`input#checkbox-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb15-1368"><a href="#cb15-1368" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-1369"><a href="#cb15-1369" aria-hidden="true" tabindex="-1"></a>  cb<span class="op">.</span><span class="fu">on</span>(<span class="st">"click"</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb15-1370"><a href="#cb15-1370" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> isChecked <span class="op">=</span> cb<span class="op">.</span><span class="fu">property</span>(<span class="st">"checked"</span>)<span class="op">;</span></span>
<span id="cb15-1371"><a href="#cb15-1371" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> chartLabels <span class="op">=</span> svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="vs">`g#labels-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb15-1372"><a href="#cb15-1372" aria-hidden="true" tabindex="-1"></a>    isChecked <span class="op">?</span> chartLabels<span class="op">.</span><span class="fu">style</span>(<span class="st">"visibility"</span><span class="op">,</span> <span class="st">"visible"</span>) <span class="op">:</span> chartLabels<span class="op">.</span><span class="fu">style</span>(<span class="st">"visibility"</span><span class="op">,</span> <span class="st">"hidden"</span>)<span class="op">;</span></span>
<span id="cb15-1373"><a href="#cb15-1373" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb15-1374"><a href="#cb15-1374" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-1375"><a href="#cb15-1375" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Chart event listeners ////////////////////////////////////////////////////////////////////////</span></span>
<span id="cb15-1376"><a href="#cb15-1376" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-1377"><a href="#cb15-1377" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> checkboxMonopoly <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"foreignObject"</span>)</span>
<span id="cb15-1378"><a href="#cb15-1378" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">400</span>)</span>
<span id="cb15-1379"><a href="#cb15-1379" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span>  <span class="dv">475</span>)</span>
<span id="cb15-1380"><a href="#cb15-1380" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> <span class="dv">20</span>)</span>
<span id="cb15-1381"><a href="#cb15-1381" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> <span class="dv">20</span>)<span class="op">;</span></span>
<span id="cb15-1382"><a href="#cb15-1382" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-1383"><a href="#cb15-1383" aria-hidden="true" tabindex="-1"></a>  checkboxMonopoly<span class="op">.</span><span class="fu">append</span>(<span class="st">"xhtml:input"</span>)</span>
<span id="cb15-1384"><a href="#cb15-1384" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"type"</span><span class="op">,</span> <span class="st">"checkbox"</span>)</span>
<span id="cb15-1385"><a href="#cb15-1385" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="vs">`checkbox-monopoly-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb15-1386"><a href="#cb15-1386" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">property</span>(<span class="st">"checked"</span><span class="op">,</span> <span class="kw">true</span>)<span class="op">;</span></span>
<span id="cb15-1387"><a href="#cb15-1387" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-1388"><a href="#cb15-1388" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb15-1389"><a href="#cb15-1389" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb15-1390"><a href="#cb15-1390" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">"Monopoly outcome"</span>)</span>
<span id="cb15-1391"><a href="#cb15-1391" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">400</span> <span class="op">+</span> <span class="dv">20</span>)</span>
<span id="cb15-1392"><a href="#cb15-1392" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">475</span> <span class="op">+</span> <span class="dv">5</span>)</span>
<span id="cb15-1393"><a href="#cb15-1393" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"start"</span>)</span>
<span id="cb15-1394"><a href="#cb15-1394" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"alignment-baseline"</span><span class="op">,</span> <span class="st">"hanging"</span>)</span>
<span id="cb15-1395"><a href="#cb15-1395" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"black"</span>)<span class="op">;</span></span>
<span id="cb15-1396"><a href="#cb15-1396" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-1397"><a href="#cb15-1397" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> checkboxCompetitive <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"foreignObject"</span>)</span>
<span id="cb15-1398"><a href="#cb15-1398" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">400</span>)</span>
<span id="cb15-1399"><a href="#cb15-1399" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span>  <span class="dv">475</span> <span class="op">+</span> <span class="dv">25</span>)</span>
<span id="cb15-1400"><a href="#cb15-1400" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> <span class="dv">20</span>)</span>
<span id="cb15-1401"><a href="#cb15-1401" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> <span class="dv">20</span>)<span class="op">;</span></span>
<span id="cb15-1402"><a href="#cb15-1402" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-1403"><a href="#cb15-1403" aria-hidden="true" tabindex="-1"></a>  checkboxCompetitive<span class="op">.</span><span class="fu">append</span>(<span class="st">"xhtml:input"</span>)</span>
<span id="cb15-1404"><a href="#cb15-1404" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"type"</span><span class="op">,</span> <span class="st">"checkbox"</span>)</span>
<span id="cb15-1405"><a href="#cb15-1405" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="vs">`checkbox-competitive-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb15-1406"><a href="#cb15-1406" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">property</span>(<span class="st">"checked"</span><span class="op">,</span> <span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb15-1407"><a href="#cb15-1407" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-1408"><a href="#cb15-1408" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb15-1409"><a href="#cb15-1409" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb15-1410"><a href="#cb15-1410" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">"Social optimum"</span>)</span>
<span id="cb15-1411"><a href="#cb15-1411" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">400</span> <span class="op">+</span> <span class="dv">20</span>)</span>
<span id="cb15-1412"><a href="#cb15-1412" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">475</span> <span class="op">+</span> <span class="dv">5</span> <span class="op">+</span> <span class="dv">25</span>)</span>
<span id="cb15-1413"><a href="#cb15-1413" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"start"</span>)</span>
<span id="cb15-1414"><a href="#cb15-1414" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"alignment-baseline"</span><span class="op">,</span> <span class="st">"hanging"</span>)</span>
<span id="cb15-1415"><a href="#cb15-1415" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"black"</span>)<span class="op">;</span></span>
<span id="cb15-1416"><a href="#cb15-1416" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-1417"><a href="#cb15-1417" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cbMonopoly <span class="op">=</span> svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"foreignObject"</span>)<span class="op">.</span><span class="fu">select</span>(<span class="vs">`input#checkbox-monopoly-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb15-1418"><a href="#cb15-1418" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cbCompetitive <span class="op">=</span> svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"foreignObject"</span>)<span class="op">.</span><span class="fu">select</span>(<span class="vs">`input#checkbox-competitive-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb15-1419"><a href="#cb15-1419" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="vs">`g#guides-competitive-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)<span class="op">.</span><span class="fu">style</span>(<span class="st">"visibility"</span><span class="op">,</span> <span class="st">"hidden"</span>)<span class="op">;</span></span>
<span id="cb15-1420"><a href="#cb15-1420" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-1421"><a href="#cb15-1421" aria-hidden="true" tabindex="-1"></a>  cbMonopoly<span class="op">.</span><span class="fu">on</span>(<span class="st">"click"</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb15-1422"><a href="#cb15-1422" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> isChecked <span class="op">=</span> cbMonopoly<span class="op">.</span><span class="fu">property</span>(<span class="st">"checked"</span>)<span class="op">;</span></span>
<span id="cb15-1423"><a href="#cb15-1423" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> guidesMonopoly <span class="op">=</span> svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="vs">`g#guides-monopoly-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb15-1424"><a href="#cb15-1424" aria-hidden="true" tabindex="-1"></a>    isChecked <span class="op">?</span> guidesMonopoly<span class="op">.</span><span class="fu">style</span>(<span class="st">"visibility"</span><span class="op">,</span> <span class="st">"visible"</span>) <span class="op">:</span> guidesMonopoly<span class="op">.</span><span class="fu">style</span>(<span class="st">"visibility"</span><span class="op">,</span> <span class="st">"hidden"</span>)<span class="op">;</span></span>
<span id="cb15-1425"><a href="#cb15-1425" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb15-1426"><a href="#cb15-1426" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-1427"><a href="#cb15-1427" aria-hidden="true" tabindex="-1"></a>  cbCompetitive<span class="op">.</span><span class="fu">on</span>(<span class="st">"click"</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb15-1428"><a href="#cb15-1428" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> isChecked <span class="op">=</span> cbCompetitive<span class="op">.</span><span class="fu">property</span>(<span class="st">"checked"</span>)<span class="op">;</span></span>
<span id="cb15-1429"><a href="#cb15-1429" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> guidesCompetitive <span class="op">=</span> svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="vs">`g#guides-competitive-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb15-1430"><a href="#cb15-1430" aria-hidden="true" tabindex="-1"></a>    isChecked <span class="op">?</span> guidesCompetitive<span class="op">.</span><span class="fu">style</span>(<span class="st">"visibility"</span><span class="op">,</span> <span class="st">"visible"</span>) <span class="op">:</span> guidesCompetitive<span class="op">.</span><span class="fu">style</span>(<span class="st">"visibility"</span><span class="op">,</span> <span class="st">"hidden"</span>)<span class="op">;</span></span>
<span id="cb15-1431"><a href="#cb15-1431" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb15-1432"><a href="#cb15-1432" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-1433"><a href="#cb15-1433" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> container<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb15-1434"><a href="#cb15-1434" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="ojs-cell-15" data-nodetype="expression">

</div>
</div>
</div>
<p>Just as with with perfect competition, complete monopolies are extremely rare in the real world. Barring natural monopolies like transport terminals and utilities, it’s near impossible for a firm to control the production of a good so exclusively that no one else can sell anything even remotely similar. It’s more often the case that a firm has a monopoly on a brand, but not on a product. While it’s true that Apple has a monopoly on selling the iPhone, it doesn’t have a monopoly on smartphones in general. Or to take a more topical example, the <a href="https://www.polygon.com/23546288/microsoft-activision-blizzard-acquisition-deal-merger-ftc-latest-news">proposed acquisition by Microsoft of Activision Blizzard</a> has raised alarm bells over the monopolization of the video game industry, but while the new entity would control several popular franchises, the video game market in general would still have plenty of sellers.</p>
<p>This cross between perfect competition and monopolies is its own class of market structure called <span class="highlight"><strong>monopolistic competition</strong></span>. Its defining trait is that while each firm holds a monopoly over its product, the product itself is substitutable to varying degrees with similar products made by other firms. Firms are free to enter and exit the market for the product class. This has wide application to many of the industries we as consumers care about: smartphones, search engines, streaming services, clothes, appliances, and so on.</p>
<p>Monopolistic competition is easy to incorporate in our model of the monopoly. All the curves will remain the same; the only difference is that in the long run, the entry of new firms in a profitable monopolistic market will diminish the demand our monopolist faces. As with perfect competition, this entry will go on until the monopoly’s profits dwindle to zero. Try it yourself by sliding the market size down in the chart below.</p>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16" data-startfrom="1448" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1447;"><span id="cb16-1448"><a href="#cb16-1448" aria-hidden="true" tabindex="-1"></a>viewof demandCoef <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">16.8</span><span class="op">,</span> <span class="dv">25</span>]<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"Market size"</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="op">.</span><span class="dv">1</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">27</span> })</span>
<span id="cb16-1449"><a href="#cb16-1449" aria-hidden="true" tabindex="-1"></a>viewof fc8 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> fcMax]<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"Fixed cost"</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">disabled</span><span class="op">:</span> <span class="kw">true</span> })</span>
<span id="cb16-1450"><a href="#cb16-1450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1451"><a href="#cb16-1451" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb16-1452"><a href="#cb16-1452" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> params <span class="op">=</span> ({ <span class="dt">q</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">fc</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">p</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">c</span><span class="op">:</span> <span class="kw">null</span> })<span class="op">;</span></span>
<span id="cb16-1453"><a href="#cb16-1453" aria-hidden="true" tabindex="-1"></a>  params<span class="op">.</span><span class="at">fc</span> <span class="op">=</span> fc8<span class="op">;</span></span>
<span id="cb16-1454"><a href="#cb16-1454" aria-hidden="true" tabindex="-1"></a>  params<span class="op">.</span><span class="at">c</span> <span class="op">=</span> demandCoef<span class="op">;</span></span>
<span id="cb16-1455"><a href="#cb16-1455" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-1456"><a href="#cb16-1456" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> b <span class="op">=</span> <span class="dv">54</span><span class="op">/</span><span class="dv">95</span> <span class="op">-</span> <span class="fl">1.12</span><span class="op">;</span></span>
<span id="cb16-1457"><a href="#cb16-1457" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> qFxn <span class="op">=</span> ({ c }) <span class="kw">=&gt;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>( (<span class="dv">1</span><span class="op">/.</span><span class="bn">036</span>) <span class="op">*</span> (<span class="op">-</span>b <span class="op">+</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">pow</span>( <span class="bu">Math</span><span class="op">.</span><span class="fu">pow</span>(b<span class="op">,</span> <span class="dv">2</span>) <span class="op">-</span> <span class="fl">1.44</span> <span class="op">+</span> <span class="op">.</span><span class="bn">072</span> <span class="op">*</span> c<span class="op">,</span> <span class="op">.</span><span class="dv">5</span> ) ) )<span class="op">;</span></span>
<span id="cb16-1458"><a href="#cb16-1458" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> demandMonoCompFxn <span class="op">=</span> ({ q<span class="op">,</span> c } <span class="op">=</span> {}) <span class="kw">=&gt;</span> c <span class="op">-</span> (<span class="dv">27</span><span class="op">/</span><span class="dv">95</span>) <span class="op">*</span> q<span class="op">;</span></span>
<span id="cb16-1459"><a href="#cb16-1459" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> mrMonoCompFxn <span class="op">=</span> ({ q<span class="op">,</span> c } <span class="op">=</span> {}) <span class="kw">=&gt;</span> c <span class="op">-</span> <span class="dv">2</span> <span class="op">*</span> (<span class="dv">27</span><span class="op">/</span><span class="dv">95</span>) <span class="op">*</span> q<span class="op">;</span></span>
<span id="cb16-1460"><a href="#cb16-1460" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> profitMonoCompFxn <span class="op">=</span> ({ q<span class="op">,</span> fc<span class="op">,</span> c } <span class="op">=</span> {}) <span class="kw">=&gt;</span> {</span>
<span id="cb16-1461"><a href="#cb16-1461" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">ceil</span>(<span class="fu">demandMonoCompFxn</span>({ q<span class="op">,</span> c }) <span class="op">*</span> q <span class="op">-</span> <span class="fu">costFxn</span>({ q<span class="op">,</span> fc }))<span class="op">;</span></span>
<span id="cb16-1462"><a href="#cb16-1462" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-1463"><a href="#cb16-1463" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> p <span class="op">=</span> ({ q<span class="op">,</span> c }) <span class="kw">=&gt;</span> <span class="fu">demandMonoCompFxn</span>({ <span class="dt">q</span><span class="op">:</span> <span class="fu">qFxn</span>({ <span class="dt">c</span><span class="op">:</span> params<span class="op">.</span><span class="at">c</span> })<span class="op">,</span> <span class="dt">c</span><span class="op">:</span> params<span class="op">.</span><span class="at">c</span> })<span class="op">;</span></span>
<span id="cb16-1464"><a href="#cb16-1464" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-1465"><a href="#cb16-1465" aria-hidden="true" tabindex="-1"></a>  params<span class="op">.</span><span class="at">q</span> <span class="op">=</span> <span class="fu">qFxn</span>({ <span class="dt">c</span><span class="op">:</span> params<span class="op">.</span><span class="at">c</span> })<span class="op">;</span></span>
<span id="cb16-1466"><a href="#cb16-1466" aria-hidden="true" tabindex="-1"></a>  params<span class="op">.</span><span class="at">p</span> <span class="op">=</span> <span class="fu">p</span>({ <span class="dt">q</span><span class="op">:</span> <span class="fu">qFxn</span>({ <span class="dt">c</span><span class="op">:</span> params<span class="op">.</span><span class="at">c</span> })<span class="op">,</span> <span class="dt">c</span><span class="op">:</span> params<span class="op">.</span><span class="at">c</span> })<span class="op">;</span></span>
<span id="cb16-1467"><a href="#cb16-1467" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-1468"><a href="#cb16-1468" aria-hidden="true" tabindex="-1"></a>  demandMonoComp<span class="op">.</span><span class="at">fxn</span> <span class="op">=</span> demandMonoCompFxn<span class="op">;</span></span>
<span id="cb16-1469"><a href="#cb16-1469" aria-hidden="true" tabindex="-1"></a>  mrMonoComp<span class="op">.</span><span class="at">fxn</span> <span class="op">=</span> mrMonoCompFxn<span class="op">;</span></span>
<span id="cb16-1470"><a href="#cb16-1470" aria-hidden="true" tabindex="-1"></a>  profitMonoComp<span class="op">.</span><span class="at">fxn</span> <span class="op">=</span> profitMonoCompFxn<span class="op">;</span></span>
<span id="cb16-1471"><a href="#cb16-1471" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-1472"><a href="#cb16-1472" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> id <span class="op">=</span> d3<span class="op">.</span><span class="fu">randomInt</span>(<span class="dv">100000</span><span class="op">,</span> <span class="dv">1000000</span>)()<span class="op">;</span></span>
<span id="cb16-1473"><a href="#cb16-1473" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> axisTitlesTop <span class="op">=</span> ({ <span class="dt">x</span><span class="op">:</span> <span class="st">"Output"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="st">"$"</span> })<span class="op">;</span></span>
<span id="cb16-1474"><a href="#cb16-1474" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> axisTitlesBottom <span class="op">=</span> ({ <span class="dt">x</span><span class="op">:</span> <span class="st">"Output"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="st">"$/unit"</span> })<span class="op">;</span></span>
<span id="cb16-1475"><a href="#cb16-1475" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-1476"><a href="#cb16-1476" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yScalerTop <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb16-1477"><a href="#cb16-1477" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="op">-</span><span class="dv">1000</span><span class="op">,</span> <span class="dv">400</span>])</span>
<span id="cb16-1478"><a href="#cb16-1478" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([panelHeight<span class="op">,</span> <span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb16-1479"><a href="#cb16-1479" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yScalerBottom <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb16-1480"><a href="#cb16-1480" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="fu">acFxn</span>({ <span class="dt">q</span><span class="op">:</span> qMax<span class="op">,</span> <span class="dt">fc</span><span class="op">:</span> fcMax })])</span>
<span id="cb16-1481"><a href="#cb16-1481" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([panelHeight<span class="op">,</span> <span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb16-1482"><a href="#cb16-1482" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-1483"><a href="#cb16-1483" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> demandMonoCompInvFxn <span class="op">=</span> ({ dmd<span class="op">,</span> c } <span class="op">=</span> {}) <span class="kw">=&gt;</span> (<span class="dv">95</span><span class="op">/</span><span class="dv">27</span>) <span class="op">*</span> (c <span class="op">-</span> dmd)<span class="op">;</span></span>
<span id="cb16-1484"><a href="#cb16-1484" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> mrMonoCompInvFxn <span class="op">=</span> ({ mr<span class="op">,</span> c } <span class="op">=</span> {}) <span class="kw">=&gt;</span> (<span class="dv">95</span><span class="op">/</span>(<span class="dv">27</span><span class="op">*</span><span class="dv">2</span>)) <span class="op">*</span> (c <span class="op">-</span> mr)<span class="op">;</span></span>
<span id="cb16-1485"><a href="#cb16-1485" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> corners <span class="op">=</span> ({ <span class="dt">x1</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">y1</span><span class="op">:</span> <span class="fu">yScalerBottom</span>(params<span class="op">.</span><span class="at">p</span>)<span class="op">,</span> <span class="dt">x2</span><span class="op">:</span> <span class="fu">xScaler</span>(params<span class="op">.</span><span class="at">q</span>)<span class="op">,</span> <span class="dt">y2</span><span class="op">:</span> <span class="fu">yScalerBottom</span>(<span class="fu">acFxn</span>(params)) })<span class="op">;</span></span>
<span id="cb16-1486"><a href="#cb16-1486" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-1487"><a href="#cb16-1487" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> container <span class="op">=</span> d3<span class="op">.</span><span class="fu">create</span>(<span class="st">"div"</span>)</span>
<span id="cb16-1488"><a href="#cb16-1488" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"style"</span><span class="op">,</span> <span class="st">"display: flex; justify-content: center"</span>)<span class="op">;</span></span>
<span id="cb16-1489"><a href="#cb16-1489" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-1490"><a href="#cb16-1490" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> container<span class="op">.</span><span class="fu">append</span>(<span class="st">"svg"</span>)</span>
<span id="cb16-1491"><a href="#cb16-1491" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> width <span class="op">+</span> margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">right</span>)</span>
<span id="cb16-1492"><a href="#cb16-1492" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> height <span class="op">+</span> margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">bottom</span>)</span>
<span id="cb16-1493"><a href="#cb16-1493" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> width <span class="op">+</span> margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">right</span><span class="op">,</span> height <span class="op">+</span> margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">bottom</span>])</span>
<span id="cb16-1494"><a href="#cb16-1494" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"style"</span><span class="op">,</span> <span class="st">"max-width: 100%; height: auto; height: intrinsic;"</span>)</span>
<span id="cb16-1495"><a href="#cb16-1495" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(background)</span>
<span id="cb16-1496"><a href="#cb16-1496" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(labelsToggle<span class="op">,</span> id)<span class="op">;</span></span>
<span id="cb16-1497"><a href="#cb16-1497" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-1498"><a href="#cb16-1498" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Top panel ////////////////////////////////////////////////////////////////////////////////////</span></span>
<span id="cb16-1499"><a href="#cb16-1499" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-1500"><a href="#cb16-1500" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> panelTop <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb16-1501"><a href="#cb16-1501" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>margin<span class="op">.</span><span class="at">left</span><span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>margin<span class="op">.</span><span class="at">top</span><span class="sc">}</span><span class="vs">)`</span>)</span>
<span id="cb16-1502"><a href="#cb16-1502" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-1503"><a href="#cb16-1503" aria-hidden="true" tabindex="-1"></a>  panelTop<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb16-1504"><a href="#cb16-1504" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clipWide<span class="op">,</span> id)</span>
<span id="cb16-1505"><a href="#cb16-1505" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurve<span class="op">,</span> id<span class="op">,</span> profitMonoComp<span class="op">,</span> params<span class="op">,</span> yScalerTop)</span>
<span id="cb16-1506"><a href="#cb16-1506" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(yGuide<span class="op">,</span> profitMonoComp<span class="op">,</span> params<span class="op">,</span> yScalerTop)<span class="op">;</span></span>
<span id="cb16-1507"><a href="#cb16-1507" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-1508"><a href="#cb16-1508" aria-hidden="true" tabindex="-1"></a>  panelTop<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb16-1509"><a href="#cb16-1509" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(panelAxesT<span class="op">,</span> axisTitlesTop<span class="op">,</span> yScalerTop)</span>
<span id="cb16-1510"><a href="#cb16-1510" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(xGuides<span class="op">,</span> profitMonoComp<span class="op">,</span> params<span class="op">,</span> yScalerTop)<span class="op">;</span></span>
<span id="cb16-1511"><a href="#cb16-1511" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-1512"><a href="#cb16-1512" aria-hidden="true" tabindex="-1"></a>  panelTop<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb16-1513"><a href="#cb16-1513" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="vs">`labels-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb16-1514"><a href="#cb16-1514" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clipWide<span class="op">,</span> id)</span>
<span id="cb16-1515"><a href="#cb16-1515" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addLabel<span class="op">,</span> <span class="st">"Profit"</span><span class="op">,</span> <span class="fu">xScaler</span>(<span class="dv">70</span>) <span class="op">+</span> <span class="dv">10</span><span class="op">,</span> <span class="fu">yScalerTop</span>(<span class="fu">profitMonoCompFxn</span>({ <span class="dt">q</span><span class="op">:</span> <span class="dv">70</span><span class="op">,</span> <span class="dt">fc</span><span class="op">:</span> params<span class="op">.</span><span class="at">fc</span><span class="op">,</span> <span class="dt">c</span><span class="op">:</span> params<span class="op">.</span><span class="at">c</span> })) <span class="op">-</span> <span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb16-1516"><a href="#cb16-1516" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-1517"><a href="#cb16-1517" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Bottom panel /////////////////////////////////////////////////////////////////////////////////</span></span>
<span id="cb16-1518"><a href="#cb16-1518" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-1519"><a href="#cb16-1519" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> panelBottom <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb16-1520"><a href="#cb16-1520" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>margin<span class="op">.</span><span class="at">left</span><span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> panelHeight <span class="op">+</span> margin<span class="op">.</span><span class="at">between</span><span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb16-1521"><a href="#cb16-1521" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-1522"><a href="#cb16-1522" aria-hidden="true" tabindex="-1"></a>  panelBottom<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb16-1523"><a href="#cb16-1523" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clipWide<span class="op">,</span> id)</span>
<span id="cb16-1524"><a href="#cb16-1524" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addArea<span class="op">,</span> id<span class="op">,</span> profitMono<span class="op">,</span> corners)</span>
<span id="cb16-1525"><a href="#cb16-1525" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">select</span>(<span class="st">"path"</span>)</span>
<span id="cb16-1526"><a href="#cb16-1526" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> corners<span class="op">.</span><span class="at">y1</span> <span class="op">&lt;</span> corners<span class="op">.</span><span class="at">y2</span> <span class="op">?</span> <span class="st">"#7fc6a4"</span> <span class="op">:</span> <span class="st">"#f697bb"</span>)<span class="op">;</span></span>
<span id="cb16-1527"><a href="#cb16-1527" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-1528"><a href="#cb16-1528" aria-hidden="true" tabindex="-1"></a>  panelBottom<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb16-1529"><a href="#cb16-1529" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clip<span class="op">,</span> id)</span>
<span id="cb16-1530"><a href="#cb16-1530" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurveFull<span class="op">,</span> id<span class="op">,</span> price<span class="op">,</span> params<span class="op">,</span> yScalerBottom<span class="op">,</span> gray)</span>
<span id="cb16-1531"><a href="#cb16-1531" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurve<span class="op">,</span> id<span class="op">,</span> ac<span class="op">,</span> params<span class="op">,</span> yScalerBottom)</span>
<span id="cb16-1532"><a href="#cb16-1532" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurve<span class="op">,</span> id<span class="op">,</span> mc<span class="op">,</span> params<span class="op">,</span> yScalerBottom)</span>
<span id="cb16-1533"><a href="#cb16-1533" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurve<span class="op">,</span> id<span class="op">,</span> demandMonoComp<span class="op">,</span> params<span class="op">,</span> yScalerBottom)</span>
<span id="cb16-1534"><a href="#cb16-1534" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addCurve<span class="op">,</span> id<span class="op">,</span> mrMonoComp<span class="op">,</span> params<span class="op">,</span> yScalerBottom)</span>
<span id="cb16-1535"><a href="#cb16-1535" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-1536"><a href="#cb16-1536" aria-hidden="true" tabindex="-1"></a>  panelBottom<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb16-1537"><a href="#cb16-1537" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(clipWide<span class="op">,</span> id)</span>
<span id="cb16-1538"><a href="#cb16-1538" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(yGuide<span class="op">,</span> ac<span class="op">,</span> params<span class="op">,</span> yScalerBottom)</span>
<span id="cb16-1539"><a href="#cb16-1539" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(yGuide<span class="op">,</span> demandMonoComp<span class="op">,</span> params<span class="op">,</span> yScalerBottom)<span class="op">;</span></span>
<span id="cb16-1540"><a href="#cb16-1540" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-1541"><a href="#cb16-1541" aria-hidden="true" tabindex="-1"></a>  panelBottom<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb16-1542"><a href="#cb16-1542" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(panelAxes<span class="op">,</span> axisTitlesBottom)</span>
<span id="cb16-1543"><a href="#cb16-1543" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-1544"><a href="#cb16-1544" aria-hidden="true" tabindex="-1"></a>  panelBottom<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb16-1545"><a href="#cb16-1545" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="vs">`labels-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb16-1546"><a href="#cb16-1546" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addLabel<span class="op">,</span> <span class="st">"Price"</span><span class="op">,</span> width <span class="op">+</span> <span class="dv">10</span><span class="op">,</span> <span class="fu">yScalerBottom</span>(params<span class="op">.</span><span class="at">p</span>))</span>
<span id="cb16-1547"><a href="#cb16-1547" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addLabel<span class="op">,</span> <span class="st">"AC"</span><span class="op">,</span> <span class="fu">xScaler</span>(<span class="dv">95</span>) <span class="op">-</span> <span class="dv">10</span><span class="op">,</span> <span class="fu">yScalerBottom</span>(<span class="fu">acFxn</span>({ <span class="dt">q</span><span class="op">:</span> <span class="dv">95</span><span class="op">,</span> <span class="dt">fc</span><span class="op">:</span> params<span class="op">.</span><span class="at">fc</span> })) <span class="op">-</span> <span class="dv">10</span><span class="op">,</span> <span class="st">"end"</span>)</span>
<span id="cb16-1548"><a href="#cb16-1548" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addLabel<span class="op">,</span> <span class="st">"MC"</span><span class="op">,</span> <span class="fu">xScaler</span>(<span class="dv">63</span>) <span class="op">+</span> <span class="dv">10</span><span class="op">,</span> <span class="fu">yScalerBottom</span>(<span class="fu">mcFxn</span>({ <span class="dt">q</span><span class="op">:</span> <span class="dv">63</span> })) <span class="op">+</span> <span class="dv">10</span>)</span>
<span id="cb16-1549"><a href="#cb16-1549" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addLabel<span class="op">,</span> <span class="st">"Demand"</span><span class="op">,</span> <span class="fu">xScaler</span>(<span class="fu">demandMonoCompInvFxn</span>({ <span class="dt">dmd</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">c</span><span class="op">:</span> params<span class="op">.</span><span class="at">c</span>})) <span class="op">+</span> <span class="dv">10</span><span class="op">,</span> <span class="fu">yScalerBottom</span>(<span class="dv">1</span>) <span class="op">-</span> <span class="dv">10</span>)</span>
<span id="cb16-1550"><a href="#cb16-1550" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(addLabel<span class="op">,</span> <span class="st">"MR"</span><span class="op">,</span> <span class="fu">xScaler</span>(<span class="fu">mrMonoCompInvFxn</span>({ <span class="dt">mr</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">c</span><span class="op">:</span> params<span class="op">.</span><span class="at">c</span> })) <span class="op">+</span> <span class="dv">10</span><span class="op">,</span> <span class="fu">yScalerBottom</span>(<span class="dv">1</span>) <span class="op">-</span> <span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb16-1551"><a href="#cb16-1551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1552"><a href="#cb16-1552" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Toggle event listener ////////////////////////////////////////////////////////////////////////</span></span>
<span id="cb16-1553"><a href="#cb16-1553" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-1554"><a href="#cb16-1554" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cb <span class="op">=</span> svg<span class="op">.</span><span class="fu">select</span>(<span class="st">"foreignObject"</span>)<span class="op">.</span><span class="fu">select</span>(<span class="vs">`input#checkbox-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb16-1555"><a href="#cb16-1555" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-1556"><a href="#cb16-1556" aria-hidden="true" tabindex="-1"></a>  cb<span class="op">.</span><span class="fu">on</span>(<span class="st">"click"</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb16-1557"><a href="#cb16-1557" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> isChecked <span class="op">=</span> cb<span class="op">.</span><span class="fu">property</span>(<span class="st">"checked"</span>)<span class="op">;</span></span>
<span id="cb16-1558"><a href="#cb16-1558" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> chartLabels <span class="op">=</span> svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="vs">`g#labels-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb16-1559"><a href="#cb16-1559" aria-hidden="true" tabindex="-1"></a>    isChecked <span class="op">?</span> chartLabels<span class="op">.</span><span class="fu">style</span>(<span class="st">"visibility"</span><span class="op">,</span> <span class="st">"visible"</span>) <span class="op">:</span> chartLabels<span class="op">.</span><span class="fu">style</span>(<span class="st">"visibility"</span><span class="op">,</span> <span class="st">"hidden"</span>)<span class="op">;</span></span>
<span id="cb16-1560"><a href="#cb16-1560" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb16-1561"><a href="#cb16-1561" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-1562"><a href="#cb16-1562" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> container<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb16-1563"><a href="#cb16-1563" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell quarto-layout-panel" data-layout="[[1, 1], [1]]">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="ojs-cell-16-1" data-nodetype="declaration">

</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="ojs-cell-16-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="ojs-cell-16-3" data-nodetype="expression">

</div>
</div>
</div>
</div>
<p>Notice however that the long-run equilibrium under monopolistic competition still enatils lower output at higher prices compared with perfect competition. While Apple and its friends do face competitive pressures from each other, product differentiation means that their profit-maximizing level of output is below the social optimum. Do note that this takes a very narrow conception of the social optimum, in that it only accounts for prices and output. An argument can be made that while a monopolistic competitor can reap more monopoly profits by further differentiating its product, the fact that it results in better smartphones, video games, and appliances redounds ultimately to the consumer’s benefit. But that’s a topic for another day.</p>
</section>
<section id="concluding-thoughts" class="level2">
<h2 class="anchored" data-anchor-id="concluding-thoughts">Concluding thoughts</h2>
<p>This blog post demonstrates how interactive charts can be used to enrich the teaching of economics. I have used D3 and Quarto’s built-in Observable engine here, but more broadly, the use of webpages in constructing learning modules lets us take full advantage of HTML, CSS, and Javascript functionality. We can spice the text up by adding <span class="highlight">highlighting</span>, <span class="animate">animation</span>, and gratuitous <img src="../../images/pikachu.png" class="endmark img-fluid"> Pikachu <img src="../../images/pikachu.png" class="endmark img-fluid"> faces <img src="../../images/pikachu.png" class="endmark img-fluid">.</p>
<p>Economists are always referring to “toy models” of the economy. It’s time we get to play with them. <img src="../../images/logo-icon.png" class="endmark img-fluid"></p>
</section>



<div id="quarto-appendix" class="default"><section id="d3-observable-code" class="level2 appendix"><h2 class="anchored quarto-appendix-heading">D3 / Observable code</h2><div class="quarto-appendix-contents">

<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17" data-startfrom="1579" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1578;"><span id="cb17-1579"><a href="#cb17-1579" aria-hidden="true" tabindex="-1"></a>costFxn <span class="op">=</span> ({ q<span class="op">,</span> fc } <span class="op">=</span> {}) <span class="kw">=&gt;</span> {</span>
<span id="cb17-1580"><a href="#cb17-1580" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="op">.</span><span class="bn">006</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">pow</span>(q<span class="op">,</span> <span class="dv">3</span>) <span class="op">-</span> <span class="op">.</span><span class="dv">56</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">pow</span>(q<span class="op">,</span> <span class="dv">2</span>) <span class="op">+</span> <span class="dv">20</span> <span class="op">*</span> q <span class="op">+</span> fc</span>
<span id="cb17-1581"><a href="#cb17-1581" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb17-1582"><a href="#cb17-1582" aria-hidden="true" tabindex="-1"></a>acFxn <span class="op">=</span> ({ q<span class="op">,</span> fc } <span class="op">=</span> {}) <span class="kw">=&gt;</span> {</span>
<span id="cb17-1583"><a href="#cb17-1583" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="pp">isNaN</span>(<span class="fu">costFxn</span>({ q<span class="op">,</span> fc }) <span class="op">/</span> q)) <span class="cf">return</span> <span class="op">.</span><span class="bn">006</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">pow</span>(q<span class="op">,</span> <span class="dv">2</span>) <span class="op">-</span> <span class="op">.</span><span class="dv">56</span> <span class="op">*</span> q <span class="op">+</span> <span class="dv">20</span></span>
<span id="cb17-1584"><a href="#cb17-1584" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">if</span> (q <span class="op">===</span> <span class="dv">0</span>) <span class="cf">return</span> <span class="kw">null</span></span>
<span id="cb17-1585"><a href="#cb17-1585" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">return</span> <span class="fu">costFxn</span>({ q<span class="op">,</span> fc }) <span class="op">/</span> q</span>
<span id="cb17-1586"><a href="#cb17-1586" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb17-1587"><a href="#cb17-1587" aria-hidden="true" tabindex="-1"></a>avcFxn <span class="op">=</span> ({q} <span class="op">=</span> {}) <span class="kw">=&gt;</span> <span class="op">.</span><span class="bn">006</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">pow</span>(q<span class="op">,</span> <span class="dv">2</span>) <span class="op">-</span> <span class="op">.</span><span class="dv">56</span> <span class="op">*</span> q <span class="op">+</span> <span class="dv">20</span><span class="op">;</span></span>
<span id="cb17-1588"><a href="#cb17-1588" aria-hidden="true" tabindex="-1"></a>mcFxn <span class="op">=</span> ({q} <span class="op">=</span> {}) <span class="kw">=&gt;</span> <span class="op">.</span><span class="bn">006</span> <span class="op">*</span> <span class="dv">3</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">pow</span>(q<span class="op">,</span> <span class="dv">2</span>) <span class="op">-</span> <span class="op">.</span><span class="dv">56</span> <span class="op">*</span> <span class="dv">2</span> <span class="op">*</span> q <span class="op">+</span> <span class="dv">20</span><span class="op">;</span></span>
<span id="cb17-1589"><a href="#cb17-1589" aria-hidden="true" tabindex="-1"></a>profitFxn <span class="op">=</span> ({ q<span class="op">,</span> p<span class="op">,</span> fc } <span class="op">=</span> {}) <span class="kw">=&gt;</span> p <span class="op">*</span> q <span class="op">-</span> <span class="fu">costFxn</span>({ q<span class="op">,</span> fc })<span class="op">;</span></span>
<span id="cb17-1590"><a href="#cb17-1590" aria-hidden="true" tabindex="-1"></a>supplyFxn <span class="op">=</span> ({q} <span class="op">=</span> {}) <span class="kw">=&gt;</span> {</span>
<span id="cb17-1591"><a href="#cb17-1591" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> minAVCq <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(<span class="op">.</span><span class="dv">56</span> <span class="op">/</span> (<span class="op">.</span><span class="bn">006</span> <span class="op">*</span> <span class="dv">2</span>))<span class="op">;</span></span>
<span id="cb17-1592"><a href="#cb17-1592" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (q <span class="op">&lt;</span> minAVCq <span class="op">+</span> <span class="dv">1</span>) <span class="cf">return</span> <span class="fu">avcFxn</span>({ <span class="dt">q</span><span class="op">:</span> minAVCq })<span class="op">;</span></span>
<span id="cb17-1593"><a href="#cb17-1593" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">return</span> <span class="fu">mcFxn</span>({ q })<span class="op">;</span></span>
<span id="cb17-1594"><a href="#cb17-1594" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-1595"><a href="#cb17-1595" aria-hidden="true" tabindex="-1"></a>mrFxn <span class="op">=</span> ({p} <span class="op">=</span> {}) <span class="kw">=&gt;</span> p<span class="op">;</span></span>
<span id="cb17-1596"><a href="#cb17-1596" aria-hidden="true" tabindex="-1"></a>demandMonoFxn <span class="op">=</span> ({q} <span class="op">=</span> {}) <span class="kw">=&gt;</span> <span class="dv">27</span> <span class="op">-</span> (<span class="dv">27</span><span class="op">/</span><span class="dv">95</span>) <span class="op">*</span> q<span class="op">;</span></span>
<span id="cb17-1597"><a href="#cb17-1597" aria-hidden="true" tabindex="-1"></a>mrMonoFxn <span class="op">=</span> ({q} <span class="op">=</span> {}) <span class="kw">=&gt;</span> <span class="dv">27</span> <span class="op">-</span> <span class="dv">2</span> <span class="op">*</span> (<span class="dv">27</span><span class="op">/</span><span class="dv">95</span>) <span class="op">*</span> q<span class="op">;</span></span>
<span id="cb17-1598"><a href="#cb17-1598" aria-hidden="true" tabindex="-1"></a>profitMonoFxn <span class="op">=</span> ({ q<span class="op">,</span> fc } <span class="op">=</span> {}) <span class="kw">=&gt;</span> {</span>
<span id="cb17-1599"><a href="#cb17-1599" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">demandMonoFxn</span>({q}) <span class="op">*</span> q <span class="op">-</span> <span class="fu">costFxn</span>({ q<span class="op">,</span> fc })</span>
<span id="cb17-1600"><a href="#cb17-1600" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb17-1601"><a href="#cb17-1601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1602"><a href="#cb17-1602" aria-hidden="true" tabindex="-1"></a>cost <span class="op">=</span> ({ <span class="dt">fxn</span><span class="op">:</span> costFxn<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Cost"</span><span class="op">,</span> <span class="dt">id</span><span class="op">:</span> <span class="st">"cost-curve"</span><span class="op">,</span> <span class="dt">scheme</span><span class="op">:</span> red })<span class="op">;</span></span>
<span id="cb17-1603"><a href="#cb17-1603" aria-hidden="true" tabindex="-1"></a>ac <span class="op">=</span> ({ <span class="dt">fxn</span><span class="op">:</span> acFxn<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Average cost"</span><span class="op">,</span> <span class="dt">id</span><span class="op">:</span> <span class="st">"ac-curve"</span><span class="op">,</span> <span class="dt">scheme</span><span class="op">:</span> blue })<span class="op">;</span></span>
<span id="cb17-1604"><a href="#cb17-1604" aria-hidden="true" tabindex="-1"></a>avc <span class="op">=</span> ({ <span class="dt">fxn</span><span class="op">:</span> avcFxn<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Average variable cost"</span><span class="op">,</span> <span class="dt">id</span><span class="op">:</span> <span class="st">"avc-curve"</span><span class="op">,</span> <span class="dt">scheme</span><span class="op">:</span> blue })<span class="op">;</span></span>
<span id="cb17-1605"><a href="#cb17-1605" aria-hidden="true" tabindex="-1"></a>mc <span class="op">=</span> ({ <span class="dt">fxn</span><span class="op">:</span> mcFxn<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Marginal cost"</span><span class="op">,</span> <span class="dt">id</span><span class="op">:</span> <span class="st">"mc-curve"</span><span class="op">,</span> <span class="dt">scheme</span><span class="op">:</span> blue })<span class="op">;</span></span>
<span id="cb17-1606"><a href="#cb17-1606" aria-hidden="true" tabindex="-1"></a>profit <span class="op">=</span> ({ <span class="dt">fxn</span><span class="op">:</span> profitFxn<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Profit"</span><span class="op">,</span> <span class="dt">id</span><span class="op">:</span> <span class="st">"profit-curve"</span><span class="op">,</span> <span class="dt">scheme</span><span class="op">:</span> red })<span class="op">;</span></span>
<span id="cb17-1607"><a href="#cb17-1607" aria-hidden="true" tabindex="-1"></a>price <span class="op">=</span> ({ <span class="dt">fxn</span><span class="op">:</span> mrFxn<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Price"</span><span class="op">,</span> <span class="dt">id</span><span class="op">:</span> <span class="st">"mr-curve"</span><span class="op">,</span> <span class="dt">scheme</span><span class="op">:</span> green })<span class="op">;</span></span>
<span id="cb17-1608"><a href="#cb17-1608" aria-hidden="true" tabindex="-1"></a>mr <span class="op">=</span> ({ <span class="dt">fxn</span><span class="op">:</span> mrFxn<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Marginal revenue"</span><span class="op">,</span> <span class="dt">id</span><span class="op">:</span> <span class="st">"mr-curve"</span><span class="op">,</span> <span class="dt">scheme</span><span class="op">:</span> green })<span class="op">;</span></span>
<span id="cb17-1609"><a href="#cb17-1609" aria-hidden="true" tabindex="-1"></a>supply <span class="op">=</span> ({ <span class="dt">fxn</span><span class="op">:</span> supplyFxn<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Supply"</span><span class="op">,</span> <span class="dt">id</span><span class="op">:</span> <span class="st">"supply-curve"</span><span class="op">,</span> <span class="dt">scheme</span><span class="op">:</span> blue })<span class="op">;</span></span>
<span id="cb17-1610"><a href="#cb17-1610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1611"><a href="#cb17-1611" aria-hidden="true" tabindex="-1"></a>demandMono <span class="op">=</span> ({ <span class="dt">fxn</span><span class="op">:</span> demandMonoFxn<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Demand"</span><span class="op">,</span> <span class="dt">id</span><span class="op">:</span> <span class="st">"demand-mono-curve"</span><span class="op">,</span> <span class="dt">scheme</span><span class="op">:</span> green })<span class="op">;</span></span>
<span id="cb17-1612"><a href="#cb17-1612" aria-hidden="true" tabindex="-1"></a>mrMono <span class="op">=</span> ({ <span class="dt">fxn</span><span class="op">:</span> mrMonoFxn<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Marginal revenue"</span><span class="op">,</span> <span class="dt">id</span><span class="op">:</span> <span class="st">"mr-mono-curve"</span><span class="op">,</span> <span class="dt">scheme</span><span class="op">:</span> green })<span class="op">;</span></span>
<span id="cb17-1613"><a href="#cb17-1613" aria-hidden="true" tabindex="-1"></a>profitMono <span class="op">=</span> ({ <span class="dt">fxn</span><span class="op">:</span> profitMonoFxn<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Profit"</span><span class="op">,</span> <span class="dt">id</span><span class="op">:</span> <span class="st">"profit-mono-curve"</span><span class="op">,</span> <span class="dt">scheme</span><span class="op">:</span> red })<span class="op">;</span></span>
<span id="cb17-1614"><a href="#cb17-1614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1615"><a href="#cb17-1615" aria-hidden="true" tabindex="-1"></a>demandMonoComp <span class="op">=</span> ({ <span class="dt">fxn</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Demand"</span><span class="op">,</span> <span class="dt">id</span><span class="op">:</span> <span class="st">"demand-monocomp-curve"</span><span class="op">,</span> <span class="dt">scheme</span><span class="op">:</span> green })<span class="op">;</span></span>
<span id="cb17-1616"><a href="#cb17-1616" aria-hidden="true" tabindex="-1"></a>mrMonoComp <span class="op">=</span> ({ <span class="dt">fxn</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Marginal revenue"</span><span class="op">,</span> <span class="dt">id</span><span class="op">:</span> <span class="st">"mr-monocomp-curve"</span><span class="op">,</span> <span class="dt">scheme</span><span class="op">:</span> green })<span class="op">;</span></span>
<span id="cb17-1617"><a href="#cb17-1617" aria-hidden="true" tabindex="-1"></a>profitMonoComp <span class="op">=</span> ({ <span class="dt">fxn</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Profit"</span><span class="op">,</span> <span class="dt">id</span><span class="op">:</span> <span class="st">"profit-monocomp-curve"</span><span class="op">,</span> <span class="dt">scheme</span><span class="op">:</span> red })<span class="op">;</span></span>
<span id="cb17-1618"><a href="#cb17-1618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1619"><a href="#cb17-1619" aria-hidden="true" tabindex="-1"></a>margin <span class="op">=</span> ({ <span class="dt">top</span><span class="op">:</span> <span class="dv">50</span><span class="op">,</span> <span class="dt">right</span><span class="op">:</span> <span class="dv">100</span><span class="op">,</span> <span class="dt">bottom</span><span class="op">:</span> <span class="dv">40</span><span class="op">,</span> <span class="dt">left</span><span class="op">:</span> <span class="dv">70</span><span class="op">,</span> <span class="dt">between</span><span class="op">:</span> <span class="dv">60</span> })<span class="op">;</span></span>
<span id="cb17-1620"><a href="#cb17-1620" aria-hidden="true" tabindex="-1"></a>width <span class="op">=</span> <span class="dv">400</span><span class="op">;</span></span>
<span id="cb17-1621"><a href="#cb17-1621" aria-hidden="true" tabindex="-1"></a>height <span class="op">=</span> panelHeight <span class="op">*</span> <span class="dv">2</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">between</span><span class="op">;</span></span>
<span id="cb17-1622"><a href="#cb17-1622" aria-hidden="true" tabindex="-1"></a>panelHeight <span class="op">=</span> <span class="dv">280</span><span class="op">;</span></span>
<span id="cb17-1623"><a href="#cb17-1623" aria-hidden="true" tabindex="-1"></a>fcMax <span class="op">=</span> <span class="dv">500</span><span class="op">;</span></span>
<span id="cb17-1624"><a href="#cb17-1624" aria-hidden="true" tabindex="-1"></a>qMax <span class="op">=</span> <span class="dv">100</span><span class="op">;</span></span>
<span id="cb17-1625"><a href="#cb17-1625" aria-hidden="true" tabindex="-1"></a>pMax <span class="op">=</span> <span class="dv">27</span><span class="op">;</span></span>
<span id="cb17-1626"><a href="#cb17-1626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1627"><a href="#cb17-1627" aria-hidden="true" tabindex="-1"></a>bgColor <span class="op">=</span> <span class="st">"#EDF8FF"</span><span class="op">;</span></span>
<span id="cb17-1628"><a href="#cb17-1628" aria-hidden="true" tabindex="-1"></a>blue <span class="op">=</span> ({ <span class="dt">base</span><span class="op">:</span> <span class="st">"#4889ab"</span><span class="op">,</span> <span class="dt">dull</span><span class="op">:</span> <span class="st">"#A2C4D2"</span><span class="op">,</span> <span class="dt">baseSelect</span><span class="op">:</span> <span class="st">"#0C6291"</span><span class="op">,</span> <span class="dt">dullSelect</span><span class="op">:</span> <span class="st">"#669DB8"</span>})<span class="op">;</span></span>
<span id="cb17-1629"><a href="#cb17-1629" aria-hidden="true" tabindex="-1"></a>red <span class="op">=</span> ({ <span class="dt">base</span><span class="op">:</span> <span class="st">"#C85B89"</span><span class="op">,</span> <span class="dt">dull</span><span class="op">:</span> <span class="st">"#E29FBC"</span><span class="op">,</span> <span class="dt">baseSelect</span><span class="op">:</span> <span class="st">"#B13D70"</span><span class="op">,</span> <span class="dt">dullSelect</span><span class="op">:</span> <span class="st">"#D1729A"</span> })<span class="op">;</span></span>
<span id="cb17-1630"><a href="#cb17-1630" aria-hidden="true" tabindex="-1"></a>green <span class="op">=</span> ({ <span class="dt">base</span><span class="op">:</span> <span class="st">"#71B795"</span><span class="op">,</span> <span class="dt">dull</span><span class="op">:</span> <span class="st">"#B4D7C6"</span><span class="op">,</span> <span class="dt">baseSelect</span><span class="op">:</span> <span class="st">"#418462"</span><span class="op">,</span> <span class="dt">dullSelect</span><span class="op">:</span> <span class="st">"#73AA8E"</span> })<span class="op">;</span></span>
<span id="cb17-1631"><a href="#cb17-1631" aria-hidden="true" tabindex="-1"></a>gray <span class="op">=</span> ({ <span class="dt">base</span><span class="op">:</span> <span class="st">"#DDDDDD"</span><span class="op">,</span> <span class="dt">dull</span><span class="op">:</span> <span class="st">"#DDDDDD"</span><span class="op">,</span> <span class="dt">baseSelect</span><span class="op">:</span> <span class="st">"#D0D0D0"</span><span class="op">,</span> <span class="dt">dullSelect</span><span class="op">:</span> <span class="st">"##D0D0D0"</span> })<span class="op">;</span></span>
<span id="cb17-1632"><a href="#cb17-1632" aria-hidden="true" tabindex="-1"></a>dashed <span class="op">=</span> <span class="st">"#999999"</span><span class="op">;</span></span>
<span id="cb17-1633"><a href="#cb17-1633" aria-hidden="true" tabindex="-1"></a>strokeWidth <span class="op">=</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb17-1634"><a href="#cb17-1634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1635"><a href="#cb17-1635" aria-hidden="true" tabindex="-1"></a>tooltip <span class="op">=</span> d3<span class="op">.</span><span class="fu">select</span>(<span class="st">"body"</span>)</span>
<span id="cb17-1636"><a href="#cb17-1636" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">append</span>(<span class="st">"div"</span>)</span>
<span id="cb17-1637"><a href="#cb17-1637" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"toolTip"</span>)</span>
<span id="cb17-1638"><a href="#cb17-1638" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">style</span>(<span class="st">"display"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb17-1639"><a href="#cb17-1639" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">style</span>(<span class="st">"position"</span><span class="op">,</span> <span class="st">"absolute"</span>)</span>
<span id="cb17-1640"><a href="#cb17-1640" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">style</span>(<span class="st">"width"</span><span class="op">,</span> <span class="dv">100</span>)</span>
<span id="cb17-1641"><a href="#cb17-1641" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">style</span>(<span class="st">"height"</span><span class="op">,</span> <span class="dv">20</span>)</span>
<span id="cb17-1642"><a href="#cb17-1642" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">style</span>(<span class="st">"background"</span><span class="op">,</span> <span class="st">"#f7f7f7"</span>)</span>
<span id="cb17-1643"><a href="#cb17-1643" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">style</span>(<span class="st">"border"</span><span class="op">,</span> <span class="st">"1px solid #cecece"</span>)</span>
<span id="cb17-1644"><a href="#cb17-1644" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">style</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="op">.</span><span class="dv">9</span>)</span>
<span id="cb17-1645"><a href="#cb17-1645" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">style</span>(<span class="st">"padding"</span><span class="op">,</span> <span class="st">".2em .45em"</span>)</span>
<span id="cb17-1646"><a href="#cb17-1646" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">".85rem"</span>)<span class="op">;</span></span>
<span id="cb17-1647"><a href="#cb17-1647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1648"><a href="#cb17-1648" aria-hidden="true" tabindex="-1"></a>line <span class="op">=</span> d3<span class="op">.</span><span class="fu">line</span>()<span class="op">.</span><span class="fu">curve</span>(d3<span class="op">.</span><span class="at">curveBasis</span>)<span class="op">;</span></span>
<span id="cb17-1649"><a href="#cb17-1649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1650"><a href="#cb17-1650" aria-hidden="true" tabindex="-1"></a>xScaler <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb17-1651"><a href="#cb17-1651" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> qMax])</span>
<span id="cb17-1652"><a href="#cb17-1652" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> width])<span class="op">;</span></span>
<span id="cb17-1653"><a href="#cb17-1653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1654"><a href="#cb17-1654" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> (fxn<span class="op">,</span> params<span class="op">,</span> yScaler) <span class="kw">=&gt;</span> {</span>
<span id="cb17-1655"><a href="#cb17-1655" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> q <span class="op">=</span> params<span class="op">.</span><span class="at">q</span><span class="op">,</span> p <span class="op">=</span> params<span class="op">.</span><span class="at">p</span><span class="op">,</span> fc <span class="op">=</span> params<span class="op">.</span><span class="at">fc</span><span class="op">,</span> c <span class="op">=</span> params<span class="op">.</span><span class="at">c</span><span class="op">;</span></span>
<span id="cb17-1656"><a href="#cb17-1656" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>({ <span class="dt">length</span><span class="op">:</span> q <span class="op">+</span> <span class="dv">1</span> }<span class="op">,</span> (_<span class="op">,</span> i) <span class="kw">=&gt;</span> {</span>
<span id="cb17-1657"><a href="#cb17-1657" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> y <span class="op">=</span> <span class="fu">yScaler</span>(<span class="fu">fxn</span>({ <span class="dt">q</span><span class="op">:</span> i<span class="op">,</span> p<span class="op">,</span> fc<span class="op">,</span> c })) <span class="op">??</span> <span class="op">-</span><span class="dv">500</span><span class="op">;</span></span>
<span id="cb17-1658"><a href="#cb17-1658" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> x <span class="op">=</span> (y <span class="op">==</span> <span class="kw">null</span>) <span class="op">?</span> <span class="kw">null</span> <span class="op">:</span> <span class="fu">xScaler</span>(i)<span class="op">;</span></span>
<span id="cb17-1659"><a href="#cb17-1659" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [x<span class="op">,</span> y]<span class="op">;</span></span>
<span id="cb17-1660"><a href="#cb17-1660" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb17-1661"><a href="#cb17-1661" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb17-1662"><a href="#cb17-1662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1663"><a href="#cb17-1663" aria-hidden="true" tabindex="-1"></a>dataMax <span class="op">=</span> (fxn<span class="op">,</span> params<span class="op">,</span> yScaler) <span class="kw">=&gt;</span> {</span>
<span id="cb17-1664"><a href="#cb17-1664" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> q <span class="op">=</span> qMax<span class="op">,</span> p <span class="op">=</span> params<span class="op">.</span><span class="at">p</span><span class="op">,</span> fc <span class="op">=</span> params<span class="op">.</span><span class="at">fc</span><span class="op">,</span> c <span class="op">=</span> params<span class="op">.</span><span class="at">c</span><span class="op">;</span></span>
<span id="cb17-1665"><a href="#cb17-1665" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>({ <span class="dt">length</span><span class="op">:</span> q <span class="op">+</span> <span class="dv">1</span> }<span class="op">,</span> (_<span class="op">,</span> i) <span class="kw">=&gt;</span> {</span>
<span id="cb17-1666"><a href="#cb17-1666" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> y <span class="op">=</span> <span class="fu">yScaler</span>(<span class="fu">fxn</span>({ <span class="dt">q</span><span class="op">:</span> i<span class="op">,</span> p<span class="op">,</span> fc<span class="op">,</span> c })) <span class="op">??</span> <span class="op">-</span><span class="dv">500</span><span class="op">;</span></span>
<span id="cb17-1667"><a href="#cb17-1667" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> x <span class="op">=</span> (y <span class="op">==</span> <span class="kw">null</span>) <span class="op">?</span> <span class="kw">null</span> <span class="op">:</span> <span class="fu">xScaler</span>(i)<span class="op">;</span></span>
<span id="cb17-1668"><a href="#cb17-1668" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [x<span class="op">,</span> y]<span class="op">;</span></span>
<span id="cb17-1669"><a href="#cb17-1669" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb17-1670"><a href="#cb17-1670" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb17-1671"><a href="#cb17-1671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1672"><a href="#cb17-1672" aria-hidden="true" tabindex="-1"></a>background <span class="op">=</span> selection <span class="kw">=&gt;</span> {</span>
<span id="cb17-1673"><a href="#cb17-1673" aria-hidden="true" tabindex="-1"></a>  selection<span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb17-1674"><a href="#cb17-1674" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb17-1675"><a href="#cb17-1675" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> selection<span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span>))</span>
<span id="cb17-1676"><a href="#cb17-1676" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> selection<span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span>))</span>
<span id="cb17-1677"><a href="#cb17-1677" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> bgColor)</span>
<span id="cb17-1678"><a href="#cb17-1678" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"#E0EDFB"</span>)</span>
<span id="cb17-1679"><a href="#cb17-1679" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="dv">8</span>)<span class="op">;</span></span>
<span id="cb17-1680"><a href="#cb17-1680" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> selection<span class="op">.</span><span class="fu">node</span>()</span>
<span id="cb17-1681"><a href="#cb17-1681" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-17-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-17-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-17-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-17-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-17-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-17-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-17-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-17-8" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-17-9" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-17-10" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-17-11" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-17-12" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-17-13" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-17-14" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-17-15" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-17-16" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-17-17" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-17-18" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-17-19" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-17-20" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-17-21" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-17-22" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-17-23" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-17-24" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-17-25" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-17-26" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-17-27" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-17-28" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-17-29" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-17-30" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-17-31" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-17-32" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-17-33" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-17-34" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-17-35" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-17-36" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-17-37" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-17-38" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-17-39" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-17-40" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-17-41" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-17-42" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-17-43" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-17-44" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18" data-startfrom="1687" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1686;"><span id="cb18-1687"><a href="#cb18-1687" aria-hidden="true" tabindex="-1"></a>addCurve <span class="op">=</span> (selection<span class="op">,</span> id<span class="op">,</span> fxnInfo<span class="op">,</span> params<span class="op">,</span> yScaler) <span class="kw">=&gt;</span> {</span>
<span id="cb18-1688"><a href="#cb18-1688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-1689"><a href="#cb18-1689" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> point <span class="op">=</span> <span class="fu">data</span>(fxnInfo<span class="op">.</span><span class="at">fxn</span><span class="op">,</span> params<span class="op">,</span> yScaler)[params<span class="op">.</span><span class="at">q</span>]</span>
<span id="cb18-1690"><a href="#cb18-1690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-1691"><a href="#cb18-1691" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> curves <span class="op">=</span> selection<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb18-1692"><a href="#cb18-1692" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>fxnInfo<span class="op">.</span><span class="at">id</span><span class="sc">}</span><span class="vs">-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb18-1693"><a href="#cb18-1693" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"pointer-events"</span><span class="op">,</span> <span class="st">"visibleStroke"</span>)</span>
<span id="cb18-1694"><a href="#cb18-1694" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-1695"><a href="#cb18-1695" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Non-highlighted portion</span></span>
<span id="cb18-1696"><a href="#cb18-1696" aria-hidden="true" tabindex="-1"></a>  curves<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb18-1697"><a href="#cb18-1697" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"curve dulled"</span>)</span>
<span id="cb18-1698"><a href="#cb18-1698" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">line</span>(<span class="fu">dataMax</span>(fxnInfo<span class="op">.</span><span class="at">fxn</span><span class="op">,</span> params<span class="op">,</span> yScaler)))</span>
<span id="cb18-1699"><a href="#cb18-1699" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb18-1700"><a href="#cb18-1700" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke"</span><span class="op">,</span> fxnInfo<span class="op">.</span><span class="at">scheme</span><span class="op">.</span><span class="at">dull</span>)</span>
<span id="cb18-1701"><a href="#cb18-1701" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke-width"</span><span class="op">,</span> strokeWidth)</span>
<span id="cb18-1702"><a href="#cb18-1702" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-1703"><a href="#cb18-1703" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Highlighted portion</span></span>
<span id="cb18-1704"><a href="#cb18-1704" aria-hidden="true" tabindex="-1"></a>  curves<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb18-1705"><a href="#cb18-1705" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"curve colored"</span>)</span>
<span id="cb18-1706"><a href="#cb18-1706" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">line</span>(<span class="fu">data</span>(fxnInfo<span class="op">.</span><span class="at">fxn</span><span class="op">,</span> params<span class="op">,</span> yScaler)))</span>
<span id="cb18-1707"><a href="#cb18-1707" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb18-1708"><a href="#cb18-1708" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke"</span><span class="op">,</span> fxnInfo<span class="op">.</span><span class="at">scheme</span><span class="op">.</span><span class="at">base</span>)</span>
<span id="cb18-1709"><a href="#cb18-1709" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke-width"</span><span class="op">,</span> strokeWidth)</span>
<span id="cb18-1710"><a href="#cb18-1710" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-1711"><a href="#cb18-1711" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Add hover effects</span></span>
<span id="cb18-1712"><a href="#cb18-1712" aria-hidden="true" tabindex="-1"></a>  curves</span>
<span id="cb18-1713"><a href="#cb18-1713" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">on</span>(<span class="st">"mousemove"</span><span class="op">,</span> (<span class="bu">event</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb18-1714"><a href="#cb18-1714" aria-hidden="true" tabindex="-1"></a>      d3<span class="op">.</span><span class="fu">selectAll</span>(<span class="vs">`#</span><span class="sc">${</span>fxnInfo<span class="op">.</span><span class="at">id</span><span class="sc">}</span><span class="vs">-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs"> .curve.colored`</span>)</span>
<span id="cb18-1715"><a href="#cb18-1715" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">transition</span>()<span class="op">.</span><span class="fu">duration</span>(<span class="dv">50</span>)</span>
<span id="cb18-1716"><a href="#cb18-1716" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke-width"</span><span class="op">,</span> strokeWidth <span class="op">+</span> <span class="dv">2</span>)</span>
<span id="cb18-1717"><a href="#cb18-1717" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke"</span><span class="op">,</span> fxnInfo<span class="op">.</span><span class="at">scheme</span><span class="op">.</span><span class="at">baseSelect</span>)<span class="op">;</span></span>
<span id="cb18-1718"><a href="#cb18-1718" aria-hidden="true" tabindex="-1"></a>      d3<span class="op">.</span><span class="fu">selectAll</span>(<span class="vs">`#</span><span class="sc">${</span>fxnInfo<span class="op">.</span><span class="at">id</span><span class="sc">}</span><span class="vs">-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs"> .curve.dulled`</span>)</span>
<span id="cb18-1719"><a href="#cb18-1719" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">transition</span>()<span class="op">.</span><span class="fu">duration</span>(<span class="dv">50</span>)</span>
<span id="cb18-1720"><a href="#cb18-1720" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke-width"</span><span class="op">,</span> strokeWidth <span class="op">+</span> <span class="dv">2</span>)</span>
<span id="cb18-1721"><a href="#cb18-1721" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke"</span><span class="op">,</span> fxnInfo<span class="op">.</span><span class="at">scheme</span><span class="op">.</span><span class="at">dullSelect</span>)<span class="op">;</span></span>
<span id="cb18-1722"><a href="#cb18-1722" aria-hidden="true" tabindex="-1"></a>      tooltip</span>
<span id="cb18-1723"><a href="#cb18-1723" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"left"</span><span class="op">,</span> <span class="bu">event</span><span class="op">.</span><span class="at">pageX</span> <span class="op">+</span> <span class="dv">18</span> <span class="op">+</span> <span class="st">"px"</span>)</span>
<span id="cb18-1724"><a href="#cb18-1724" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"top"</span><span class="op">,</span> <span class="bu">event</span><span class="op">.</span><span class="at">pageY</span> <span class="op">+</span> <span class="dv">18</span> <span class="op">+</span> <span class="st">"px"</span>)</span>
<span id="cb18-1725"><a href="#cb18-1725" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"display"</span><span class="op">,</span> <span class="st">"block"</span>)</span>
<span id="cb18-1726"><a href="#cb18-1726" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">text</span>(fxnInfo<span class="op">.</span><span class="at">label</span>)<span class="op">;</span></span>
<span id="cb18-1727"><a href="#cb18-1727" aria-hidden="true" tabindex="-1"></a>      d3<span class="op">.</span><span class="fu">select</span>(<span class="bu">event</span><span class="op">.</span><span class="at">target</span>)<span class="op">.</span><span class="fu">style</span>(<span class="st">"cursor"</span><span class="op">,</span> <span class="st">"pointer"</span>)<span class="op">;</span></span>
<span id="cb18-1728"><a href="#cb18-1728" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb18-1729"><a href="#cb18-1729" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">on</span>(<span class="st">"mouseleave"</span><span class="op">,</span> (<span class="bu">event</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb18-1730"><a href="#cb18-1730" aria-hidden="true" tabindex="-1"></a>      d3<span class="op">.</span><span class="fu">selectAll</span>(<span class="vs">`#</span><span class="sc">${</span>fxnInfo<span class="op">.</span><span class="at">id</span><span class="sc">}</span><span class="vs">-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs"> .curve.colored`</span>)</span>
<span id="cb18-1731"><a href="#cb18-1731" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">transition</span>()<span class="op">.</span><span class="fu">duration</span>(<span class="dv">100</span>)</span>
<span id="cb18-1732"><a href="#cb18-1732" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke-width"</span><span class="op">,</span> strokeWidth)</span>
<span id="cb18-1733"><a href="#cb18-1733" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke"</span><span class="op">,</span> fxnInfo<span class="op">.</span><span class="at">scheme</span><span class="op">.</span><span class="at">base</span>)<span class="op">;</span></span>
<span id="cb18-1734"><a href="#cb18-1734" aria-hidden="true" tabindex="-1"></a>      d3<span class="op">.</span><span class="fu">selectAll</span>(<span class="vs">`#</span><span class="sc">${</span>fxnInfo<span class="op">.</span><span class="at">id</span><span class="sc">}</span><span class="vs">-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs"> .curve.dulled`</span>)</span>
<span id="cb18-1735"><a href="#cb18-1735" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">transition</span>()<span class="op">.</span><span class="fu">duration</span>(<span class="dv">100</span>)</span>
<span id="cb18-1736"><a href="#cb18-1736" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke-width"</span><span class="op">,</span> strokeWidth)</span>
<span id="cb18-1737"><a href="#cb18-1737" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke"</span><span class="op">,</span> fxnInfo<span class="op">.</span><span class="at">scheme</span><span class="op">.</span><span class="at">dull</span>)<span class="op">;</span></span>
<span id="cb18-1738"><a href="#cb18-1738" aria-hidden="true" tabindex="-1"></a>      tooltip<span class="op">.</span><span class="fu">style</span>(<span class="st">"display"</span><span class="op">,</span> <span class="st">"none"</span>)<span class="op">;</span></span>
<span id="cb18-1739"><a href="#cb18-1739" aria-hidden="true" tabindex="-1"></a>      d3<span class="op">.</span><span class="fu">select</span>(<span class="bu">event</span><span class="op">.</span><span class="at">target</span>)<span class="op">.</span><span class="fu">style</span>(<span class="st">"cursor"</span><span class="op">,</span> <span class="st">"default"</span>)<span class="op">;</span></span>
<span id="cb18-1740"><a href="#cb18-1740" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb18-1741"><a href="#cb18-1741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-1742"><a href="#cb18-1742" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> selection<span class="op">.</span><span class="fu">node</span>()</span>
<span id="cb18-1743"><a href="#cb18-1743" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-1744"><a href="#cb18-1744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-1745"><a href="#cb18-1745" aria-hidden="true" tabindex="-1"></a>addCurveFull <span class="op">=</span> (selection<span class="op">,</span> id<span class="op">,</span> fxnInfo<span class="op">,</span> params<span class="op">,</span> yScaler<span class="op">,</span> scheme <span class="op">=</span> fxnInfo<span class="op">.</span><span class="at">scheme</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb18-1746"><a href="#cb18-1746" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-1747"><a href="#cb18-1747" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> curves <span class="op">=</span> selection<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb18-1748"><a href="#cb18-1748" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>fxnInfo<span class="op">.</span><span class="at">id</span><span class="sc">}</span><span class="vs">-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb18-1749"><a href="#cb18-1749" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"pointer-events"</span><span class="op">,</span> <span class="st">"visibleStroke"</span>)<span class="op">;</span></span>
<span id="cb18-1750"><a href="#cb18-1750" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-1751"><a href="#cb18-1751" aria-hidden="true" tabindex="-1"></a>  curves<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb18-1752"><a href="#cb18-1752" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"curve"</span>)</span>
<span id="cb18-1753"><a href="#cb18-1753" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">line</span>(<span class="fu">dataMax</span>(fxnInfo<span class="op">.</span><span class="at">fxn</span><span class="op">,</span> params<span class="op">,</span> yScaler)))</span>
<span id="cb18-1754"><a href="#cb18-1754" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb18-1755"><a href="#cb18-1755" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke"</span><span class="op">,</span> scheme<span class="op">.</span><span class="at">base</span>)</span>
<span id="cb18-1756"><a href="#cb18-1756" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke-width"</span><span class="op">,</span> strokeWidth)</span>
<span id="cb18-1757"><a href="#cb18-1757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-1758"><a href="#cb18-1758" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Add hover effects</span></span>
<span id="cb18-1759"><a href="#cb18-1759" aria-hidden="true" tabindex="-1"></a>  curves</span>
<span id="cb18-1760"><a href="#cb18-1760" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">on</span>(<span class="st">"mousemove"</span><span class="op">,</span> (<span class="bu">event</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb18-1761"><a href="#cb18-1761" aria-hidden="true" tabindex="-1"></a>      d3<span class="op">.</span><span class="fu">selectAll</span>(<span class="vs">`#</span><span class="sc">${</span>fxnInfo<span class="op">.</span><span class="at">id</span><span class="sc">}</span><span class="vs">-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs"> .curve`</span>)</span>
<span id="cb18-1762"><a href="#cb18-1762" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">transition</span>()<span class="op">.</span><span class="fu">duration</span>(<span class="dv">50</span>)</span>
<span id="cb18-1763"><a href="#cb18-1763" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke-width"</span><span class="op">,</span> strokeWidth <span class="op">+</span> <span class="dv">2</span>)</span>
<span id="cb18-1764"><a href="#cb18-1764" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke"</span><span class="op">,</span> scheme<span class="op">.</span><span class="at">baseSelect</span>)<span class="op">;</span></span>
<span id="cb18-1765"><a href="#cb18-1765" aria-hidden="true" tabindex="-1"></a>      tooltip</span>
<span id="cb18-1766"><a href="#cb18-1766" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"left"</span><span class="op">,</span> <span class="bu">event</span><span class="op">.</span><span class="at">pageX</span> <span class="op">+</span> <span class="dv">18</span> <span class="op">+</span> <span class="st">"px"</span>)</span>
<span id="cb18-1767"><a href="#cb18-1767" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"top"</span><span class="op">,</span> <span class="bu">event</span><span class="op">.</span><span class="at">pageY</span> <span class="op">+</span> <span class="dv">18</span> <span class="op">+</span> <span class="st">"px"</span>)</span>
<span id="cb18-1768"><a href="#cb18-1768" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"display"</span><span class="op">,</span> <span class="st">"block"</span>)</span>
<span id="cb18-1769"><a href="#cb18-1769" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">text</span>(fxnInfo<span class="op">.</span><span class="at">label</span>)<span class="op">;</span></span>
<span id="cb18-1770"><a href="#cb18-1770" aria-hidden="true" tabindex="-1"></a>      d3<span class="op">.</span><span class="fu">select</span>(<span class="bu">event</span><span class="op">.</span><span class="at">target</span>)<span class="op">.</span><span class="fu">style</span>(<span class="st">"cursor"</span><span class="op">,</span> <span class="st">"pointer"</span>)<span class="op">;</span></span>
<span id="cb18-1771"><a href="#cb18-1771" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb18-1772"><a href="#cb18-1772" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">on</span>(<span class="st">"mouseleave"</span><span class="op">,</span> (<span class="bu">event</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb18-1773"><a href="#cb18-1773" aria-hidden="true" tabindex="-1"></a>      d3<span class="op">.</span><span class="fu">selectAll</span>(<span class="vs">`#</span><span class="sc">${</span>fxnInfo<span class="op">.</span><span class="at">id</span><span class="sc">}</span><span class="vs">-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs"> .curve`</span>)</span>
<span id="cb18-1774"><a href="#cb18-1774" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">transition</span>()<span class="op">.</span><span class="fu">duration</span>(<span class="dv">100</span>)</span>
<span id="cb18-1775"><a href="#cb18-1775" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke-width"</span><span class="op">,</span> strokeWidth)</span>
<span id="cb18-1776"><a href="#cb18-1776" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke"</span><span class="op">,</span> scheme<span class="op">.</span><span class="at">base</span>)<span class="op">;</span></span>
<span id="cb18-1777"><a href="#cb18-1777" aria-hidden="true" tabindex="-1"></a>      tooltip<span class="op">.</span><span class="fu">style</span>(<span class="st">"display"</span><span class="op">,</span> <span class="st">"none"</span>)<span class="op">;</span></span>
<span id="cb18-1778"><a href="#cb18-1778" aria-hidden="true" tabindex="-1"></a>      d3<span class="op">.</span><span class="fu">select</span>(<span class="bu">event</span><span class="op">.</span><span class="at">target</span>)<span class="op">.</span><span class="fu">style</span>(<span class="st">"cursor"</span><span class="op">,</span> <span class="st">"default"</span>)<span class="op">;</span></span>
<span id="cb18-1779"><a href="#cb18-1779" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb18-1780"><a href="#cb18-1780" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-1781"><a href="#cb18-1781" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> selection<span class="op">.</span><span class="fu">node</span>()</span>
<span id="cb18-1782"><a href="#cb18-1782" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-1783"><a href="#cb18-1783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-1784"><a href="#cb18-1784" aria-hidden="true" tabindex="-1"></a>addArea <span class="op">=</span> (selection<span class="op">,</span> id<span class="op">,</span> info<span class="op">,</span> corners) <span class="kw">=&gt;</span> {</span>
<span id="cb18-1785"><a href="#cb18-1785" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-1786"><a href="#cb18-1786" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> area <span class="op">=</span> selection<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb18-1787"><a href="#cb18-1787" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="vs">`area-</span><span class="sc">${</span>info<span class="op">.</span><span class="at">id</span><span class="sc">}</span><span class="vs">-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb18-1788"><a href="#cb18-1788" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> d3<span class="op">.</span><span class="fu">line</span>()([ </span>
<span id="cb18-1789"><a href="#cb18-1789" aria-hidden="true" tabindex="-1"></a>      [corners<span class="op">.</span><span class="at">x1</span><span class="op">,</span> corners<span class="op">.</span><span class="at">y1</span>]<span class="op">,</span> </span>
<span id="cb18-1790"><a href="#cb18-1790" aria-hidden="true" tabindex="-1"></a>      [corners<span class="op">.</span><span class="at">x2</span><span class="op">,</span> corners<span class="op">.</span><span class="at">y1</span>]<span class="op">,</span></span>
<span id="cb18-1791"><a href="#cb18-1791" aria-hidden="true" tabindex="-1"></a>      [corners<span class="op">.</span><span class="at">x2</span><span class="op">,</span> corners<span class="op">.</span><span class="at">y2</span>]<span class="op">,</span></span>
<span id="cb18-1792"><a href="#cb18-1792" aria-hidden="true" tabindex="-1"></a>      [corners<span class="op">.</span><span class="at">x1</span><span class="op">,</span> corners<span class="op">.</span><span class="at">y2</span>]</span>
<span id="cb18-1793"><a href="#cb18-1793" aria-hidden="true" tabindex="-1"></a>    ]))</span>
<span id="cb18-1794"><a href="#cb18-1794" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="op">.</span><span class="dv">25</span>)</span>
<span id="cb18-1795"><a href="#cb18-1795" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"#7fc6a4"</span>)</span>
<span id="cb18-1796"><a href="#cb18-1796" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-1797"><a href="#cb18-1797" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Add hover effects</span></span>
<span id="cb18-1798"><a href="#cb18-1798" aria-hidden="true" tabindex="-1"></a>  area</span>
<span id="cb18-1799"><a href="#cb18-1799" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">on</span>(<span class="st">"mousemove"</span><span class="op">,</span> (<span class="bu">event</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb18-1800"><a href="#cb18-1800" aria-hidden="true" tabindex="-1"></a>      d3<span class="op">.</span><span class="fu">selectAll</span>(<span class="vs">`#area-</span><span class="sc">${</span>info<span class="op">.</span><span class="at">id</span><span class="sc">}</span><span class="vs">-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb18-1801"><a href="#cb18-1801" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">transition</span>()<span class="op">.</span><span class="fu">duration</span>(<span class="dv">50</span>)</span>
<span id="cb18-1802"><a href="#cb18-1802" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="op">.</span><span class="dv">5</span>)<span class="op">;</span></span>
<span id="cb18-1803"><a href="#cb18-1803" aria-hidden="true" tabindex="-1"></a>      tooltip</span>
<span id="cb18-1804"><a href="#cb18-1804" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"left"</span><span class="op">,</span> <span class="bu">event</span><span class="op">.</span><span class="at">pageX</span> <span class="op">+</span> <span class="dv">18</span> <span class="op">+</span> <span class="st">"px"</span>)</span>
<span id="cb18-1805"><a href="#cb18-1805" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"top"</span><span class="op">,</span> <span class="bu">event</span><span class="op">.</span><span class="at">pageY</span> <span class="op">+</span> <span class="dv">18</span> <span class="op">+</span> <span class="st">"px"</span>)</span>
<span id="cb18-1806"><a href="#cb18-1806" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"display"</span><span class="op">,</span> <span class="st">"block"</span>)</span>
<span id="cb18-1807"><a href="#cb18-1807" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">text</span>(info<span class="op">.</span><span class="at">label</span>)<span class="op">;</span></span>
<span id="cb18-1808"><a href="#cb18-1808" aria-hidden="true" tabindex="-1"></a>      d3<span class="op">.</span><span class="fu">select</span>(<span class="bu">event</span><span class="op">.</span><span class="at">target</span>)<span class="op">.</span><span class="fu">style</span>(<span class="st">"cursor"</span><span class="op">,</span> <span class="st">"pointer"</span>)<span class="op">;</span></span>
<span id="cb18-1809"><a href="#cb18-1809" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb18-1810"><a href="#cb18-1810" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">on</span>(<span class="st">"mouseleave"</span><span class="op">,</span> (<span class="bu">event</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb18-1811"><a href="#cb18-1811" aria-hidden="true" tabindex="-1"></a>      d3<span class="op">.</span><span class="fu">selectAll</span>(<span class="vs">`#area-</span><span class="sc">${</span>info<span class="op">.</span><span class="at">id</span><span class="sc">}</span><span class="vs">-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb18-1812"><a href="#cb18-1812" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">transition</span>()<span class="op">.</span><span class="fu">duration</span>(<span class="dv">50</span>)</span>
<span id="cb18-1813"><a href="#cb18-1813" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="op">.</span><span class="dv">25</span>)<span class="op">;</span></span>
<span id="cb18-1814"><a href="#cb18-1814" aria-hidden="true" tabindex="-1"></a>      tooltip<span class="op">.</span><span class="fu">style</span>(<span class="st">"display"</span><span class="op">,</span> <span class="st">"none"</span>)<span class="op">;</span></span>
<span id="cb18-1815"><a href="#cb18-1815" aria-hidden="true" tabindex="-1"></a>      d3<span class="op">.</span><span class="fu">select</span>(<span class="bu">event</span><span class="op">.</span><span class="at">target</span>)<span class="op">.</span><span class="fu">style</span>(<span class="st">"cursor"</span><span class="op">,</span> <span class="st">"default"</span>)<span class="op">;</span></span>
<span id="cb18-1816"><a href="#cb18-1816" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb18-1817"><a href="#cb18-1817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-1818"><a href="#cb18-1818" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> selection<span class="op">.</span><span class="fu">node</span>()</span>
<span id="cb18-1819"><a href="#cb18-1819" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-1820"><a href="#cb18-1820" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-1821"><a href="#cb18-1821" aria-hidden="true" tabindex="-1"></a>clip <span class="op">=</span> (selection<span class="op">,</span> id) <span class="kw">=&gt;</span> {</span>
<span id="cb18-1822"><a href="#cb18-1822" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-1823"><a href="#cb18-1823" aria-hidden="true" tabindex="-1"></a>  selection<span class="op">.</span><span class="fu">attr</span>(<span class="st">"clip-path"</span><span class="op">,</span> <span class="vs">`url(#clip-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb18-1824"><a href="#cb18-1824" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-1825"><a href="#cb18-1825" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> clip <span class="op">=</span> selection<span class="op">.</span><span class="fu">append</span>(<span class="st">"clipPath"</span>)</span>
<span id="cb18-1826"><a href="#cb18-1826" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="vs">`clip-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb18-1827"><a href="#cb18-1827" aria-hidden="true" tabindex="-1"></a>  clip<span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb18-1828"><a href="#cb18-1828" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb18-1829"><a href="#cb18-1829" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb18-1830"><a href="#cb18-1830" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> width <span class="op">+</span> margin<span class="op">.</span><span class="at">right</span>)</span>
<span id="cb18-1831"><a href="#cb18-1831" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> panelHeight)</span>
<span id="cb18-1832"><a href="#cb18-1832" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"white"</span>)<span class="op">;</span></span>
<span id="cb18-1833"><a href="#cb18-1833" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-1834"><a href="#cb18-1834" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> selection<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb18-1835"><a href="#cb18-1835" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-1836"><a href="#cb18-1836" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-1837"><a href="#cb18-1837" aria-hidden="true" tabindex="-1"></a>clipWide <span class="op">=</span> (selection<span class="op">,</span> id) <span class="kw">=&gt;</span> {</span>
<span id="cb18-1838"><a href="#cb18-1838" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-1839"><a href="#cb18-1839" aria-hidden="true" tabindex="-1"></a>  selection<span class="op">.</span><span class="fu">attr</span>(<span class="st">"clip-path"</span><span class="op">,</span> <span class="vs">`url(#clip-wide-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb18-1840"><a href="#cb18-1840" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-1841"><a href="#cb18-1841" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> clip <span class="op">=</span> selection<span class="op">.</span><span class="fu">append</span>(<span class="st">"clipPath"</span>)</span>
<span id="cb18-1842"><a href="#cb18-1842" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="vs">`clip-wide-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb18-1843"><a href="#cb18-1843" aria-hidden="true" tabindex="-1"></a>  clip<span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb18-1844"><a href="#cb18-1844" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb18-1845"><a href="#cb18-1845" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb18-1846"><a href="#cb18-1846" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> width <span class="op">+</span> margin<span class="op">.</span><span class="at">right</span>)</span>
<span id="cb18-1847"><a href="#cb18-1847" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> panelHeight)</span>
<span id="cb18-1848"><a href="#cb18-1848" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"white"</span>)<span class="op">;</span></span>
<span id="cb18-1849"><a href="#cb18-1849" aria-hidden="true" tabindex="-1"></a>  clip<span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb18-1850"><a href="#cb18-1850" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="op">-</span>margin<span class="op">.</span><span class="at">left</span>)</span>
<span id="cb18-1851"><a href="#cb18-1851" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="op">-</span><span class="dv">10</span>)</span>
<span id="cb18-1852"><a href="#cb18-1852" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> margin<span class="op">.</span><span class="at">left</span>)</span>
<span id="cb18-1853"><a href="#cb18-1853" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> panelHeight <span class="op">+</span> <span class="dv">20</span>)</span>
<span id="cb18-1854"><a href="#cb18-1854" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"white"</span>)<span class="op">;</span></span>
<span id="cb18-1855"><a href="#cb18-1855" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-1856"><a href="#cb18-1856" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> selection<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb18-1857"><a href="#cb18-1857" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-18-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-18-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-18-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-18-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-18-5" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19" data-startfrom="1863" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1862;"><span id="cb19-1863"><a href="#cb19-1863" aria-hidden="true" tabindex="-1"></a>panelAxes <span class="op">=</span> (selection<span class="op">,</span> titles) <span class="kw">=&gt;</span> {</span>
<span id="cb19-1864"><a href="#cb19-1864" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-1865"><a href="#cb19-1865" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> axes <span class="op">=</span> selection<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb19-1866"><a href="#cb19-1866" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-1867"><a href="#cb19-1867" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Axis lines</span></span>
<span id="cb19-1868"><a href="#cb19-1868" aria-hidden="true" tabindex="-1"></a>  axes<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb19-1869"><a href="#cb19-1869" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> d3<span class="op">.</span><span class="fu">line</span>()([[width<span class="op">,</span> panelHeight]<span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> panelHeight]<span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span>]]))</span>
<span id="cb19-1870"><a href="#cb19-1870" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb19-1871"><a href="#cb19-1871" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"black"</span>)</span>
<span id="cb19-1872"><a href="#cb19-1872" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb19-1873"><a href="#cb19-1873" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-1874"><a href="#cb19-1874" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Axis titles    </span></span>
<span id="cb19-1875"><a href="#cb19-1875" aria-hidden="true" tabindex="-1"></a>  axes<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb19-1876"><a href="#cb19-1876" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(titles<span class="op">.</span><span class="at">x</span>)</span>
<span id="cb19-1877"><a href="#cb19-1877" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> width <span class="op">+</span> <span class="dv">10</span>)</span>
<span id="cb19-1878"><a href="#cb19-1878" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> panelHeight)</span>
<span id="cb19-1879"><a href="#cb19-1879" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"black"</span>)</span>
<span id="cb19-1880"><a href="#cb19-1880" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">".9rem"</span>)</span>
<span id="cb19-1881"><a href="#cb19-1881" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"start"</span>)</span>
<span id="cb19-1882"><a href="#cb19-1882" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"alignment-baseline"</span><span class="op">,</span> <span class="st">"middle"</span>)<span class="op">;</span></span>
<span id="cb19-1883"><a href="#cb19-1883" aria-hidden="true" tabindex="-1"></a>  axes<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb19-1884"><a href="#cb19-1884" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(titles<span class="op">.</span><span class="at">y</span>)</span>
<span id="cb19-1885"><a href="#cb19-1885" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb19-1886"><a href="#cb19-1886" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="op">-</span><span class="dv">15</span>)</span>
<span id="cb19-1887"><a href="#cb19-1887" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"black"</span>)</span>
<span id="cb19-1888"><a href="#cb19-1888" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">".9rem"</span>)</span>
<span id="cb19-1889"><a href="#cb19-1889" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)<span class="op">;</span></span>
<span id="cb19-1890"><a href="#cb19-1890" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-1891"><a href="#cb19-1891" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> selection<span class="op">.</span><span class="fu">node</span>()</span>
<span id="cb19-1892"><a href="#cb19-1892" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-1893"><a href="#cb19-1893" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-1894"><a href="#cb19-1894" aria-hidden="true" tabindex="-1"></a>panelAxesT <span class="op">=</span> (selection<span class="op">,</span> titles<span class="op">,</span> yScaler) <span class="kw">=&gt;</span> {</span>
<span id="cb19-1895"><a href="#cb19-1895" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-1896"><a href="#cb19-1896" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> axes <span class="op">=</span> selection<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb19-1897"><a href="#cb19-1897" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-1898"><a href="#cb19-1898" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Axis lines</span></span>
<span id="cb19-1899"><a href="#cb19-1899" aria-hidden="true" tabindex="-1"></a>  axes<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb19-1900"><a href="#cb19-1900" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> d3<span class="op">.</span><span class="fu">line</span>()([[<span class="dv">0</span><span class="op">,</span> <span class="fu">yScaler</span>(<span class="dv">0</span>)]<span class="op">,</span> [width<span class="op">,</span> <span class="fu">yScaler</span>(<span class="dv">0</span>)]]))</span>
<span id="cb19-1901"><a href="#cb19-1901" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"black"</span>)</span>
<span id="cb19-1902"><a href="#cb19-1902" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb19-1903"><a href="#cb19-1903" aria-hidden="true" tabindex="-1"></a>  axes<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb19-1904"><a href="#cb19-1904" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> d3<span class="op">.</span><span class="fu">line</span>()([[<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span>]<span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> panelHeight]]))</span>
<span id="cb19-1905"><a href="#cb19-1905" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"black"</span>)</span>
<span id="cb19-1906"><a href="#cb19-1906" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb19-1907"><a href="#cb19-1907" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-1908"><a href="#cb19-1908" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Axis titles</span></span>
<span id="cb19-1909"><a href="#cb19-1909" aria-hidden="true" tabindex="-1"></a>  axes<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb19-1910"><a href="#cb19-1910" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(titles<span class="op">.</span><span class="at">x</span>)</span>
<span id="cb19-1911"><a href="#cb19-1911" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> width <span class="op">+</span> <span class="dv">10</span>)</span>
<span id="cb19-1912"><a href="#cb19-1912" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="fu">yScaler</span>(<span class="dv">0</span>))</span>
<span id="cb19-1913"><a href="#cb19-1913" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"black"</span>)</span>
<span id="cb19-1914"><a href="#cb19-1914" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">".9rem"</span>)</span>
<span id="cb19-1915"><a href="#cb19-1915" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"start"</span>)</span>
<span id="cb19-1916"><a href="#cb19-1916" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"alignment-baseline"</span><span class="op">,</span> <span class="st">"middle"</span>)<span class="op">;</span></span>
<span id="cb19-1917"><a href="#cb19-1917" aria-hidden="true" tabindex="-1"></a>  axes<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb19-1918"><a href="#cb19-1918" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(titles<span class="op">.</span><span class="at">y</span>)</span>
<span id="cb19-1919"><a href="#cb19-1919" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb19-1920"><a href="#cb19-1920" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="op">-</span><span class="dv">15</span>)</span>
<span id="cb19-1921"><a href="#cb19-1921" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"black"</span>)</span>
<span id="cb19-1922"><a href="#cb19-1922" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">".9rem"</span>)</span>
<span id="cb19-1923"><a href="#cb19-1923" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)<span class="op">;</span></span>
<span id="cb19-1924"><a href="#cb19-1924" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-1925"><a href="#cb19-1925" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> selection<span class="op">.</span><span class="fu">node</span>()</span>
<span id="cb19-1926"><a href="#cb19-1926" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-1927"><a href="#cb19-1927" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-1928"><a href="#cb19-1928" aria-hidden="true" tabindex="-1"></a>xGuides <span class="op">=</span> (selection<span class="op">,</span> fxnInfo<span class="op">,</span> params<span class="op">,</span> yScaler<span class="op">,</span> panels <span class="op">=</span> <span class="dv">2</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb19-1929"><a href="#cb19-1929" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-1930"><a href="#cb19-1930" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> point <span class="op">=</span> <span class="fu">data</span>(fxnInfo<span class="op">.</span><span class="at">fxn</span><span class="op">,</span> params<span class="op">,</span> yScaler)[params<span class="op">.</span><span class="at">q</span>]<span class="op">;</span></span>
<span id="cb19-1931"><a href="#cb19-1931" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> guide <span class="op">=</span> selection<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">;</span></span>
<span id="cb19-1932"><a href="#cb19-1932" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-1933"><a href="#cb19-1933" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Dashed line</span></span>
<span id="cb19-1934"><a href="#cb19-1934" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> dashedLine <span class="op">=</span> guide<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb19-1935"><a href="#cb19-1935" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">line</span>([[point[<span class="dv">0</span>]<span class="op">,</span> point[<span class="dv">1</span>]]<span class="op">,</span> [point[<span class="dv">0</span>]<span class="op">,</span> panelHeight <span class="op">*</span> <span class="dv">2</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">between</span>]]))</span>
<span id="cb19-1936"><a href="#cb19-1936" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb19-1937"><a href="#cb19-1937" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> dashed)</span>
<span id="cb19-1938"><a href="#cb19-1938" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-dasharray"</span><span class="op">,</span> <span class="st">"4 4"</span>)<span class="op">;</span></span>
<span id="cb19-1939"><a href="#cb19-1939" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-1940"><a href="#cb19-1940" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Tick</span></span>
<span id="cb19-1941"><a href="#cb19-1941" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> tick <span class="op">=</span> guide<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb19-1942"><a href="#cb19-1942" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(d3<span class="op">.</span><span class="fu">format</span>(<span class="st">",.0f"</span>)(params<span class="op">.</span><span class="at">q</span>))</span>
<span id="cb19-1943"><a href="#cb19-1943" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="fu">xScaler</span>(params<span class="op">.</span><span class="at">q</span>))</span>
<span id="cb19-1944"><a href="#cb19-1944" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> panelHeight <span class="op">*</span> <span class="dv">2</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">between</span>)</span>
<span id="cb19-1945"><a href="#cb19-1945" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"dy"</span><span class="op">,</span> <span class="dv">10</span>)</span>
<span id="cb19-1946"><a href="#cb19-1946" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb19-1947"><a href="#cb19-1947" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"alignment-baseline"</span><span class="op">,</span> <span class="st">"hanging"</span>)</span>
<span id="cb19-1948"><a href="#cb19-1948" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"black"</span>)</span>
<span id="cb19-1949"><a href="#cb19-1949" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">".9rem"</span>)<span class="op">;</span></span>
<span id="cb19-1950"><a href="#cb19-1950" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-1951"><a href="#cb19-1951" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (panels <span class="op">===</span> <span class="dv">1</span>) {</span>
<span id="cb19-1952"><a href="#cb19-1952" aria-hidden="true" tabindex="-1"></a>    dashedLine<span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">line</span>([[point[<span class="dv">0</span>]<span class="op">,</span> point[<span class="dv">1</span>]]<span class="op">,</span> [point[<span class="dv">0</span>]<span class="op">,</span> panelHeight]]))<span class="op">;</span></span>
<span id="cb19-1953"><a href="#cb19-1953" aria-hidden="true" tabindex="-1"></a>    tick<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> panelHeight)</span>
<span id="cb19-1954"><a href="#cb19-1954" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb19-1955"><a href="#cb19-1955" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb19-1956"><a href="#cb19-1956" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> selection<span class="op">.</span><span class="fu">node</span>()</span>
<span id="cb19-1957"><a href="#cb19-1957" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-1958"><a href="#cb19-1958" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-1959"><a href="#cb19-1959" aria-hidden="true" tabindex="-1"></a>yGuide <span class="op">=</span> (selection<span class="op">,</span> fxnInfo<span class="op">,</span> params<span class="op">,</span> yScaler<span class="op">,</span> format <span class="op">=</span> <span class="st">",.0f"</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb19-1960"><a href="#cb19-1960" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-1961"><a href="#cb19-1961" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> point <span class="op">=</span> <span class="fu">data</span>(fxnInfo<span class="op">.</span><span class="at">fxn</span><span class="op">,</span> params<span class="op">,</span> yScaler)[params<span class="op">.</span><span class="at">q</span>]</span>
<span id="cb19-1962"><a href="#cb19-1962" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> guide <span class="op">=</span> selection<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb19-1963"><a href="#cb19-1963" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-1964"><a href="#cb19-1964" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Dashed line</span></span>
<span id="cb19-1965"><a href="#cb19-1965" aria-hidden="true" tabindex="-1"></a>  guide<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb19-1966"><a href="#cb19-1966" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb19-1967"><a href="#cb19-1967" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">line</span>([[point[<span class="dv">0</span>]<span class="op">,</span> point[<span class="dv">1</span>]]<span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> point[<span class="dv">1</span>]]]))</span>
<span id="cb19-1968"><a href="#cb19-1968" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb19-1969"><a href="#cb19-1969" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> dashed)</span>
<span id="cb19-1970"><a href="#cb19-1970" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-dasharray"</span><span class="op">,</span> <span class="st">"4 4"</span>)</span>
<span id="cb19-1971"><a href="#cb19-1971" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-1972"><a href="#cb19-1972" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Axis tick</span></span>
<span id="cb19-1973"><a href="#cb19-1973" aria-hidden="true" tabindex="-1"></a>  guide<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb19-1974"><a href="#cb19-1974" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb19-1975"><a href="#cb19-1975" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(d3<span class="op">.</span><span class="fu">format</span>(format)(fxnInfo<span class="op">.</span><span class="fu">fxn</span>(params)))</span>
<span id="cb19-1976"><a href="#cb19-1976" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb19-1977"><a href="#cb19-1977" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> point[<span class="dv">1</span>])</span>
<span id="cb19-1978"><a href="#cb19-1978" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"dx"</span><span class="op">,</span> <span class="op">-</span><span class="dv">10</span>)</span>
<span id="cb19-1979"><a href="#cb19-1979" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"end"</span>)</span>
<span id="cb19-1980"><a href="#cb19-1980" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"alignment-baseline"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb19-1981"><a href="#cb19-1981" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"black"</span>)</span>
<span id="cb19-1982"><a href="#cb19-1982" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">".9rem"</span>)<span class="op">;</span></span>
<span id="cb19-1983"><a href="#cb19-1983" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-1984"><a href="#cb19-1984" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> selection<span class="op">.</span><span class="fu">node</span>()</span>
<span id="cb19-1985"><a href="#cb19-1985" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-19-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-19-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-19-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-19-4" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20" data-startfrom="1990" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1989;"><span id="cb20-1990"><a href="#cb20-1990" aria-hidden="true" tabindex="-1"></a>addLabel <span class="op">=</span> (selection<span class="op">,</span> label<span class="op">,</span> x<span class="op">,</span> y<span class="op">,</span> anchor <span class="op">=</span> <span class="st">"start"</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb20-1991"><a href="#cb20-1991" aria-hidden="true" tabindex="-1"></a>  selection<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb20-1992"><a href="#cb20-1992" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(label)</span>
<span id="cb20-1993"><a href="#cb20-1993" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> x)</span>
<span id="cb20-1994"><a href="#cb20-1994" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> y)</span>
<span id="cb20-1995"><a href="#cb20-1995" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> anchor)</span>
<span id="cb20-1996"><a href="#cb20-1996" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"alignment-baseline"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb20-1997"><a href="#cb20-1997" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"black"</span>)</span>
<span id="cb20-1998"><a href="#cb20-1998" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">".9rem"</span>)</span>
<span id="cb20-1999"><a href="#cb20-1999" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-weight"</span><span class="op">,</span> <span class="st">"bold"</span>)<span class="op">;</span></span>
<span id="cb20-2000"><a href="#cb20-2000" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> selection<span class="op">.</span><span class="fu">node</span>()</span>
<span id="cb20-2001"><a href="#cb20-2001" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-2002"><a href="#cb20-2002" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-2003"><a href="#cb20-2003" aria-hidden="true" tabindex="-1"></a>labelsToggle <span class="op">=</span> (selection<span class="op">,</span> id) <span class="kw">=&gt;</span> {</span>
<span id="cb20-2004"><a href="#cb20-2004" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-2005"><a href="#cb20-2005" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> checkbox <span class="op">=</span> selection<span class="op">.</span><span class="fu">append</span>(<span class="st">"foreignObject"</span>)</span>
<span id="cb20-2006"><a href="#cb20-2006" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> width <span class="op">+</span> margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> <span class="dv">10</span>)</span>
<span id="cb20-2007"><a href="#cb20-2007" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span>  <span class="dv">15</span>)</span>
<span id="cb20-2008"><a href="#cb20-2008" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> <span class="dv">20</span>)</span>
<span id="cb20-2009"><a href="#cb20-2009" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> <span class="dv">20</span>)<span class="op">;</span></span>
<span id="cb20-2010"><a href="#cb20-2010" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-2011"><a href="#cb20-2011" aria-hidden="true" tabindex="-1"></a>  checkbox<span class="op">.</span><span class="fu">append</span>(<span class="st">"xhtml:input"</span>)</span>
<span id="cb20-2012"><a href="#cb20-2012" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"type"</span><span class="op">,</span> <span class="st">"checkbox"</span>)</span>
<span id="cb20-2013"><a href="#cb20-2013" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="vs">`checkbox-</span><span class="sc">${</span>id<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb20-2014"><a href="#cb20-2014" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">property</span>(<span class="st">"checked"</span><span class="op">,</span> <span class="kw">true</span>)<span class="op">;</span></span>
<span id="cb20-2015"><a href="#cb20-2015" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-2016"><a href="#cb20-2016" aria-hidden="true" tabindex="-1"></a>  selection<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb20-2017"><a href="#cb20-2017" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb20-2018"><a href="#cb20-2018" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">"Labels"</span>)</span>
<span id="cb20-2019"><a href="#cb20-2019" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> width <span class="op">+</span> margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">right</span> <span class="op">-</span> <span class="dv">25</span>)</span>
<span id="cb20-2020"><a href="#cb20-2020" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">20</span>)</span>
<span id="cb20-2021"><a href="#cb20-2021" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"end"</span>)</span>
<span id="cb20-2022"><a href="#cb20-2022" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"alignment-baseline"</span><span class="op">,</span> <span class="st">"hanging"</span>)</span>
<span id="cb20-2023"><a href="#cb20-2023" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"#84b0c5"</span>)<span class="op">;</span></span>
<span id="cb20-2024"><a href="#cb20-2024" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-2025"><a href="#cb20-2025" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> selection<span class="op">.</span><span class="fu">node</span>()</span>
<span id="cb20-2026"><a href="#cb20-2026" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-20-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-20-2" data-nodetype="declaration">

</div>
</div>
</div>
</div>


</div></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>The numbers in this and all the charts are a little imprecise. This is because, for simplicity, I’m only letting <span class="math inline">\(q\)</span> take integer values whereas the mathematics of optimization assumes we can pick any <span class="math inline">\(q\)</span> we want, be it 59 or 59.000001.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Why the MR curve’s slope should specifically be twice that of the demand curve’s stems from the fact that MR takes twice the impact of each additional increase in <span class="math inline">\(q\)</span>. If <span class="math inline">\(q\)</span> increases by 1, the price associated with that level of demand falls by, let’s say, <span class="math inline">\(b\)</span> units. Meanwhile, for every unit of <span class="math inline">\(b\)</span>, MR loses one unit from the price drop and one unit from the price adjustment via the demand curve. Thus it falls by twice <span class="math inline">\(b\)</span>.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section></div></main> <!-- /main -->
<script type="ojs-module-contents">
eyJjb250ZW50cyI6W3sibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ilxudmlld29mIHEwID0gSW5wdXRzLnJhbmdlKFswLCBxTWF4XSwgeyBsYWJlbDogXCJPdXRwdXRcIiwgc3RlcDogMSwgdmFsdWU6IDUwIH0pXG52aWV3b2YgZmMwID0gSW5wdXRzLnJhbmdlKFswLCBmY01heF0sIHsgbGFiZWw6IFwiRml4ZWQgY29zdFwiLCBzdGVwOiAxLCB2YWx1ZTogMjUwIH0pXG5cbntcbiAgY29uc3QgcGFyYW1zID0gKHsgcTogbnVsbCwgZmM6IG51bGwsIHA6IG51bGwsIGM6IG51bGwgfSk7XG4gIHBhcmFtcy5xID0gcTA7XG4gIHBhcmFtcy5mYyA9IGZjMDtcbiAgY29uc3QgaWQgPSBkMy5yYW5kb21JbnQoMTAwMDAwLCAxMDAwMDAwKSgpO1xuICBjb25zdCBheGlzVGl0bGVzID0gKHsgeDogXCJPdXRwdXRcIiwgeTogXCIkXCIgfSk7XG4gIFxuICBjb25zdCB5U2NhbGVyID0gZDMuc2NhbGVMaW5lYXIoKVxuICAgIC5kb21haW4oWzAsIGNvc3RGeG4oeyBxOiBxTWF4LCBmYzogZmNNYXggfSldKVxuICAgIC5yYW5nZShbcGFuZWxIZWlnaHQsIDBdKTtcbiAgXG4gIGNvbnN0IGNvbnRhaW5lciA9IGQzLmNyZWF0ZShcImRpdlwiKVxuXHRcdC5hdHRyKFwic3R5bGVcIiwgXCJkaXNwbGF5OiBmbGV4OyBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlclwiKTtcblx0XHRcbiAgY29uc3Qgc3ZnID0gY29udGFpbmVyLmFwcGVuZChcInN2Z1wiKVxuICAgIC5hdHRyKFwid2lkdGhcIiwgd2lkdGggKyBtYXJnaW4ubGVmdCArIG1hcmdpbi5yaWdodClcbiAgICAuYXR0cihcImhlaWdodFwiLCBwYW5lbEhlaWdodCArIG1hcmdpbi50b3AgKyBtYXJnaW4uYm90dG9tKVxuICAgIC5hdHRyKFwidmlld0JveFwiLCBbMCwgMCwgd2lkdGggKyBtYXJnaW4ubGVmdCArIG1hcmdpbi5yaWdodCwgcGFuZWxIZWlnaHQgKyBtYXJnaW4udG9wICsgbWFyZ2luLmJvdHRvbV0pXG4gICAgLmF0dHIoXCJzdHlsZVwiLCBcIm1heC13aWR0aDogMTAwJTsgaGVpZ2h0OiBhdXRvOyBoZWlnaHQ6IGludHJpbnNpYztcIilcbiAgICAuY2FsbChiYWNrZ3JvdW5kKVxuICAgIC5jYWxsKGxhYmVsc1RvZ2dsZSwgaWQpO1xuICBcbiAgY29uc3QgcGFuZWwgPSBzdmcuYXBwZW5kKFwiZ1wiKVxuICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGB0cmFuc2xhdGUoJHttYXJnaW4ubGVmdH0sICR7bWFyZ2luLnRvcH0pYClcbiAgXG4gIHBhbmVsLmFwcGVuZChcImdcIilcbiAgICAuY2FsbChjbGlwV2lkZSwgaWQpXG4gICAgLmNhbGwoYWRkQ3VydmUsIGlkLCBjb3N0LCBwYXJhbXMsIHlTY2FsZXIpXG4gICAgLmNhbGwoeUd1aWRlLCBjb3N0LCBwYXJhbXMsIHlTY2FsZXIpO1xuICBcbiAgcGFuZWwuYXBwZW5kKFwiZ1wiKVxuICAgIC5jYWxsKHBhbmVsQXhlcywgYXhpc1RpdGxlcylcbiAgICAuY2FsbCh4R3VpZGVzLCBjb3N0LCBwYXJhbXMsIHlTY2FsZXIsIDEpO1xuICBcbiAgcGFuZWwuYXBwZW5kKFwiZ1wiKVxuICAgIC5hdHRyKFwiaWRcIiwgYGxhYmVscy0ke2lkfWApXG4gICAgLmNhbGwoY2xpcFdpZGUsIGlkKVxuICAgIC5jYWxsKGFkZExhYmVsLCBcIkNvc3RcIiwgeFNjYWxlcig4NSkgKyAxMCwgeVNjYWxlcihjb3N0RnhuKHsgcTogODUsIGZjOiBwYXJhbXMuZmMgfSkpICsgMTApO1xuICAgXG4gIC8vIFRvZ2dsZSBldmVudCBsaXN0ZW5lciAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgXG4gIGNvbnN0IGNiID0gc3ZnLnNlbGVjdChcImZvcmVpZ25PYmplY3RcIikuc2VsZWN0KGBpbnB1dCNjaGVja2JveC0ke2lkfWApXG4gIFxuICBjYi5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICBjb25zdCBpc0NoZWNrZWQgPSBjYi5wcm9wZXJ0eShcImNoZWNrZWRcIik7XG4gICAgY29uc3QgY2hhcnRMYWJlbHMgPSBzdmcuc2VsZWN0QWxsKGBnI2xhYmVscy0ke2lkfWApO1xuICAgIGlzQ2hlY2tlZCA/IGNoYXJ0TGFiZWxzLnN0eWxlKFwidmlzaWJpbGl0eVwiLCBcInZpc2libGVcIikgOiBjaGFydExhYmVscy5zdHlsZShcInZpc2liaWxpdHlcIiwgXCJoaWRkZW5cIik7XG4gIH0pO1xuICBcbiAgcmV0dXJuIGNvbnRhaW5lci5ub2RlKCk7XG59XG5cbmh0bWxgPGRpdiBjbGFzcz1cIm9qcy1jYXB0aW9uXCI+VGhlIGNoZWNrYm94IGF0IHRoZSBjb3JuZXIgdG9nZ2xlcyB3aGV0aGVyIGxhYmVscyBhcmUgdmlzaWJsZSwgYSBmZWF0dXJlIHRoYXQgd2lsbCBiZSB1c2VmdWwgbGF0ZXIgYXMgb3VyIGNoYXJ0cyBnZXQgbW9yZSBjcm93ZGVkLiBZb3UgY2FuIGFsd2F5cyBob3ZlciBvdmVyIGEgY3VydmUgdG8gc2VlIGl0cyBuYW1lLjwvZGl2PmBcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ilxudmlld29mIHExID0gSW5wdXRzLnJhbmdlKFswLCBxTWF4XSwgeyBsYWJlbDogXCJPdXRwdXRcIiwgc3RlcDogMSwgdmFsdWU6IDUwIH0pXG52aWV3b2YgZmMxID0gSW5wdXRzLnJhbmdlKFswLCBmY01heF0sIHsgbGFiZWw6IFwiRml4ZWQgY29zdFwiLCBzdGVwOiAxLCB2YWx1ZTogMjUwIH0pXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTMiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ7XG4gIGNvbnN0IHBhcmFtcyA9ICh7IHE6IG51bGwsIGZjOiBudWxsLCBwOiBudWxsLCBjOiBudWxsIH0pO1xuICBwYXJhbXMucSA9IHExO1xuICBwYXJhbXMuZmMgPSBmYzE7XG4gIGNvbnN0IGlkID0gZDMucmFuZG9tSW50KDEwMDAwMCwgMTAwMDAwMCkoKTtcbiAgY29uc3QgYXhpc1RpdGxlc1RvcCA9ICh7IHg6IFwiT3V0cHV0XCIsIHk6IFwiJFwiIH0pO1xuICBjb25zdCBheGlzVGl0bGVzQm90dG9tID0gKHsgeDogXCJPdXRwdXRcIiwgeTogXCIkL3VuaXRcIiB9KTtcbiAgXG4gIGNvbnN0IHlTY2FsZXJUb3AgPSBkMy5zY2FsZUxpbmVhcigpXG4gICAgLmRvbWFpbihbMCwgY29zdEZ4bih7IHE6IHFNYXgsIGZjOiBmY01heCB9KV0pXG4gICAgLnJhbmdlKFtwYW5lbEhlaWdodCwgMF0pO1xuICAgIFxuICBjb25zdCB5U2NhbGVyQm90dG9tID0gZDMuc2NhbGVMaW5lYXIoKVxuICAgIC5kb21haW4oWzAsIGFjRnhuKHsgcTogcU1heCwgZmM6IGZjTWF4IH0pXSlcbiAgICAucmFuZ2UoW3BhbmVsSGVpZ2h0LCAwXSk7XG4gIFxuICBjb25zdCBjb250YWluZXIgPSBkMy5jcmVhdGUoXCJkaXZcIilcblx0XHQuYXR0cihcInN0eWxlXCIsIFwiZGlzcGxheTogZmxleDsganVzdGlmeS1jb250ZW50OiBjZW50ZXJcIik7XG5cdFx0XG4gIGNvbnN0IHN2ZyA9IGNvbnRhaW5lci5hcHBlbmQoXCJzdmdcIilcbiAgICAuYXR0cihcIndpZHRoXCIsIHdpZHRoICsgbWFyZ2luLmxlZnQgKyBtYXJnaW4ucmlnaHQpXG4gICAgLmF0dHIoXCJoZWlnaHRcIiwgaGVpZ2h0ICsgbWFyZ2luLnRvcCArIG1hcmdpbi5ib3R0b20pXG4gICAgLmF0dHIoXCJ2aWV3Qm94XCIsIFswLCAwLCB3aWR0aCArIG1hcmdpbi5sZWZ0ICsgbWFyZ2luLnJpZ2h0LCBoZWlnaHQgKyBtYXJnaW4udG9wICsgbWFyZ2luLmJvdHRvbV0pXG4gICAgLmF0dHIoXCJzdHlsZVwiLCBcIm1heC13aWR0aDogMTAwJTsgaGVpZ2h0OiBhdXRvOyBoZWlnaHQ6IGludHJpbnNpYztcIilcbiAgICAuY2FsbChiYWNrZ3JvdW5kKVxuICAgIC5jYWxsKGxhYmVsc1RvZ2dsZSwgaWQpO1xuICBcbiAgLy8gVG9wIHBhbmVsIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICBcbiAgY29uc3QgcGFuZWxUb3AgPSBzdmcuYXBwZW5kKFwiZ1wiKVxuICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGB0cmFuc2xhdGUoJHttYXJnaW4ubGVmdH0sICR7bWFyZ2luLnRvcH0pYCk7XG4gIFxuICBwYW5lbFRvcC5hcHBlbmQoXCJnXCIpXG4gICAgLmNhbGwoY2xpcFdpZGUsIGlkKVxuICAgIC5jYWxsKGFkZEN1cnZlLCBpZCwgY29zdCwgcGFyYW1zLCB5U2NhbGVyVG9wKVxuICAgIC5jYWxsKHlHdWlkZSwgY29zdCwgcGFyYW1zLCB5U2NhbGVyVG9wKTtcbiAgXG4gIHBhbmVsVG9wLmFwcGVuZChcImdcIilcbiAgICAuY2FsbChwYW5lbEF4ZXMsIGF4aXNUaXRsZXNUb3ApXG4gICAgLmNhbGwoeEd1aWRlcywgY29zdCwgcGFyYW1zLCB5U2NhbGVyVG9wKTtcbiAgXG4gIHBhbmVsVG9wLmFwcGVuZChcImdcIilcbiAgICAuYXR0cihcImlkXCIsIGBsYWJlbHMtJHtpZH1gKVxuICAgIC5jYWxsKGNsaXBXaWRlLCBpZClcbiAgICAuY2FsbChhZGRMYWJlbCwgXCJDb3N0XCIsIHhTY2FsZXIoODUpICsgMTAsIHlTY2FsZXJUb3AoY29zdEZ4bih7IHE6IDg1LCBmYzogcGFyYW1zLmZjIH0pKSArIDEwKTtcbiAgICBcbiAgLy8gQm90dG9tIHBhbmVsIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICBcbiAgY29uc3QgcGFuZWxCb3R0b20gPSBzdmcuYXBwZW5kKFwiZ1wiKVxuICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGB0cmFuc2xhdGUoJHttYXJnaW4ubGVmdH0sICR7bWFyZ2luLnRvcCArIHBhbmVsSGVpZ2h0ICsgbWFyZ2luLmJldHdlZW59KWApO1xuICBcbiAgcGFuZWxCb3R0b20uYXBwZW5kKFwiZ1wiKVxuICAgIC5jYWxsKGNsaXAsIGlkKVxuICAgIC5jYWxsKGFkZEN1cnZlLCBpZCwgYWMsIHBhcmFtcywgeVNjYWxlckJvdHRvbSlcbiAgICBcbiAgcGFuZWxCb3R0b20uYXBwZW5kKFwiZ1wiKVxuICAgIC5jYWxsKGNsaXBXaWRlLCBpZClcbiAgICAuY2FsbCh5R3VpZGUsIGFjLCBwYXJhbXMsIHlTY2FsZXJCb3R0b20pO1xuICBcbiAgcGFuZWxCb3R0b20uYXBwZW5kKFwiZ1wiKVxuICAgIC5jYWxsKHBhbmVsQXhlcywgYXhpc1RpdGxlc0JvdHRvbSk7XG4gIFxuICBwYW5lbEJvdHRvbS5hcHBlbmQoXCJnXCIpXG4gICAgLmF0dHIoXCJpZFwiLCBgbGFiZWxzLSR7aWR9YClcbiAgICAuY2FsbChhZGRMYWJlbCwgXCJBQ1wiLCB4U2NhbGVyKDk1KSAtIDEwLCB5U2NhbGVyQm90dG9tKGFjRnhuKHsgcTogOTUsIGZjOiBwYXJhbXMuZmMgfSkpIC0gMTAsIFwiZW5kXCIpO1xuICBcbiAgLy8gVG9nZ2xlIGV2ZW50IGxpc3RlbmVyIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICBcbiAgY29uc3QgY2IgPSBzdmcuc2VsZWN0KFwiZm9yZWlnbk9iamVjdFwiKS5zZWxlY3QoYGlucHV0I2NoZWNrYm94LSR7aWR9YCk7XG4gIFxuICBjYi5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICBjb25zdCBpc0NoZWNrZWQgPSBjYi5wcm9wZXJ0eShcImNoZWNrZWRcIik7XG4gICAgY29uc3QgY2hhcnRMYWJlbHMgPSBzdmcuc2VsZWN0QWxsKGBnI2xhYmVscy0ke2lkfWApO1xuICAgIGlzQ2hlY2tlZCA/IGNoYXJ0TGFiZWxzLnN0eWxlKFwidmlzaWJpbGl0eVwiLCBcInZpc2libGVcIikgOiBjaGFydExhYmVscy5zdHlsZShcInZpc2liaWxpdHlcIiwgXCJoaWRkZW5cIik7XG4gIH0pO1xuICBcbiAgcmV0dXJuIGNvbnRhaW5lci5ub2RlKCk7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTQiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ7XG4gIGNvbnN0IHBhcmFtcyA9ICh7IHE6IG51bGwsIGZjOiBudWxsLCBwOiBudWxsLCBjOiBudWxsIH0pO1xuICBwYXJhbXMucSA9IHExO1xuICBwYXJhbXMuZmMgPSBmYzE7XG4gIGNvbnN0IGlkID0gZDMucmFuZG9tSW50KDEwMDAwMCwgMTAwMDAwMCkoKTtcbiAgY29uc3QgYXhpc1RpdGxlc1RvcCA9ICh7IHg6IFwiT3V0cHV0XCIsIHk6IFwiJFwiIH0pO1xuICBjb25zdCBheGlzVGl0bGVzQm90dG9tID0gKHsgeDogXCJPdXRwdXRcIiwgeTogXCIkL3VuaXRcIiB9KTtcbiAgXG4gIGNvbnN0IHlTY2FsZXJUb3AgPSBkMy5zY2FsZUxpbmVhcigpXG4gICAgLmRvbWFpbihbMCwgY29zdEZ4bih7IHE6IHFNYXgsIGZjOiBmY01heCB9KV0pXG4gICAgLnJhbmdlKFtwYW5lbEhlaWdodCwgMF0pO1xuICAgIFxuICBjb25zdCB5U2NhbGVyQm90dG9tID0gZDMuc2NhbGVMaW5lYXIoKVxuICAgIC5kb21haW4oWzAsIGFjRnhuKHsgcTogcU1heCwgZmM6IGZjTWF4IH0pXSlcbiAgICAucmFuZ2UoW3BhbmVsSGVpZ2h0LCAwXSk7XG4gIFxuICBjb25zdCBjb250YWluZXIgPSBkMy5jcmVhdGUoXCJkaXZcIilcblx0XHQuYXR0cihcInN0eWxlXCIsIFwiZGlzcGxheTogZmxleDsganVzdGlmeS1jb250ZW50OiBjZW50ZXJcIik7XG5cdFx0XG4gIGNvbnN0IHN2ZyA9IGNvbnRhaW5lci5hcHBlbmQoXCJzdmdcIilcbiAgICAuYXR0cihcIndpZHRoXCIsIHdpZHRoICsgbWFyZ2luLmxlZnQgKyBtYXJnaW4ucmlnaHQpXG4gICAgLmF0dHIoXCJoZWlnaHRcIiwgaGVpZ2h0ICsgbWFyZ2luLnRvcCArIG1hcmdpbi5ib3R0b20pXG4gICAgLmF0dHIoXCJ2aWV3Qm94XCIsIFswLCAwLCB3aWR0aCArIG1hcmdpbi5sZWZ0ICsgbWFyZ2luLnJpZ2h0LCBoZWlnaHQgKyBtYXJnaW4udG9wICsgbWFyZ2luLmJvdHRvbV0pXG4gICAgLmF0dHIoXCJzdHlsZVwiLCBcIm1heC13aWR0aDogMTAwJTsgaGVpZ2h0OiBhdXRvOyBoZWlnaHQ6IGludHJpbnNpYztcIilcbiAgICAuY2FsbChiYWNrZ3JvdW5kKVxuICAgIC5jYWxsKGxhYmVsc1RvZ2dsZSwgaWQpO1xuICAgIFxuICAvLyBUb3AgcGFuZWwgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG4gIFxuICBjb25zdCBwYW5lbFRvcCA9IHN2Zy5hcHBlbmQoXCJnXCIpXG4gICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgYHRyYW5zbGF0ZSgke21hcmdpbi5sZWZ0fSwgJHttYXJnaW4udG9wfSlgKTtcbiAgXG4gIHBhbmVsVG9wLmFwcGVuZChcImdcIilcbiAgICAuY2FsbChjbGlwV2lkZSwgaWQpXG4gICAgLmNhbGwoYWRkQ3VydmUsIGlkLCBjb3N0LCBwYXJhbXMsIHlTY2FsZXJUb3ApXG4gICAgLmNhbGwoeUd1aWRlLCBjb3N0LCBwYXJhbXMsIHlTY2FsZXJUb3ApO1xuICBcbiAgcGFuZWxUb3AuYXBwZW5kKFwiZ1wiKVxuICAgIC5jYWxsKHBhbmVsQXhlcywgYXhpc1RpdGxlc1RvcClcbiAgICAuY2FsbCh4R3VpZGVzLCBjb3N0LCBwYXJhbXMsIHlTY2FsZXJUb3ApO1xuICBcbiAgcGFuZWxUb3AuYXBwZW5kKFwiZ1wiKVxuICAgIC5hdHRyKFwiaWRcIiwgYGxhYmVscy0ke2lkfWApXG4gICAgLmNhbGwoY2xpcFdpZGUsIGlkKVxuICAgIC5jYWxsKGFkZExhYmVsLCBcIkNvc3RcIiwgeFNjYWxlcig4NSkgKyAxMCwgeVNjYWxlclRvcChjb3N0RnhuKHsgcTogODUsIGZjOiBwYXJhbXMuZmMgfSkpICsgMTApO1xuICAgIFxuICAvLyBCb3R0b20gcGFuZWwgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG4gIFxuICBjb25zdCBwYW5lbEJvdHRvbSA9IHN2Zy5hcHBlbmQoXCJnXCIpXG4gICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgYHRyYW5zbGF0ZSgke21hcmdpbi5sZWZ0fSwgJHttYXJnaW4udG9wICsgcGFuZWxIZWlnaHQgKyBtYXJnaW4uYmV0d2Vlbn0pYCk7XG4gIFxuICBwYW5lbEJvdHRvbS5hcHBlbmQoXCJnXCIpXG4gICAgLmNhbGwoY2xpcCwgaWQpXG4gICAgLmNhbGwoYWRkQ3VydmVGdWxsLCBpZCwgYWMsIHBhcmFtcywgeVNjYWxlckJvdHRvbSwgZ3JheSlcbiAgICAuY2FsbChhZGRDdXJ2ZSwgaWQsIGF2YywgcGFyYW1zLCB5U2NhbGVyQm90dG9tKVxuICBcbiAgcGFuZWxCb3R0b20uYXBwZW5kKFwiZ1wiKVxuICAgIC5jYWxsKGNsaXBXaWRlLCBpZClcbiAgICAuY2FsbCh5R3VpZGUsIGF2YywgcGFyYW1zLCB5U2NhbGVyQm90dG9tKTtcbiAgXG4gIHBhbmVsQm90dG9tLmFwcGVuZChcImdcIilcbiAgICAuY2FsbChwYW5lbEF4ZXMsIGF4aXNUaXRsZXNCb3R0b20pO1xuICAgIFxuICBwYW5lbEJvdHRvbS5hcHBlbmQoXCJnXCIpXG4gICAgLmF0dHIoXCJpZFwiLCBgbGFiZWxzLSR7aWR9YClcbiAgICAuY2FsbChhZGRMYWJlbCwgXCJBQ1wiLCB4U2NhbGVyKDk1KSAtIDEwLCB5U2NhbGVyQm90dG9tKGFjRnhuKHsgcTogOTUsIGZjOiBwYXJhbXMuZmMgfSkpIC0gMTAsIFwiZW5kXCIpXG4gICAgLmNhbGwoYWRkTGFiZWwsIFwiQVZDXCIsIHhTY2FsZXIoOTUpICsgMTAsIHlTY2FsZXJCb3R0b20oYXZjRnhuKHsgcTogOTUgfSkpICsgMTApO1xuICBcbiAgLy8gVG9nZ2xlIGV2ZW50IGxpc3RlbmVyIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICBcbiAgY29uc3QgY2IgPSBzdmcuc2VsZWN0KFwiZm9yZWlnbk9iamVjdFwiKS5zZWxlY3QoYGlucHV0I2NoZWNrYm94LSR7aWR9YCk7XG4gIFxuICBjYi5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICBjb25zdCBpc0NoZWNrZWQgPSBjYi5wcm9wZXJ0eShcImNoZWNrZWRcIik7XG4gICAgY29uc3QgY2hhcnRMYWJlbHMgPSBzdmcuc2VsZWN0QWxsKGBnI2xhYmVscy0ke2lkfWApO1xuICAgIGlzQ2hlY2tlZCA/IGNoYXJ0TGFiZWxzLnN0eWxlKFwidmlzaWJpbGl0eVwiLCBcInZpc2libGVcIikgOiBjaGFydExhYmVscy5zdHlsZShcInZpc2liaWxpdHlcIiwgXCJoaWRkZW5cIik7XG4gIH0pO1xuICByZXR1cm4gY29udGFpbmVyLm5vZGUoKTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IntcbiAgY29uc3QgcGFyYW1zID0gKHsgcTogbnVsbCwgZmM6IG51bGwsIHA6IG51bGwsIGM6IG51bGwgfSk7XG4gIHBhcmFtcy5xID0gcTE7XG4gIHBhcmFtcy5mYyA9IGZjMTtcbiAgY29uc3QgaWQgPSBkMy5yYW5kb21JbnQoMTAwMDAwLCAxMDAwMDAwKSgpO1xuICBjb25zdCBheGlzVGl0bGVzVG9wID0gKHsgeDogXCJPdXRwdXRcIiwgeTogXCIkXCIgfSk7XG4gIGNvbnN0IGF4aXNUaXRsZXNCb3R0b20gPSAoeyB4OiBcIk91dHB1dFwiLCB5OiBcIiQvdW5pdFwiIH0pO1xuICBcbiAgY29uc3QgeVNjYWxlclRvcCA9IGQzLnNjYWxlTGluZWFyKClcbiAgICAuZG9tYWluKFswLCBjb3N0RnhuKHsgcTogcU1heCwgZmM6IGZjTWF4IH0pXSlcbiAgICAucmFuZ2UoW3BhbmVsSGVpZ2h0LCAwXSk7XG4gICAgXG4gIGNvbnN0IHlTY2FsZXJCb3R0b20gPSBkMy5zY2FsZUxpbmVhcigpXG4gICAgLmRvbWFpbihbMCwgYWNGeG4oeyBxOiBxTWF4LCBmYzogZmNNYXggfSldKVxuICAgIC5yYW5nZShbcGFuZWxIZWlnaHQsIDBdKTtcbiAgXG4gIGNvbnN0IGNvbnRhaW5lciA9IGQzLmNyZWF0ZShcImRpdlwiKVxuXHRcdC5hdHRyKFwic3R5bGVcIiwgXCJkaXNwbGF5OiBmbGV4OyBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlclwiKTtcblx0XHRcbiAgY29uc3Qgc3ZnID0gY29udGFpbmVyLmFwcGVuZChcInN2Z1wiKVxuICAgIC5hdHRyKFwid2lkdGhcIiwgd2lkdGggKyBtYXJnaW4ubGVmdCArIG1hcmdpbi5yaWdodClcbiAgICAuYXR0cihcImhlaWdodFwiLCBoZWlnaHQgKyBtYXJnaW4udG9wICsgbWFyZ2luLmJvdHRvbSlcbiAgICAuYXR0cihcInZpZXdCb3hcIiwgWzAsIDAsIHdpZHRoICsgbWFyZ2luLmxlZnQgKyBtYXJnaW4ucmlnaHQsIGhlaWdodCArIG1hcmdpbi50b3AgKyBtYXJnaW4uYm90dG9tXSlcbiAgICAuYXR0cihcInN0eWxlXCIsIFwibWF4LXdpZHRoOiAxMDAlOyBoZWlnaHQ6IGF1dG87IGhlaWdodDogaW50cmluc2ljO1wiKVxuICAgIC5jYWxsKGJhY2tncm91bmQpXG4gICAgLmNhbGwobGFiZWxzVG9nZ2xlLCBpZCk7XG4gICAgXG4gIC8vIFRvcCBwYW5lbCAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgXG4gIGNvbnN0IHBhbmVsVG9wID0gc3ZnLmFwcGVuZChcImdcIilcbiAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBgdHJhbnNsYXRlKCR7bWFyZ2luLmxlZnR9LCAke21hcmdpbi50b3B9KWApO1xuICBcbiAgcGFuZWxUb3AuYXBwZW5kKFwiZ1wiKVxuICAgIC5jYWxsKGNsaXBXaWRlLCBpZClcbiAgICAuY2FsbChhZGRDdXJ2ZSwgaWQsIGNvc3QsIHBhcmFtcywgeVNjYWxlclRvcClcbiAgICAuY2FsbCh5R3VpZGUsIGNvc3QsIHBhcmFtcywgeVNjYWxlclRvcCk7XG4gIFxuICBwYW5lbFRvcC5hcHBlbmQoXCJnXCIpXG4gICAgLmNhbGwocGFuZWxBeGVzLCBheGlzVGl0bGVzVG9wKVxuICAgIC5jYWxsKHhHdWlkZXMsIGNvc3QsIHBhcmFtcywgeVNjYWxlclRvcCk7XG4gICAgXG4gIHBhbmVsVG9wLmFwcGVuZChcImdcIilcbiAgICAuYXR0cihcImlkXCIsIGBsYWJlbHMtJHtpZH1gKVxuICAgIC5jYWxsKGNsaXBXaWRlLCBpZClcbiAgICAuY2FsbChhZGRMYWJlbCwgXCJDb3N0XCIsIHhTY2FsZXIoODUpICsgMTAsIHlTY2FsZXJUb3AoY29zdEZ4bih7IHE6IDg1LCBmYzogcGFyYW1zLmZjIH0pKSArIDEwKTtcbiAgICBcbiAgLy8gQm90dG9tIHBhbmVsIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICBcbiAgY29uc3QgcGFuZWxCb3R0b20gPSBzdmcuYXBwZW5kKFwiZ1wiKVxuICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGB0cmFuc2xhdGUoJHttYXJnaW4ubGVmdH0sICR7bWFyZ2luLnRvcCArIHBhbmVsSGVpZ2h0ICsgbWFyZ2luLmJldHdlZW59KWApO1xuICBcbiAgcGFuZWxCb3R0b20uYXBwZW5kKFwiZ1wiKVxuICAgIC5jYWxsKGNsaXAsIGlkKVxuICAgIC5jYWxsKGFkZEN1cnZlRnVsbCwgaWQsIGFjLCBwYXJhbXMsIHlTY2FsZXJCb3R0b20sIGdyYXkpXG4gICAgLmNhbGwoYWRkQ3VydmVGdWxsLCBpZCwgYXZjLCBwYXJhbXMsIHlTY2FsZXJCb3R0b20sIGdyYXkpXG4gICAgLmNhbGwoYWRkQ3VydmUsIGlkLCBtYywgcGFyYW1zLCB5U2NhbGVyQm90dG9tKVxuICBcbiAgcGFuZWxCb3R0b20uYXBwZW5kKFwiZ1wiKVxuICAgIC5jYWxsKGNsaXBXaWRlLCBpZClcbiAgICAuY2FsbCh5R3VpZGUsIG1jLCBwYXJhbXMsIHlTY2FsZXJCb3R0b20pO1xuICBcbiAgcGFuZWxCb3R0b20uYXBwZW5kKFwiZ1wiKVxuICAgIC5jYWxsKHBhbmVsQXhlcywgYXhpc1RpdGxlc0JvdHRvbSk7XG4gIFxuICBwYW5lbEJvdHRvbS5hcHBlbmQoXCJnXCIpXG4gICAgLmF0dHIoXCJpZFwiLCBgbGFiZWxzLSR7aWR9YClcbiAgICAuY2FsbChhZGRMYWJlbCwgXCJBQ1wiLCB4U2NhbGVyKDk1KSAtIDEwLCB5U2NhbGVyQm90dG9tKGFjRnhuKHsgcTogOTUsIGZjOiBwYXJhbXMuZmMgfSkpIC0gMTAsIFwiZW5kXCIpXG4gICAgLmNhbGwoYWRkTGFiZWwsIFwiQVZDXCIsIHhTY2FsZXIoOTUpICsgMTAsIHlTY2FsZXJCb3R0b20oYXZjRnhuKHsgcTogOTUgfSkpICsgMTApXG4gICAgLmNhbGwoYWRkTGFiZWwsIFwiTUNcIiwgeFNjYWxlcig2MykgKyAxMCwgeVNjYWxlckJvdHRvbShtY0Z4bih7IHE6IDYzIH0pKSArIDEwKTtcbiAgICBcbiAgLy8gVG9nZ2xlIGV2ZW50IGxpc3RlbmVyIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICBcbiAgY29uc3QgY2IgPSBzdmcuc2VsZWN0KFwiZm9yZWlnbk9iamVjdFwiKS5zZWxlY3QoYGlucHV0I2NoZWNrYm94LSR7aWR9YCk7XG4gIFxuICBjYi5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICBjb25zdCBpc0NoZWNrZWQgPSBjYi5wcm9wZXJ0eShcImNoZWNrZWRcIik7XG4gICAgY29uc3QgY2hhcnRMYWJlbHMgPSBzdmcuc2VsZWN0QWxsKGBnI2xhYmVscy0ke2lkfWApO1xuICAgIGlzQ2hlY2tlZCA/IGNoYXJ0TGFiZWxzLnN0eWxlKFwidmlzaWJpbGl0eVwiLCBcInZpc2libGVcIikgOiBjaGFydExhYmVscy5zdHlsZShcInZpc2liaWxpdHlcIiwgXCJoaWRkZW5cIik7XG4gIH0pO1xuICBcbiAgcmV0dXJuIGNvbnRhaW5lci5ub2RlKCk7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTYiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJcbnZpZXdvZiBxMiA9IElucHV0cy5yYW5nZShbMCwgcU1heF0sIHtsYWJlbDogXCJPdXRwdXRcIiwgc3RlcDogMSwgdmFsdWU6IDUwfSlcbnZpZXdvZiBmYzIgPSBJbnB1dHMucmFuZ2UoWzAsIGZjTWF4XSwge2xhYmVsOiBcIkZpeGVkIGNvc3RcIiwgc3RlcDogMSwgdmFsdWU6IDI1MCwgZGlzYWJsZWQ6IHRydWV9KVxudmlld29mIHAyID0gSW5wdXRzLnJhbmdlKFswLCBwTWF4XSwge2xhYmVsOiBcIlByaWNlXCIsIHN0ZXA6IC4xLCB2YWx1ZTogMTcsIGRpc2FibGVkOiB0cnVlfSlcblxue1xuICBjb25zdCBwYXJhbXMgPSAoeyBxOiBudWxsLCBmYzogbnVsbCwgcDogbnVsbCwgYzogbnVsbCB9KTtcbiAgcGFyYW1zLnEgPSBxMjtcbiAgcGFyYW1zLmZjID0gZmMyO1xuICBwYXJhbXMucCA9IHAyO1xuICBjb25zdCBpZCA9IGQzLnJhbmRvbUludCgxMDAwMDAsIDEwMDAwMDApKCk7XG4gIGNvbnN0IGF4aXNUaXRsZXNUb3AgPSAoeyB4OiBcIk91dHB1dFwiLCB5OiBcIiRcIiB9KTtcbiAgY29uc3QgYXhpc1RpdGxlc0JvdHRvbSA9ICh7IHg6IFwiT3V0cHV0XCIsIHk6IFwiJC91bml0XCIgfSk7XG4gIFxuICBjb25zdCB5U2NhbGVyVG9wID0gZDMuc2NhbGVMaW5lYXIoKVxuICAgIC5kb21haW4oWy04MDAsIDgwMF0pXG4gICAgLnJhbmdlKFtwYW5lbEhlaWdodCwgMF0pO1xuICBjb25zdCB5U2NhbGVyQm90dG9tID0gZDMuc2NhbGVMaW5lYXIoKVxuICAgIC5kb21haW4oWzAsIGFjRnhuKHsgcTogcU1heCwgZmM6IGZjTWF4IH0pXSlcbiAgICAucmFuZ2UoW3BhbmVsSGVpZ2h0LCAwXSk7XG4gICAgXG4gIGNvbnN0IGNvcm5lcnMgPSAoeyB4MTogMCwgeTE6IHlTY2FsZXJCb3R0b20ocGFyYW1zLnApLCB4MjogeFNjYWxlcihwYXJhbXMucSksIHkyOiB5U2NhbGVyQm90dG9tKGFjRnhuKHBhcmFtcykpIH0pO1xuXG4gIGNvbnN0IGNvbnRhaW5lciA9IGQzLmNyZWF0ZShcImRpdlwiKVxuXHRcdC5hdHRyKFwic3R5bGVcIiwgXCJkaXNwbGF5OiBmbGV4OyBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlclwiKTtcblx0XG4gIGNvbnN0IHN2ZyA9IGNvbnRhaW5lci5hcHBlbmQoXCJzdmdcIilcbiAgICAuYXR0cihcIndpZHRoXCIsIHdpZHRoICsgbWFyZ2luLmxlZnQgKyBtYXJnaW4ucmlnaHQpXG4gICAgLmF0dHIoXCJoZWlnaHRcIiwgaGVpZ2h0ICsgbWFyZ2luLnRvcCArIG1hcmdpbi5ib3R0b20pXG4gICAgLmF0dHIoXCJ2aWV3Qm94XCIsIFswLCAwLCB3aWR0aCArIG1hcmdpbi5sZWZ0ICsgbWFyZ2luLnJpZ2h0LCBoZWlnaHQgKyBtYXJnaW4udG9wICsgbWFyZ2luLmJvdHRvbV0pXG4gICAgLmF0dHIoXCJzdHlsZVwiLCBcIm1heC13aWR0aDogMTAwJTsgaGVpZ2h0OiBhdXRvOyBoZWlnaHQ6IGludHJpbnNpYztcIilcbiAgICAuY2FsbChiYWNrZ3JvdW5kKVxuICAgIC5jYWxsKGxhYmVsc1RvZ2dsZSwgaWQpO1xuICBcbiAgLy8gVG9wIHBhbmVsIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICBcbiAgY29uc3QgcGFuZWxUb3AgPSBzdmcuYXBwZW5kKFwiZ1wiKVxuICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGB0cmFuc2xhdGUoJHttYXJnaW4ubGVmdH0sICR7bWFyZ2luLnRvcH0pYClcbiAgXG4gIHBhbmVsVG9wLmFwcGVuZChcImdcIilcbiAgICAuY2FsbChjbGlwV2lkZSwgaWQpXG4gICAgLmNhbGwoYWRkQ3VydmUsIGlkLCBwcm9maXQsIHBhcmFtcywgeVNjYWxlclRvcClcbiAgICAuY2FsbCh5R3VpZGUsIHByb2ZpdCwgcGFyYW1zLCB5U2NhbGVyVG9wKTtcbiAgXG4gIHBhbmVsVG9wLmFwcGVuZChcImdcIilcbiAgICAuY2FsbChwYW5lbEF4ZXNULCBheGlzVGl0bGVzVG9wLCB5U2NhbGVyVG9wKVxuICAgIC5jYWxsKHhHdWlkZXMsIHByb2ZpdCwgcGFyYW1zLCB5U2NhbGVyVG9wKTtcbiAgXG4gIHBhbmVsVG9wLmFwcGVuZChcImdcIilcbiAgICAuYXR0cihcImlkXCIsIGBsYWJlbHMtJHtpZH1gKVxuICAgIC5jYWxsKGNsaXBXaWRlLCBpZClcbiAgICAuY2FsbChhZGRMYWJlbCwgXCJQcm9maXRcIiwgeFNjYWxlcig3MCkgKyAxMCwgeVNjYWxlclRvcChwcm9maXRGeG4oeyBxOiA3MCwgcDogcGFyYW1zLnAsIGZjOiBwYXJhbXMuZmMgfSkpIC0gMTApO1xuICBcbiAgLy8gQm90dG9tIHBhbmVsIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICBcbiAgY29uc3QgcGFuZWxCb3R0b20gPSBzdmcuYXBwZW5kKFwiZ1wiKVxuICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGB0cmFuc2xhdGUoJHttYXJnaW4ubGVmdH0sICR7bWFyZ2luLnRvcCArIHBhbmVsSGVpZ2h0ICsgbWFyZ2luLmJldHdlZW59KWApO1xuICBcbiAgcGFuZWxCb3R0b20uYXBwZW5kKFwiZ1wiKVxuICAgIC5jYWxsKGNsaXBXaWRlLCBpZClcbiAgICAuY2FsbChhZGRBcmVhLCBpZCwgcHJvZml0LCBjb3JuZXJzKVxuICAgIC5zZWxlY3QoXCJwYXRoXCIpXG4gICAgLnN0eWxlKFwiZmlsbFwiLCBjb3JuZXJzLnkxIDwgY29ybmVycy55MiA/IFwiIzdmYzZhNFwiIDogXCIjZjY5N2JiXCIpO1xuICAgIFxuICBwYW5lbEJvdHRvbS5hcHBlbmQoXCJnXCIpXG4gICAgLmNhbGwoY2xpcCwgaWQpXG4gICAgLmNhbGwoYWRkQ3VydmUsIGlkLCBhdmMsIHBhcmFtcywgeVNjYWxlckJvdHRvbSlcbiAgICAuY2FsbChhZGRDdXJ2ZSwgaWQsIG1jLCBwYXJhbXMsIHlTY2FsZXJCb3R0b20pXG4gICAgLmNhbGwoYWRkQ3VydmUsIGlkLCBhYywgcGFyYW1zLCB5U2NhbGVyQm90dG9tKVxuICBcbiAgcGFuZWxCb3R0b20uYXBwZW5kKFwiZ1wiKVxuICAgIC5jYWxsKGNsaXBXaWRlLCBpZClcbiAgICAuY2FsbCh5R3VpZGUsIHByaWNlLCBwYXJhbXMsIHlTY2FsZXJCb3R0b20pXG4gICAgLmNhbGwoYWRkQ3VydmVGdWxsLCBpZCwgcHJpY2UsIHBhcmFtcywgeVNjYWxlckJvdHRvbSlcbiAgICAuY2FsbCh5R3VpZGUsIGFjLCBwYXJhbXMsIHlTY2FsZXJCb3R0b20pO1xuICAgIFxuICBwYW5lbEJvdHRvbS5hcHBlbmQoXCJnXCIpXG4gICAgLmNhbGwocGFuZWxBeGVzLCBheGlzVGl0bGVzQm90dG9tKVxuXG4gIHBhbmVsQm90dG9tLmFwcGVuZChcImdcIilcbiAgICAuYXR0cihcImlkXCIsIGBsYWJlbHMtJHtpZH1gKVxuICAgIC5jYWxsKGFkZExhYmVsLCBcIlByaWNlXCIsIHdpZHRoICsgMTAsIHlTY2FsZXJCb3R0b20ocGFyYW1zLnApKVxuICAgIC5jYWxsKGFkZExhYmVsLCBcIkFDXCIsIHhTY2FsZXIoOTUpIC0gMTAsIHlTY2FsZXJCb3R0b20oYWNGeG4oeyBxOiA5NSwgZmM6IHBhcmFtcy5mYyB9KSkgLSAxMCwgXCJlbmRcIilcbiAgICAuY2FsbChhZGRMYWJlbCwgXCJBVkNcIiwgeFNjYWxlcig5NSkgKyAxMCwgeVNjYWxlckJvdHRvbShhdmNGeG4oeyBxOiA5NSB9KSkgKyAxMClcbiAgICAuY2FsbChhZGRMYWJlbCwgXCJNQ1wiLCB4U2NhbGVyKDYzKSArIDEwLCB5U2NhbGVyQm90dG9tKG1jRnhuKHsgcTogNjMgfSkpICsgMTApO1xuICBcbiAgLy8gVG9nZ2xlIGV2ZW50IGxpc3RlbmVyIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICBcbiAgY29uc3QgY2IgPSBzdmcuc2VsZWN0KFwiZm9yZWlnbk9iamVjdFwiKS5zZWxlY3QoYGlucHV0I2NoZWNrYm94LSR7aWR9YClcbiAgXG4gIGNiLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIGNvbnN0IGlzQ2hlY2tlZCA9IGNiLnByb3BlcnR5KFwiY2hlY2tlZFwiKTtcbiAgICBjb25zdCBjaGFydExhYmVscyA9IHN2Zy5zZWxlY3RBbGwoYGcjbGFiZWxzLSR7aWR9YCk7XG4gICAgaXNDaGVja2VkID8gY2hhcnRMYWJlbHMuc3R5bGUoXCJ2aXNpYmlsaXR5XCIsIFwidmlzaWJsZVwiKSA6IGNoYXJ0TGFiZWxzLnN0eWxlKFwidmlzaWJpbGl0eVwiLCBcImhpZGRlblwiKTtcbiAgfSk7XG4gIFxuICByZXR1cm4gY29udGFpbmVyLm5vZGUoKTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ilxudmlld29mIHEzID0gSW5wdXRzLnJhbmdlKFswLCBxTWF4XSwge2xhYmVsOiBcIk91dHB1dFwiLCBzdGVwOiAxLCB2YWx1ZTogNTB9KVxudmlld29mIGZjMyA9IElucHV0cy5yYW5nZShbMCwgZmNNYXhdLCB7bGFiZWw6IFwiRml4ZWQgY29zdFwiLCBzdGVwOiAxLCB2YWx1ZTogMjUwLCBkaXNhYmxlZDogdHJ1ZSB9KVxudmlld29mIHAzID0gSW5wdXRzLnJhbmdlKFswLCBwTWF4XSwge2xhYmVsOiBcIlByaWNlXCIsIHN0ZXA6IC4xLCB2YWx1ZTogMTAsIGRpc2FibGVkOiB0cnVlIH0pXG5cbntcbiAgY29uc3QgcGFyYW1zID0gKHsgcTogbnVsbCwgZmM6IG51bGwsIHA6IG51bGwsIGM6IG51bGwgfSk7XG4gIHBhcmFtcy5xID0gcTM7XG4gIHBhcmFtcy5wID0gcDM7XG4gIHBhcmFtcy5mYyA9IGZjMztcbiAgY29uc3QgaWQgPSBkMy5yYW5kb21JbnQoMTAwMDAwLCAxMDAwMDAwKSgpO1xuICBjb25zdCBheGlzVGl0bGVzVG9wID0gKHsgeDogXCJPdXRwdXRcIiwgeTogXCIkXCIgfSk7XG4gIGNvbnN0IGF4aXNUaXRsZXNCb3R0b20gPSAoeyB4OiBcIk91dHB1dFwiLCB5OiBcIiQvdW5pdFwiIH0pO1xuICBcbiAgY29uc3QgeVNjYWxlclRvcCA9IGQzLnNjYWxlTGluZWFyKClcbiAgICAuZG9tYWluKFstODAwLCA4MDBdKVxuICAgIC5yYW5nZShbcGFuZWxIZWlnaHQsIDBdKTtcbiAgY29uc3QgeVNjYWxlckJvdHRvbSA9IGQzLnNjYWxlTGluZWFyKClcbiAgICAuZG9tYWluKFswLCBhY0Z4bih7IHE6IHFNYXgsIGZjOiBmY01heCB9KV0pXG4gICAgLnJhbmdlKFtwYW5lbEhlaWdodCwgMF0pO1xuICAgIFxuICBjb25zdCBjb3JuZXJzID0gKHsgeDE6IDAsIHkxOiB5U2NhbGVyQm90dG9tKHBhcmFtcy5wKSwgeDI6IHhTY2FsZXIocGFyYW1zLnEpLCB5MjogeVNjYWxlckJvdHRvbShhY0Z4bihwYXJhbXMpKSB9KTtcblxuICBjb25zdCBjb250YWluZXIgPSBkMy5jcmVhdGUoXCJkaXZcIilcblx0XHQuYXR0cihcInN0eWxlXCIsIFwiZGlzcGxheTogZmxleDsganVzdGlmeS1jb250ZW50OiBjZW50ZXJcIik7XG5cdFxuICBjb25zdCBzdmcgPSBjb250YWluZXIuYXBwZW5kKFwic3ZnXCIpXG4gICAgLmF0dHIoXCJ3aWR0aFwiLCB3aWR0aCArIG1hcmdpbi5sZWZ0ICsgbWFyZ2luLnJpZ2h0KVxuICAgIC5hdHRyKFwiaGVpZ2h0XCIsIGhlaWdodCArIG1hcmdpbi50b3AgKyBtYXJnaW4uYm90dG9tKVxuICAgIC5hdHRyKFwidmlld0JveFwiLCBbMCwgMCwgd2lkdGggKyBtYXJnaW4ubGVmdCArIG1hcmdpbi5yaWdodCwgaGVpZ2h0ICsgbWFyZ2luLnRvcCArIG1hcmdpbi5ib3R0b21dKVxuICAgIC5hdHRyKFwic3R5bGVcIiwgXCJtYXgtd2lkdGg6IDEwMCU7IGhlaWdodDogYXV0bzsgaGVpZ2h0OiBpbnRyaW5zaWM7XCIpXG4gICAgLmNhbGwoYmFja2dyb3VuZClcbiAgICAuY2FsbChsYWJlbHNUb2dnbGUsIGlkKTtcbiAgXG4gIC8vIFRvcCBwYW5lbCAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgXG4gIGNvbnN0IHBhbmVsVG9wID0gc3ZnLmFwcGVuZChcImdcIilcbiAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBgdHJhbnNsYXRlKCR7bWFyZ2luLmxlZnR9LCAke21hcmdpbi50b3B9KWApXG4gIFxuICBwYW5lbFRvcC5hcHBlbmQoXCJnXCIpXG4gICAgLmNhbGwoY2xpcFdpZGUsIGlkKVxuICAgIC5jYWxsKGFkZEN1cnZlLCBpZCwgcHJvZml0LCBwYXJhbXMsIHlTY2FsZXJUb3ApXG4gICAgLmNhbGwoeUd1aWRlLCBwcm9maXQsIHBhcmFtcywgeVNjYWxlclRvcCk7XG4gIFxuICBwYW5lbFRvcC5hcHBlbmQoXCJnXCIpXG4gICAgLmNhbGwocGFuZWxBeGVzVCwgYXhpc1RpdGxlc1RvcCwgeVNjYWxlclRvcClcbiAgICAuY2FsbCh4R3VpZGVzLCBwcm9maXQsIHBhcmFtcywgeVNjYWxlclRvcCk7XG4gIFxuICBwYW5lbFRvcC5hcHBlbmQoXCJnXCIpXG4gICAgLmF0dHIoXCJpZFwiLCBgbGFiZWxzLSR7aWR9YClcbiAgICAuY2FsbChjbGlwV2lkZSwgaWQpXG4gICAgLmNhbGwoYWRkTGFiZWwsIFwiUHJvZml0XCIsIHhTY2FsZXIoNzApICsgMTAsIHlTY2FsZXJUb3AocHJvZml0RnhuKHsgcTogNzAsIHA6IHBhcmFtcy5wLCBmYzogcGFyYW1zLmZjIH0pKSAtIDEwKTtcbiAgXG4gIC8vIEJvdHRvbSBwYW5lbCAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgXG4gIGNvbnN0IHBhbmVsQm90dG9tID0gc3ZnLmFwcGVuZChcImdcIilcbiAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBgdHJhbnNsYXRlKCR7bWFyZ2luLmxlZnR9LCAke21hcmdpbi50b3AgKyBwYW5lbEhlaWdodCArIG1hcmdpbi5iZXR3ZWVufSlgKTtcbiAgXG4gIHBhbmVsQm90dG9tLmFwcGVuZChcImdcIilcbiAgICAuY2FsbChjbGlwV2lkZSwgaWQpXG4gICAgLmNhbGwoYWRkQXJlYSwgaWQsIHByb2ZpdCwgY29ybmVycylcbiAgICAuc2VsZWN0KFwicGF0aFwiKVxuICAgIC5zdHlsZShcImZpbGxcIiwgY29ybmVycy55MSA8IGNvcm5lcnMueTIgPyBcIiM3ZmM2YTRcIiA6IFwiI2Y2OTdiYlwiKTtcbiAgICBcbiAgcGFuZWxCb3R0b20uYXBwZW5kKFwiZ1wiKVxuICAgIC5jYWxsKGNsaXAsIGlkKVxuICAgIC5jYWxsKGFkZEN1cnZlRnVsbCwgaWQsIGF2YywgcGFyYW1zLCB5U2NhbGVyQm90dG9tLCBncmF5KVxuICAgIC5jYWxsKGFkZEN1cnZlRnVsbCwgaWQsIGFjLCBwYXJhbXMsIHlTY2FsZXJCb3R0b20sIGdyYXkpXG4gICAgLmNhbGwoYWRkQ3VydmUsIGlkLCBtYywgcGFyYW1zLCB5U2NhbGVyQm90dG9tKVxuICBcbiAgcGFuZWxCb3R0b20uYXBwZW5kKFwiZ1wiKVxuICAgIC5jYWxsKGNsaXBXaWRlLCBpZClcbiAgICAuY2FsbCh5R3VpZGUsIG1yLCBwYXJhbXMsIHlTY2FsZXJCb3R0b20pXG4gICAgLmNhbGwoYWRkQ3VydmVGdWxsLCBpZCwgbXIsIHBhcmFtcywgeVNjYWxlckJvdHRvbSlcbiAgICAuY2FsbCh5R3VpZGUsIGFjLCBwYXJhbXMsIHlTY2FsZXJCb3R0b20pO1xuICAgIFxuICBwYW5lbEJvdHRvbS5hcHBlbmQoXCJnXCIpXG4gICAgLmNhbGwocGFuZWxBeGVzLCBheGlzVGl0bGVzQm90dG9tKVxuXG4gIHBhbmVsQm90dG9tLmFwcGVuZChcImdcIilcbiAgICAuYXR0cihcImlkXCIsIGBsYWJlbHMtJHtpZH1gKVxuICAgIC5jYWxsKGFkZExhYmVsLCBcIlByaWNlXCIsIHdpZHRoICsgMTAsIHlTY2FsZXJCb3R0b20ocGFyYW1zLnApKVxuICAgIC5jYWxsKGFkZExhYmVsLCBcIkFDXCIsIHhTY2FsZXIoOTUpIC0gMTAsIHlTY2FsZXJCb3R0b20oYWNGeG4oeyBxOiA5NSwgZmM6IHBhcmFtcy5mYyB9KSkgLSAxMCwgXCJlbmRcIilcbiAgICAuY2FsbChhZGRMYWJlbCwgXCJBVkNcIiwgeFNjYWxlcig5NSkgKyAxMCwgeVNjYWxlckJvdHRvbShhdmNGeG4oeyBxOiA5NSB9KSkgKyAxMClcbiAgICAuY2FsbChhZGRMYWJlbCwgXCJNQ1wiLCB4U2NhbGVyKDYzKSArIDEwLCB5U2NhbGVyQm90dG9tKG1jRnhuKHsgcTogNjMgfSkpICsgMTApO1xuICBcbiAgLy8gVG9nZ2xlIGV2ZW50IGxpc3RlbmVyIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICBcbiAgY29uc3QgY2IgPSBzdmcuc2VsZWN0KFwiZm9yZWlnbk9iamVjdFwiKS5zZWxlY3QoYGlucHV0I2NoZWNrYm94LSR7aWR9YClcbiAgXG4gIGNiLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIGNvbnN0IGlzQ2hlY2tlZCA9IGNiLnByb3BlcnR5KFwiY2hlY2tlZFwiKTtcbiAgICBjb25zdCBjaGFydExhYmVscyA9IHN2Zy5zZWxlY3RBbGwoYGcjbGFiZWxzLSR7aWR9YCk7XG4gICAgaXNDaGVja2VkID8gY2hhcnRMYWJlbHMuc3R5bGUoXCJ2aXNpYmlsaXR5XCIsIFwidmlzaWJsZVwiKSA6IGNoYXJ0TGFiZWxzLnN0eWxlKFwidmlzaWJpbGl0eVwiLCBcImhpZGRlblwiKTtcbiAgfSk7XG4gIFxuICByZXR1cm4gY29udGFpbmVyLm5vZGUoKTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtOCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ilxudmlld29mIHE0ID0gSW5wdXRzLnJhbmdlKFswLCBxTWF4XSwge2xhYmVsOiBcIk91dHB1dFwiLCBzdGVwOiAxLCB2YWx1ZTogNTAgfSlcbnZpZXdvZiBmYzQgPSBJbnB1dHMucmFuZ2UoWzAsIGZjTWF4XSwge2xhYmVsOiBcIkZpeGVkIGNvc3RcIiwgc3RlcDogMSwgdmFsdWU6IDI1MCwgZGlzYWJsZWQ6IHRydWUgfSlcbnZpZXdvZiBwNCA9IElucHV0cy5yYW5nZShbMCwgcE1heF0sIHtsYWJlbDogXCJQcmljZVwiLCBzdGVwOiAuMSwgdmFsdWU6IDE1IH0pXG5cbntcbiAgY29uc3QgcGFyYW1zID0gKHsgcTogbnVsbCwgZmM6IG51bGwsIHA6IG51bGwsIGM6IG51bGwgfSk7XG4gIHBhcmFtcy5xID0gcTQ7XG4gIHBhcmFtcy5wID0gcDQ7XG4gIHBhcmFtcy5mYyA9IGZjNDtcbiAgY29uc3QgaWQgPSBkMy5yYW5kb21JbnQoMTAwMDAwLCAxMDAwMDAwKSgpO1xuICBjb25zdCBheGlzVGl0bGVzVG9wID0gKHsgeDogXCJPdXRwdXRcIiwgeTogXCIkXCIgfSk7XG4gIGNvbnN0IGF4aXNUaXRsZXNCb3R0b20gPSAoeyB4OiBcIk91dHB1dFwiLCB5OiBcIiQvdW5pdFwiIH0pO1xuICBcbiAgY29uc3QgeVNjYWxlclRvcCA9IGQzLnNjYWxlTGluZWFyKClcbiAgICAuZG9tYWluKFstODAwLCA4MDBdKVxuICAgIC5yYW5nZShbcGFuZWxIZWlnaHQsIDBdKTtcbiAgY29uc3QgeVNjYWxlckJvdHRvbSA9IGQzLnNjYWxlTGluZWFyKClcbiAgICAuZG9tYWluKFswLCBhY0Z4bih7IHE6IHFNYXgsIGZjOiBmY01heCB9KV0pXG4gICAgLnJhbmdlKFtwYW5lbEhlaWdodCwgMF0pO1xuICAgIFxuICBjb25zdCBjb3JuZXJzID0gKHsgeDE6IDAsIHkxOiB5U2NhbGVyQm90dG9tKHBhcmFtcy5wKSwgeDI6IHhTY2FsZXIocGFyYW1zLnEpLCB5MjogeVNjYWxlckJvdHRvbShhY0Z4bihwYXJhbXMpKSB9KTtcbiAgXG4gIGNvbnN0IGNvbnRhaW5lciA9IGQzLmNyZWF0ZShcImRpdlwiKVxuXHRcdC5hdHRyKFwic3R5bGVcIiwgXCJkaXNwbGF5OiBmbGV4OyBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlclwiKTtcblx0XG4gIGNvbnN0IHN2ZyA9IGNvbnRhaW5lci5hcHBlbmQoXCJzdmdcIilcbiAgICAuYXR0cihcIndpZHRoXCIsIHdpZHRoICsgbWFyZ2luLmxlZnQgKyBtYXJnaW4ucmlnaHQpXG4gICAgLmF0dHIoXCJoZWlnaHRcIiwgaGVpZ2h0ICsgbWFyZ2luLnRvcCArIG1hcmdpbi5ib3R0b20pXG4gICAgLmF0dHIoXCJ2aWV3Qm94XCIsIFswLCAwLCB3aWR0aCArIG1hcmdpbi5sZWZ0ICsgbWFyZ2luLnJpZ2h0LCBoZWlnaHQgKyBtYXJnaW4udG9wICsgbWFyZ2luLmJvdHRvbV0pXG4gICAgLmF0dHIoXCJzdHlsZVwiLCBcIm1heC13aWR0aDogMTAwJTsgaGVpZ2h0OiBhdXRvOyBoZWlnaHQ6IGludHJpbnNpYztcIilcbiAgICAuY2FsbChiYWNrZ3JvdW5kKVxuICAgIC5jYWxsKGxhYmVsc1RvZ2dsZSwgaWQpO1xuICBcbiAgLy8gVG9wIHBhbmVsIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICBcbiAgY29uc3QgcGFuZWxUb3AgPSBzdmcuYXBwZW5kKFwiZ1wiKVxuICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGB0cmFuc2xhdGUoJHttYXJnaW4ubGVmdH0sICR7bWFyZ2luLnRvcH0pYClcbiAgXG4gIHBhbmVsVG9wLmFwcGVuZChcImdcIilcbiAgICAuY2FsbChjbGlwV2lkZSwgaWQpXG4gICAgLmNhbGwoYWRkQ3VydmUsIGlkLCBwcm9maXQsIHBhcmFtcywgeVNjYWxlclRvcClcbiAgICAuY2FsbCh5R3VpZGUsIHByb2ZpdCwgcGFyYW1zLCB5U2NhbGVyVG9wKTtcbiAgXG4gIHBhbmVsVG9wLmFwcGVuZChcImdcIilcbiAgICAuY2FsbChwYW5lbEF4ZXNULCBheGlzVGl0bGVzVG9wLCB5U2NhbGVyVG9wKVxuICAgIC5jYWxsKHhHdWlkZXMsIHByb2ZpdCwgcGFyYW1zLCB5U2NhbGVyVG9wKTtcbiAgXG4gIHBhbmVsVG9wLmFwcGVuZChcImdcIilcbiAgICAuYXR0cihcImlkXCIsIGBsYWJlbHMtJHtpZH1gKVxuICAgIC5jYWxsKGNsaXBXaWRlLCBpZClcbiAgICAuY2FsbChhZGRMYWJlbCwgXCJQcm9maXRcIiwgeFNjYWxlcig3MCkgKyAxMCwgeVNjYWxlclRvcChwcm9maXRGeG4oeyBxOiA3MCwgcDogcGFyYW1zLnAsIGZjOiBwYXJhbXMuZmMgfSkpIC0gMTApO1xuICBcbiAgLy8gQm90dG9tIHBhbmVsIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICBcbiAgY29uc3QgcGFuZWxCb3R0b20gPSBzdmcuYXBwZW5kKFwiZ1wiKVxuICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGB0cmFuc2xhdGUoJHttYXJnaW4ubGVmdH0sICR7bWFyZ2luLnRvcCArIHBhbmVsSGVpZ2h0ICsgbWFyZ2luLmJldHdlZW59KWApO1xuICBcbiAgcGFuZWxCb3R0b20uYXBwZW5kKFwiZ1wiKVxuICAgIC5jYWxsKGNsaXBXaWRlLCBpZClcbiAgICAuY2FsbChhZGRBcmVhLCBpZCwgcHJvZml0LCBjb3JuZXJzKVxuICAgIC5zZWxlY3QoXCJwYXRoXCIpXG4gICAgLnN0eWxlKFwiZmlsbFwiLCBjb3JuZXJzLnkxIDwgY29ybmVycy55MiA/IFwiIzdmYzZhNFwiIDogXCIjZjY5N2JiXCIpO1xuICAgIFxuICBwYW5lbEJvdHRvbS5hcHBlbmQoXCJnXCIpXG4gICAgLmNhbGwoY2xpcCwgaWQpXG4gICAgLmNhbGwoYWRkQ3VydmVGdWxsLCBpZCwgYXZjLCBwYXJhbXMsIHlTY2FsZXJCb3R0b20sIGdyYXkpXG4gICAgLmNhbGwoYWRkQ3VydmVGdWxsLCBpZCwgYWMsIHBhcmFtcywgeVNjYWxlckJvdHRvbSwgZ3JheSlcbiAgICAuY2FsbChhZGRDdXJ2ZSwgaWQsIG1jLCBwYXJhbXMsIHlTY2FsZXJCb3R0b20pXG4gICAgXG4gIHBhbmVsQm90dG9tLmFwcGVuZChcImdcIilcbiAgICAuY2FsbChjbGlwV2lkZSwgaWQpXG4gICAgLmNhbGwoeUd1aWRlLCBtciwgcGFyYW1zLCB5U2NhbGVyQm90dG9tKVxuICAgIC5jYWxsKGFkZEN1cnZlRnVsbCwgaWQsIG1yLCBwYXJhbXMsIHlTY2FsZXJCb3R0b20pXG4gICAgLmNhbGwoeUd1aWRlLCBhYywgcGFyYW1zLCB5U2NhbGVyQm90dG9tKTtcbiAgICBcbiAgcGFuZWxCb3R0b20uYXBwZW5kKFwiZ1wiKVxuICAgIC5jYWxsKHBhbmVsQXhlcywgYXhpc1RpdGxlc0JvdHRvbSlcblxuICBwYW5lbEJvdHRvbS5hcHBlbmQoXCJnXCIpXG4gICAgLmF0dHIoXCJpZFwiLCBgbGFiZWxzLSR7aWR9YClcbiAgICAuY2FsbChhZGRMYWJlbCwgXCJQcmljZVwiLCB3aWR0aCArIDEwLCB5U2NhbGVyQm90dG9tKHBhcmFtcy5wKSlcbiAgICAuY2FsbChhZGRMYWJlbCwgXCJBQ1wiLCB4U2NhbGVyKDk1KSAtIDEwLCB5U2NhbGVyQm90dG9tKGFjRnhuKHsgcTogOTUsIGZjOiBwYXJhbXMuZmMgfSkpIC0gMTAsIFwiZW5kXCIpXG4gICAgLmNhbGwoYWRkTGFiZWwsIFwiQVZDXCIsIHhTY2FsZXIoOTUpICsgMTAsIHlTY2FsZXJCb3R0b20oYXZjRnhuKHsgcTogOTUgfSkpICsgMTApXG4gICAgLmNhbGwoYWRkTGFiZWwsIFwiTUNcIiwgeFNjYWxlcig2MykgKyAxMCwgeVNjYWxlckJvdHRvbShtY0Z4bih7IHE6IDYzIH0pKSArIDEwKTtcbiAgXG4gIC8vIFNodXRkb3duIHBvaW50XG4gIHBhbmVsQm90dG9tLmFwcGVuZChcImdcIilcbiAgICAuYXBwZW5kKFwiY2lyY2xlXCIpXG4gICAgLmF0dHIoXCJjeFwiLCB4U2NhbGVyKDM2KSlcbiAgICAuYXR0cihcImN5XCIsIHlTY2FsZXJCb3R0b20obWNGeG4oeyBxOiAzNiB9KSkpXG4gIFxuICAvLyBUb2dnbGUgZXZlbnQgbGlzdGVuZXIgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG4gIFxuICBjb25zdCBjYiA9IHN2Zy5zZWxlY3QoXCJmb3JlaWduT2JqZWN0XCIpLnNlbGVjdChgaW5wdXQjY2hlY2tib3gtJHtpZH1gKVxuICBcbiAgY2Iub24oXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgY29uc3QgaXNDaGVja2VkID0gY2IucHJvcGVydHkoXCJjaGVja2VkXCIpO1xuICAgIGNvbnN0IGNoYXJ0TGFiZWxzID0gc3ZnLnNlbGVjdEFsbChgZyNsYWJlbHMtJHtpZH1gKTtcbiAgICBpc0NoZWNrZWQgPyBjaGFydExhYmVscy5zdHlsZShcInZpc2liaWxpdHlcIiwgXCJ2aXNpYmxlXCIpIDogY2hhcnRMYWJlbHMuc3R5bGUoXCJ2aXNpYmlsaXR5XCIsIFwiaGlkZGVuXCIpO1xuICB9KTtcbiAgXG4gIHJldHVybiBjb250YWluZXIubm9kZSgpO1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC05IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiXG52aWV3b2YgcDUgPSBJbnB1dHMucmFuZ2UoWzAsIHBNYXhdLCB7bGFiZWw6IFwiUHJpY2VcIiwgc3RlcDogLjEsIHZhbHVlOiAxNSB9KVxudmlld29mIGZjNSA9IElucHV0cy5yYW5nZShbMCwgZmNNYXhdLCB7bGFiZWw6IFwiRml4ZWQgY29zdFwiLCBzdGVwOiAxLCB2YWx1ZTogMjUwIH0pXG5cbntcbiAgY29uc3QgcGFyYW1zID0gKHsgcTogbnVsbCwgZmM6IG51bGwsIHA6IG51bGwsIGM6IG51bGwgfSk7XG4gIHBhcmFtcy5wID0gcDU7XG4gIHBhcmFtcy5mYyA9IGZjNTtcbiAgXG4gIGNvbnN0IHFTaHV0RG93biA9IE1hdGguZmxvb3IoLjU2IC8gKC4wMDYgKiAyKSk7XG4gIGNvbnN0IHEgPSAocCkgPT4ge1xuICAgIGlmIChwIDwgYXZjRnhuKHsgcTogcVNodXREb3duIH0pKSByZXR1cm4gMDtcbiAgICBlbHNlIHJldHVybiBNYXRoLmZsb29yKCgxLjEyICsgTWF0aC5wb3coLjA3MiAqIHAgLSAuMTg1NiwgLjUpKSAvIC4wMzYpO1xuICB9O1xuICBcbiAgcGFyYW1zLnEgPSBxKHA1KTtcbiAgY29uc3QgaWQgPSBkMy5yYW5kb21JbnQoMTAwMDAwLCAxMDAwMDAwKSgpO1xuICBjb25zdCBheGlzVGl0bGVzVG9wID0gKHsgeDogXCJPdXRwdXRcIiwgeTogXCIkXCIgfSk7XG4gIGNvbnN0IGF4aXNUaXRsZXNCb3R0b20gPSAoeyB4OiBcIk91dHB1dFwiLCB5OiBcIiQvdW5pdFwiIH0pO1xuICBcbiAgY29uc3QgeVNjYWxlclRvcCA9IGQzLnNjYWxlTGluZWFyKClcbiAgICAuZG9tYWluKFstODAwLCA4MDBdKVxuICAgIC5yYW5nZShbcGFuZWxIZWlnaHQsIDBdKTtcbiAgY29uc3QgeVNjYWxlckJvdHRvbSA9IGQzLnNjYWxlTGluZWFyKClcbiAgICAuZG9tYWluKFswLCBhY0Z4bih7IHE6IHFNYXgsIGZjOiBmY01heCB9KV0pXG4gICAgLnJhbmdlKFtwYW5lbEhlaWdodCwgMF0pO1xuICAgIFxuICBjb25zdCBjb3JuZXJzID0gKHsgeDE6IDAsIHkxOiB5U2NhbGVyQm90dG9tKHBhcmFtcy5wKSwgeDI6IHhTY2FsZXIocGFyYW1zLnEpLCB5MjogeVNjYWxlckJvdHRvbShhY0Z4bihwYXJhbXMpKSB9KTtcbiAgXG4gIGNvbnN0IGNvbnRhaW5lciA9IGQzLmNyZWF0ZShcImRpdlwiKVxuXHRcdC5hdHRyKFwic3R5bGVcIiwgXCJkaXNwbGF5OiBmbGV4OyBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlclwiKTtcblx0XG4gIGNvbnN0IHN2ZyA9IGNvbnRhaW5lci5hcHBlbmQoXCJzdmdcIilcbiAgICAuYXR0cihcIndpZHRoXCIsIHdpZHRoICsgbWFyZ2luLmxlZnQgKyBtYXJnaW4ucmlnaHQpXG4gICAgLmF0dHIoXCJoZWlnaHRcIiwgaGVpZ2h0ICsgbWFyZ2luLnRvcCArIG1hcmdpbi5ib3R0b20pXG4gICAgLmF0dHIoXCJ2aWV3Qm94XCIsIFswLCAwLCB3aWR0aCArIG1hcmdpbi5sZWZ0ICsgbWFyZ2luLnJpZ2h0LCBoZWlnaHQgKyBtYXJnaW4udG9wICsgbWFyZ2luLmJvdHRvbV0pXG4gICAgLmF0dHIoXCJzdHlsZVwiLCBcIm1heC13aWR0aDogMTAwJTsgaGVpZ2h0OiBhdXRvOyBoZWlnaHQ6IGludHJpbnNpYztcIilcbiAgICAuY2FsbChiYWNrZ3JvdW5kKVxuICAgIC5jYWxsKGxhYmVsc1RvZ2dsZSwgaWQpO1xuICBcbiAgLy8gVG9wIHBhbmVsIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICBcbiAgY29uc3QgcGFuZWxUb3AgPSBzdmcuYXBwZW5kKFwiZ1wiKVxuICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGB0cmFuc2xhdGUoJHttYXJnaW4ubGVmdH0sICR7bWFyZ2luLnRvcH0pYClcbiAgXG4gIHBhbmVsVG9wLmFwcGVuZChcImdcIilcbiAgICAuY2FsbChjbGlwV2lkZSwgaWQpXG4gICAgLmNhbGwoYWRkQ3VydmUsIGlkLCBwcm9maXQsIHBhcmFtcywgeVNjYWxlclRvcClcbiAgICAuY2FsbCh5R3VpZGUsIHByb2ZpdCwgcGFyYW1zLCB5U2NhbGVyVG9wKTtcbiAgXG4gIHBhbmVsVG9wLmFwcGVuZChcImdcIilcbiAgICAuY2FsbChwYW5lbEF4ZXNULCBheGlzVGl0bGVzVG9wLCB5U2NhbGVyVG9wKVxuICAgIC5jYWxsKHhHdWlkZXMsIHByb2ZpdCwgcGFyYW1zLCB5U2NhbGVyVG9wKTtcbiAgXG4gIHBhbmVsVG9wLmFwcGVuZChcImdcIilcbiAgICAuYXR0cihcImlkXCIsIGBsYWJlbHMtJHtpZH1gKVxuICAgIC5jYWxsKGNsaXBXaWRlLCBpZClcbiAgICAuY2FsbChhZGRMYWJlbCwgXCJQcm9maXRcIiwgeFNjYWxlcig3MCkgKyAxMCwgeVNjYWxlclRvcChwcm9maXRGeG4oeyBxOiA3MCwgcDogcGFyYW1zLnAsIGZjOiBwYXJhbXMuZmMgfSkpIC0gMTApO1xuICBcbiAgLy8gQm90dG9tIHBhbmVsIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICBcbiAgY29uc3QgcGFuZWxCb3R0b20gPSBzdmcuYXBwZW5kKFwiZ1wiKVxuICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGB0cmFuc2xhdGUoJHttYXJnaW4ubGVmdH0sICR7bWFyZ2luLnRvcCArIHBhbmVsSGVpZ2h0ICsgbWFyZ2luLmJldHdlZW59KWApO1xuICBcbiAgcGFuZWxCb3R0b20uYXBwZW5kKFwiZ1wiKVxuICAgIC5jYWxsKGNsaXBXaWRlLCBpZClcbiAgICAuY2FsbChhZGRBcmVhLCBpZCwgcHJvZml0LCBjb3JuZXJzKVxuICAgIC5zZWxlY3QoXCJwYXRoXCIpXG4gICAgLnN0eWxlKFwiZmlsbFwiLCBjb3JuZXJzLnkxIDwgY29ybmVycy55MiA/IFwiIzdmYzZhNFwiIDogXCIjZjY5N2JiXCIpO1xuICAgIFxuICBwYW5lbEJvdHRvbS5hcHBlbmQoXCJnXCIpXG4gICAgLmNhbGwoY2xpcCwgaWQpXG4gICAgLmNhbGwoYWRkQ3VydmVGdWxsLCBpZCwgYXZjLCBwYXJhbXMsIHlTY2FsZXJCb3R0b20sIGdyYXkpXG4gICAgLmNhbGwoYWRkQ3VydmVGdWxsLCBpZCwgYWMsIHBhcmFtcywgeVNjYWxlckJvdHRvbSwgZ3JheSlcbiAgICAuY2FsbChhZGRDdXJ2ZUZ1bGwsIGlkLCBtYywgcGFyYW1zLCB5U2NhbGVyQm90dG9tLCBncmF5KVxuICBcbiAgIHBhbmVsQm90dG9tLmFwcGVuZChcImdcIilcbiAgICAuY2FsbChjbGlwV2lkZSwgaWQpXG4gICAgLmNhbGwoeUd1aWRlLCBtciwgcGFyYW1zLCB5U2NhbGVyQm90dG9tKVxuICAgIC5jYWxsKGFkZEN1cnZlRnVsbCwgaWQsIG1yLCBwYXJhbXMsIHlTY2FsZXJCb3R0b20pXG4gICAgLmNhbGwoYWRkQ3VydmUsIGlkLCBzdXBwbHksIHBhcmFtcywgeVNjYWxlckJvdHRvbSlcbiAgICAuY2FsbCh5R3VpZGUsIGFjLCBwYXJhbXMsIHlTY2FsZXJCb3R0b20pXG4gICAgXG4gIHBhbmVsQm90dG9tLmFwcGVuZChcImdcIilcbiAgICAuY2FsbChwYW5lbEF4ZXMsIGF4aXNUaXRsZXNCb3R0b20pXG4gIFxuICAvLyBWZXJ0aWNhbCBwb3J0aW9uIG9mIHN1cHBseSBjdXJ2ZVxuICBcbiAgcGFuZWxCb3R0b20uYXBwZW5kKFwiZ1wiKVxuICAgIC5hdHRyKFwiaWRcIiwgYCR7c3VwcGx5LmlkfS0ke2lkfWApXG4gICAgLmF0dHIoXCJwb2ludGVyLWV2ZW50c1wiLCBcInZpc2libGVTdHJva2VcIilcbiAgICAuY2FsbChjbGlwV2lkZSwgaWQpXG4gICAgLmFwcGVuZChcInBhdGhcIilcbiAgICAuYXR0cihcImNsYXNzXCIsIFwiY3VydmUgY29sb3JlZFwiKVxuICAgIC5hdHRyKFwiZFwiLCBsaW5lKFtbMCwgcGFuZWxIZWlnaHRdLCBbMCwgeVNjYWxlckJvdHRvbShhdmNGeG4oeyBxOiBxU2h1dERvd24gfSkpXSwgWzEsIHlTY2FsZXJCb3R0b20oYXZjRnhuKHsgcTogcVNodXREb3duIH0pKV1dKSlcbiAgICAuc3R5bGUoXCJmaWxsXCIsIFwibm9uZVwiKVxuICAgIC5zdHlsZShcInN0cm9rZVwiLCBibHVlLmJhc2UpXG4gICAgLnN0eWxlKFwic3Ryb2tlLXdpZHRoXCIsIHN0cm9rZVdpZHRoKVxuICAgIC5vbihcIm1vdXNlbW92ZVwiLCAoZXZlbnQpID0+IHtcbiAgICAgIGQzLnNlbGVjdEFsbChgIyR7c3VwcGx5LmlkfS0ke2lkfSAuY3VydmVgKVxuICAgICAgICAudHJhbnNpdGlvbigpLmR1cmF0aW9uKDUwKVxuICAgICAgICAuc3R5bGUoXCJzdHJva2Utd2lkdGhcIiwgc3Ryb2tlV2lkdGggKyAyKVxuICAgICAgICAuc3R5bGUoXCJzdHJva2VcIiwgc3VwcGx5LnNjaGVtZS5iYXNlU2VsZWN0KTtcbiAgICAgIHRvb2x0aXBcbiAgICAgICAgLnN0eWxlKFwibGVmdFwiLCBldmVudC5wYWdlWCArIDE4ICsgXCJweFwiKVxuICAgICAgICAuc3R5bGUoXCJ0b3BcIiwgZXZlbnQucGFnZVkgKyAxOCArIFwicHhcIilcbiAgICAgICAgLnN0eWxlKFwiZGlzcGxheVwiLCBcImJsb2NrXCIpXG4gICAgICAgIC50ZXh0KHN1cHBseS5sYWJlbCk7XG4gICAgICBkMy5zZWxlY3QoZXZlbnQudGFyZ2V0KS5zdHlsZShcImN1cnNvclwiLCBcInBvaW50ZXJcIik7XG4gICAgfSlcbiAgICAub24oXCJtb3VzZWxlYXZlXCIsIChldmVudCkgPT4ge1xuICAgICAgZDMuc2VsZWN0QWxsKGAjJHtzdXBwbHkuaWR9LSR7aWR9IC5jdXJ2ZWApXG4gICAgICAgIC50cmFuc2l0aW9uKCkuZHVyYXRpb24oMTAwKVxuICAgICAgICAuc3R5bGUoXCJzdHJva2Utd2lkdGhcIiwgc3Ryb2tlV2lkdGgpXG4gICAgICAgIC5zdHlsZShcInN0cm9rZVwiLCBzdXBwbHkuc2NoZW1lLmJhc2UpO1xuICAgICAgdG9vbHRpcC5zdHlsZShcImRpc3BsYXlcIiwgXCJub25lXCIpO1xuICAgICAgZDMuc2VsZWN0KGV2ZW50LnRhcmdldCkuc3R5bGUoXCJjdXJzb3JcIiwgXCJkZWZhdWx0XCIpO1xuICAgIH0pO1xuXG4gIHBhbmVsQm90dG9tLmFwcGVuZChcImdcIilcbiAgICAuYXR0cihcImlkXCIsIGBsYWJlbHMtJHtpZH1gKVxuICAgIC5jYWxsKGFkZExhYmVsLCBcIlByaWNlXCIsIHdpZHRoICsgMTAsIHlTY2FsZXJCb3R0b20ocGFyYW1zLnApKVxuICAgIC5jYWxsKGFkZExhYmVsLCBcIkFDXCIsIHhTY2FsZXIoOTUpIC0gMTAsIHlTY2FsZXJCb3R0b20oYWNGeG4oeyBxOiA5NSwgZmM6IHBhcmFtcy5mYyB9KSkgLSAxMCwgXCJlbmRcIilcbiAgICAuY2FsbChhZGRMYWJlbCwgXCJBVkNcIiwgeFNjYWxlcig5NSkgKyAxMCwgeVNjYWxlckJvdHRvbShhdmNGeG4oeyBxOiA5NSB9KSkgKyAxMClcbiAgICAuY2FsbChhZGRMYWJlbCwgXCJTdXBwbHlcIiwgeFNjYWxlcig2OSkgKyA1LCB5U2NhbGVyQm90dG9tKG1jRnhuKHsgcTogNjkgfSkpIC0gMjUsIFwibWlkZGxlXCIpO1xuICBcbiAgLy8gVG9nZ2xlIGV2ZW50IGxpc3RlbmVyIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICBcbiAgY29uc3QgY2IgPSBzdmcuc2VsZWN0KFwiZm9yZWlnbk9iamVjdFwiKS5zZWxlY3QoYGlucHV0I2NoZWNrYm94LSR7aWR9YClcbiAgXG4gIGNiLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIGNvbnN0IGlzQ2hlY2tlZCA9IGNiLnByb3BlcnR5KFwiY2hlY2tlZFwiKTtcbiAgICBjb25zdCBjaGFydExhYmVscyA9IHN2Zy5zZWxlY3RBbGwoYGcjbGFiZWxzLSR7aWR9YCk7XG4gICAgaXNDaGVja2VkID8gY2hhcnRMYWJlbHMuc3R5bGUoXCJ2aXNpYmlsaXR5XCIsIFwidmlzaWJsZVwiKSA6IGNoYXJ0TGFiZWxzLnN0eWxlKFwidmlzaWJpbGl0eVwiLCBcImhpZGRlblwiKTtcbiAgfSk7XG4gIFxuICByZXR1cm4gY29udGFpbmVyLm5vZGUoKTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTAiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ7XG4gIGNvbnN0IHBhcmFtcyA9ICh7IHE6IG51bGwsIGZjOiBudWxsLCBwOiBudWxsLCBjOiBudWxsIH0pO1xuICBjb25zdCBxU2h1dERvd24gPSBNYXRoLmZsb29yKC41NiAvICguMDA2ICogMikpO1xuICBwYXJhbXMucCA9IDYuOTtcbiAgcGFyYW1zLmZjID0gMDtcbiAgcGFyYW1zLnEgPSA0NjtcbiAgY29uc3QgaWQgPSBkMy5yYW5kb21JbnQoMTAwMDAwLCAxMDAwMDAwKSgpO1xuICBjb25zdCBheGlzVGl0bGVzVG9wID0gKHsgeDogXCJPdXRwdXRcIiwgeTogXCIkXCIgfSk7XG4gIGNvbnN0IGF4aXNUaXRsZXNCb3R0b20gPSAoeyB4OiBcIk91dHB1dFwiLCB5OiBcIiQvdW5pdFwiIH0pO1xuICBcbiAgY29uc3QgeVNjYWxlclRvcCA9IGQzLnNjYWxlTGluZWFyKClcbiAgICAuZG9tYWluKFstODAwLCA4MDBdKVxuICAgIC5yYW5nZShbcGFuZWxIZWlnaHQsIDBdKTtcbiAgY29uc3QgeVNjYWxlckJvdHRvbSA9IGQzLnNjYWxlTGluZWFyKClcbiAgICAuZG9tYWluKFswLCBhY0Z4bih7IHE6IHFNYXgsIGZjOiBmY01heCB9KV0pXG4gICAgLnJhbmdlKFtwYW5lbEhlaWdodCwgMF0pO1xuICAgIFxuICBjb25zdCBjb3JuZXJzID0gKHsgeDE6IDAsIHkxOiB5U2NhbGVyQm90dG9tKHBhcmFtcy5wKSwgeDI6IHhTY2FsZXIocGFyYW1zLnEpLCB5MjogeVNjYWxlckJvdHRvbShhY0Z4bihwYXJhbXMpKSB9KTtcbiAgXG4gIGNvbnN0IGNvbnRhaW5lciA9IGQzLmNyZWF0ZShcImRpdlwiKVxuXHRcdC5hdHRyKFwic3R5bGVcIiwgXCJkaXNwbGF5OiBmbGV4OyBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlclwiKTtcblx0XG4gIGNvbnN0IHN2ZyA9IGNvbnRhaW5lci5hcHBlbmQoXCJzdmdcIilcbiAgICAuYXR0cihcIndpZHRoXCIsIHdpZHRoICsgbWFyZ2luLmxlZnQgKyBtYXJnaW4ucmlnaHQpXG4gICAgLmF0dHIoXCJoZWlnaHRcIiwgaGVpZ2h0ICsgbWFyZ2luLnRvcCArIG1hcmdpbi5ib3R0b20pXG4gICAgLmF0dHIoXCJ2aWV3Qm94XCIsIFswLCAwLCB3aWR0aCArIG1hcmdpbi5sZWZ0ICsgbWFyZ2luLnJpZ2h0LCBoZWlnaHQgKyBtYXJnaW4udG9wICsgbWFyZ2luLmJvdHRvbV0pXG4gICAgLmF0dHIoXCJzdHlsZVwiLCBcIm1heC13aWR0aDogMTAwJTsgaGVpZ2h0OiBhdXRvOyBoZWlnaHQ6IGludHJpbnNpYztcIilcbiAgICAuY2FsbChiYWNrZ3JvdW5kKVxuICAgIC5jYWxsKGxhYmVsc1RvZ2dsZSwgaWQpO1xuICBcbiAgLy8gVG9wIHBhbmVsIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICBcbiAgY29uc3QgcGFuZWxUb3AgPSBzdmcuYXBwZW5kKFwiZ1wiKVxuICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGB0cmFuc2xhdGUoJHttYXJnaW4ubGVmdH0sICR7bWFyZ2luLnRvcH0pYClcbiAgXG4gIHBhbmVsVG9wLmFwcGVuZChcImdcIilcbiAgICAuY2FsbChjbGlwV2lkZSwgaWQpXG4gICAgLmNhbGwoYWRkQ3VydmUsIGlkLCBwcm9maXQsIHBhcmFtcywgeVNjYWxlclRvcClcblxuICBwYW5lbFRvcC5hcHBlbmQoXCJnXCIpXG4gICAgLmNhbGwocGFuZWxBeGVzVCwgYXhpc1RpdGxlc1RvcCwgeVNjYWxlclRvcClcbiAgICAuY2FsbCh4R3VpZGVzLCBwcm9maXQsIHBhcmFtcywgeVNjYWxlclRvcCk7XG4gIFxuICBwYW5lbFRvcC5hcHBlbmQoXCJnXCIpXG4gICAgLmF0dHIoXCJpZFwiLCBgbGFiZWxzLSR7aWR9YClcbiAgICAuY2FsbChjbGlwV2lkZSwgaWQpXG4gICAgLmNhbGwoYWRkTGFiZWwsIFwiUHJvZml0XCIsIHhTY2FsZXIoNzApICsgMTAsIHlTY2FsZXJUb3AocHJvZml0RnhuKHsgcTogNzAsIHA6IHBhcmFtcy5wLCBmYzogcGFyYW1zLmZjIH0pKSAtIDEwKTtcblxuICBwYW5lbFRvcC5hcHBlbmQoXCJnXCIpXG4gICAgLmFwcGVuZChcInRleHRcIilcbiAgICAudGV4dCgwKVxuICAgIC5hdHRyKFwieFwiLCAwKVxuICAgIC5hdHRyKFwieVwiLCBkYXRhKHByb2ZpdC5meG4sIHBhcmFtcywgeVNjYWxlclRvcClbcGFyYW1zLnFdWzFdKVxuICAgIC5hdHRyKFwiZHhcIiwgLTEwKVxuICAgIC5hdHRyKFwidGV4dC1hbmNob3JcIiwgXCJlbmRcIilcbiAgICAuYXR0cihcImFsaWdubWVudC1iYXNlbGluZVwiLCBcIm1pZGRsZVwiKVxuICAgIC5zdHlsZShcImZpbGxcIiwgXCJibGFja1wiKVxuICAgIC5zdHlsZShcImZvbnQtc2l6ZVwiLCBcIi45cmVtXCIpO1xuICBcbiAgLy8gQm90dG9tIHBhbmVsIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICBcbiAgY29uc3QgcGFuZWxCb3R0b20gPSBzdmcuYXBwZW5kKFwiZ1wiKVxuICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGB0cmFuc2xhdGUoJHttYXJnaW4ubGVmdH0sICR7bWFyZ2luLnRvcCArIHBhbmVsSGVpZ2h0ICsgbWFyZ2luLmJldHdlZW59KWApO1xuICBcbiAgcGFuZWxCb3R0b20uYXBwZW5kKFwiZ1wiKVxuICAgIC5jYWxsKGNsaXBXaWRlLCBpZClcbiAgICAuY2FsbChhZGRBcmVhLCBpZCwgcHJvZml0LCBjb3JuZXJzKVxuICAgIC5zZWxlY3QoXCJwYXRoXCIpXG4gICAgLnN0eWxlKFwiZmlsbFwiLCBjb3JuZXJzLnkxIDwgY29ybmVycy55MiA/IFwiIzdmYzZhNFwiIDogXCIjZjY5N2JiXCIpO1xuICAgIFxuICBwYW5lbEJvdHRvbS5hcHBlbmQoXCJnXCIpXG4gICAgLmNhbGwoY2xpcCwgaWQpXG4gICAgLmNhbGwoYWRkQ3VydmVGdWxsLCBpZCwgYWMsIHBhcmFtcywgeVNjYWxlckJvdHRvbSwgZ3JheSlcbiAgICAuY2FsbChhZGRDdXJ2ZUZ1bGwsIGlkLCBtYywgcGFyYW1zLCB5U2NhbGVyQm90dG9tLCBncmF5KVxuICBcbiAgcGFuZWxCb3R0b20uYXBwZW5kKFwiZ1wiKVxuICAgIC5jYWxsKGNsaXBXaWRlLCBpZClcbiAgICAuY2FsbCh5R3VpZGUsIG1yLCBwYXJhbXMsIHlTY2FsZXJCb3R0b20pXG4gICAgLmNhbGwoYWRkQ3VydmVGdWxsLCBpZCwgbXIsIHBhcmFtcywgeVNjYWxlckJvdHRvbSlcbiAgICAuY2FsbChhZGRDdXJ2ZSwgaWQsIHN1cHBseSwgcGFyYW1zLCB5U2NhbGVyQm90dG9tKVxuXG4gIHBhbmVsQm90dG9tLmFwcGVuZChcImdcIilcbiAgICAuY2FsbChwYW5lbEF4ZXMsIGF4aXNUaXRsZXNCb3R0b20pXG4gIFxuICAvLyBWZXJ0aWNhbCBwb3J0aW9uIG9mIHN1cHBseSBjdXJ2ZVxuICBcbiAgcGFuZWxCb3R0b20uYXBwZW5kKFwiZ1wiKVxuICAgIC5hdHRyKFwiaWRcIiwgYCR7c3VwcGx5LmlkfS0ke2lkfWApXG4gICAgLmF0dHIoXCJwb2ludGVyLWV2ZW50c1wiLCBcInZpc2libGVTdHJva2VcIilcbiAgICAuY2FsbChjbGlwV2lkZSwgaWQpXG4gICAgLmFwcGVuZChcInBhdGhcIilcbiAgICAuYXR0cihcImNsYXNzXCIsIFwiY3VydmUgY29sb3JlZFwiKVxuICAgIC5hdHRyKFwiZFwiLCBsaW5lKFtbMCwgcGFuZWxIZWlnaHRdLCBbMCwgeVNjYWxlckJvdHRvbShhdmNGeG4oeyBxOiBxU2h1dERvd24gfSkpXSwgWzEsIHlTY2FsZXJCb3R0b20oYXZjRnhuKHsgcTogcVNodXREb3duIH0pKV1dKSlcbiAgICAuc3R5bGUoXCJmaWxsXCIsIFwibm9uZVwiKVxuICAgIC5zdHlsZShcInN0cm9rZVwiLCBibHVlLmJhc2UpXG4gICAgLnN0eWxlKFwic3Ryb2tlLXdpZHRoXCIsIHN0cm9rZVdpZHRoKVxuICAgIC5vbihcIm1vdXNlbW92ZVwiLCAoZXZlbnQpID0+IHtcbiAgICAgIGQzLnNlbGVjdEFsbChgIyR7c3VwcGx5LmlkfS0ke2lkfSAuY3VydmVgKVxuICAgICAgICAudHJhbnNpdGlvbigpLmR1cmF0aW9uKDUwKVxuICAgICAgICAuc3R5bGUoXCJzdHJva2Utd2lkdGhcIiwgc3Ryb2tlV2lkdGggKyAyKVxuICAgICAgICAuc3R5bGUoXCJzdHJva2VcIiwgc3VwcGx5LnNjaGVtZS5iYXNlU2VsZWN0KTtcbiAgICAgIHRvb2x0aXBcbiAgICAgICAgLnN0eWxlKFwibGVmdFwiLCBldmVudC5wYWdlWCArIDE4ICsgXCJweFwiKVxuICAgICAgICAuc3R5bGUoXCJ0b3BcIiwgZXZlbnQucGFnZVkgKyAxOCArIFwicHhcIilcbiAgICAgICAgLnN0eWxlKFwiZGlzcGxheVwiLCBcImJsb2NrXCIpXG4gICAgICAgIC50ZXh0KHN1cHBseS5sYWJlbCk7XG4gICAgICBkMy5zZWxlY3QoZXZlbnQudGFyZ2V0KS5zdHlsZShcImN1cnNvclwiLCBcInBvaW50ZXJcIik7XG4gICAgfSlcbiAgICAub24oXCJtb3VzZWxlYXZlXCIsIChldmVudCkgPT4ge1xuICAgICAgZDMuc2VsZWN0QWxsKGAjJHtzdXBwbHkuaWR9LSR7aWR9IC5jdXJ2ZWApXG4gICAgICAgIC50cmFuc2l0aW9uKCkuZHVyYXRpb24oMTAwKVxuICAgICAgICAuc3R5bGUoXCJzdHJva2Utd2lkdGhcIiwgc3Ryb2tlV2lkdGgpXG4gICAgICAgIC5zdHlsZShcInN0cm9rZVwiLCBzdXBwbHkuc2NoZW1lLmJhc2UpO1xuICAgICAgdG9vbHRpcC5zdHlsZShcImRpc3BsYXlcIiwgXCJub25lXCIpO1xuICAgICAgZDMuc2VsZWN0KGV2ZW50LnRhcmdldCkuc3R5bGUoXCJjdXJzb3JcIiwgXCJkZWZhdWx0XCIpO1xuICAgIH0pO1xuXG4gIHBhbmVsQm90dG9tLmFwcGVuZChcImdcIilcbiAgICAuYXR0cihcImlkXCIsIGBsYWJlbHMtJHtpZH1gKVxuICAgIC5jYWxsKGFkZExhYmVsLCBcIlByaWNlXCIsIHdpZHRoICsgMTAsIHlTY2FsZXJCb3R0b20ocGFyYW1zLnApKVxuICAgIC5jYWxsKGFkZExhYmVsLCBcIkFDXCIsIHhTY2FsZXIoOTUpIC0gMTAsIHlTY2FsZXJCb3R0b20oYWNGeG4oeyBxOiA5NSwgZmM6IHBhcmFtcy5mYyB9KSkgLSAxMCwgXCJlbmRcIilcbiAgICAuY2FsbChhZGRMYWJlbCwgXCJTdXBwbHlcIiwgeFNjYWxlcig2OSkgKyA1LCB5U2NhbGVyQm90dG9tKG1jRnhuKHsgcTogNjkgfSkpIC0gMjUsIFwibWlkZGxlXCIpO1xuICBcbiAgLy8gVG9nZ2xlIGV2ZW50IGxpc3RlbmVyIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICBcbiAgY29uc3QgY2IgPSBzdmcuc2VsZWN0KFwiZm9yZWlnbk9iamVjdFwiKS5zZWxlY3QoYGlucHV0I2NoZWNrYm94LSR7aWR9YClcbiAgXG4gIGNiLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIGNvbnN0IGlzQ2hlY2tlZCA9IGNiLnByb3BlcnR5KFwiY2hlY2tlZFwiKTtcbiAgICBjb25zdCBjaGFydExhYmVscyA9IHN2Zy5zZWxlY3RBbGwoYGcjbGFiZWxzLSR7aWR9YCk7XG4gICAgaXNDaGVja2VkID8gY2hhcnRMYWJlbHMuc3R5bGUoXCJ2aXNpYmlsaXR5XCIsIFwidmlzaWJsZVwiKSA6IGNoYXJ0TGFiZWxzLnN0eWxlKFwidmlzaWJpbGl0eVwiLCBcImhpZGRlblwiKTtcbiAgfSk7XG4gIFxuICByZXR1cm4gY29udGFpbmVyLm5vZGUoKTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTEiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ2aWV3b2YgcTYgPSBJbnB1dHMucmFuZ2UoWzAsIHFNYXhdLCB7bGFiZWw6IFwiT3V0cHV0XCIsIHN0ZXA6IDEsIHZhbHVlOiA1MCB9KTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTIiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ7XG4gIGNvbnN0IHBhcmFtcyA9ICh7IHE6IG51bGwsIGZjOiBudWxsLCBwOiBudWxsLCBjOiBudWxsIH0pO1xuICBwYXJhbXMucSA9IHE2O1xuICBwYXJhbXMucCA9IDE1O1xuICBjb25zdCBpZCA9IGQzLnJhbmRvbUludCgxMDAwMDAsIDEwMDAwMDApKCk7XG4gIGNvbnN0IGF4aXNUaXRsZXMgPSAoeyB4OiBcIk91dHB1dFwiLCB5OiBcIiRcIiB9KTtcblxuICBjb25zdCB5U2NhbGVyID0gZDMuc2NhbGVMaW5lYXIoKVxuICAgIC5kb21haW4oWzAsIGFjRnhuKHsgcTogcU1heCwgZmM6IGZjTWF4IH0pXSlcbiAgICAucmFuZ2UoW3BhbmVsSGVpZ2h0LCAwXSk7XG4gIFxuICBjb25zdCBjb250YWluZXIgPSBkMy5jcmVhdGUoXCJkaXZcIilcblx0XHQuYXR0cihcInN0eWxlXCIsIFwiZGlzcGxheTogZmxleDsganVzdGlmeS1jb250ZW50OiBjZW50ZXJcIik7XG5cdFx0XG4gIGNvbnN0IHN2ZyA9IGNvbnRhaW5lci5hcHBlbmQoXCJzdmdcIilcbiAgICAuYXR0cihcIndpZHRoXCIsIHdpZHRoICsgbWFyZ2luLmxlZnQgKyBtYXJnaW4ucmlnaHQpXG4gICAgLmF0dHIoXCJoZWlnaHRcIiwgcGFuZWxIZWlnaHQgKyBtYXJnaW4udG9wICsgbWFyZ2luLmJvdHRvbSlcbiAgICAuYXR0cihcInZpZXdCb3hcIiwgWzAsIDAsIHdpZHRoICsgbWFyZ2luLmxlZnQgKyBtYXJnaW4ucmlnaHQsIHBhbmVsSGVpZ2h0ICsgbWFyZ2luLnRvcCArIG1hcmdpbi5ib3R0b21dKVxuICAgIC5hdHRyKFwic3R5bGVcIiwgXCJtYXgtd2lkdGg6IDEwMCU7IGhlaWdodDogYXV0bzsgaGVpZ2h0OiBpbnRyaW5zaWM7XCIpXG4gICAgLmNhbGwoYmFja2dyb3VuZClcbiAgICAuY2FsbChsYWJlbHNUb2dnbGUsIGlkKTtcbiAgXG4gIGNvbnN0IHBhbmVsID0gc3ZnLmFwcGVuZChcImdcIilcbiAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBgdHJhbnNsYXRlKCR7bWFyZ2luLmxlZnR9LCAke21hcmdpbi50b3B9KWApO1xuICBcbiAgcGFuZWwuYXBwZW5kKFwiZ1wiKVxuICAgIC5jYWxsKHBhbmVsQXhlcywgYXhpc1RpdGxlcylcbiAgICAuY2FsbCh5R3VpZGUsIG1yLCBwYXJhbXMsIHlTY2FsZXIpXG4gICAgLmNhbGwoeEd1aWRlcywgbXIsIHBhcmFtcywgeVNjYWxlciwgMSlcbiAgICAuY2FsbChhZGRDdXJ2ZSwgaWQsIG1yLCBwYXJhbXMsIHlTY2FsZXIpO1xuICBcbiAgcGFuZWwuYXBwZW5kKFwiZ1wiKVxuICAgIC5hdHRyKFwiaWRcIiwgYGxhYmVscy0ke2lkfWApXG4gICAgLmNhbGwoYWRkTGFiZWwsIFwiUHJpY2UgPSBEZW1hbmQgPSBNUlwiLCB4U2NhbGVyKDU1KSwgeVNjYWxlcihwYXJhbXMucCkgLSAyMCk7XG4gICBcbiAgLy8gVG9nZ2xlIGV2ZW50IGxpc3RlbmVyIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICBcbiAgY29uc3QgY2IgPSBzdmcuc2VsZWN0KFwiZm9yZWlnbk9iamVjdFwiKS5zZWxlY3QoYGlucHV0I2NoZWNrYm94LSR7aWR9YCk7XG4gIFxuICBjYi5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICBjb25zdCBpc0NoZWNrZWQgPSBjYi5wcm9wZXJ0eShcImNoZWNrZWRcIik7XG4gICAgY29uc3QgY2hhcnRMYWJlbHMgPSBzdmcuc2VsZWN0QWxsKGBnI2xhYmVscy0ke2lkfWApO1xuICAgIGlzQ2hlY2tlZCA/IGNoYXJ0TGFiZWxzLnN0eWxlKFwidmlzaWJpbGl0eVwiLCBcInZpc2libGVcIikgOiBjaGFydExhYmVscy5zdHlsZShcInZpc2liaWxpdHlcIiwgXCJoaWRkZW5cIik7XG4gIH0pO1xuICBcbiAgcmV0dXJuIGNvbnRhaW5lci5ub2RlKCk7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTEzIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoie1xuICBjb25zdCBwYXJhbXMgPSAoeyBxOiBudWxsLCBmYzogbnVsbCwgcDogbnVsbCwgYzogbnVsbCB9KTtcbiAgcGFyYW1zLnEgPSBxNjtcbiAgY29uc3QgcDYgPSBkZW1hbmRNb25vRnhuKHsgcTogcTYgfSk7XG4gIHBhcmFtcy5wID0gcDY7XG4gIGNvbnN0IGlkID0gZDMucmFuZG9tSW50KDEwMDAwMCwgMTAwMDAwMCkoKTtcbiAgY29uc3QgYXhpc1RpdGxlcyA9ICh7IHg6IFwiT3V0cHV0XCIsIHk6IFwiJFwiIH0pO1xuICBcbiAgY29uc3QgeVNjYWxlciA9IGQzLnNjYWxlTGluZWFyKClcbiAgICAuZG9tYWluKFswLCBhY0Z4bih7IHE6IHFNYXgsIGZjOiBmY01heCB9KV0pXG4gICAgLnJhbmdlKFtwYW5lbEhlaWdodCwgMF0pO1xuICBcbiAgY29uc3QgY29udGFpbmVyID0gZDMuY3JlYXRlKFwiZGl2XCIpXG5cdFx0LmF0dHIoXCJzdHlsZVwiLCBcImRpc3BsYXk6IGZsZXg7IGp1c3RpZnktY29udGVudDogY2VudGVyXCIpO1xuXHRcdFxuICBjb25zdCBzdmcgPSBjb250YWluZXIuYXBwZW5kKFwic3ZnXCIpXG4gICAgLmF0dHIoXCJ3aWR0aFwiLCB3aWR0aCArIG1hcmdpbi5sZWZ0ICsgbWFyZ2luLnJpZ2h0KVxuICAgIC5hdHRyKFwiaGVpZ2h0XCIsIHBhbmVsSGVpZ2h0ICsgbWFyZ2luLnRvcCArIG1hcmdpbi5ib3R0b20pXG4gICAgLmF0dHIoXCJ2aWV3Qm94XCIsIFswLCAwLCB3aWR0aCArIG1hcmdpbi5sZWZ0ICsgbWFyZ2luLnJpZ2h0LCBwYW5lbEhlaWdodCArIG1hcmdpbi50b3AgKyBtYXJnaW4uYm90dG9tXSlcbiAgICAuYXR0cihcInN0eWxlXCIsIFwibWF4LXdpZHRoOiAxMDAlOyBoZWlnaHQ6IGF1dG87IGhlaWdodDogaW50cmluc2ljO1wiKVxuICAgIC5jYWxsKGJhY2tncm91bmQpXG4gICAgLmNhbGwobGFiZWxzVG9nZ2xlLCBpZCk7XG4gIFxuICBjb25zdCBwYW5lbCA9IHN2Zy5hcHBlbmQoXCJnXCIpXG4gICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgYHRyYW5zbGF0ZSgke21hcmdpbi5sZWZ0fSwgJHttYXJnaW4udG9wfSlgKVxuICAgIFxuICBwYW5lbC5hcHBlbmQoXCJnXCIpXG4gICAgLmNhbGwoY2xpcFdpZGUsIGlkKVxuICAgIC5jYWxsKHlHdWlkZSwgbXJNb25vLCBwYXJhbXMsIHlTY2FsZXIpXG4gICAgLmNhbGwoeUd1aWRlLCBkZW1hbmRNb25vLCBwYXJhbXMsIHlTY2FsZXIpO1xuICBcbiAgcGFuZWwuYXBwZW5kKFwiZ1wiKVxuICAgIC5jYWxsKGNsaXAsIGlkKVxuICAgIC5jYWxsKGFkZEN1cnZlRnVsbCwgaWQsIG1yLCBwYXJhbXMsIHlTY2FsZXIsIGdyYXkpXG4gICAgLmNhbGwoYWRkQ3VydmUsIGlkLCBtck1vbm8sIHBhcmFtcywgeVNjYWxlcilcbiAgICAuY2FsbChhZGRDdXJ2ZSwgaWQsIGRlbWFuZE1vbm8sIHBhcmFtcywgeVNjYWxlcilcbiAgXG4gIHBhbmVsLmFwcGVuZChcImdcIilcbiAgICAuY2FsbChwYW5lbEF4ZXMsIGF4aXNUaXRsZXMpXG4gICAgLmNhbGwoeEd1aWRlcywgZGVtYW5kTW9ubywgcGFyYW1zLCB5U2NhbGVyLCAxKTtcbiAgXG4gIHBhbmVsLmFwcGVuZChcImdcIilcbiAgICAuYXR0cihcImlkXCIsIGBsYWJlbHMtJHtpZH1gKVxuICAgIC5jYWxsKGNsaXBXaWRlLCBpZClcbiAgICAuY2FsbChhZGRMYWJlbCwgXCJQcmljZVwiLCB3aWR0aCArIDEwLCB5U2NhbGVyKHBhcmFtcy5wKSlcbiAgICAuY2FsbChhZGRMYWJlbCwgXCJEZW1hbmRcIiwgeFNjYWxlcig2NikgKyAxMCwgeVNjYWxlcihkZW1hbmRNb25vRnhuKHsgcTogNjYgfSkpIC0gMTApXG4gICAgLmNhbGwoYWRkTGFiZWwsIFwiTVJcIiwgeFNjYWxlcigzMykgKyAxMCwgeVNjYWxlcihtck1vbm9GeG4oeyBxOiAzMyB9KSkgLSAxMCk7XG4gICBcbiAgLy8gVG9nZ2xlIGV2ZW50IGxpc3RlbmVyIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICBcbiAgY29uc3QgY2IgPSBzdmcuc2VsZWN0KFwiZm9yZWlnbk9iamVjdFwiKS5zZWxlY3QoYGlucHV0I2NoZWNrYm94LSR7aWR9YClcbiAgXG4gIGNiLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIGNvbnN0IGlzQ2hlY2tlZCA9IGNiLnByb3BlcnR5KFwiY2hlY2tlZFwiKTtcbiAgICBjb25zdCBjaGFydExhYmVscyA9IHN2Zy5zZWxlY3RBbGwoYGcjbGFiZWxzLSR7aWR9YCk7XG4gICAgaXNDaGVja2VkID8gY2hhcnRMYWJlbHMuc3R5bGUoXCJ2aXNpYmlsaXR5XCIsIFwidmlzaWJsZVwiKSA6IGNoYXJ0TGFiZWxzLnN0eWxlKFwidmlzaWJpbGl0eVwiLCBcImhpZGRlblwiKTtcbiAgfSk7XG4gIFxuICByZXR1cm4gY29udGFpbmVyLm5vZGUoKTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTQiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJcbnZpZXdvZiBwNyA9IElucHV0cy5yYW5nZShbMCwgcE1heF0sIHtsYWJlbDogXCJQcmljZVwiLCBzdGVwOiAuMSwgdmFsdWU6IDE1IH0pXG52aWV3b2YgZmM3ID0gSW5wdXRzLnJhbmdlKFswLCBmY01heF0sIHtsYWJlbDogXCJGaXhlZCBjb3N0XCIsIHN0ZXA6IDEsIHZhbHVlOiAxODAgfSlcblxue1xuICBjb25zdCBwYXJhbXMgPSAoeyBxOiBudWxsLCBmYzogbnVsbCwgcDogbnVsbCwgYzogbnVsbCB9KTtcbiAgY29uc3QgcSA9IChwKSA9PiBNYXRoLmZsb29yKCgyNyAtIHApIC8gKDI3Lzk1KSk7XG4gIHBhcmFtcy5xID0gcShwNyk7XG4gIHBhcmFtcy5wID0gcDc7XG4gIHBhcmFtcy5mYyA9IGZjNztcbiAgXG4gIGNvbnN0IGlkID0gZDMucmFuZG9tSW50KDEwMDAwMCwgMTAwMDAwMCkoKTtcbiAgY29uc3QgYXhpc1RpdGxlc1RvcCA9ICh7IHg6IFwiT3V0cHV0XCIsIHk6IFwiJFwiIH0pO1xuICBjb25zdCBheGlzVGl0bGVzQm90dG9tID0gKHsgeDogXCJPdXRwdXRcIiwgeTogXCIkL3VuaXRcIiB9KTtcbiAgXG4gIGNvbnN0IHlTY2FsZXJUb3AgPSBkMy5zY2FsZUxpbmVhcigpXG4gICAgLmRvbWFpbihbLTEwMDAsIDQwMF0pXG4gICAgLnJhbmdlKFtwYW5lbEhlaWdodCwgMF0pO1xuICBjb25zdCB5U2NhbGVyQm90dG9tID0gZDMuc2NhbGVMaW5lYXIoKVxuICAgIC5kb21haW4oWzAsIGFjRnhuKHsgcTogcU1heCwgZmM6IGZjTWF4IH0pXSlcbiAgICAucmFuZ2UoW3BhbmVsSGVpZ2h0LCAwXSk7XG4gICAgXG4gIGNvbnN0IGNvcm5lcnMgPSAoeyB4MTogMCwgeTE6IHlTY2FsZXJCb3R0b20ocGFyYW1zLnApLCB4MjogeFNjYWxlcihwYXJhbXMucSksIHkyOiB5U2NhbGVyQm90dG9tKGFjRnhuKHBhcmFtcykpIH0pO1xuICBcbiAgY29uc3QgY29udGFpbmVyID0gZDMuY3JlYXRlKFwiZGl2XCIpXG5cdFx0LmF0dHIoXCJzdHlsZVwiLCBcImRpc3BsYXk6IGZsZXg7IGp1c3RpZnktY29udGVudDogY2VudGVyXCIpO1xuXHRcbiAgY29uc3Qgc3ZnID0gY29udGFpbmVyLmFwcGVuZChcInN2Z1wiKVxuICAgIC5hdHRyKFwid2lkdGhcIiwgd2lkdGggKyBtYXJnaW4ubGVmdCArIG1hcmdpbi5yaWdodClcbiAgICAuYXR0cihcImhlaWdodFwiLCBoZWlnaHQgKyBtYXJnaW4udG9wICsgbWFyZ2luLmJvdHRvbSlcbiAgICAuYXR0cihcInZpZXdCb3hcIiwgWzAsIDAsIHdpZHRoICsgbWFyZ2luLmxlZnQgKyBtYXJnaW4ucmlnaHQsIGhlaWdodCArIG1hcmdpbi50b3AgKyBtYXJnaW4uYm90dG9tXSlcbiAgICAuYXR0cihcInN0eWxlXCIsIFwibWF4LXdpZHRoOiAxMDAlOyBoZWlnaHQ6IGF1dG87IGhlaWdodDogaW50cmluc2ljO1wiKVxuICAgIC5jYWxsKGJhY2tncm91bmQpXG4gICAgLmNhbGwobGFiZWxzVG9nZ2xlLCBpZCk7XG4gIFxuICAvLyBUb3AgcGFuZWwgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG4gIFxuICBjb25zdCBwYW5lbFRvcCA9IHN2Zy5hcHBlbmQoXCJnXCIpXG4gICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgYHRyYW5zbGF0ZSgke21hcmdpbi5sZWZ0fSwgJHttYXJnaW4udG9wfSlgKVxuICBcbiAgcGFuZWxUb3AuYXBwZW5kKFwiZ1wiKVxuICAgIC5jYWxsKGNsaXBXaWRlLCBpZClcbiAgICAuY2FsbChhZGRDdXJ2ZSwgaWQsIHByb2ZpdE1vbm8sIHBhcmFtcywgeVNjYWxlclRvcClcbiAgICAuY2FsbCh5R3VpZGUsIHByb2ZpdE1vbm8sIHBhcmFtcywgeVNjYWxlclRvcCk7XG4gIFxuICBwYW5lbFRvcC5hcHBlbmQoXCJnXCIpXG4gICAgLmNhbGwocGFuZWxBeGVzVCwgYXhpc1RpdGxlc1RvcCwgeVNjYWxlclRvcClcbiAgICAuY2FsbCh4R3VpZGVzLCBwcm9maXRNb25vLCBwYXJhbXMsIHlTY2FsZXJUb3ApO1xuICBcbiAgcGFuZWxUb3AuYXBwZW5kKFwiZ1wiKVxuICAgIC5hdHRyKFwiaWRcIiwgYGxhYmVscy0ke2lkfWApXG4gICAgLmNhbGwoY2xpcFdpZGUsIGlkKVxuICAgIC5jYWxsKGFkZExhYmVsLCBcIlByb2ZpdFwiLCB4U2NhbGVyKDcwKSArIDEwLCB5U2NhbGVyVG9wKHByb2ZpdE1vbm9GeG4oeyBxOiA3MCwgZmM6IHBhcmFtcy5mYyB9KSkgLSAxMCk7XG4gIFxuICAvLyBCb3R0b20gcGFuZWwgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG4gIFxuICBjb25zdCBwYW5lbEJvdHRvbSA9IHN2Zy5hcHBlbmQoXCJnXCIpXG4gICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgYHRyYW5zbGF0ZSgke21hcmdpbi5sZWZ0fSwgJHttYXJnaW4udG9wICsgcGFuZWxIZWlnaHQgKyBtYXJnaW4uYmV0d2Vlbn0pYCk7XG4gIFxuICBwYW5lbEJvdHRvbS5hcHBlbmQoXCJnXCIpXG4gICAgLmNhbGwoY2xpcFdpZGUsIGlkKVxuICAgIC5jYWxsKGFkZEFyZWEsIGlkLCBwcm9maXRNb25vLCBjb3JuZXJzKVxuICAgIC5zZWxlY3QoXCJwYXRoXCIpXG4gICAgLnN0eWxlKFwiZmlsbFwiLCBjb3JuZXJzLnkxIDwgY29ybmVycy55MiA/IFwiIzdmYzZhNFwiIDogXCIjZjY5N2JiXCIpO1xuICAgIFxuICBwYW5lbEJvdHRvbS5hcHBlbmQoXCJnXCIpXG4gICAgLmNhbGwoY2xpcCwgaWQpXG4gICAgLmNhbGwoYWRkQ3VydmVGdWxsLCBpZCwgbXIsIHBhcmFtcywgeVNjYWxlckJvdHRvbSwgZ3JheSlcbiAgICAuY2FsbChhZGRDdXJ2ZSwgaWQsIGFjLCBwYXJhbXMsIHlTY2FsZXJCb3R0b20pXG4gICAgLmNhbGwoYWRkQ3VydmUsIGlkLCBtYywgcGFyYW1zLCB5U2NhbGVyQm90dG9tKVxuICAgIC5jYWxsKGFkZEN1cnZlLCBpZCwgZGVtYW5kTW9ubywgcGFyYW1zLCB5U2NhbGVyQm90dG9tKVxuICAgIC5jYWxsKGFkZEN1cnZlLCBpZCwgbXJNb25vLCBwYXJhbXMsIHlTY2FsZXJCb3R0b20pXG4gIFxuICBwYW5lbEJvdHRvbS5hcHBlbmQoXCJnXCIpXG4gICAgLmNhbGwoY2xpcFdpZGUsIGlkKVxuICAgIC5jYWxsKHlHdWlkZSwgYWMsIHBhcmFtcywgeVNjYWxlckJvdHRvbSlcbiAgICAuY2FsbCh5R3VpZGUsIG1jLCBwYXJhbXMsIHlTY2FsZXJCb3R0b20pXG4gICAgLmNhbGwoeUd1aWRlLCBtck1vbm8sIHBhcmFtcywgeVNjYWxlckJvdHRvbSlcbiAgICAuY2FsbCh5R3VpZGUsIGRlbWFuZE1vbm8sIHBhcmFtcywgeVNjYWxlckJvdHRvbSk7XG4gICAgXG4gIHBhbmVsQm90dG9tLmFwcGVuZChcImdcIilcbiAgICAuY2FsbChwYW5lbEF4ZXMsIGF4aXNUaXRsZXNCb3R0b20pXG4gIFxuICBwYW5lbEJvdHRvbS5hcHBlbmQoXCJnXCIpXG4gICAgLmF0dHIoXCJpZFwiLCBgbGFiZWxzLSR7aWR9YClcbiAgICAuY2FsbChhZGRMYWJlbCwgXCJQcmljZVwiLCB3aWR0aCArIDEwLCB5U2NhbGVyQm90dG9tKHBhcmFtcy5wKSlcbiAgICAuY2FsbChhZGRMYWJlbCwgXCJBQ1wiLCB4U2NhbGVyKDk1KSAtIDEwLCB5U2NhbGVyQm90dG9tKGFjRnhuKHsgcTogOTUsIGZjOiBwYXJhbXMuZmMgfSkpIC0gMTAsIFwiZW5kXCIpXG4gICAgLmNhbGwoYWRkTGFiZWwsIFwiTUNcIiwgeFNjYWxlcig2MykgKyAxMCwgeVNjYWxlckJvdHRvbShtY0Z4bih7IHE6IDYzIH0pKSArIDEwKVxuICAgIC5jYWxsKGFkZExhYmVsLCBcIkRlbWFuZFwiLCB4U2NhbGVyKDg0KSArIDEwLCB5U2NhbGVyQm90dG9tKGRlbWFuZE1vbm9GeG4oeyBxOiA4NCB9KSkgLSAxMClcbiAgICAuY2FsbChhZGRMYWJlbCwgXCJNUlwiLCB4U2NhbGVyKDQ1KSArIDEwLCB5U2NhbGVyQm90dG9tKG1yTW9ub0Z4bih7IHE6IDQ1IH0pKSAtIDEwKTtcblxuICAvLyBUb2dnbGUgZXZlbnQgbGlzdGVuZXIgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG4gIFxuICBjb25zdCBjYiA9IHN2Zy5zZWxlY3QoXCJmb3JlaWduT2JqZWN0XCIpLnNlbGVjdChgaW5wdXQjY2hlY2tib3gtJHtpZH1gKVxuICBcbiAgY2Iub24oXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgY29uc3QgaXNDaGVja2VkID0gY2IucHJvcGVydHkoXCJjaGVja2VkXCIpO1xuICAgIGNvbnN0IGNoYXJ0TGFiZWxzID0gc3ZnLnNlbGVjdEFsbChgZyNsYWJlbHMtJHtpZH1gKTtcbiAgICBpc0NoZWNrZWQgPyBjaGFydExhYmVscy5zdHlsZShcInZpc2liaWxpdHlcIiwgXCJ2aXNpYmxlXCIpIDogY2hhcnRMYWJlbHMuc3R5bGUoXCJ2aXNpYmlsaXR5XCIsIFwiaGlkZGVuXCIpO1xuICB9KTtcbiAgXG4gIHJldHVybiBjb250YWluZXIubm9kZSgpO1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xNSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IntcbiAgY29uc3QgcGFyYW1zID0gKHsgcTogbnVsbCwgZmM6IG51bGwsIHA6IG51bGwsIGM6IG51bGwgfSk7XG4gIGNvbnN0IHEgPSAocCkgPT4gTWF0aC5mbG9vcigoMjcgLSBwKSAvICgyNy85NSkpO1xuICBjb25zdCBwTW9ub3BvbHkgPSAxNS41O1xuICBjb25zdCBwQ29tcGV0aXRpdmUgPSAxMS41O1xuICBwYXJhbXMuZmMgPSAxODA7XG4gIFxuICBjb25zdCBpZCA9IGQzLnJhbmRvbUludCgxMDAwMDAsIDEwMDAwMDApKCk7XG4gIGNvbnN0IGF4aXNUaXRsZXNUb3AgPSAoeyB4OiBcIk91dHB1dFwiLCB5OiBcIiRcIiB9KTtcbiAgY29uc3QgYXhpc1RpdGxlc0JvdHRvbSA9ICh7IHg6IFwiT3V0cHV0XCIsIHk6IFwiJC91bml0XCIgfSk7XG4gIFxuICBjb25zdCB5U2NhbGVyVG9wID0gZDMuc2NhbGVMaW5lYXIoKVxuICAgIC5kb21haW4oWy0xMDAwLCA0MDBdKVxuICAgIC5yYW5nZShbcGFuZWxIZWlnaHQsIDBdKTtcbiAgY29uc3QgeVNjYWxlckJvdHRvbSA9IGQzLnNjYWxlTGluZWFyKClcbiAgICAuZG9tYWluKFswLCBhY0Z4bih7IHE6IHFNYXgsIGZjOiBmY01heCB9KV0pXG4gICAgLnJhbmdlKFtwYW5lbEhlaWdodCwgMF0pO1xuICAgIFxuICBjb25zdCBjb250YWluZXIgPSBkMy5jcmVhdGUoXCJkaXZcIilcblx0XHQuYXR0cihcInN0eWxlXCIsIFwiZGlzcGxheTogZmxleDsganVzdGlmeS1jb250ZW50OiBjZW50ZXJcIik7XG5cdFxuICBjb25zdCBzdmcgPSBjb250YWluZXIuYXBwZW5kKFwic3ZnXCIpXG4gICAgLmF0dHIoXCJ3aWR0aFwiLCB3aWR0aCArIG1hcmdpbi5sZWZ0ICsgbWFyZ2luLnJpZ2h0KVxuICAgIC5hdHRyKFwiaGVpZ2h0XCIsIGhlaWdodCArIG1hcmdpbi50b3AgKyBtYXJnaW4uYm90dG9tKVxuICAgIC5hdHRyKFwidmlld0JveFwiLCBbMCwgMCwgd2lkdGggKyBtYXJnaW4ubGVmdCArIG1hcmdpbi5yaWdodCwgaGVpZ2h0ICsgbWFyZ2luLnRvcCArIG1hcmdpbi5ib3R0b21dKVxuICAgIC5hdHRyKFwic3R5bGVcIiwgXCJtYXgtd2lkdGg6IDEwMCU7IGhlaWdodDogYXV0bzsgaGVpZ2h0OiBpbnRyaW5zaWM7XCIpXG4gICAgLmNhbGwoYmFja2dyb3VuZClcbiAgICAuY2FsbChsYWJlbHNUb2dnbGUsIGlkKTtcbiAgXG4gIC8vIFRvcCBwYW5lbCAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgXG4gIGNvbnN0IHBhbmVsVG9wID0gc3ZnLmFwcGVuZChcImdcIilcbiAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBgdHJhbnNsYXRlKCR7bWFyZ2luLmxlZnR9LCAke21hcmdpbi50b3B9KWApXG4gIFxuICBwYW5lbFRvcC5hcHBlbmQoXCJnXCIpXG4gICAgLmNhbGwoY2xpcFdpZGUsIGlkKVxuICAgIC5jYWxsKGFkZEN1cnZlRnVsbCwgaWQsIHByb2ZpdE1vbm8sIHBhcmFtcywgeVNjYWxlclRvcCk7XG4gIFxuICBwYW5lbFRvcC5hcHBlbmQoXCJnXCIpXG4gICAgLmNhbGwocGFuZWxBeGVzVCwgYXhpc1RpdGxlc1RvcCwgeVNjYWxlclRvcClcbiAgXG4gIHBhbmVsVG9wLmFwcGVuZChcImdcIilcbiAgICAuYXR0cihcImlkXCIsIGBsYWJlbHMtJHtpZH1gKVxuICAgIC5jYWxsKGNsaXBXaWRlLCBpZClcbiAgICAuY2FsbChhZGRMYWJlbCwgXCJQcm9maXRcIiwgeFNjYWxlcig3MCkgKyAxMCwgeVNjYWxlclRvcChwcm9maXRNb25vRnhuKHsgcTogNzAsIGZjOiBwYXJhbXMuZmMgfSkpIC0gMTApO1xuICBcbiAgcGFuZWxUb3AuYXBwZW5kKFwiZ1wiKVxuICAgIC5hdHRyKFwiaWRcIiwgYGd1aWRlcy1tb25vcG9seS0ke2lkfWApXG4gICAgLmNhbGwoeUd1aWRlLCBwcm9maXRNb25vLCAoeyBxOiBxKHBNb25vcG9seSksIGZjOiAxODAsIHA6IHBNb25vcG9seSB9KSwgeVNjYWxlclRvcClcbiAgICAuY2FsbCh4R3VpZGVzLCBwcm9maXRNb25vLCAoeyBxOiBxKHBNb25vcG9seSksIGZjOiAxODAsIHA6IHBNb25vcG9seSB9KSwgeVNjYWxlclRvcCk7XG4gIFxuICBwYW5lbFRvcC5hcHBlbmQoXCJnXCIpXG4gICAgLmF0dHIoXCJpZFwiLCBgZ3VpZGVzLWNvbXBldGl0aXZlLSR7aWR9YClcbiAgICAuY2FsbCh5R3VpZGUsIHByb2ZpdE1vbm8sICh7IHE6IHEocENvbXBldGl0aXZlKSwgZmM6IDE4MCwgcDogcENvbXBldGl0aXZlIH0pLCB5U2NhbGVyVG9wKVxuICAgIC5jYWxsKHhHdWlkZXMsIHByb2ZpdE1vbm8sICh7IHE6IHEocENvbXBldGl0aXZlKSwgZmM6IDE4MCwgcDogcENvbXBldGl0aXZlIH0pLCB5U2NhbGVyVG9wKTtcbiAgICBcbiAgLy8gQm90dG9tIHBhbmVsIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICBcbiAgY29uc3QgcGFuZWxCb3R0b20gPSBzdmcuYXBwZW5kKFwiZ1wiKVxuICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGB0cmFuc2xhdGUoJHttYXJnaW4ubGVmdH0sICR7bWFyZ2luLnRvcCArIHBhbmVsSGVpZ2h0ICsgbWFyZ2luLmJldHdlZW59KWApO1xuICBcbiAgcGFuZWxCb3R0b20uYXBwZW5kKFwiZ1wiKVxuICAgIC5jYWxsKGNsaXAsIGlkKVxuICAgIC5jYWxsKGFkZEN1cnZlRnVsbCwgaWQsIG1jLCBwYXJhbXMsIHlTY2FsZXJCb3R0b20pXG4gICAgLmNhbGwoYWRkQ3VydmVGdWxsLCBpZCwgZGVtYW5kTW9ubywgcGFyYW1zLCB5U2NhbGVyQm90dG9tKVxuICAgIC5jYWxsKGFkZEN1cnZlRnVsbCwgaWQsIG1yTW9ubywgcGFyYW1zLCB5U2NhbGVyQm90dG9tKTtcbiAgICBcbiAgcGFuZWxCb3R0b20uYXBwZW5kKFwiZ1wiKVxuICAgIC5jYWxsKHBhbmVsQXhlcywgYXhpc1RpdGxlc0JvdHRvbSk7XG4gIFxuICBwYW5lbEJvdHRvbS5hcHBlbmQoXCJnXCIpXG4gICAgLmF0dHIoXCJpZFwiLCBgbGFiZWxzLSR7aWR9YClcbiAgICAuY2FsbChhZGRMYWJlbCwgXCJNQ1wiLCB4U2NhbGVyKDYzKSArIDEwLCB5U2NhbGVyQm90dG9tKG1jRnhuKHsgcTogNjMgfSkpICsgMTApXG4gICAgLmNhbGwoYWRkTGFiZWwsIFwiRGVtYW5kXCIsIHhTY2FsZXIoODQpICsgMTAsIHlTY2FsZXJCb3R0b20oZGVtYW5kTW9ub0Z4bih7IHE6IDg0IH0pKSAtIDEwKVxuICAgIC5jYWxsKGFkZExhYmVsLCBcIk1SXCIsIHhTY2FsZXIoNDUpICsgMTAsIHlTY2FsZXJCb3R0b20obXJNb25vRnhuKHsgcTogNDUgfSkpIC0gMTApO1xuXG4gIHBhbmVsQm90dG9tLmFwcGVuZChcImdcIilcbiAgICAuYXR0cihcImlkXCIsIGBndWlkZXMtbW9ub3BvbHktJHtpZH1gKVxuICAgIC5jYWxsKHlHdWlkZSwgZGVtYW5kTW9ubywgKHsgcTogcShwTW9ub3BvbHkpLCBmYzogMTgwLCBwOiBwTW9ub3BvbHkgfSksIHlTY2FsZXJCb3R0b20pO1xuXG4gIHBhbmVsQm90dG9tLmFwcGVuZChcImdcIilcbiAgICAuYXR0cihcImlkXCIsIGBndWlkZXMtY29tcGV0aXRpdmUtJHtpZH1gKVxuICAgIC5jYWxsKHlHdWlkZSwgZGVtYW5kTW9ubywgKHsgcTogcShwQ29tcGV0aXRpdmUpLCBmYzogMTgwLCBwOiBwQ29tcGV0aXRpdmUgfSksIHlTY2FsZXJCb3R0b20pO1xuICBcbiAgLy8gVG9nZ2xlIGV2ZW50IGxpc3RlbmVyIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICBcbiAgY29uc3QgY2IgPSBzdmcuc2VsZWN0QWxsKFwiZm9yZWlnbk9iamVjdFwiKS5zZWxlY3QoYGlucHV0I2NoZWNrYm94LSR7aWR9YClcbiAgXG4gIGNiLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIGNvbnN0IGlzQ2hlY2tlZCA9IGNiLnByb3BlcnR5KFwiY2hlY2tlZFwiKTtcbiAgICBjb25zdCBjaGFydExhYmVscyA9IHN2Zy5zZWxlY3RBbGwoYGcjbGFiZWxzLSR7aWR9YCk7XG4gICAgaXNDaGVja2VkID8gY2hhcnRMYWJlbHMuc3R5bGUoXCJ2aXNpYmlsaXR5XCIsIFwidmlzaWJsZVwiKSA6IGNoYXJ0TGFiZWxzLnN0eWxlKFwidmlzaWJpbGl0eVwiLCBcImhpZGRlblwiKTtcbiAgfSk7XG4gIFxuICAvLyBDaGFydCBldmVudCBsaXN0ZW5lcnMgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG4gIFxuICBjb25zdCBjaGVja2JveE1vbm9wb2x5ID0gc3ZnLmFwcGVuZChcImZvcmVpZ25PYmplY3RcIilcbiAgICAuYXR0cihcInhcIiwgNDAwKVxuICAgIC5hdHRyKFwieVwiLCAgNDc1KVxuICAgIC5hdHRyKFwid2lkdGhcIiwgMjApXG4gICAgLmF0dHIoXCJoZWlnaHRcIiwgMjApO1xuICBcbiAgY2hlY2tib3hNb25vcG9seS5hcHBlbmQoXCJ4aHRtbDppbnB1dFwiKVxuICAgIC5hdHRyKFwidHlwZVwiLCBcImNoZWNrYm94XCIpXG4gICAgLmF0dHIoXCJpZFwiLCBgY2hlY2tib3gtbW9ub3BvbHktJHtpZH1gKVxuICAgIC5wcm9wZXJ0eShcImNoZWNrZWRcIiwgdHJ1ZSk7XG4gIFxuICBzdmcuYXBwZW5kKFwiZ1wiKVxuICAgIC5hcHBlbmQoXCJ0ZXh0XCIpXG4gICAgLnRleHQoXCJNb25vcG9seSBvdXRjb21lXCIpXG4gICAgLmF0dHIoXCJ4XCIsIDQwMCArIDIwKVxuICAgIC5hdHRyKFwieVwiLCA0NzUgKyA1KVxuICAgIC5hdHRyKFwidGV4dC1hbmNob3JcIiwgXCJzdGFydFwiKVxuICAgIC5hdHRyKFwiYWxpZ25tZW50LWJhc2VsaW5lXCIsIFwiaGFuZ2luZ1wiKVxuICAgIC5zdHlsZShcImZpbGxcIiwgXCJibGFja1wiKTtcbiAgICBcbiAgY29uc3QgY2hlY2tib3hDb21wZXRpdGl2ZSA9IHN2Zy5hcHBlbmQoXCJmb3JlaWduT2JqZWN0XCIpXG4gICAgLmF0dHIoXCJ4XCIsIDQwMClcbiAgICAuYXR0cihcInlcIiwgIDQ3NSArIDI1KVxuICAgIC5hdHRyKFwid2lkdGhcIiwgMjApXG4gICAgLmF0dHIoXCJoZWlnaHRcIiwgMjApO1xuICBcbiAgY2hlY2tib3hDb21wZXRpdGl2ZS5hcHBlbmQoXCJ4aHRtbDppbnB1dFwiKVxuICAgIC5hdHRyKFwidHlwZVwiLCBcImNoZWNrYm94XCIpXG4gICAgLmF0dHIoXCJpZFwiLCBgY2hlY2tib3gtY29tcGV0aXRpdmUtJHtpZH1gKVxuICAgIC5wcm9wZXJ0eShcImNoZWNrZWRcIiwgZmFsc2UpO1xuICBcbiAgc3ZnLmFwcGVuZChcImdcIilcbiAgICAuYXBwZW5kKFwidGV4dFwiKVxuICAgIC50ZXh0KFwiU29jaWFsIG9wdGltdW1cIilcbiAgICAuYXR0cihcInhcIiwgNDAwICsgMjApXG4gICAgLmF0dHIoXCJ5XCIsIDQ3NSArIDUgKyAyNSlcbiAgICAuYXR0cihcInRleHQtYW5jaG9yXCIsIFwic3RhcnRcIilcbiAgICAuYXR0cihcImFsaWdubWVudC1iYXNlbGluZVwiLCBcImhhbmdpbmdcIilcbiAgICAuc3R5bGUoXCJmaWxsXCIsIFwiYmxhY2tcIik7XG4gIFxuICBjb25zdCBjYk1vbm9wb2x5ID0gc3ZnLnNlbGVjdEFsbChcImZvcmVpZ25PYmplY3RcIikuc2VsZWN0KGBpbnB1dCNjaGVja2JveC1tb25vcG9seS0ke2lkfWApO1xuICBjb25zdCBjYkNvbXBldGl0aXZlID0gc3ZnLnNlbGVjdEFsbChcImZvcmVpZ25PYmplY3RcIikuc2VsZWN0KGBpbnB1dCNjaGVja2JveC1jb21wZXRpdGl2ZS0ke2lkfWApO1xuICBzdmcuc2VsZWN0QWxsKGBnI2d1aWRlcy1jb21wZXRpdGl2ZS0ke2lkfWApLnN0eWxlKFwidmlzaWJpbGl0eVwiLCBcImhpZGRlblwiKTtcbiAgXG4gIGNiTW9ub3BvbHkub24oXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgY29uc3QgaXNDaGVja2VkID0gY2JNb25vcG9seS5wcm9wZXJ0eShcImNoZWNrZWRcIik7XG4gICAgY29uc3QgZ3VpZGVzTW9ub3BvbHkgPSBzdmcuc2VsZWN0QWxsKGBnI2d1aWRlcy1tb25vcG9seS0ke2lkfWApO1xuICAgIGlzQ2hlY2tlZCA/IGd1aWRlc01vbm9wb2x5LnN0eWxlKFwidmlzaWJpbGl0eVwiLCBcInZpc2libGVcIikgOiBndWlkZXNNb25vcG9seS5zdHlsZShcInZpc2liaWxpdHlcIiwgXCJoaWRkZW5cIik7XG4gIH0pO1xuICBcbiAgY2JDb21wZXRpdGl2ZS5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICBjb25zdCBpc0NoZWNrZWQgPSBjYkNvbXBldGl0aXZlLnByb3BlcnR5KFwiY2hlY2tlZFwiKTtcbiAgICBjb25zdCBndWlkZXNDb21wZXRpdGl2ZSA9IHN2Zy5zZWxlY3RBbGwoYGcjZ3VpZGVzLWNvbXBldGl0aXZlLSR7aWR9YCk7XG4gICAgaXNDaGVja2VkID8gZ3VpZGVzQ29tcGV0aXRpdmUuc3R5bGUoXCJ2aXNpYmlsaXR5XCIsIFwidmlzaWJsZVwiKSA6IGd1aWRlc0NvbXBldGl0aXZlLnN0eWxlKFwidmlzaWJpbGl0eVwiLCBcImhpZGRlblwiKTtcbiAgfSk7XG4gIFxuICByZXR1cm4gY29udGFpbmVyLm5vZGUoKTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTYiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJcbnZpZXdvZiBkZW1hbmRDb2VmID0gSW5wdXRzLnJhbmdlKFsxNi44LCAyNV0sIHtsYWJlbDogXCJNYXJrZXQgc2l6ZVwiLCBzdGVwOiAuMSwgdmFsdWU6IDI3IH0pXG52aWV3b2YgZmM4ID0gSW5wdXRzLnJhbmdlKFswLCBmY01heF0sIHtsYWJlbDogXCJGaXhlZCBjb3N0XCIsIHN0ZXA6IDEsIHZhbHVlOiAwLCBkaXNhYmxlZDogdHJ1ZSB9KVxuXG57XG4gIGNvbnN0IHBhcmFtcyA9ICh7IHE6IG51bGwsIGZjOiBudWxsLCBwOiBudWxsLCBjOiBudWxsIH0pO1xuICBwYXJhbXMuZmMgPSBmYzg7XG4gIHBhcmFtcy5jID0gZGVtYW5kQ29lZjtcbiAgXG4gIGNvbnN0IGIgPSA1NC85NSAtIDEuMTI7XG4gIGNvbnN0IHFGeG4gPSAoeyBjIH0pID0+IE1hdGguZmxvb3IoICgxLy4wMzYpICogKC1iICsgTWF0aC5wb3coIE1hdGgucG93KGIsIDIpIC0gMS40NCArIC4wNzIgKiBjLCAuNSApICkgKTtcbiAgY29uc3QgZGVtYW5kTW9ub0NvbXBGeG4gPSAoeyBxLCBjIH0gPSB7fSkgPT4gYyAtICgyNy85NSkgKiBxO1xuICBjb25zdCBtck1vbm9Db21wRnhuID0gKHsgcSwgYyB9ID0ge30pID0+IGMgLSAyICogKDI3Lzk1KSAqIHE7XG4gIGNvbnN0IHByb2ZpdE1vbm9Db21wRnhuID0gKHsgcSwgZmMsIGMgfSA9IHt9KSA9PiB7XG4gICAgcmV0dXJuIE1hdGguY2VpbChkZW1hbmRNb25vQ29tcEZ4bih7IHEsIGMgfSkgKiBxIC0gY29zdEZ4bih7IHEsIGZjIH0pKTtcbiAgfVxuICBjb25zdCBwID0gKHsgcSwgYyB9KSA9PiBkZW1hbmRNb25vQ29tcEZ4bih7IHE6IHFGeG4oeyBjOiBwYXJhbXMuYyB9KSwgYzogcGFyYW1zLmMgfSk7XG4gIFxuICBwYXJhbXMucSA9IHFGeG4oeyBjOiBwYXJhbXMuYyB9KTtcbiAgcGFyYW1zLnAgPSBwKHsgcTogcUZ4bih7IGM6IHBhcmFtcy5jIH0pLCBjOiBwYXJhbXMuYyB9KTtcbiAgXG4gIGRlbWFuZE1vbm9Db21wLmZ4biA9IGRlbWFuZE1vbm9Db21wRnhuO1xuICBtck1vbm9Db21wLmZ4biA9IG1yTW9ub0NvbXBGeG47XG4gIHByb2ZpdE1vbm9Db21wLmZ4biA9IHByb2ZpdE1vbm9Db21wRnhuO1xuICBcbiAgY29uc3QgaWQgPSBkMy5yYW5kb21JbnQoMTAwMDAwLCAxMDAwMDAwKSgpO1xuICBjb25zdCBheGlzVGl0bGVzVG9wID0gKHsgeDogXCJPdXRwdXRcIiwgeTogXCIkXCIgfSk7XG4gIGNvbnN0IGF4aXNUaXRsZXNCb3R0b20gPSAoeyB4OiBcIk91dHB1dFwiLCB5OiBcIiQvdW5pdFwiIH0pO1xuICBcbiAgY29uc3QgeVNjYWxlclRvcCA9IGQzLnNjYWxlTGluZWFyKClcbiAgICAuZG9tYWluKFstMTAwMCwgNDAwXSlcbiAgICAucmFuZ2UoW3BhbmVsSGVpZ2h0LCAwXSk7XG4gIGNvbnN0IHlTY2FsZXJCb3R0b20gPSBkMy5zY2FsZUxpbmVhcigpXG4gICAgLmRvbWFpbihbMCwgYWNGeG4oeyBxOiBxTWF4LCBmYzogZmNNYXggfSldKVxuICAgIC5yYW5nZShbcGFuZWxIZWlnaHQsIDBdKTtcbiAgICBcbiAgY29uc3QgZGVtYW5kTW9ub0NvbXBJbnZGeG4gPSAoeyBkbWQsIGMgfSA9IHt9KSA9PiAoOTUvMjcpICogKGMgLSBkbWQpO1xuICBjb25zdCBtck1vbm9Db21wSW52RnhuID0gKHsgbXIsIGMgfSA9IHt9KSA9PiAoOTUvKDI3KjIpKSAqIChjIC0gbXIpO1xuICBjb25zdCBjb3JuZXJzID0gKHsgeDE6IDAsIHkxOiB5U2NhbGVyQm90dG9tKHBhcmFtcy5wKSwgeDI6IHhTY2FsZXIocGFyYW1zLnEpLCB5MjogeVNjYWxlckJvdHRvbShhY0Z4bihwYXJhbXMpKSB9KTtcbiAgXG4gIGNvbnN0IGNvbnRhaW5lciA9IGQzLmNyZWF0ZShcImRpdlwiKVxuXHRcdC5hdHRyKFwic3R5bGVcIiwgXCJkaXNwbGF5OiBmbGV4OyBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlclwiKTtcblx0XG4gIGNvbnN0IHN2ZyA9IGNvbnRhaW5lci5hcHBlbmQoXCJzdmdcIilcbiAgICAuYXR0cihcIndpZHRoXCIsIHdpZHRoICsgbWFyZ2luLmxlZnQgKyBtYXJnaW4ucmlnaHQpXG4gICAgLmF0dHIoXCJoZWlnaHRcIiwgaGVpZ2h0ICsgbWFyZ2luLnRvcCArIG1hcmdpbi5ib3R0b20pXG4gICAgLmF0dHIoXCJ2aWV3Qm94XCIsIFswLCAwLCB3aWR0aCArIG1hcmdpbi5sZWZ0ICsgbWFyZ2luLnJpZ2h0LCBoZWlnaHQgKyBtYXJnaW4udG9wICsgbWFyZ2luLmJvdHRvbV0pXG4gICAgLmF0dHIoXCJzdHlsZVwiLCBcIm1heC13aWR0aDogMTAwJTsgaGVpZ2h0OiBhdXRvOyBoZWlnaHQ6IGludHJpbnNpYztcIilcbiAgICAuY2FsbChiYWNrZ3JvdW5kKVxuICAgIC5jYWxsKGxhYmVsc1RvZ2dsZSwgaWQpO1xuICBcbiAgLy8gVG9wIHBhbmVsIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICBcbiAgY29uc3QgcGFuZWxUb3AgPSBzdmcuYXBwZW5kKFwiZ1wiKVxuICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGB0cmFuc2xhdGUoJHttYXJnaW4ubGVmdH0sICR7bWFyZ2luLnRvcH0pYClcbiAgXG4gIHBhbmVsVG9wLmFwcGVuZChcImdcIilcbiAgICAuY2FsbChjbGlwV2lkZSwgaWQpXG4gICAgLmNhbGwoYWRkQ3VydmUsIGlkLCBwcm9maXRNb25vQ29tcCwgcGFyYW1zLCB5U2NhbGVyVG9wKVxuICAgIC5jYWxsKHlHdWlkZSwgcHJvZml0TW9ub0NvbXAsIHBhcmFtcywgeVNjYWxlclRvcCk7XG4gIFxuICBwYW5lbFRvcC5hcHBlbmQoXCJnXCIpXG4gICAgLmNhbGwocGFuZWxBeGVzVCwgYXhpc1RpdGxlc1RvcCwgeVNjYWxlclRvcClcbiAgICAuY2FsbCh4R3VpZGVzLCBwcm9maXRNb25vQ29tcCwgcGFyYW1zLCB5U2NhbGVyVG9wKTtcbiAgXG4gIHBhbmVsVG9wLmFwcGVuZChcImdcIilcbiAgICAuYXR0cihcImlkXCIsIGBsYWJlbHMtJHtpZH1gKVxuICAgIC5jYWxsKGNsaXBXaWRlLCBpZClcbiAgICAuY2FsbChhZGRMYWJlbCwgXCJQcm9maXRcIiwgeFNjYWxlcig3MCkgKyAxMCwgeVNjYWxlclRvcChwcm9maXRNb25vQ29tcEZ4bih7IHE6IDcwLCBmYzogcGFyYW1zLmZjLCBjOiBwYXJhbXMuYyB9KSkgLSAxMCk7XG4gIFxuICAvLyBCb3R0b20gcGFuZWwgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG4gIFxuICBjb25zdCBwYW5lbEJvdHRvbSA9IHN2Zy5hcHBlbmQoXCJnXCIpXG4gICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgYHRyYW5zbGF0ZSgke21hcmdpbi5sZWZ0fSwgJHttYXJnaW4udG9wICsgcGFuZWxIZWlnaHQgKyBtYXJnaW4uYmV0d2Vlbn0pYCk7XG4gIFxuICBwYW5lbEJvdHRvbS5hcHBlbmQoXCJnXCIpXG4gICAgLmNhbGwoY2xpcFdpZGUsIGlkKVxuICAgIC5jYWxsKGFkZEFyZWEsIGlkLCBwcm9maXRNb25vLCBjb3JuZXJzKVxuICAgIC5zZWxlY3QoXCJwYXRoXCIpXG4gICAgLnN0eWxlKFwiZmlsbFwiLCBjb3JuZXJzLnkxIDwgY29ybmVycy55MiA/IFwiIzdmYzZhNFwiIDogXCIjZjY5N2JiXCIpO1xuICAgIFxuICBwYW5lbEJvdHRvbS5hcHBlbmQoXCJnXCIpXG4gICAgLmNhbGwoY2xpcCwgaWQpXG4gICAgLmNhbGwoYWRkQ3VydmVGdWxsLCBpZCwgcHJpY2UsIHBhcmFtcywgeVNjYWxlckJvdHRvbSwgZ3JheSlcbiAgICAuY2FsbChhZGRDdXJ2ZSwgaWQsIGFjLCBwYXJhbXMsIHlTY2FsZXJCb3R0b20pXG4gICAgLmNhbGwoYWRkQ3VydmUsIGlkLCBtYywgcGFyYW1zLCB5U2NhbGVyQm90dG9tKVxuICAgIC5jYWxsKGFkZEN1cnZlLCBpZCwgZGVtYW5kTW9ub0NvbXAsIHBhcmFtcywgeVNjYWxlckJvdHRvbSlcbiAgICAuY2FsbChhZGRDdXJ2ZSwgaWQsIG1yTW9ub0NvbXAsIHBhcmFtcywgeVNjYWxlckJvdHRvbSlcbiAgXG4gIHBhbmVsQm90dG9tLmFwcGVuZChcImdcIilcbiAgICAuY2FsbChjbGlwV2lkZSwgaWQpXG4gICAgLmNhbGwoeUd1aWRlLCBhYywgcGFyYW1zLCB5U2NhbGVyQm90dG9tKVxuICAgIC5jYWxsKHlHdWlkZSwgZGVtYW5kTW9ub0NvbXAsIHBhcmFtcywgeVNjYWxlckJvdHRvbSk7XG4gICAgXG4gIHBhbmVsQm90dG9tLmFwcGVuZChcImdcIilcbiAgICAuY2FsbChwYW5lbEF4ZXMsIGF4aXNUaXRsZXNCb3R0b20pXG4gIFxuICBwYW5lbEJvdHRvbS5hcHBlbmQoXCJnXCIpXG4gICAgLmF0dHIoXCJpZFwiLCBgbGFiZWxzLSR7aWR9YClcbiAgICAuY2FsbChhZGRMYWJlbCwgXCJQcmljZVwiLCB3aWR0aCArIDEwLCB5U2NhbGVyQm90dG9tKHBhcmFtcy5wKSlcbiAgICAuY2FsbChhZGRMYWJlbCwgXCJBQ1wiLCB4U2NhbGVyKDk1KSAtIDEwLCB5U2NhbGVyQm90dG9tKGFjRnhuKHsgcTogOTUsIGZjOiBwYXJhbXMuZmMgfSkpIC0gMTAsIFwiZW5kXCIpXG4gICAgLmNhbGwoYWRkTGFiZWwsIFwiTUNcIiwgeFNjYWxlcig2MykgKyAxMCwgeVNjYWxlckJvdHRvbShtY0Z4bih7IHE6IDYzIH0pKSArIDEwKVxuICAgIC5jYWxsKGFkZExhYmVsLCBcIkRlbWFuZFwiLCB4U2NhbGVyKGRlbWFuZE1vbm9Db21wSW52RnhuKHsgZG1kOiAxLCBjOiBwYXJhbXMuY30pKSArIDEwLCB5U2NhbGVyQm90dG9tKDEpIC0gMTApXG4gICAgLmNhbGwoYWRkTGFiZWwsIFwiTVJcIiwgeFNjYWxlcihtck1vbm9Db21wSW52RnhuKHsgbXI6IDEsIGM6IHBhcmFtcy5jIH0pKSArIDEwLCB5U2NhbGVyQm90dG9tKDEpIC0gMTApO1xuXG4gIC8vIFRvZ2dsZSBldmVudCBsaXN0ZW5lciAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgXG4gIGNvbnN0IGNiID0gc3ZnLnNlbGVjdChcImZvcmVpZ25PYmplY3RcIikuc2VsZWN0KGBpbnB1dCNjaGVja2JveC0ke2lkfWApXG4gIFxuICBjYi5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICBjb25zdCBpc0NoZWNrZWQgPSBjYi5wcm9wZXJ0eShcImNoZWNrZWRcIik7XG4gICAgY29uc3QgY2hhcnRMYWJlbHMgPSBzdmcuc2VsZWN0QWxsKGBnI2xhYmVscy0ke2lkfWApO1xuICAgIGlzQ2hlY2tlZCA/IGNoYXJ0TGFiZWxzLnN0eWxlKFwidmlzaWJpbGl0eVwiLCBcInZpc2libGVcIikgOiBjaGFydExhYmVscy5zdHlsZShcInZpc2liaWxpdHlcIiwgXCJoaWRkZW5cIik7XG4gIH0pO1xuICBcbiAgcmV0dXJuIGNvbnRhaW5lci5ub2RlKCk7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTE3IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiXG5jb3N0RnhuID0gKHsgcSwgZmMgfSA9IHt9KSA9PiB7XG4gIHJldHVybiAuMDA2ICogTWF0aC5wb3cocSwgMykgLSAuNTYgKiBNYXRoLnBvdyhxLCAyKSArIDIwICogcSArIGZjXG59O1xuYWNGeG4gPSAoeyBxLCBmYyB9ID0ge30pID0+IHtcbiAgaWYgKGlzTmFOKGNvc3RGeG4oeyBxLCBmYyB9KSAvIHEpKSByZXR1cm4gLjAwNiAqIE1hdGgucG93KHEsIDIpIC0gLjU2ICogcSArIDIwXG4gIGVsc2UgaWYgKHEgPT09IDApIHJldHVybiBudWxsXG4gIGVsc2UgcmV0dXJuIGNvc3RGeG4oeyBxLCBmYyB9KSAvIHFcbn07XG5hdmNGeG4gPSAoe3F9ID0ge30pID0+IC4wMDYgKiBNYXRoLnBvdyhxLCAyKSAtIC41NiAqIHEgKyAyMDtcbm1jRnhuID0gKHtxfSA9IHt9KSA9PiAuMDA2ICogMyAqIE1hdGgucG93KHEsIDIpIC0gLjU2ICogMiAqIHEgKyAyMDtcbnByb2ZpdEZ4biA9ICh7IHEsIHAsIGZjIH0gPSB7fSkgPT4gcCAqIHEgLSBjb3N0RnhuKHsgcSwgZmMgfSk7XG5zdXBwbHlGeG4gPSAoe3F9ID0ge30pID0+IHtcbiAgY29uc3QgbWluQVZDcSA9IE1hdGguZmxvb3IoLjU2IC8gKC4wMDYgKiAyKSk7XG4gIGlmIChxIDwgbWluQVZDcSArIDEpIHJldHVybiBhdmNGeG4oeyBxOiBtaW5BVkNxIH0pO1xuICBlbHNlIHJldHVybiBtY0Z4bih7IHEgfSk7XG59XG5tckZ4biA9ICh7cH0gPSB7fSkgPT4gcDtcbmRlbWFuZE1vbm9GeG4gPSAoe3F9ID0ge30pID0+IDI3IC0gKDI3Lzk1KSAqIHE7XG5tck1vbm9GeG4gPSAoe3F9ID0ge30pID0+IDI3IC0gMiAqICgyNy85NSkgKiBxO1xucHJvZml0TW9ub0Z4biA9ICh7IHEsIGZjIH0gPSB7fSkgPT4ge1xuICByZXR1cm4gZGVtYW5kTW9ub0Z4bih7cX0pICogcSAtIGNvc3RGeG4oeyBxLCBmYyB9KVxufTtcblxuY29zdCA9ICh7IGZ4bjogY29zdEZ4biwgbGFiZWw6IFwiQ29zdFwiLCBpZDogXCJjb3N0LWN1cnZlXCIsIHNjaGVtZTogcmVkIH0pO1xuYWMgPSAoeyBmeG46IGFjRnhuLCBsYWJlbDogXCJBdmVyYWdlIGNvc3RcIiwgaWQ6IFwiYWMtY3VydmVcIiwgc2NoZW1lOiBibHVlIH0pO1xuYXZjID0gKHsgZnhuOiBhdmNGeG4sIGxhYmVsOiBcIkF2ZXJhZ2UgdmFyaWFibGUgY29zdFwiLCBpZDogXCJhdmMtY3VydmVcIiwgc2NoZW1lOiBibHVlIH0pO1xubWMgPSAoeyBmeG46IG1jRnhuLCBsYWJlbDogXCJNYXJnaW5hbCBjb3N0XCIsIGlkOiBcIm1jLWN1cnZlXCIsIHNjaGVtZTogYmx1ZSB9KTtcbnByb2ZpdCA9ICh7IGZ4bjogcHJvZml0RnhuLCBsYWJlbDogXCJQcm9maXRcIiwgaWQ6IFwicHJvZml0LWN1cnZlXCIsIHNjaGVtZTogcmVkIH0pO1xucHJpY2UgPSAoeyBmeG46IG1yRnhuLCBsYWJlbDogXCJQcmljZVwiLCBpZDogXCJtci1jdXJ2ZVwiLCBzY2hlbWU6IGdyZWVuIH0pO1xubXIgPSAoeyBmeG46IG1yRnhuLCBsYWJlbDogXCJNYXJnaW5hbCByZXZlbnVlXCIsIGlkOiBcIm1yLWN1cnZlXCIsIHNjaGVtZTogZ3JlZW4gfSk7XG5zdXBwbHkgPSAoeyBmeG46IHN1cHBseUZ4biwgbGFiZWw6IFwiU3VwcGx5XCIsIGlkOiBcInN1cHBseS1jdXJ2ZVwiLCBzY2hlbWU6IGJsdWUgfSk7XG5cbmRlbWFuZE1vbm8gPSAoeyBmeG46IGRlbWFuZE1vbm9GeG4sIGxhYmVsOiBcIkRlbWFuZFwiLCBpZDogXCJkZW1hbmQtbW9uby1jdXJ2ZVwiLCBzY2hlbWU6IGdyZWVuIH0pO1xubXJNb25vID0gKHsgZnhuOiBtck1vbm9GeG4sIGxhYmVsOiBcIk1hcmdpbmFsIHJldmVudWVcIiwgaWQ6IFwibXItbW9uby1jdXJ2ZVwiLCBzY2hlbWU6IGdyZWVuIH0pO1xucHJvZml0TW9ubyA9ICh7IGZ4bjogcHJvZml0TW9ub0Z4biwgbGFiZWw6IFwiUHJvZml0XCIsIGlkOiBcInByb2ZpdC1tb25vLWN1cnZlXCIsIHNjaGVtZTogcmVkIH0pO1xuXG5kZW1hbmRNb25vQ29tcCA9ICh7IGZ4bjogbnVsbCwgbGFiZWw6IFwiRGVtYW5kXCIsIGlkOiBcImRlbWFuZC1tb25vY29tcC1jdXJ2ZVwiLCBzY2hlbWU6IGdyZWVuIH0pO1xubXJNb25vQ29tcCA9ICh7IGZ4bjogbnVsbCwgbGFiZWw6IFwiTWFyZ2luYWwgcmV2ZW51ZVwiLCBpZDogXCJtci1tb25vY29tcC1jdXJ2ZVwiLCBzY2hlbWU6IGdyZWVuIH0pO1xucHJvZml0TW9ub0NvbXAgPSAoeyBmeG46IG51bGwsIGxhYmVsOiBcIlByb2ZpdFwiLCBpZDogXCJwcm9maXQtbW9ub2NvbXAtY3VydmVcIiwgc2NoZW1lOiByZWQgfSk7XG5cbm1hcmdpbiA9ICh7IHRvcDogNTAsIHJpZ2h0OiAxMDAsIGJvdHRvbTogNDAsIGxlZnQ6IDcwLCBiZXR3ZWVuOiA2MCB9KTtcbndpZHRoID0gNDAwO1xuaGVpZ2h0ID0gcGFuZWxIZWlnaHQgKiAyICsgbWFyZ2luLmJldHdlZW47XG5wYW5lbEhlaWdodCA9IDI4MDtcbmZjTWF4ID0gNTAwO1xucU1heCA9IDEwMDtcbnBNYXggPSAyNztcblxuYmdDb2xvciA9IFwiI0VERjhGRlwiO1xuYmx1ZSA9ICh7IGJhc2U6IFwiIzQ4ODlhYlwiLCBkdWxsOiBcIiNBMkM0RDJcIiwgYmFzZVNlbGVjdDogXCIjMEM2MjkxXCIsIGR1bGxTZWxlY3Q6IFwiIzY2OURCOFwifSk7XG5yZWQgPSAoeyBiYXNlOiBcIiNDODVCODlcIiwgZHVsbDogXCIjRTI5RkJDXCIsIGJhc2VTZWxlY3Q6IFwiI0IxM0Q3MFwiLCBkdWxsU2VsZWN0OiBcIiNEMTcyOUFcIiB9KTtcbmdyZWVuID0gKHsgYmFzZTogXCIjNzFCNzk1XCIsIGR1bGw6IFwiI0I0RDdDNlwiLCBiYXNlU2VsZWN0OiBcIiM0MTg0NjJcIiwgZHVsbFNlbGVjdDogXCIjNzNBQThFXCIgfSk7XG5ncmF5ID0gKHsgYmFzZTogXCIjREREREREXCIsIGR1bGw6IFwiI0RERERERFwiLCBiYXNlU2VsZWN0OiBcIiNEMEQwRDBcIiwgZHVsbFNlbGVjdDogXCIjI0QwRDBEMFwiIH0pO1xuZGFzaGVkID0gXCIjOTk5OTk5XCI7XG5zdHJva2VXaWR0aCA9IDU7XG5cbnRvb2x0aXAgPSBkMy5zZWxlY3QoXCJib2R5XCIpXG4gIC5hcHBlbmQoXCJkaXZcIilcbiAgLmF0dHIoXCJjbGFzc1wiLCBcInRvb2xUaXBcIilcbiAgLnN0eWxlKFwiZGlzcGxheVwiLCBcIm5vbmVcIilcbiAgLnN0eWxlKFwicG9zaXRpb25cIiwgXCJhYnNvbHV0ZVwiKVxuICAuc3R5bGUoXCJ3aWR0aFwiLCAxMDApXG4gIC5zdHlsZShcImhlaWdodFwiLCAyMClcbiAgLnN0eWxlKFwiYmFja2dyb3VuZFwiLCBcIiNmN2Y3ZjdcIilcbiAgLnN0eWxlKFwiYm9yZGVyXCIsIFwiMXB4IHNvbGlkICNjZWNlY2VcIilcbiAgLnN0eWxlKFwib3BhY2l0eVwiLCAuOSlcbiAgLnN0eWxlKFwicGFkZGluZ1wiLCBcIi4yZW0gLjQ1ZW1cIilcbiAgLnN0eWxlKFwiZm9udC1zaXplXCIsIFwiLjg1cmVtXCIpO1xuXG5saW5lID0gZDMubGluZSgpLmN1cnZlKGQzLmN1cnZlQmFzaXMpO1xuXG54U2NhbGVyID0gZDMuc2NhbGVMaW5lYXIoKVxuICAuZG9tYWluKFswLCBxTWF4XSlcbiAgLnJhbmdlKFswLCB3aWR0aF0pO1xuXG5kYXRhID0gKGZ4biwgcGFyYW1zLCB5U2NhbGVyKSA9PiB7XG4gIGNvbnN0IHEgPSBwYXJhbXMucSwgcCA9IHBhcmFtcy5wLCBmYyA9IHBhcmFtcy5mYywgYyA9IHBhcmFtcy5jO1xuICByZXR1cm4gQXJyYXkuZnJvbSh7IGxlbmd0aDogcSArIDEgfSwgKF8sIGkpID0+IHtcbiAgICBjb25zdCB5ID0geVNjYWxlcihmeG4oeyBxOiBpLCBwLCBmYywgYyB9KSkgPz8gLTUwMDtcbiAgICBjb25zdCB4ID0gKHkgPT0gbnVsbCkgPyBudWxsIDogeFNjYWxlcihpKTtcbiAgICByZXR1cm4gW3gsIHldO1xuICB9KVxufTtcblxuZGF0YU1heCA9IChmeG4sIHBhcmFtcywgeVNjYWxlcikgPT4ge1xuICBjb25zdCBxID0gcU1heCwgcCA9IHBhcmFtcy5wLCBmYyA9IHBhcmFtcy5mYywgYyA9IHBhcmFtcy5jO1xuICByZXR1cm4gQXJyYXkuZnJvbSh7IGxlbmd0aDogcSArIDEgfSwgKF8sIGkpID0+IHtcbiAgICBjb25zdCB5ID0geVNjYWxlcihmeG4oeyBxOiBpLCBwLCBmYywgYyB9KSkgPz8gLTUwMDtcbiAgICBjb25zdCB4ID0gKHkgPT0gbnVsbCkgPyBudWxsIDogeFNjYWxlcihpKTtcbiAgICByZXR1cm4gW3gsIHldO1xuICB9KVxufTtcblxuYmFja2dyb3VuZCA9IHNlbGVjdGlvbiA9PiB7XG4gIHNlbGVjdGlvbi5hcHBlbmQoXCJyZWN0XCIpXG4gICAgLmF0dHIoXCJ4XCIsIDApLmF0dHIoXCJ5XCIsIDApXG4gICAgLmF0dHIoXCJ3aWR0aFwiLCBzZWxlY3Rpb24uYXR0cihcIndpZHRoXCIpKVxuICAgIC5hdHRyKFwiaGVpZ2h0XCIsIHNlbGVjdGlvbi5hdHRyKFwiaGVpZ2h0XCIpKVxuICAgIC5zdHlsZShcImZpbGxcIiwgYmdDb2xvcilcbiAgICAuc3R5bGUoXCJzdHJva2VcIiwgXCIjRTBFREZCXCIpXG4gICAgLnN0eWxlKFwic3Ryb2tlLXdpZHRoXCIsIDgpO1xuICByZXR1cm4gc2VsZWN0aW9uLm5vZGUoKVxufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xOCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlxuYWRkQ3VydmUgPSAoc2VsZWN0aW9uLCBpZCwgZnhuSW5mbywgcGFyYW1zLCB5U2NhbGVyKSA9PiB7XG5cbiAgY29uc3QgcG9pbnQgPSBkYXRhKGZ4bkluZm8uZnhuLCBwYXJhbXMsIHlTY2FsZXIpW3BhcmFtcy5xXVxuXG4gIGNvbnN0IGN1cnZlcyA9IHNlbGVjdGlvbi5hcHBlbmQoXCJnXCIpXG4gICAgLmF0dHIoXCJpZFwiLCBgJHtmeG5JbmZvLmlkfS0ke2lkfWApXG4gICAgLmF0dHIoXCJwb2ludGVyLWV2ZW50c1wiLCBcInZpc2libGVTdHJva2VcIilcbiAgXG4gIC8vIE5vbi1oaWdobGlnaHRlZCBwb3J0aW9uXG4gIGN1cnZlcy5hcHBlbmQoXCJwYXRoXCIpXG4gICAgLmF0dHIoXCJjbGFzc1wiLCBcImN1cnZlIGR1bGxlZFwiKVxuICAgIC5hdHRyKFwiZFwiLCBsaW5lKGRhdGFNYXgoZnhuSW5mby5meG4sIHBhcmFtcywgeVNjYWxlcikpKVxuICAgIC5zdHlsZShcImZpbGxcIiwgXCJub25lXCIpXG4gICAgLnN0eWxlKFwic3Ryb2tlXCIsIGZ4bkluZm8uc2NoZW1lLmR1bGwpXG4gICAgLnN0eWxlKFwic3Ryb2tlLXdpZHRoXCIsIHN0cm9rZVdpZHRoKVxuICBcbiAgLy8gSGlnaGxpZ2h0ZWQgcG9ydGlvblxuICBjdXJ2ZXMuYXBwZW5kKFwicGF0aFwiKVxuICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJjdXJ2ZSBjb2xvcmVkXCIpXG4gICAgLmF0dHIoXCJkXCIsIGxpbmUoZGF0YShmeG5JbmZvLmZ4biwgcGFyYW1zLCB5U2NhbGVyKSkpXG4gICAgLnN0eWxlKFwiZmlsbFwiLCBcIm5vbmVcIilcbiAgICAuc3R5bGUoXCJzdHJva2VcIiwgZnhuSW5mby5zY2hlbWUuYmFzZSlcbiAgICAuc3R5bGUoXCJzdHJva2Utd2lkdGhcIiwgc3Ryb2tlV2lkdGgpXG4gIFxuICAvLyBBZGQgaG92ZXIgZWZmZWN0c1xuICBjdXJ2ZXNcbiAgICAub24oXCJtb3VzZW1vdmVcIiwgKGV2ZW50KSA9PiB7XG4gICAgICBkMy5zZWxlY3RBbGwoYCMke2Z4bkluZm8uaWR9LSR7aWR9IC5jdXJ2ZS5jb2xvcmVkYClcbiAgICAgICAgLnRyYW5zaXRpb24oKS5kdXJhdGlvbig1MClcbiAgICAgICAgLnN0eWxlKFwic3Ryb2tlLXdpZHRoXCIsIHN0cm9rZVdpZHRoICsgMilcbiAgICAgICAgLnN0eWxlKFwic3Ryb2tlXCIsIGZ4bkluZm8uc2NoZW1lLmJhc2VTZWxlY3QpO1xuICAgICAgZDMuc2VsZWN0QWxsKGAjJHtmeG5JbmZvLmlkfS0ke2lkfSAuY3VydmUuZHVsbGVkYClcbiAgICAgICAgLnRyYW5zaXRpb24oKS5kdXJhdGlvbig1MClcbiAgICAgICAgLnN0eWxlKFwic3Ryb2tlLXdpZHRoXCIsIHN0cm9rZVdpZHRoICsgMilcbiAgICAgICAgLnN0eWxlKFwic3Ryb2tlXCIsIGZ4bkluZm8uc2NoZW1lLmR1bGxTZWxlY3QpO1xuICAgICAgdG9vbHRpcFxuICAgICAgICAuc3R5bGUoXCJsZWZ0XCIsIGV2ZW50LnBhZ2VYICsgMTggKyBcInB4XCIpXG4gICAgICAgIC5zdHlsZShcInRvcFwiLCBldmVudC5wYWdlWSArIDE4ICsgXCJweFwiKVxuICAgICAgICAuc3R5bGUoXCJkaXNwbGF5XCIsIFwiYmxvY2tcIilcbiAgICAgICAgLnRleHQoZnhuSW5mby5sYWJlbCk7XG4gICAgICBkMy5zZWxlY3QoZXZlbnQudGFyZ2V0KS5zdHlsZShcImN1cnNvclwiLCBcInBvaW50ZXJcIik7XG4gICAgfSlcbiAgICAub24oXCJtb3VzZWxlYXZlXCIsIChldmVudCkgPT4ge1xuICAgICAgZDMuc2VsZWN0QWxsKGAjJHtmeG5JbmZvLmlkfS0ke2lkfSAuY3VydmUuY29sb3JlZGApXG4gICAgICAgIC50cmFuc2l0aW9uKCkuZHVyYXRpb24oMTAwKVxuICAgICAgICAuc3R5bGUoXCJzdHJva2Utd2lkdGhcIiwgc3Ryb2tlV2lkdGgpXG4gICAgICAgIC5zdHlsZShcInN0cm9rZVwiLCBmeG5JbmZvLnNjaGVtZS5iYXNlKTtcbiAgICAgIGQzLnNlbGVjdEFsbChgIyR7ZnhuSW5mby5pZH0tJHtpZH0gLmN1cnZlLmR1bGxlZGApXG4gICAgICAgIC50cmFuc2l0aW9uKCkuZHVyYXRpb24oMTAwKVxuICAgICAgICAuc3R5bGUoXCJzdHJva2Utd2lkdGhcIiwgc3Ryb2tlV2lkdGgpXG4gICAgICAgIC5zdHlsZShcInN0cm9rZVwiLCBmeG5JbmZvLnNjaGVtZS5kdWxsKTtcbiAgICAgIHRvb2x0aXAuc3R5bGUoXCJkaXNwbGF5XCIsIFwibm9uZVwiKTtcbiAgICAgIGQzLnNlbGVjdChldmVudC50YXJnZXQpLnN0eWxlKFwiY3Vyc29yXCIsIFwiZGVmYXVsdFwiKTtcbiAgICB9KTtcblxuICByZXR1cm4gc2VsZWN0aW9uLm5vZGUoKVxufVxuXG5hZGRDdXJ2ZUZ1bGwgPSAoc2VsZWN0aW9uLCBpZCwgZnhuSW5mbywgcGFyYW1zLCB5U2NhbGVyLCBzY2hlbWUgPSBmeG5JbmZvLnNjaGVtZSkgPT4ge1xuICBcbiAgY29uc3QgY3VydmVzID0gc2VsZWN0aW9uLmFwcGVuZChcImdcIilcbiAgICAuYXR0cihcImlkXCIsIGAke2Z4bkluZm8uaWR9LSR7aWR9YClcbiAgICAuYXR0cihcInBvaW50ZXItZXZlbnRzXCIsIFwidmlzaWJsZVN0cm9rZVwiKTtcbiAgXG4gIGN1cnZlcy5hcHBlbmQoXCJwYXRoXCIpXG4gICAgLmF0dHIoXCJjbGFzc1wiLCBcImN1cnZlXCIpXG4gICAgLmF0dHIoXCJkXCIsIGxpbmUoZGF0YU1heChmeG5JbmZvLmZ4biwgcGFyYW1zLCB5U2NhbGVyKSkpXG4gICAgLnN0eWxlKFwiZmlsbFwiLCBcIm5vbmVcIilcbiAgICAuc3R5bGUoXCJzdHJva2VcIiwgc2NoZW1lLmJhc2UpXG4gICAgLnN0eWxlKFwic3Ryb2tlLXdpZHRoXCIsIHN0cm9rZVdpZHRoKVxuXG4gIC8vIEFkZCBob3ZlciBlZmZlY3RzXG4gIGN1cnZlc1xuICAgIC5vbihcIm1vdXNlbW92ZVwiLCAoZXZlbnQpID0+IHtcbiAgICAgIGQzLnNlbGVjdEFsbChgIyR7ZnhuSW5mby5pZH0tJHtpZH0gLmN1cnZlYClcbiAgICAgICAgLnRyYW5zaXRpb24oKS5kdXJhdGlvbig1MClcbiAgICAgICAgLnN0eWxlKFwic3Ryb2tlLXdpZHRoXCIsIHN0cm9rZVdpZHRoICsgMilcbiAgICAgICAgLnN0eWxlKFwic3Ryb2tlXCIsIHNjaGVtZS5iYXNlU2VsZWN0KTtcbiAgICAgIHRvb2x0aXBcbiAgICAgICAgLnN0eWxlKFwibGVmdFwiLCBldmVudC5wYWdlWCArIDE4ICsgXCJweFwiKVxuICAgICAgICAuc3R5bGUoXCJ0b3BcIiwgZXZlbnQucGFnZVkgKyAxOCArIFwicHhcIilcbiAgICAgICAgLnN0eWxlKFwiZGlzcGxheVwiLCBcImJsb2NrXCIpXG4gICAgICAgIC50ZXh0KGZ4bkluZm8ubGFiZWwpO1xuICAgICAgZDMuc2VsZWN0KGV2ZW50LnRhcmdldCkuc3R5bGUoXCJjdXJzb3JcIiwgXCJwb2ludGVyXCIpO1xuICAgIH0pXG4gICAgLm9uKFwibW91c2VsZWF2ZVwiLCAoZXZlbnQpID0+IHtcbiAgICAgIGQzLnNlbGVjdEFsbChgIyR7ZnhuSW5mby5pZH0tJHtpZH0gLmN1cnZlYClcbiAgICAgICAgLnRyYW5zaXRpb24oKS5kdXJhdGlvbigxMDApXG4gICAgICAgIC5zdHlsZShcInN0cm9rZS13aWR0aFwiLCBzdHJva2VXaWR0aClcbiAgICAgICAgLnN0eWxlKFwic3Ryb2tlXCIsIHNjaGVtZS5iYXNlKTtcbiAgICAgIHRvb2x0aXAuc3R5bGUoXCJkaXNwbGF5XCIsIFwibm9uZVwiKTtcbiAgICAgIGQzLnNlbGVjdChldmVudC50YXJnZXQpLnN0eWxlKFwiY3Vyc29yXCIsIFwiZGVmYXVsdFwiKTtcbiAgICB9KTtcblxuICByZXR1cm4gc2VsZWN0aW9uLm5vZGUoKVxufVxuXG5hZGRBcmVhID0gKHNlbGVjdGlvbiwgaWQsIGluZm8sIGNvcm5lcnMpID0+IHtcbiAgXG4gIGNvbnN0IGFyZWEgPSBzZWxlY3Rpb24uYXBwZW5kKFwicGF0aFwiKVxuICAgIC5hdHRyKFwiaWRcIiwgYGFyZWEtJHtpbmZvLmlkfS0ke2lkfWApXG4gICAgLmF0dHIoXCJkXCIsIGQzLmxpbmUoKShbIFxuICAgICAgW2Nvcm5lcnMueDEsIGNvcm5lcnMueTFdLCBcbiAgICAgIFtjb3JuZXJzLngyLCBjb3JuZXJzLnkxXSxcbiAgICAgIFtjb3JuZXJzLngyLCBjb3JuZXJzLnkyXSxcbiAgICAgIFtjb3JuZXJzLngxLCBjb3JuZXJzLnkyXVxuICAgIF0pKVxuICAgIC5zdHlsZShcIm9wYWNpdHlcIiwgLjI1KVxuICAgIC5zdHlsZShcImZpbGxcIiwgXCIjN2ZjNmE0XCIpXG4gIFxuICAvLyBBZGQgaG92ZXIgZWZmZWN0c1xuICBhcmVhXG4gICAgLm9uKFwibW91c2Vtb3ZlXCIsIChldmVudCkgPT4ge1xuICAgICAgZDMuc2VsZWN0QWxsKGAjYXJlYS0ke2luZm8uaWR9LSR7aWR9YClcbiAgICAgICAgLnRyYW5zaXRpb24oKS5kdXJhdGlvbig1MClcbiAgICAgICAgLnN0eWxlKFwib3BhY2l0eVwiLCAuNSk7XG4gICAgICB0b29sdGlwXG4gICAgICAgIC5zdHlsZShcImxlZnRcIiwgZXZlbnQucGFnZVggKyAxOCArIFwicHhcIilcbiAgICAgICAgLnN0eWxlKFwidG9wXCIsIGV2ZW50LnBhZ2VZICsgMTggKyBcInB4XCIpXG4gICAgICAgIC5zdHlsZShcImRpc3BsYXlcIiwgXCJibG9ja1wiKVxuICAgICAgICAudGV4dChpbmZvLmxhYmVsKTtcbiAgICAgIGQzLnNlbGVjdChldmVudC50YXJnZXQpLnN0eWxlKFwiY3Vyc29yXCIsIFwicG9pbnRlclwiKTtcbiAgICB9KVxuICAgIC5vbihcIm1vdXNlbGVhdmVcIiwgKGV2ZW50KSA9PiB7XG4gICAgICBkMy5zZWxlY3RBbGwoYCNhcmVhLSR7aW5mby5pZH0tJHtpZH1gKVxuICAgICAgICAudHJhbnNpdGlvbigpLmR1cmF0aW9uKDUwKVxuICAgICAgICAuc3R5bGUoXCJvcGFjaXR5XCIsIC4yNSk7XG4gICAgICB0b29sdGlwLnN0eWxlKFwiZGlzcGxheVwiLCBcIm5vbmVcIik7XG4gICAgICBkMy5zZWxlY3QoZXZlbnQudGFyZ2V0KS5zdHlsZShcImN1cnNvclwiLCBcImRlZmF1bHRcIik7XG4gICAgfSk7XG5cbiAgcmV0dXJuIHNlbGVjdGlvbi5ub2RlKClcbn1cblxuY2xpcCA9IChzZWxlY3Rpb24sIGlkKSA9PiB7XG4gIFxuICBzZWxlY3Rpb24uYXR0cihcImNsaXAtcGF0aFwiLCBgdXJsKCNjbGlwLSR7aWR9KWApO1xuICBcbiAgY29uc3QgY2xpcCA9IHNlbGVjdGlvbi5hcHBlbmQoXCJjbGlwUGF0aFwiKVxuICAgIC5hdHRyKFwiaWRcIiwgYGNsaXAtJHtpZH1gKTtcbiAgY2xpcC5hcHBlbmQoXCJyZWN0XCIpXG4gICAgLmF0dHIoXCJ4XCIsIDApXG4gICAgLmF0dHIoXCJ5XCIsIDApXG4gICAgLmF0dHIoXCJ3aWR0aFwiLCB3aWR0aCArIG1hcmdpbi5yaWdodClcbiAgICAuYXR0cihcImhlaWdodFwiLCBwYW5lbEhlaWdodClcbiAgICAuc3R5bGUoXCJmaWxsXCIsIFwid2hpdGVcIik7XG4gICAgXG4gIHJldHVybiBzZWxlY3Rpb24ubm9kZSgpO1xufVxuXG5jbGlwV2lkZSA9IChzZWxlY3Rpb24sIGlkKSA9PiB7XG4gIFxuICBzZWxlY3Rpb24uYXR0cihcImNsaXAtcGF0aFwiLCBgdXJsKCNjbGlwLXdpZGUtJHtpZH0pYCk7XG4gIFxuICBjb25zdCBjbGlwID0gc2VsZWN0aW9uLmFwcGVuZChcImNsaXBQYXRoXCIpXG4gICAgLmF0dHIoXCJpZFwiLCBgY2xpcC13aWRlLSR7aWR9YCk7XG4gIGNsaXAuYXBwZW5kKFwicmVjdFwiKVxuICAgIC5hdHRyKFwieFwiLCAwKVxuICAgIC5hdHRyKFwieVwiLCAwKVxuICAgIC5hdHRyKFwid2lkdGhcIiwgd2lkdGggKyBtYXJnaW4ucmlnaHQpXG4gICAgLmF0dHIoXCJoZWlnaHRcIiwgcGFuZWxIZWlnaHQpXG4gICAgLnN0eWxlKFwiZmlsbFwiLCBcIndoaXRlXCIpO1xuICBjbGlwLmFwcGVuZChcInJlY3RcIilcbiAgICAuYXR0cihcInhcIiwgLW1hcmdpbi5sZWZ0KVxuICAgIC5hdHRyKFwieVwiLCAtMTApXG4gICAgLmF0dHIoXCJ3aWR0aFwiLCBtYXJnaW4ubGVmdClcbiAgICAuYXR0cihcImhlaWdodFwiLCBwYW5lbEhlaWdodCArIDIwKVxuICAgIC5zdHlsZShcImZpbGxcIiwgXCJ3aGl0ZVwiKTtcbiAgXG4gIHJldHVybiBzZWxlY3Rpb24ubm9kZSgpO1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xOSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlxucGFuZWxBeGVzID0gKHNlbGVjdGlvbiwgdGl0bGVzKSA9PiB7XG4gIFxuICBjb25zdCBheGVzID0gc2VsZWN0aW9uLmFwcGVuZChcImdcIilcbiAgXG4gIC8vIEF4aXMgbGluZXNcbiAgYXhlcy5hcHBlbmQoXCJwYXRoXCIpXG4gICAgLmF0dHIoXCJkXCIsIGQzLmxpbmUoKShbW3dpZHRoLCBwYW5lbEhlaWdodF0sIFswLCBwYW5lbEhlaWdodF0sIFswLCAwXV0pKVxuICAgIC5zdHlsZShcImZpbGxcIiwgXCJub25lXCIpXG4gICAgLnN0eWxlKFwic3Ryb2tlXCIsIFwiYmxhY2tcIilcbiAgICAuc3R5bGUoXCJzdHJva2Utd2lkdGhcIiwgMik7XG4gIFxuICAvLyBBeGlzIHRpdGxlcyAgICBcbiAgYXhlcy5hcHBlbmQoXCJ0ZXh0XCIpXG4gICAgLnRleHQodGl0bGVzLngpXG4gICAgLmF0dHIoXCJ4XCIsIHdpZHRoICsgMTApXG4gICAgLmF0dHIoXCJ5XCIsIHBhbmVsSGVpZ2h0KVxuICAgIC5zdHlsZShcImZpbGxcIiwgXCJibGFja1wiKVxuICAgIC5zdHlsZShcImZvbnQtc2l6ZVwiLCBcIi45cmVtXCIpXG4gICAgLnN0eWxlKFwidGV4dC1hbmNob3JcIiwgXCJzdGFydFwiKVxuICAgIC5zdHlsZShcImFsaWdubWVudC1iYXNlbGluZVwiLCBcIm1pZGRsZVwiKTtcbiAgYXhlcy5hcHBlbmQoXCJ0ZXh0XCIpXG4gICAgLnRleHQodGl0bGVzLnkpXG4gICAgLmF0dHIoXCJ4XCIsIDApXG4gICAgLmF0dHIoXCJ5XCIsIC0xNSlcbiAgICAuc3R5bGUoXCJmaWxsXCIsIFwiYmxhY2tcIilcbiAgICAuc3R5bGUoXCJmb250LXNpemVcIiwgXCIuOXJlbVwiKVxuICAgIC5zdHlsZShcInRleHQtYW5jaG9yXCIsIFwibWlkZGxlXCIpO1xuXG4gIHJldHVybiBzZWxlY3Rpb24ubm9kZSgpXG59XG5cbnBhbmVsQXhlc1QgPSAoc2VsZWN0aW9uLCB0aXRsZXMsIHlTY2FsZXIpID0+IHtcbiAgXG4gIGNvbnN0IGF4ZXMgPSBzZWxlY3Rpb24uYXBwZW5kKFwiZ1wiKVxuICBcbiAgLy8gQXhpcyBsaW5lc1xuICBheGVzLmFwcGVuZChcInBhdGhcIilcbiAgICAuYXR0cihcImRcIiwgZDMubGluZSgpKFtbMCwgeVNjYWxlcigwKV0sIFt3aWR0aCwgeVNjYWxlcigwKV1dKSlcbiAgICAuc3R5bGUoXCJzdHJva2VcIiwgXCJibGFja1wiKVxuICAgIC5zdHlsZShcInN0cm9rZS13aWR0aFwiLCAyKTtcbiAgYXhlcy5hcHBlbmQoXCJwYXRoXCIpXG4gICAgLmF0dHIoXCJkXCIsIGQzLmxpbmUoKShbWzAsIDBdLCBbMCwgcGFuZWxIZWlnaHRdXSkpXG4gICAgLnN0eWxlKFwic3Ryb2tlXCIsIFwiYmxhY2tcIilcbiAgICAuc3R5bGUoXCJzdHJva2Utd2lkdGhcIiwgMik7XG4gIFxuICAvLyBBeGlzIHRpdGxlc1xuICBheGVzLmFwcGVuZChcInRleHRcIilcbiAgICAudGV4dCh0aXRsZXMueClcbiAgICAuYXR0cihcInhcIiwgd2lkdGggKyAxMClcbiAgICAuYXR0cihcInlcIiwgeVNjYWxlcigwKSlcbiAgICAuc3R5bGUoXCJmaWxsXCIsIFwiYmxhY2tcIilcbiAgICAuc3R5bGUoXCJmb250LXNpemVcIiwgXCIuOXJlbVwiKVxuICAgIC5zdHlsZShcInRleHQtYW5jaG9yXCIsIFwic3RhcnRcIilcbiAgICAuc3R5bGUoXCJhbGlnbm1lbnQtYmFzZWxpbmVcIiwgXCJtaWRkbGVcIik7XG4gIGF4ZXMuYXBwZW5kKFwidGV4dFwiKVxuICAgIC50ZXh0KHRpdGxlcy55KVxuICAgIC5hdHRyKFwieFwiLCAwKVxuICAgIC5hdHRyKFwieVwiLCAtMTUpXG4gICAgLnN0eWxlKFwiZmlsbFwiLCBcImJsYWNrXCIpXG4gICAgLnN0eWxlKFwiZm9udC1zaXplXCIsIFwiLjlyZW1cIilcbiAgICAuc3R5bGUoXCJ0ZXh0LWFuY2hvclwiLCBcIm1pZGRsZVwiKTtcblxuICByZXR1cm4gc2VsZWN0aW9uLm5vZGUoKVxufVxuXG54R3VpZGVzID0gKHNlbGVjdGlvbiwgZnhuSW5mbywgcGFyYW1zLCB5U2NhbGVyLCBwYW5lbHMgPSAyKSA9PiB7XG4gIFxuICBjb25zdCBwb2ludCA9IGRhdGEoZnhuSW5mby5meG4sIHBhcmFtcywgeVNjYWxlcilbcGFyYW1zLnFdO1xuICBjb25zdCBndWlkZSA9IHNlbGVjdGlvbi5hcHBlbmQoXCJnXCIpO1xuICBcbiAgLy8gRGFzaGVkIGxpbmVcbiAgY29uc3QgZGFzaGVkTGluZSA9IGd1aWRlLmFwcGVuZChcInBhdGhcIilcbiAgICAuYXR0cihcImRcIiwgbGluZShbW3BvaW50WzBdLCBwb2ludFsxXV0sIFtwb2ludFswXSwgcGFuZWxIZWlnaHQgKiAyICsgbWFyZ2luLmJldHdlZW5dXSkpXG4gICAgLmF0dHIoXCJmaWxsXCIsIFwibm9uZVwiKVxuICAgIC5hdHRyKFwic3Ryb2tlXCIsIGRhc2hlZClcbiAgICAuYXR0cihcInN0cm9rZS1kYXNoYXJyYXlcIiwgXCI0IDRcIik7XG4gIFxuICAvLyBUaWNrXG4gIGNvbnN0IHRpY2sgPSBndWlkZS5hcHBlbmQoXCJ0ZXh0XCIpXG4gICAgLnRleHQoZDMuZm9ybWF0KFwiLC4wZlwiKShwYXJhbXMucSkpXG4gICAgLmF0dHIoXCJ4XCIsIHhTY2FsZXIocGFyYW1zLnEpKVxuICAgIC5hdHRyKFwieVwiLCBwYW5lbEhlaWdodCAqIDIgKyBtYXJnaW4uYmV0d2VlbilcbiAgICAuYXR0cihcImR5XCIsIDEwKVxuICAgIC5hdHRyKFwidGV4dC1hbmNob3JcIiwgXCJtaWRkbGVcIilcbiAgICAuYXR0cihcImFsaWdubWVudC1iYXNlbGluZVwiLCBcImhhbmdpbmdcIilcbiAgICAuc3R5bGUoXCJmaWxsXCIsIFwiYmxhY2tcIilcbiAgICAuc3R5bGUoXCJmb250LXNpemVcIiwgXCIuOXJlbVwiKTtcbiAgICBcbiAgaWYgKHBhbmVscyA9PT0gMSkge1xuICAgIGRhc2hlZExpbmUuYXR0cihcImRcIiwgbGluZShbW3BvaW50WzBdLCBwb2ludFsxXV0sIFtwb2ludFswXSwgcGFuZWxIZWlnaHRdXSkpO1xuICAgIHRpY2suYXR0cihcInlcIiwgcGFuZWxIZWlnaHQpXG4gIH1cbiAgIFxuICByZXR1cm4gc2VsZWN0aW9uLm5vZGUoKVxufVxuICBcbnlHdWlkZSA9IChzZWxlY3Rpb24sIGZ4bkluZm8sIHBhcmFtcywgeVNjYWxlciwgZm9ybWF0ID0gXCIsLjBmXCIpID0+IHtcbiAgXG4gIGNvbnN0IHBvaW50ID0gZGF0YShmeG5JbmZvLmZ4biwgcGFyYW1zLCB5U2NhbGVyKVtwYXJhbXMucV1cbiAgY29uc3QgZ3VpZGUgPSBzZWxlY3Rpb24uYXBwZW5kKFwiZ1wiKVxuICBcbiAgLy8gRGFzaGVkIGxpbmVcbiAgZ3VpZGUuYXBwZW5kKFwiZ1wiKVxuICAgIC5hcHBlbmQoXCJwYXRoXCIpXG4gICAgLmF0dHIoXCJkXCIsIGxpbmUoW1twb2ludFswXSwgcG9pbnRbMV1dLCBbMCwgcG9pbnRbMV1dXSkpXG4gICAgLmF0dHIoXCJmaWxsXCIsIFwibm9uZVwiKVxuICAgIC5hdHRyKFwic3Ryb2tlXCIsIGRhc2hlZClcbiAgICAuYXR0cihcInN0cm9rZS1kYXNoYXJyYXlcIiwgXCI0IDRcIilcbiAgXG4gIC8vIEF4aXMgdGlja1xuICBndWlkZS5hcHBlbmQoXCJnXCIpXG4gICAgLmFwcGVuZChcInRleHRcIilcbiAgICAudGV4dChkMy5mb3JtYXQoZm9ybWF0KShmeG5JbmZvLmZ4bihwYXJhbXMpKSlcbiAgICAuYXR0cihcInhcIiwgMClcbiAgICAuYXR0cihcInlcIiwgcG9pbnRbMV0pXG4gICAgLmF0dHIoXCJkeFwiLCAtMTApXG4gICAgLmF0dHIoXCJ0ZXh0LWFuY2hvclwiLCBcImVuZFwiKVxuICAgIC5hdHRyKFwiYWxpZ25tZW50LWJhc2VsaW5lXCIsIFwibWlkZGxlXCIpXG4gICAgLnN0eWxlKFwiZmlsbFwiLCBcImJsYWNrXCIpXG4gICAgLnN0eWxlKFwiZm9udC1zaXplXCIsIFwiLjlyZW1cIik7XG4gIFxuICByZXR1cm4gc2VsZWN0aW9uLm5vZGUoKVxufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yMCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImFkZExhYmVsID0gKHNlbGVjdGlvbiwgbGFiZWwsIHgsIHksIGFuY2hvciA9IFwic3RhcnRcIikgPT4ge1xuICBzZWxlY3Rpb24uYXBwZW5kKFwidGV4dFwiKVxuICAgIC50ZXh0KGxhYmVsKVxuICAgIC5hdHRyKFwieFwiLCB4KVxuICAgIC5hdHRyKFwieVwiLCB5KVxuICAgIC5hdHRyKFwidGV4dC1hbmNob3JcIiwgYW5jaG9yKVxuICAgIC5hdHRyKFwiYWxpZ25tZW50LWJhc2VsaW5lXCIsIFwibWlkZGxlXCIpXG4gICAgLnN0eWxlKFwiZmlsbFwiLCBcImJsYWNrXCIpXG4gICAgLnN0eWxlKFwiZm9udC1zaXplXCIsIFwiLjlyZW1cIilcbiAgICAuc3R5bGUoXCJmb250LXdlaWdodFwiLCBcImJvbGRcIik7XG4gIHJldHVybiBzZWxlY3Rpb24ubm9kZSgpXG59XG5cbmxhYmVsc1RvZ2dsZSA9IChzZWxlY3Rpb24sIGlkKSA9PiB7XG5cbiAgY29uc3QgY2hlY2tib3ggPSBzZWxlY3Rpb24uYXBwZW5kKFwiZm9yZWlnbk9iamVjdFwiKVxuICAgIC5hdHRyKFwieFwiLCB3aWR0aCArIG1hcmdpbi5sZWZ0ICsgMTApXG4gICAgLmF0dHIoXCJ5XCIsICAxNSlcbiAgICAuYXR0cihcIndpZHRoXCIsIDIwKVxuICAgIC5hdHRyKFwiaGVpZ2h0XCIsIDIwKTtcbiAgXG4gIGNoZWNrYm94LmFwcGVuZChcInhodG1sOmlucHV0XCIpXG4gICAgLmF0dHIoXCJ0eXBlXCIsIFwiY2hlY2tib3hcIilcbiAgICAuYXR0cihcImlkXCIsIGBjaGVja2JveC0ke2lkfWApXG4gICAgLnByb3BlcnR5KFwiY2hlY2tlZFwiLCB0cnVlKTtcbiAgXG4gIHNlbGVjdGlvbi5hcHBlbmQoXCJnXCIpXG4gICAgLmFwcGVuZChcInRleHRcIilcbiAgICAudGV4dChcIkxhYmVsc1wiKVxuICAgIC5hdHRyKFwieFwiLCB3aWR0aCArIG1hcmdpbi5sZWZ0ICsgbWFyZ2luLnJpZ2h0IC0gMjUpXG4gICAgLmF0dHIoXCJ5XCIsIDIwKVxuICAgIC5hdHRyKFwidGV4dC1hbmNob3JcIiwgXCJlbmRcIilcbiAgICAuYXR0cihcImFsaWdubWVudC1iYXNlbGluZVwiLCBcImhhbmdpbmdcIilcbiAgICAuc3R5bGUoXCJmaWxsXCIsIFwiIzg0YjBjNVwiKTtcbiAgXG4gIHJldHVybiBzZWxlY3Rpb24ubm9kZSgpXG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ3EwJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2ZjMCcpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdxMScpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdmYzEnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgncTInKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnZmMyJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ3AyJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ3EzJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2ZjMycpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdwMycpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdxNCcpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdmYzQnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgncDQnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgncDUnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnZmM1JykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ3E2JykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ3A3JykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2ZjNycpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdkZW1hbmRDb2VmJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2ZjOCcpIn1dfQ==
</script>
<script type="module">
if (window.location.protocol === "file:") { alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."); }
window._ojs.paths.runtimeToDoc = "../../posts/2023-04-14-learning-curves";
window._ojs.paths.runtimeToRoot = "../..";
window._ojs.paths.docToRoot = "../..";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/twopoints\.blog");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">

<div class="cookie-consent-footer"><a href="#" id="open_preferences_center">Cookie Preferences</a></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>