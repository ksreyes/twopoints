<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2023-04-06">

<title>That’ll be ₱1 billion please – Two Points Make a Line</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../..//images/logo-icon.png" rel="icon" type="image/png">
<script src="../../site_libs/cookie-consent/cookie-consent.js"></script>
<link href="../../site_libs/cookie-consent/cookie-consent.css" rel="stylesheet">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-9fa50ab0619afc8daa582ba3d036cca2.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-EJMC44PZ56"></script>

<script type="text/plain" cookie-consent="tracking">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-EJMC44PZ56', { 'anonymize_ip': true});
</script>

<script type="text/javascript" charset="UTF-8">
document.addEventListener('DOMContentLoaded', function () {
cookieconsent.run({
  "notice_banner_type":"simple",
  "consent_type":"implied",
  "palette":"light",
  "language":"en",
  "page_load_consent_levels":["strictly-necessary","functionality","tracking","targeting"],
  "notice_banner_reject_button_hide":false,
  "preferences_center_close_button_hide":false,
  "website_name":""
  ,
"language":"en"
  });
});
</script> 
  
<style>

#bikes {
  position: relative;
  width: 100%;
  height: 5em;
  overflow: hidden;
}

.bi-bicycle {
  position: absolute;
  font-size: 3rem;
  color: #0C6291;
}

#bike-1 {
  left: -10%;
  animation: left-right 5s linear infinite;
}

#bike-2 {
  left: -10%;
  opacity: .75;
  animation: left-right 4.7s linear 1s infinite;
}

#bike-3 {
  left: -10%;
  opacity: .5;
  animation: left-right 4s linear .5s infinite;
}

#bike-4 {
  right: -10%;
  transform: scaleX(-1);
  opacity: .25;
  animation: right-left 3.8s linear 1.5s infinite;
}

#bike-5 {
  right: -10%;
  transform: scaleX(-1);
  opacity: 1;
  animation: right-left 3.5s linear .2s infinite;
}

@keyframes left-right {
  0% { left: -10%; }
  100% { left: 100%; }
}

@keyframes right-left {
  0% { right: -10%; }
  100% { right: 100%; }
}

@media only screen and (max-width: 768px) {
  
  #bikes {
    position: relative;
    width: 100%;
    height: 3em;
    overflow: hidden;
  }
  .bi-bicycle {
    font-size: 2rem;
  }
  
  #bike-1 {
    animation: left-right 3.5s linear infinite;
  }
  
  #bike-2 {
    animation: left-right 3s linear .5s infinite;
  }
  
  #bike-3 {
    animation: left-right 2.5s linear infinite;
  }
  
  #bike-4 {
    animation: right-left 2.3s linear 1s infinite;
  }
  
  #bike-5 {
    animation: right-left 2s linear .2s infinite;
  }

}  
</style>
<script type="module" src="../../site_libs/quarto-ojs/quarto-ojs-runtime.js"></script>
<link href="../../site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">
<script src="../../site_libs/core-js-2.5.3/shim.min.js"></script>
<script src="../../site_libs/react-17.0.0/react.min.js"></script>
<script src="../../site_libs/react-17.0.0/react-dom.min.js"></script>
<script src="../../site_libs/reactwidget-1.0.0/react-tools.js"></script>
<script src="../../site_libs/htmlwidgets-1.6.1/htmlwidgets.js"></script>
<link href="../../site_libs/reactable-0.4.3/reactable.css" rel="stylesheet">
<script src="../../site_libs/reactable-binding-0.4.3/reactable.js"></script>


<meta property="og:title" content="That’ll be ₱1 billion please – Two Points Make a Line">
<meta property="og:description" content="A bike lane building blitz from the pandemic era offers a glimpse into the Philippine government’s procurement process">
<meta property="og:image" content="https://twopoints.blog/posts/2023-04-06-bikes/thumbnail.gif">
<meta property="og:site_name" content="Two Points Make a Line">
<meta name="twitter:title" content="That’ll be ₱1 billion please – Two Points Make a Line">
<meta name="twitter:description" content="A bike lane building blitz from the pandemic era offers a glimpse into the Philippine government’s procurement process">
<meta name="twitter:image" content="https://twopoints.blog/posts/2023-04-06-bikes/thumbnail.gif">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../images/logo-icon-invert.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Two Points Make a Line</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <span class="nav-link">
<span class="menu-text">Telling stories through visualized data — by Kenneth S. Reyes</span>
    </span>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/ksreyes/twopoints"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">That’ll be ₱1 billion please</h1>
<p class="subtitle lead">A bike lane building blitz from the pandemic era offers a glimpse into the Philippine government’s procurement process</p>
  <div class="quarto-categories">
    <div class="quarto-category">R</div>
    <div class="quarto-category">D3/OJS</div>
  </div>
  </div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">April 6, 2023</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<div id="bikes">
<p><i id="bike-1" class="bi bi-bicycle"></i> <i id="bike-2" class="bi bi-bicycle"></i> <i id="bike-3" class="bi bi-bicycle"></i> <i id="bike-4" class="bi bi-bicycle"></i> <i id="bike-5" class="bi bi-bicycle"></i></p>
</div>
<p>The pandemic provoked a lot of experimentation in Philippine urban transport policy. Some were sensible, like <a href="https://www.pna.gov.ph/articles/1107581">rationalizing bus stops along EDSA</a>. Some were, uh, destined to be <a href="https://www.cnnphilippines.com/news/2020/7/13/Angkas-back-riding-shield-approved-for-use.html">hallmarks of the time</a>. One of the more forward-thinking was the elevation of bicycles as a bona fide mode of transport. What’s not to love: they take little road space, they’re cheap, they’re green, and they keep you fit.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> Biking infrastructure is an actionable investment while waiting for the big-ticket rail projects to <a href="https://www.gmanetwork.com/news/topstories/nation/846774/metro-manila-subway-finished-by-2028-or-2029-dotr-exec-says/story/">crawl towards completion</a>.</p>
<p>Funding for the construction of bike lanes in Metro Manila, Metro Cebu, and Metro Davao was <a href="https://newsinfo.inquirer.net/1356640/dotr-secures-p1-3b-funds-for-bike-lanes">included</a> in the pandemic recovery bill. The transportation and public works departments, tasked with implementation, <a href="https://blogs.worldbank.org/transport/crisis-opportunity-how-philippines-built-500km-bike-lanes-less-year#comments">received technical assistance</a> from the World Bank and the Netherlands Embassy to ensure a “Safe System approach” and “Dutch Cycling Infrastructure principles”. Contracts were drawn up and opened to the private sector for bidding. By June 2021, almost 500 kilometers of bike lanes were completed at the cost of over ₱1 billion ($19.6 million), or about ₱2.1 million ($40,000) per kilometer.</p>
<p>Well. Here’s what the lane closest to where I live looks like:</p>
<div class="page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p class="page-columns page-full"><img src="../../images/bikelane.jpg" class="img-fluid figure-img column-body-outset"></p>
<figcaption>EDSA bike late in front of SM Megamall, April 2023</figcaption>
</figure>
</div>
</div>
<p>It’s a little underwhelming? No bollards, no buffers, just some hard-to-see paint on the ground and a dash of prayer. Granted, there are sections that are less <em>brutalist</em>, but this is not unrepresentative either.</p>
<p>As a tax-funded project, it’s worthwhile to look closely into the procurement process that resulted in these bike lanes. This is exactly the subject of an illuminating <a href="https://wesolve.ph/empowering-citizens-to-build-better-bike-lanes-through-open-contracting">paper</a> from WeSolve Foundation, published last week. They’ve made their <a href="https://docs.google.com/spreadsheets/d/1eZLfoH0eA0xMU79GVp_8zM_uEcENMKhV52nWqLwH-Ao/edit">dataset</a> available, and in this post, I’d like to visualize some of its more interesting aspects. The authors attach a disclaimer that their findings “cannot and should not be used to conclude fraud or corruption”, and indeed, the work was made in partnership with the Philippine Government Electronic Procurement System, who provided some data. I do believe that an imperfect system need not necessarily imply deliberate wrongdoing, so the same disclaimer applies in this post.</p>
<p>Let’s load up the dataset in R.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>file <span class="ot">&lt;-</span> <span class="st">"[PUBLIC DATASET] Empowering Citizens to Build Better Bike Lanes through Open Contracting.xlsx"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>contract <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">"datasets"</span>, <span class="st">"bikelanes"</span>, file) <span class="sc">%&gt;%</span> <span class="fu">read_excel</span>(<span class="at">sheet =</span> <span class="st">"contract"</span>, <span class="at">skip =</span> <span class="dv">1</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>item <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">"datasets"</span>, <span class="st">"bikelanes"</span>, file) <span class="sc">%&gt;%</span> <span class="fu">read_excel</span>(<span class="at">sheet =</span> <span class="st">"item"</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>bidder <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">"datasets"</span>, <span class="st">"bikelanes"</span>, file) <span class="sc">%&gt;%</span> <span class="fu">read_excel</span>(<span class="at">sheet =</span> <span class="st">"bidder"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The following table contains key information on the 12 contracts the study covered. There are 10 in Metro Manila and one each in Cebu and Davao. The contract advertising date (<code>date_ad</code>), the notice-to-proceed date (<code>date_ntp</code>), the winning bidder (<code>noa_supplier</code>), and the approved final value (<code>noa_award_value</code>) are given for each contract.</p>
<div class="cell page-columns page-full">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reactable)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>contract <span class="sc">%&gt;%</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(contract_no, contract_title, contract_location, proc_entity, date_ad, date_ntp, noa_supplier, noa_award_value) <span class="sc">%&gt;%</span> </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reactable</span>(</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">defaultColDef =</span> <span class="fu">colDef</span>(</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">minWidth =</span> <span class="dv">125</span>,</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">align =</span> <span class="st">"left"</span>,</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">headerStyle =</span> <span class="fu">list</span>(<span class="at">fontFamily =</span> <span class="st">"Karla"</span>, <span class="at">background =</span> <span class="st">"#f7f7f8"</span>),</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="fu">list</span>(</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">contract_title =</span> <span class="fu">colDef</span>(<span class="at">minWidth =</span> <span class="dv">350</span>),</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">contract_location =</span> <span class="fu">colDef</span>(<span class="at">minWidth =</span> <span class="dv">175</span>),</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">proc_entity =</span> <span class="fu">colDef</span>(<span class="at">minWidth =</span> <span class="dv">175</span>),</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">date_ad =</span> <span class="fu">colDef</span>(<span class="at">align =</span> <span class="st">"center"</span>, <span class="at">cell =</span> <span class="cf">function</span>(x) <span class="fu">format</span>(x, <span class="st">"%Y-%m-%d"</span>)),</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">date_ntp =</span> <span class="fu">colDef</span>(<span class="at">align =</span> <span class="st">"center"</span>, <span class="at">cell =</span> <span class="cf">function</span>(x) <span class="fu">format</span>(x, <span class="st">"%Y-%m-%d"</span>)),</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">noa_supplier =</span> <span class="fu">colDef</span>(<span class="at">minWidth =</span> <span class="dv">225</span>),</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">noa_award_value =</span> <span class="fu">colDef</span>(<span class="at">minWidth =</span> <span class="dv">150</span>, <span class="at">align =</span> <span class="st">"right"</span>, <span class="at">format =</span> <span class="fu">colFormat</span>(<span class="at">prefix =</span> <span class="st">"₱"</span>, <span class="at">separators =</span> <span class="cn">TRUE</span>, <span class="at">digits =</span> <span class="dv">0</span>))</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">defaultPageSize =</span> <span class="dv">4</span>,</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">bordered =</span> <span class="cn">TRUE</span>,</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">highlight =</span> <span class="cn">TRUE</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display column-page">
<div class="reactable html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-13229005cb0622e39424" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-13229005cb0622e39424">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"contract_no":["20GOH0009","20H00087","20L00186","20O00096","20O00097","20O00098","20O00099","20O00100","20O00101","20O00102","20O00103","20O00104"],"contract_title":["Fabrication and Installation of Bollard for Bicycle Lanes along 1.) U.N. Ave., 2.)\nTaft Ave., 3.) Pres. Quirino Ave., 4.) Roxas Blvd. Service Road (Northbound) PSG Compound","Proposed Bike Lanes in Cebu, covering the Cities of Talisay, Cebu, Mandaue, and Lapu-lapu City","Construction of Bicycle Lanes in Davao City: 1. Davao-Cotabato Road 2. ABS-CBN Quimpo Blvd. Div. Road 3. G.E. Street (Sandawa Road) 4. Daang Maharlika Road (CM Recto St.) 5. Roxas Avenue 6. Quezon Blvd.","Metropolitan Bikelane Networks: Proposed Bike Share System to EDSA","Metropolitan Bikelane Networks: Proposed Bikelane from Circumferential Road 5 (C-5): NLEX Karuhatan Link to C-5 Extension","Metropolitan Bikelane Networks: Proposed Bikelane from in Circumferential Road 4 (C-4): From Roxas Blvd. to Monumento","Metropolitan Bikelane Networks: Proposed Bikelane from Radial Road 1 (Roxas Boulevard) to Radial Road 7 (Commonwealth Avenue)","Metropolitan Bikelane Networks: Proposed Bikelane in Radial Road 8: Quezon Boulevard to Blumentritt","Metropolitan Bikelane Networks: Proposed Bikelane in Radial Road 6 (R-6) from Legarda to Marcos Highway","Metropolitan Bikelane Networks: Proposed Bikelane in Radial Road 5 (R-5) from V. Mapa St. to Ortigas Avenue Ext. (C. Reymundo)","Metropolitan Bikelane Networks: Proposed Bikelane in Radial Road 4: Pedro Gil St. to Tejeron St. - J.P. Rizal Ave. - EDSA - C-5","Metropolitan Bikelane Networks: Proposed Bikelane from Radial Road 3 (R-3): Quirino Aveenue (C-2) - EDSA (C-4) - Lawton Ave. - C.P. Garcia Ave. (C-5) - General Santos Ave. - SLEX"],"contract_location":["Metro Manila","Cities of Talisay, Cebu, Mandaue, and Lapu-lapu City","Davao City","Cities of Pasay, Makati, Mandaluyong, San Juan, Caloocan, and Quezon City","Cities of Valenzuela, Quezon City, Pasig, Makati, Taguig, Pasay, Parañaque, and Las Piñas","Cities of Pasay, Makati, Mandaluyong, San Juan, Caloocan, and Quezon City","Cities of Pasay, Manila, and Quezon City","City of Manila","Cities of Quezon City, San Juan, Pasig, and Marikina","Cities of Manila, Mandaluyong, and Pasig","City of Manila","Cities of Valenzuela, Quezon City, Pasig, Makati, Taguig, Pasay, Parañaque, and Las Piñas"],"proc_entity":["DPWH SOUTH MANILA DISTRICT ENGINEERING OFFICE","DPWH REGIONAL OFFICE VII","DPWH REGIONAL OFFICE XI","DPWH NCR","DPWH NCR","DPWH NCR","DPWH NCR","DPWH NCR","DPWH NCR","DPWH NCR","DPWH NCR","DPWH NCR"],"date_ad":["2020-10-02T00:00:00Z",null,"2020-11-27T00:00:00Z","2020-11-20T00:00:00Z","2020-11-20T00:00:00Z","2020-11-19T00:00:00Z","2020-11-17T00:00:00Z","2020-11-20T00:00:00Z","2020-11-19T00:00:00Z","2020-11-17T00:00:00Z","2020-11-19T00:00:00Z","2020-11-17T00:00:00Z"],"date_ntp":["2020-11-27T00:00:00Z","2020-12-16T00:00:00Z","2021-01-27T00:00:00Z","2020-12-23T00:00:00Z","2020-12-23T00:00:00Z","2020-12-23T00:00:00Z","2020-12-23T00:00:00Z","2020-12-23T00:00:00Z","2020-12-23T00:00:00Z","2020-12-23T00:00:00Z","2020-12-23T00:00:00Z","2020-12-23T00:00:00Z"],"noa_supplier":["KP GONZALES CONST. SUPPLY & TRADING","P. B. OBIAL CONSTRUCTION","GP&H CONST., INC./MAGAR CONST. & SUPPLY (JV)","PHILIPPINE CHEMSTEEL INDUSTRIES. INC.","PHILIPPINE CHEMSTEEL INDUSTRIES. INC.","PHILIPPINE CHEMSTEEL INDUSTRIES. INC.","STUDIO 26 CONSTRUCTION, INC./ NORTHERN BUILDERS (JV)","NEWBIG FOUR J CONSTRUCTION","PHILIPPINE CHEMSTEEL INDUSTRIES. INC.","PHILIPPINE CHEMSTEEL INDUSTRIES. INC.","NORTHERN BUILDERS","PHILIPPINE CHEMSTEEL INDUSTRIES. INC."],"noa_award_value":[2433642.23,140247790.6,145370671.39,117225835.42,125002595.5,125013173.37,138927407.81,23854508.52,62474577.36,75812525.61,47102409.06,67843914.26]},"columns":[{"id":"contract_no","name":"contract_no","type":"character","minWidth":125,"align":"left","headerStyle":{"fontFamily":"Karla","background":"#f7f7f8"}},{"id":"contract_title","name":"contract_title","type":"character","minWidth":350,"align":"left","headerStyle":{"fontFamily":"Karla","background":"#f7f7f8"}},{"id":"contract_location","name":"contract_location","type":"character","minWidth":175,"align":"left","headerStyle":{"fontFamily":"Karla","background":"#f7f7f8"}},{"id":"proc_entity","name":"proc_entity","type":"character","minWidth":175,"align":"left","headerStyle":{"fontFamily":"Karla","background":"#f7f7f8"}},{"id":"date_ad","name":"date_ad","type":"Date","minWidth":125,"align":"center","headerStyle":{"fontFamily":"Karla","background":"#f7f7f8"},"cell":["2020-10-02","NA","2020-11-27","2020-11-20","2020-11-20","2020-11-19","2020-11-17","2020-11-20","2020-11-19","2020-11-17","2020-11-19","2020-11-17"]},{"id":"date_ntp","name":"date_ntp","type":"Date","minWidth":125,"align":"center","headerStyle":{"fontFamily":"Karla","background":"#f7f7f8"},"cell":["2020-11-27","2020-12-16","2021-01-27","2020-12-23","2020-12-23","2020-12-23","2020-12-23","2020-12-23","2020-12-23","2020-12-23","2020-12-23","2020-12-23"]},{"id":"noa_supplier","name":"noa_supplier","type":"character","minWidth":225,"align":"left","headerStyle":{"fontFamily":"Karla","background":"#f7f7f8"}},{"id":"noa_award_value","name":"noa_award_value","type":"numeric","minWidth":150,"align":"right","headerStyle":{"fontFamily":"Karla","background":"#f7f7f8"},"format":{"cell":{"prefix":"₱","digits":0,"separators":true},"aggregated":{"prefix":"₱","digits":0,"separators":true}}}],"defaultPageSize":4,"highlight":true,"bordered":true,"dataKey":"d04477327609442bb08c8a3cecf2326a"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Let’s start by visualizing where these bike lanes are located. The dataset does not actually have information on routes, so I’ve had to infer them from the contract title, the stipulated length, and my educated guesses. I drew the routes on <a href="https://www.google.com/maps/about/mymaps/">Google My Maps</a> and exported them as a KML file, which I then uploaded on <a href="https://mapshaper.org/">mapshaper</a> to consolidate the features and convert to topoJSON format. Because this took a bit of work, I’m focusing here only on the Metro Manila contracts. One of the contracts (20O0096) has an uninformative title so I was unable to draw it, leaving me with nine routes in all. For the administrative boundaries of Metro Manila and surrounding areas, I used the topoJSON files of <a href="https://github.com/faeldon/philippines-json-maps">James Faeldon</a>.</p>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3" data-startfrom="107" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 106;"><span id="cb3-107"><a href="#cb3-107" aria-hidden="true" tabindex="-1"></a><span class="fu">html</span><span class="vs">`</span></span>
<span id="cb3-108"><a href="#cb3-108" aria-hidden="true" tabindex="-1"></a><span class="vs">  &lt;div class="ojs-title"&gt;Life in the bike lane&lt;/div&gt;</span></span>
<span id="cb3-109"><a href="#cb3-109" aria-hidden="true" tabindex="-1"></a><span class="vs">  &lt;div class="ojs-subtitle"&gt;Contracts for Metro Manila bike lanes, 2020-2021&lt;/div&gt;</span></span>
<span id="cb3-110"><a href="#cb3-110" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span></span>
<span id="cb3-111"><a href="#cb3-111" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb3-112"><a href="#cb3-112" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Parameters</span></span>
<span id="cb3-113"><a href="#cb3-113" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-114"><a href="#cb3-114" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> width <span class="op">=</span> <span class="dv">920</span><span class="op">;</span></span>
<span id="cb3-115"><a href="#cb3-115" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> height <span class="op">=</span> <span class="dv">620</span><span class="op">;</span></span>
<span id="cb3-116"><a href="#cb3-116" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-117"><a href="#cb3-117" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> legendBoxWidth <span class="op">=</span> <span class="dv">100</span><span class="op">;</span></span>
<span id="cb3-118"><a href="#cb3-118" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> legendBoxHeight <span class="op">=</span> <span class="dv">35</span><span class="op">;</span></span>
<span id="cb3-119"><a href="#cb3-119" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> legendBoxGap <span class="op">=</span> <span class="dv">55</span><span class="op">;</span></span>
<span id="cb3-120"><a href="#cb3-120" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> insetLeft <span class="op">=</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb3-121"><a href="#cb3-121" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> insetTop <span class="op">=</span> <span class="dv">115</span><span class="op">;</span></span>
<span id="cb3-122"><a href="#cb3-122" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> marginRight <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb3-123"><a href="#cb3-123" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-124"><a href="#cb3-124" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> colorNCR <span class="op">=</span> <span class="st">"#c0d7df"</span></span>
<span id="cb3-125"><a href="#cb3-125" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> colorBG <span class="op">=</span> <span class="st">"#eeeeee"</span></span>
<span id="cb3-126"><a href="#cb3-126" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> colorLegend <span class="op">=</span> <span class="st">"#84b0c5"</span></span>
<span id="cb3-127"><a href="#cb3-127" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> colorLegendSelect <span class="op">=</span> <span class="st">"#f697bb"</span></span>
<span id="cb3-128"><a href="#cb3-128" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> colorLanes <span class="op">=</span> <span class="st">"#84b0c5"</span></span>
<span id="cb3-129"><a href="#cb3-129" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> colorLanesSelect <span class="op">=</span> <span class="st">"#B13D70"</span></span>
<span id="cb3-130"><a href="#cb3-130" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-131"><a href="#cb3-131" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Canvas</span></span>
<span id="cb3-132"><a href="#cb3-132" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-133"><a href="#cb3-133" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> d3<span class="op">.</span><span class="fu">create</span>(<span class="st">"svg"</span>)</span>
<span id="cb3-134"><a href="#cb3-134" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> width)</span>
<span id="cb3-135"><a href="#cb3-135" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> height)</span>
<span id="cb3-136"><a href="#cb3-136" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> width<span class="op">,</span> height])</span>
<span id="cb3-137"><a href="#cb3-137" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"style"</span><span class="op">,</span> <span class="st">"max-width: 100%; height: auto; height: intrinsic;"</span>)<span class="op">;</span></span>
<span id="cb3-138"><a href="#cb3-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-139"><a href="#cb3-139" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Map</span></span>
<span id="cb3-140"><a href="#cb3-140" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-141"><a href="#cb3-141" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> projection <span class="op">=</span> d3<span class="op">.</span><span class="fu">geoMercator</span>()</span>
<span id="cb3-142"><a href="#cb3-142" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">scale</span>([<span class="dv">100000</span>])</span>
<span id="cb3-143"><a href="#cb3-143" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">center</span>([<span class="fl">120.89</span><span class="op">,</span> <span class="fl">14.64</span>])</span>
<span id="cb3-144"><a href="#cb3-144" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-145"><a href="#cb3-145" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> pathGenerator <span class="op">=</span> d3<span class="op">.</span><span class="fu">geoPath</span>(projection)<span class="op">;</span></span>
<span id="cb3-146"><a href="#cb3-146" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-147"><a href="#cb3-147" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> map <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb3-148"><a href="#cb3-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-149"><a href="#cb3-149" aria-hidden="true" tabindex="-1"></a>  map<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"bg"</span>)</span>
<span id="cb3-150"><a href="#cb3-150" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(bgFeatures)</span>
<span id="cb3-151"><a href="#cb3-151" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">join</span>(<span class="st">"path"</span>)</span>
<span id="cb3-152"><a href="#cb3-152" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> pathGenerator)</span>
<span id="cb3-153"><a href="#cb3-153" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> colorBG)</span>
<span id="cb3-154"><a href="#cb3-154" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-155"><a href="#cb3-155" aria-hidden="true" tabindex="-1"></a>  map<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"boundaries"</span>)</span>
<span id="cb3-156"><a href="#cb3-156" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(ncrFeatures)</span>
<span id="cb3-157"><a href="#cb3-157" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">join</span>(<span class="st">"path"</span>)</span>
<span id="cb3-158"><a href="#cb3-158" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> pathGenerator)</span>
<span id="cb3-159"><a href="#cb3-159" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> colorNCR)</span>
<span id="cb3-160"><a href="#cb3-160" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="op">.</span><span class="dv">8</span>)</span>
<span id="cb3-161"><a href="#cb3-161" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"#ffffff"</span>)</span>
<span id="cb3-162"><a href="#cb3-162" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="dv">1</span>)</span>
<span id="cb3-163"><a href="#cb3-163" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-164"><a href="#cb3-164" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Bike lanes</span></span>
<span id="cb3-165"><a href="#cb3-165" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-166"><a href="#cb3-166" aria-hidden="true" tabindex="-1"></a>  map<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"lanes"</span>)</span>
<span id="cb3-167"><a href="#cb3-167" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(contractsFeatures)</span>
<span id="cb3-168"><a href="#cb3-168" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">join</span>(<span class="st">"path"</span>)</span>
<span id="cb3-169"><a href="#cb3-169" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> pathGenerator)</span>
<span id="cb3-170"><a href="#cb3-170" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="st">"lanes lane-"</span> <span class="op">+</span> d<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">contract</span>)</span>
<span id="cb3-171"><a href="#cb3-171" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb3-172"><a href="#cb3-172" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="op">.</span><span class="dv">8</span>)</span>
<span id="cb3-173"><a href="#cb3-173" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> colorLanes)</span>
<span id="cb3-174"><a href="#cb3-174" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="dv">3</span>)<span class="op">;</span></span>
<span id="cb3-175"><a href="#cb3-175" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-176"><a href="#cb3-176" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Legend</span></span>
<span id="cb3-177"><a href="#cb3-177" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-178"><a href="#cb3-178" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> mouseenter <span class="op">=</span> <span class="kw">function</span>(<span class="bu">event</span><span class="op">,</span> d) {</span>
<span id="cb3-179"><a href="#cb3-179" aria-hidden="true" tabindex="-1"></a>    legend<span class="op">.</span><span class="fu">select</span>(<span class="st">".legendbox-"</span> <span class="op">+</span> d)</span>
<span id="cb3-180"><a href="#cb3-180" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">transition</span>()<span class="op">.</span><span class="fu">duration</span>(<span class="dv">100</span>)</span>
<span id="cb3-181"><a href="#cb3-181" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> colorLegendSelect)</span>
<span id="cb3-182"><a href="#cb3-182" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb3-183"><a href="#cb3-183" aria-hidden="true" tabindex="-1"></a>    map<span class="op">.</span><span class="fu">select</span>(<span class="st">".lane-"</span> <span class="op">+</span> d)</span>
<span id="cb3-184"><a href="#cb3-184" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">transition</span>()<span class="op">.</span><span class="fu">duration</span>(<span class="dv">100</span>)</span>
<span id="cb3-185"><a href="#cb3-185" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="dv">1</span>)</span>
<span id="cb3-186"><a href="#cb3-186" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> colorLanesSelect)</span>
<span id="cb3-187"><a href="#cb3-187" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="dv">4</span>)<span class="op">;</span></span>
<span id="cb3-188"><a href="#cb3-188" aria-hidden="true" tabindex="-1"></a>    d3<span class="op">.</span><span class="fu">select</span>(<span class="st">".detail-"</span> <span class="op">+</span> d)</span>
<span id="cb3-189"><a href="#cb3-189" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">transition</span>()<span class="op">.</span><span class="fu">duration</span>(<span class="dv">100</span>)</span>
<span id="cb3-190"><a href="#cb3-190" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb3-191"><a href="#cb3-191" aria-hidden="true" tabindex="-1"></a>    d3<span class="op">.</span><span class="fu">select</span>(<span class="bu">event</span><span class="op">.</span><span class="at">target</span>)</span>
<span id="cb3-192"><a href="#cb3-192" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"cursor"</span><span class="op">,</span> <span class="st">"pointer"</span>)<span class="op">;</span></span>
<span id="cb3-193"><a href="#cb3-193" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-194"><a href="#cb3-194" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-195"><a href="#cb3-195" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> mouseleave <span class="op">=</span> <span class="kw">function</span>(<span class="bu">event</span>) {</span>
<span id="cb3-196"><a href="#cb3-196" aria-hidden="true" tabindex="-1"></a>    legend<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".legendbox"</span>)</span>
<span id="cb3-197"><a href="#cb3-197" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">transition</span>()<span class="op">.</span><span class="fu">duration</span>(<span class="dv">100</span>)</span>
<span id="cb3-198"><a href="#cb3-198" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> colorLegend)</span>
<span id="cb3-199"><a href="#cb3-199" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="op">.</span><span class="dv">25</span>)<span class="op">;</span></span>
<span id="cb3-200"><a href="#cb3-200" aria-hidden="true" tabindex="-1"></a>    map<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".lanes"</span>)</span>
<span id="cb3-201"><a href="#cb3-201" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">transition</span>()<span class="op">.</span><span class="fu">duration</span>(<span class="dv">800</span>)</span>
<span id="cb3-202"><a href="#cb3-202" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="op">.</span><span class="dv">8</span>)</span>
<span id="cb3-203"><a href="#cb3-203" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> colorLanes)</span>
<span id="cb3-204"><a href="#cb3-204" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="dv">3</span>)<span class="op">;</span></span>
<span id="cb3-205"><a href="#cb3-205" aria-hidden="true" tabindex="-1"></a>    d3<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".details"</span>)</span>
<span id="cb3-206"><a href="#cb3-206" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">transition</span>()<span class="op">.</span><span class="fu">duration</span>(<span class="dv">100</span>)</span>
<span id="cb3-207"><a href="#cb3-207" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="op">.</span><span class="dv">25</span>)<span class="op">;</span></span>
<span id="cb3-208"><a href="#cb3-208" aria-hidden="true" tabindex="-1"></a>    d3<span class="op">.</span><span class="fu">select</span>(<span class="bu">event</span><span class="op">.</span><span class="at">target</span>)</span>
<span id="cb3-209"><a href="#cb3-209" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"cursor"</span><span class="op">,</span> <span class="st">"default"</span>)<span class="op">;</span></span>
<span id="cb3-210"><a href="#cb3-210" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-211"><a href="#cb3-211" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-212"><a href="#cb3-212" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> legend <span class="op">=</span> svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"boxes"</span>)</span>
<span id="cb3-213"><a href="#cb3-213" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(contractNames)</span>
<span id="cb3-214"><a href="#cb3-214" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">join</span>(<span class="st">"g"</span>)</span>
<span id="cb3-215"><a href="#cb3-215" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">on</span>(<span class="st">"mouseenter"</span><span class="op">,</span> mouseenter)</span>
<span id="cb3-216"><a href="#cb3-216" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">on</span>(<span class="st">"mouseleave"</span><span class="op">,</span> mouseleave)<span class="op">;</span></span>
<span id="cb3-217"><a href="#cb3-217" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-218"><a href="#cb3-218" aria-hidden="true" tabindex="-1"></a>  legend<span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb3-219"><a href="#cb3-219" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="st">"legendbox legendbox-"</span> <span class="op">+</span> d)</span>
<span id="cb3-220"><a href="#cb3-220" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> legendBoxWidth)</span>
<span id="cb3-221"><a href="#cb3-221" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> legendBoxHeight)</span>
<span id="cb3-222"><a href="#cb3-222" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> colorLegend)</span>
<span id="cb3-223"><a href="#cb3-223" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"rx"</span><span class="op">,</span> <span class="st">".25em"</span>)</span>
<span id="cb3-224"><a href="#cb3-224" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"ry"</span><span class="op">,</span> <span class="st">".25em"</span>)</span>
<span id="cb3-225"><a href="#cb3-225" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="op">.</span><span class="dv">25</span>)</span>
<span id="cb3-226"><a href="#cb3-226" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> insetLeft)</span>
<span id="cb3-227"><a href="#cb3-227" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> (d<span class="op">,</span> i) <span class="kw">=&gt;</span> (insetTop <span class="op">+</span> i <span class="op">*</span> legendBoxGap))<span class="op">;</span></span>
<span id="cb3-228"><a href="#cb3-228" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-229"><a href="#cb3-229" aria-hidden="true" tabindex="-1"></a>  legend<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb3-230"><a href="#cb3-230" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(d <span class="kw">=&gt;</span> d)</span>
<span id="cb3-231"><a href="#cb3-231" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb3-232"><a href="#cb3-232" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"alignment-baseline"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb3-233"><a href="#cb3-233" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> insetLeft <span class="op">+</span> legendBoxWidth <span class="op">/</span> <span class="dv">2</span>)</span>
<span id="cb3-234"><a href="#cb3-234" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> (d<span class="op">,</span> i) <span class="kw">=&gt;</span> (insetTop <span class="op">+</span> i <span class="op">*</span> legendBoxGap))</span>
<span id="cb3-235"><a href="#cb3-235" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"dy"</span><span class="op">,</span> legendBoxHeight <span class="op">/</span> <span class="dv">2</span> <span class="op">+</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb3-236"><a href="#cb3-236" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-237"><a href="#cb3-237" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Details</span></span>
<span id="cb3-238"><a href="#cb3-238" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-239"><a href="#cb3-239" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> details <span class="op">=</span> svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"details"</span>)</span>
<span id="cb3-240"><a href="#cb3-240" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(contractDetails)</span>
<span id="cb3-241"><a href="#cb3-241" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">join</span>(<span class="st">"g"</span>)</span>
<span id="cb3-242"><a href="#cb3-242" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> (d<span class="op">,</span> i) <span class="kw">=&gt;</span> <span class="st">"details detail-"</span> <span class="op">+</span> contractDetails<span class="op">.</span><span class="fu">map</span>(dd <span class="kw">=&gt;</span> dd<span class="op">.</span><span class="at">contract_no</span>)[i])</span>
<span id="cb3-243"><a href="#cb3-243" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="op">.</span><span class="dv">25</span>)</span>
<span id="cb3-244"><a href="#cb3-244" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-245"><a href="#cb3-245" aria-hidden="true" tabindex="-1"></a>  details<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb3-246"><a href="#cb3-246" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>((d<span class="op">,</span> i) <span class="kw">=&gt;</span> <span class="st">"Bidder: "</span> <span class="op">+</span> contractDetails<span class="op">.</span><span class="fu">map</span>(dd <span class="kw">=&gt;</span> dd<span class="op">.</span><span class="at">noa_supplier</span>)[i])</span>
<span id="cb3-247"><a href="#cb3-247" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> insetLeft <span class="op">+</span> legendBoxWidth <span class="op">+</span> marginRight)</span>
<span id="cb3-248"><a href="#cb3-248" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> (d<span class="op">,</span> i) <span class="kw">=&gt;</span> (insetTop <span class="op">+</span> i <span class="op">*</span> legendBoxGap))</span>
<span id="cb3-249"><a href="#cb3-249" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"dy"</span><span class="op">,</span> <span class="dv">5</span>)</span>
<span id="cb3-250"><a href="#cb3-250" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">".75rem"</span>)</span>
<span id="cb3-251"><a href="#cb3-251" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"alignment-baseline"</span><span class="op">,</span> <span class="st">"hanging"</span>)</span>
<span id="cb3-252"><a href="#cb3-252" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-253"><a href="#cb3-253" aria-hidden="true" tabindex="-1"></a>  details<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb3-254"><a href="#cb3-254" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>((d<span class="op">,</span> i) <span class="kw">=&gt;</span> <span class="st">"Value: ₱"</span> <span class="op">+</span> contractDetails<span class="op">.</span><span class="fu">map</span>(dd <span class="kw">=&gt;</span> d3<span class="op">.</span><span class="fu">format</span>(<span class="st">",.2r"</span>)(dd<span class="op">.</span><span class="at">noa_award_value</span> <span class="op">/</span> <span class="dv">1000000</span>))[i] <span class="op">+</span> <span class="st">" million"</span>)</span>
<span id="cb3-255"><a href="#cb3-255" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> (d<span class="op">,</span> i) <span class="kw">=&gt;</span> <span class="st">"values value-"</span> <span class="op">+</span> contractDetails<span class="op">.</span><span class="fu">map</span>(dd <span class="kw">=&gt;</span> dd<span class="op">.</span><span class="at">contract_no</span>)[i])</span>
<span id="cb3-256"><a href="#cb3-256" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> insetLeft <span class="op">+</span> legendBoxWidth <span class="op">+</span> marginRight)</span>
<span id="cb3-257"><a href="#cb3-257" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> (d<span class="op">,</span> i) <span class="kw">=&gt;</span> (insetTop <span class="op">+</span> i <span class="op">*</span> legendBoxGap))</span>
<span id="cb3-258"><a href="#cb3-258" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"dy"</span><span class="op">,</span> <span class="dv">20</span>)</span>
<span id="cb3-259"><a href="#cb3-259" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">".75rem"</span>)</span>
<span id="cb3-260"><a href="#cb3-260" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"alignment-baseline"</span><span class="op">,</span> <span class="st">"hanging"</span>)</span>
<span id="cb3-261"><a href="#cb3-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-262"><a href="#cb3-262" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Tip</span></span>
<span id="cb3-263"><a href="#cb3-263" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-264"><a href="#cb3-264" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> tip <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb3-265"><a href="#cb3-265" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">"Hover over a contract to see it on the map"</span>)</span>
<span id="cb3-266"><a href="#cb3-266" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> insetLeft <span class="op">+</span> <span class="dv">5</span>)</span>
<span id="cb3-267"><a href="#cb3-267" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> insetTop <span class="op">-</span> <span class="dv">30</span>)</span>
<span id="cb3-268"><a href="#cb3-268" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-weight"</span><span class="op">,</span> <span class="st">"bold"</span>)<span class="op">;</span></span>
<span id="cb3-269"><a href="#cb3-269" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-270"><a href="#cb3-270" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> svg<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb3-271"><a href="#cb3-271" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell column-body-outset quarto-layout-panel" data-layout="[[1], [1]]">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="ojs-cell-1-1" data-nodetype="expression">

</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="ojs-cell-1-2" data-nodetype="expression">

</div>
</div>
</div>
</div>
<p>The network is certainly comprehensive, covering most major roads in the metro. These do not yet include bike lanes built by local government units, which traverse secondary roads. On paper at least, cycling infrastructure in Metro Manila has become fairly well-connected. But things are not so rosy on the ground. As shown in the picture above, these lanes are often unprotected for long stretches, even in major highways. Fatal accidents are <a href="https://mmda.gov.ph/images/Home/FOI/Bicycle-related-Road-Crash-Statistics-in-Metro-Manila/Bicycle-related_Road_Crash_Statistics_2021.pdf">frequent</a>. And without the vigilance of activists, there is a tendency for car-centric policies to <a href="https://www.firstbikeride.com/whats-up/amang-rodriguez-bike-lanes/">creep</a> <a href="https://www.philstar.com/nation/2023/02/13/2244543/cyclists-protest-shared-bike-lanes-makati">back</a> <a href="https://mb.com.ph/2022/12/20/what-to-do-with-the-bike-lanes/">in</a>.</p>
<p>You may notice that several of the contracts were won by one company, Philippine Chemsteel Industries. The idea of a public bidding is <a href="https://www.gppb.gov.ph/laws/laws/RA_9184.pdf">meant to ensure</a> transparency and competitiveness in government procurement. Following economic theory, the presence of many sellers helps drive prices down to marginal cost. The fact that one company seems to have dominated these bids hints at the possible breakdown of this assumption. We can check this by visualizing WeSolve’s data in a network chart.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>bidders <span class="ot">&lt;-</span> bidder <span class="sc">%&gt;%</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(total_calc_bid)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(contract_no, bidder_name, total_calc_bid, flag_lcb)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>nodes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">unique</span>(bidders<span class="sc">$</span>bidder_name), <span class="fu">unique</span>(bidders<span class="sc">$</span>contract_no))</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>biddersNodes <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(nodes),</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> nodes,</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="fu">case_when</span>(</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(name, <span class="st">"20"</span>) <span class="sc">~</span> <span class="st">"contract"</span>,</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"bidder"</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>biddersLinks <span class="ot">&lt;-</span> bidders <span class="sc">%&gt;%</span> </span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(biddersNodes, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"contract_no"</span> <span class="ot">=</span> <span class="st">"name"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(biddersNodes, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"bidder_name"</span> <span class="ot">=</span> <span class="st">"name"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">source =</span> id.y, <span class="at">target =</span> id.x, <span class="at">bid =</span> total_calc_bid, <span class="at">win =</span> flag_lcb)</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Correction</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>biddersLinks<span class="sc">$</span>source[biddersLinks<span class="sc">$</span>target <span class="sc">==</span> <span class="dv">18</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">6</span>, <span class="dv">5</span>)</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>biddersLinks<span class="sc">$</span>source[biddersLinks<span class="sc">$</span>target <span class="sc">==</span> <span class="dv">20</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Disqualified bids (due to, for example, incomplete requirements) are excluded. I am also correcting what looks like an encoding error in the WeSolve dataset where Philippine Chemsteel Industries and Newbig Four J Construction were switched by mistake. The <a href="https://dpwh.gov.ph/DPWH/sites/default/files/webform/civil_works/notice_of_award/20O00104.pdf">official</a> <a href="https://dpwh.gov.ph/DPWH/sites/default/files/webform/civil_works/contract_of_agreement/20O00104.pdf">documents</a> confirm that it was Philippine Chemsteel, not Newbig, who won in the two contracts they competed in.</p>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5" data-startfrom="315" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 314;"><span id="cb5-315"><a href="#cb5-315" aria-hidden="true" tabindex="-1"></a><span class="fu">html</span><span class="vs">`</span></span>
<span id="cb5-316"><a href="#cb5-316" aria-hidden="true" tabindex="-1"></a><span class="vs">  &lt;div class="ojs-title"&gt;Slim pickings&lt;/div&gt;</span></span>
<span id="cb5-317"><a href="#cb5-317" aria-hidden="true" tabindex="-1"></a><span class="vs">  &lt;div class="ojs-subtitle"&gt;Network of &lt;span style="font-weight:bold; color:#7fc6a4"&gt;contracts&lt;/span&gt; and their &lt;span style="font-weight:bold; color:#4889ab"&gt;bidders&lt;/span&gt;, with winning bids &lt;b&gt;identified&lt;/b&gt; &lt;/span&gt;&lt;/div&gt;</span></span>
<span id="cb5-318"><a href="#cb5-318" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span></span>
<span id="cb5-319"><a href="#cb5-319" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb5-320"><a href="#cb5-320" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Parameters</span></span>
<span id="cb5-321"><a href="#cb5-321" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> width <span class="op">=</span> <span class="dv">790</span></span>
<span id="cb5-322"><a href="#cb5-322" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> height <span class="op">=</span> <span class="dv">350</span></span>
<span id="cb5-323"><a href="#cb5-323" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> colorLinks <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleOrdinal</span>()</span>
<span id="cb5-324"><a href="#cb5-324" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>])</span>
<span id="cb5-325"><a href="#cb5-325" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([<span class="st">"#cecece"</span><span class="op">,</span> <span class="st">"#2B303A"</span>])<span class="op">;</span></span>
<span id="cb5-326"><a href="#cb5-326" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> strokeLinks <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleOrdinal</span>()</span>
<span id="cb5-327"><a href="#cb5-327" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>])</span>
<span id="cb5-328"><a href="#cb5-328" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([<span class="dv">1</span><span class="op">,</span> <span class="dv">3</span>])<span class="op">;</span></span>
<span id="cb5-329"><a href="#cb5-329" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> colorNodes <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleOrdinal</span>()</span>
<span id="cb5-330"><a href="#cb5-330" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="st">"bidder"</span><span class="op">,</span> <span class="st">"contract"</span>])</span>
<span id="cb5-331"><a href="#cb5-331" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([<span class="st">"#4889ab"</span><span class="op">,</span> <span class="st">"#7fc6a4"</span>])<span class="op">;</span></span>
<span id="cb5-332"><a href="#cb5-332" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-333"><a href="#cb5-333" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Data</span></span>
<span id="cb5-334"><a href="#cb5-334" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> nodes <span class="op">=</span> biddersNodes<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> <span class="bu">Object</span><span class="op">.</span><span class="fu">create</span>(d))<span class="op">;</span></span>
<span id="cb5-335"><a href="#cb5-335" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> links <span class="op">=</span> biddersLinks<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> <span class="bu">Object</span><span class="op">.</span><span class="fu">create</span>(d))<span class="op">;</span></span>
<span id="cb5-336"><a href="#cb5-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-337"><a href="#cb5-337" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Define forces</span></span>
<span id="cb5-338"><a href="#cb5-338" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> simulation <span class="op">=</span> d3<span class="op">.</span><span class="fu">forceSimulation</span>(nodes)</span>
<span id="cb5-339"><a href="#cb5-339" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">force</span>(<span class="st">"link"</span><span class="op">,</span> d3<span class="op">.</span><span class="fu">forceLink</span>(links)<span class="op">.</span><span class="fu">id</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">id</span>))</span>
<span id="cb5-340"><a href="#cb5-340" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">force</span>(<span class="st">"charge"</span><span class="op">,</span> d3<span class="op">.</span><span class="fu">forceManyBody</span>()<span class="op">.</span><span class="fu">strength</span>(<span class="op">-</span><span class="dv">200</span>))</span>
<span id="cb5-341"><a href="#cb5-341" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">force</span>(<span class="st">"x"</span><span class="op">,</span> d3<span class="op">.</span><span class="fu">forceX</span>())</span>
<span id="cb5-342"><a href="#cb5-342" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">force</span>(<span class="st">"y"</span><span class="op">,</span> d3<span class="op">.</span><span class="fu">forceY</span>())</span>
<span id="cb5-343"><a href="#cb5-343" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">force</span>(<span class="st">"limit"</span><span class="op">,</span> d3<span class="op">.</span><span class="fu">forceLimit</span>()<span class="op">.</span><span class="fu">x0</span>(<span class="op">-</span>width <span class="op">/</span> <span class="dv">2</span>)<span class="op">.</span><span class="fu">x1</span>(width <span class="op">/</span> <span class="dv">2</span>)<span class="op">.</span><span class="fu">y0</span>(<span class="op">-</span>height <span class="op">/</span> <span class="dv">2</span> <span class="op">+</span> <span class="dv">20</span>)<span class="op">.</span><span class="fu">y1</span>(height <span class="op">/</span> <span class="dv">2</span> <span class="op">-</span> <span class="dv">20</span>)<span class="op">.</span><span class="fu">radius</span>(<span class="dv">10</span>))</span>
<span id="cb5-344"><a href="#cb5-344" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">on</span>(<span class="st">"tick"</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb5-345"><a href="#cb5-345" aria-hidden="true" tabindex="-1"></a>      link</span>
<span id="cb5-346"><a href="#cb5-346" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x1"</span><span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">source</span><span class="op">.</span><span class="at">x</span>)</span>
<span id="cb5-347"><a href="#cb5-347" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">source</span><span class="op">.</span><span class="at">y</span> <span class="op">-</span> <span class="dv">20</span>)</span>
<span id="cb5-348"><a href="#cb5-348" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">target</span><span class="op">.</span><span class="at">x</span>)</span>
<span id="cb5-349"><a href="#cb5-349" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">target</span><span class="op">.</span><span class="at">y</span> <span class="op">-</span> <span class="dv">20</span>)<span class="op">;</span></span>
<span id="cb5-350"><a href="#cb5-350" aria-hidden="true" tabindex="-1"></a>      node</span>
<span id="cb5-351"><a href="#cb5-351" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="vs">`translate(</span><span class="sc">${</span>d<span class="op">.</span><span class="at">x</span><span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>d<span class="op">.</span><span class="at">y</span> <span class="op">-</span> <span class="dv">20</span><span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb5-352"><a href="#cb5-352" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb5-353"><a href="#cb5-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-354"><a href="#cb5-354" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Canvas</span></span>
<span id="cb5-355"><a href="#cb5-355" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> d3<span class="op">.</span><span class="fu">create</span>(<span class="st">"svg"</span>)</span>
<span id="cb5-356"><a href="#cb5-356" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> width)</span>
<span id="cb5-357"><a href="#cb5-357" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> height)</span>
<span id="cb5-358"><a href="#cb5-358" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [<span class="op">-</span>width <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> <span class="op">-</span>height <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> width<span class="op">,</span> height])</span>
<span id="cb5-359"><a href="#cb5-359" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"style"</span><span class="op">,</span> <span class="st">"max-width: 100%; height: auto; height: intrinsic;"</span>)<span class="op">;</span></span>
<span id="cb5-360"><a href="#cb5-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-361"><a href="#cb5-361" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Tooltip</span></span>
<span id="cb5-362"><a href="#cb5-362" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> tooltip <span class="op">=</span> d3<span class="op">.</span><span class="fu">select</span>(<span class="st">"body"</span>)</span>
<span id="cb5-363"><a href="#cb5-363" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"div"</span>)</span>
<span id="cb5-364"><a href="#cb5-364" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"toolTip"</span>)</span>
<span id="cb5-365"><a href="#cb5-365" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"display"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb5-366"><a href="#cb5-366" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"position"</span><span class="op">,</span> <span class="st">"absolute"</span>)</span>
<span id="cb5-367"><a href="#cb5-367" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"width"</span><span class="op">,</span> <span class="dv">100</span>)</span>
<span id="cb5-368"><a href="#cb5-368" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"height"</span><span class="op">,</span> <span class="dv">20</span>)</span>
<span id="cb5-369"><a href="#cb5-369" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"background"</span><span class="op">,</span> <span class="st">"#f7f7f7"</span>)</span>
<span id="cb5-370"><a href="#cb5-370" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"border"</span><span class="op">,</span> <span class="st">"1px solid #cecece"</span>)</span>
<span id="cb5-371"><a href="#cb5-371" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="op">.</span><span class="dv">9</span>)</span>
<span id="cb5-372"><a href="#cb5-372" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"padding"</span><span class="op">,</span> <span class="st">".2em .45em"</span>)</span>
<span id="cb5-373"><a href="#cb5-373" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">".85rem"</span>)<span class="op">;</span></span>
<span id="cb5-374"><a href="#cb5-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-375"><a href="#cb5-375" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> showTooltip <span class="op">=</span> <span class="kw">function</span>(<span class="bu">event</span><span class="op">,</span> d) {</span>
<span id="cb5-376"><a href="#cb5-376" aria-hidden="true" tabindex="-1"></a>    d3<span class="op">.</span><span class="fu">select</span>(<span class="kw">this</span>)</span>
<span id="cb5-377"><a href="#cb5-377" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">transition</span>()<span class="op">.</span><span class="fu">duration</span>(<span class="dv">50</span>)</span>
<span id="cb5-378"><a href="#cb5-378" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="st">"scale(1.25)"</span>)<span class="op">;</span></span>
<span id="cb5-379"><a href="#cb5-379" aria-hidden="true" tabindex="-1"></a>    tooltip</span>
<span id="cb5-380"><a href="#cb5-380" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"left"</span><span class="op">,</span> <span class="bu">event</span><span class="op">.</span><span class="at">pageX</span> <span class="op">+</span> <span class="dv">18</span> <span class="op">+</span> <span class="st">"px"</span>)</span>
<span id="cb5-381"><a href="#cb5-381" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"top"</span><span class="op">,</span> <span class="bu">event</span><span class="op">.</span><span class="at">pageY</span> <span class="op">+</span> <span class="dv">18</span> <span class="op">+</span> <span class="st">"px"</span>)</span>
<span id="cb5-382"><a href="#cb5-382" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"display"</span><span class="op">,</span> <span class="st">"block"</span>)</span>
<span id="cb5-383"><a href="#cb5-383" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(d<span class="op">.</span><span class="at">name</span>)</span>
<span id="cb5-384"><a href="#cb5-384" aria-hidden="true" tabindex="-1"></a>    d3<span class="op">.</span><span class="fu">select</span>(<span class="bu">event</span><span class="op">.</span><span class="at">target</span>)</span>
<span id="cb5-385"><a href="#cb5-385" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"cursor"</span><span class="op">,</span> <span class="st">"pointer"</span>)<span class="op">;</span></span>
<span id="cb5-386"><a href="#cb5-386" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-387"><a href="#cb5-387" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-388"><a href="#cb5-388" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> hideTooltip <span class="op">=</span> <span class="kw">function</span>(<span class="bu">event</span>) {</span>
<span id="cb5-389"><a href="#cb5-389" aria-hidden="true" tabindex="-1"></a>    d3<span class="op">.</span><span class="fu">select</span>(<span class="kw">this</span>)</span>
<span id="cb5-390"><a href="#cb5-390" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">transition</span>()<span class="op">.</span><span class="fu">duration</span>(<span class="dv">50</span>)</span>
<span id="cb5-391"><a href="#cb5-391" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="st">"scale(1)"</span>)<span class="op">;</span></span>
<span id="cb5-392"><a href="#cb5-392" aria-hidden="true" tabindex="-1"></a>    tooltip</span>
<span id="cb5-393"><a href="#cb5-393" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"display"</span><span class="op">,</span> <span class="st">"none"</span>)<span class="op">;</span></span>
<span id="cb5-394"><a href="#cb5-394" aria-hidden="true" tabindex="-1"></a>    d3<span class="op">.</span><span class="fu">select</span>(<span class="bu">event</span><span class="op">.</span><span class="at">target</span>)</span>
<span id="cb5-395"><a href="#cb5-395" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"cursor"</span><span class="op">,</span> <span class="st">"default"</span>)<span class="op">;</span></span>
<span id="cb5-396"><a href="#cb5-396" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-397"><a href="#cb5-397" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-398"><a href="#cb5-398" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> link <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb5-399"><a href="#cb5-399" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb5-400"><a href="#cb5-400" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="fl">1.5</span>)</span>
<span id="cb5-401"><a href="#cb5-401" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"line"</span>)</span>
<span id="cb5-402"><a href="#cb5-402" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(links)</span>
<span id="cb5-403"><a href="#cb5-403" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">join</span>(<span class="st">"line"</span>)</span>
<span id="cb5-404"><a href="#cb5-404" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">colorLinks</span>(d<span class="op">.</span><span class="at">win</span>))</span>
<span id="cb5-405"><a href="#cb5-405" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">strokeLinks</span>(d<span class="op">.</span><span class="at">win</span>))</span>
<span id="cb5-406"><a href="#cb5-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-407"><a href="#cb5-407" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> node <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb5-408"><a href="#cb5-408" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-linecap"</span><span class="op">,</span> <span class="st">"round"</span>)</span>
<span id="cb5-409"><a href="#cb5-409" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-linejoin"</span><span class="op">,</span> <span class="st">"round"</span>)</span>
<span id="cb5-410"><a href="#cb5-410" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"g"</span>)</span>
<span id="cb5-411"><a href="#cb5-411" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(nodes)</span>
<span id="cb5-412"><a href="#cb5-412" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">join</span>(<span class="st">"g"</span>)</span>
<span id="cb5-413"><a href="#cb5-413" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(<span class="fu">drag</span>(simulation))<span class="op">;</span></span>
<span id="cb5-414"><a href="#cb5-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-415"><a href="#cb5-415" aria-hidden="true" tabindex="-1"></a>  node<span class="op">.</span><span class="fu">append</span>(<span class="st">"circle"</span>)</span>
<span id="cb5-416"><a href="#cb5-416" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"white"</span>)</span>
<span id="cb5-417"><a href="#cb5-417" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="fl">1.5</span>)</span>
<span id="cb5-418"><a href="#cb5-418" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">colorNodes</span>(d<span class="op">.</span><span class="at">type</span>))</span>
<span id="cb5-419"><a href="#cb5-419" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> <span class="dv">10</span>)</span>
<span id="cb5-420"><a href="#cb5-420" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">on</span>(<span class="st">"mousemove"</span><span class="op">,</span> showTooltip)</span>
<span id="cb5-421"><a href="#cb5-421" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">on</span>(<span class="st">"mouseleave"</span><span class="op">,</span> hideTooltip)<span class="op">;</span></span>
<span id="cb5-422"><a href="#cb5-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-423"><a href="#cb5-423" aria-hidden="true" tabindex="-1"></a>  invalidation<span class="op">.</span><span class="fu">then</span>(() <span class="kw">=&gt;</span> simulation<span class="op">.</span><span class="fu">stop</span>())<span class="op">;</span></span>
<span id="cb5-424"><a href="#cb5-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-425"><a href="#cb5-425" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> svg<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb5-426"><a href="#cb5-426" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-427"><a href="#cb5-427" aria-hidden="true" tabindex="-1"></a><span class="fu">html</span><span class="vs">`&lt;div class="ojs-caption"&gt;Click and drag to highlight relationships.&lt;/div&gt;`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell quarto-layout-panel" data-layout="[[1], [1], [1]]">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="ojs-cell-2-1" data-nodetype="expression">

</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="ojs-cell-2-2" data-nodetype="expression">

</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="ojs-cell-2-3" data-nodetype="expression">

</div>
</div>
</div>
</div>
<p>Seven of the 11 contracts with bidders data<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> had more than one valid bid, which, by WeSolve’s reckoning, saved the government an average of 1.6%. It’s not exactly a blockbuster amount, and looking at the network, it’s pretty clear why. Adam Smith’s marketplace this is not. The ten Metro Manila contracts received just 1-3 bidders each; Philippine Chemsteel won all six contracts for which it submitted a bid. The Metro Davao contract was the most competitive at four bidders, though the winning bid was a mere 0.1% less than the budgeted amount.</p>
<p>What exactly did these companies spend on? Luckily, the WeSolve dataset also contains item-level price and quantity information for each winning bid. Let’s prep these for charting on a stacked bar plot.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>items <span class="ot">&lt;-</span> item <span class="sc">%&gt;%</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(contract_no, item_description, item_amt) <span class="sc">%&gt;%</span> </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(contract_no) <span class="sc">%&gt;%</span> </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(item_amt), <span class="at">.by_group =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">rank =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>(),</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">item =</span> <span class="fu">case_when</span>(</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>      rank <span class="sc">&lt;=</span> <span class="dv">9</span> <span class="sc">~</span> item_description,</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Others"</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    )) <span class="sc">%&gt;%</span> </span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(contract_no, item) <span class="sc">%&gt;%</span> </span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">value =</span> <span class="fu">sum</span>(item_amt),</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">rank =</span> <span class="fu">sum</span>(rank)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value_norm =</span> value <span class="sc">/</span> <span class="fu">sum</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(rank, <span class="at">.by_group =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rank =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>itemsWide <span class="ot">&lt;-</span> items <span class="sc">%&gt;%</span> </span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(contract_no, rank, value_norm) <span class="sc">%&gt;%</span> </span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> rank, <span class="at">values_from =</span> value_norm)</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>itemsDesc <span class="ot">&lt;-</span> items <span class="sc">%&gt;%</span> </span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(contract_no, rank, item, value, value_norm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To keep the chart manageable, I’m only identifying the nine biggest items in each contract, with the rest aggregated into an “others” category. Those steeped in the philosophy of tidy data might be wondering what sort of abomination am I trying to create with <code>itemsWide</code>. This step is necessary because making stacked bar charts in D3 requires data in wide format.</p>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7" data-startfrom="477" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 476;"><span id="cb7-477"><a href="#cb7-477" aria-hidden="true" tabindex="-1"></a><span class="fu">html</span><span class="vs">`</span></span>
<span id="cb7-478"><a href="#cb7-478" aria-hidden="true" tabindex="-1"></a><span class="vs">  &lt;div class="ojs-title"&gt;Is that everything?&lt;/div&gt;</span></span>
<span id="cb7-479"><a href="#cb7-479" aria-hidden="true" tabindex="-1"></a><span class="vs">  &lt;div class="ojs-subtitle"&gt;Itemized breakdown of winning contract bid&lt;/div&gt;</span></span>
<span id="cb7-480"><a href="#cb7-480" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span></span>
<span id="cb7-481"><a href="#cb7-481" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb7-482"><a href="#cb7-482" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Parameters</span></span>
<span id="cb7-483"><a href="#cb7-483" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> margin <span class="op">=</span> { <span class="dt">top</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">right</span><span class="op">:</span> <span class="dv">20</span><span class="op">,</span> <span class="dt">bottom</span><span class="op">:</span> <span class="dv">30</span><span class="op">,</span> <span class="dt">left</span><span class="op">:</span> <span class="dv">80</span> }<span class="op">;</span></span>
<span id="cb7-484"><a href="#cb7-484" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> width <span class="op">=</span> <span class="dv">790</span> <span class="op">-</span> margin<span class="op">.</span><span class="at">left</span> <span class="op">-</span> margin<span class="op">.</span><span class="at">right</span><span class="op">;</span></span>
<span id="cb7-485"><a href="#cb7-485" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> height <span class="op">=</span> <span class="dv">500</span> <span class="op">-</span> margin<span class="op">.</span><span class="at">top</span> <span class="op">-</span> margin<span class="op">.</span><span class="at">bottom</span><span class="op">;</span></span>
<span id="cb7-486"><a href="#cb7-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-487"><a href="#cb7-487" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> subgroups <span class="op">=</span> itemsWide<span class="op">.</span><span class="at">columns</span><span class="op">.</span><span class="fu">slice</span>(<span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb7-488"><a href="#cb7-488" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> groups <span class="op">=</span> itemsWide<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">contract_no</span>)<span class="op">;</span></span>
<span id="cb7-489"><a href="#cb7-489" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-490"><a href="#cb7-490" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> colors <span class="op">=</span> [</span>
<span id="cb7-491"><a href="#cb7-491" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#0C6291"</span><span class="op">,</span></span>
<span id="cb7-492"><a href="#cb7-492" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#4889ab"</span><span class="op">,</span></span>
<span id="cb7-493"><a href="#cb7-493" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#B13D70"</span><span class="op">,</span></span>
<span id="cb7-494"><a href="#cb7-494" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#f697bb"</span><span class="op">,</span></span>
<span id="cb7-495"><a href="#cb7-495" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#307351"</span><span class="op">,</span></span>
<span id="cb7-496"><a href="#cb7-496" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#7fc6a4"</span><span class="op">,</span></span>
<span id="cb7-497"><a href="#cb7-497" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#FCB13B"</span><span class="op">,</span></span>
<span id="cb7-498"><a href="#cb7-498" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#F7DD72"</span><span class="op">,</span></span>
<span id="cb7-499"><a href="#cb7-499" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#c0d7df"</span><span class="op">,</span></span>
<span id="cb7-500"><a href="#cb7-500" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#f7f7f7"</span></span>
<span id="cb7-501"><a href="#cb7-501" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb7-502"><a href="#cb7-502" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> color <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleOrdinal</span>()</span>
<span id="cb7-503"><a href="#cb7-503" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>(subgroups)</span>
<span id="cb7-504"><a href="#cb7-504" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>(colors)<span class="op">;</span></span>
<span id="cb7-505"><a href="#cb7-505" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-506"><a href="#cb7-506" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Canvas</span></span>
<span id="cb7-507"><a href="#cb7-507" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> d3<span class="op">.</span><span class="fu">create</span>(<span class="st">"svg"</span>)</span>
<span id="cb7-508"><a href="#cb7-508" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> width <span class="op">+</span> margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">right</span>)</span>
<span id="cb7-509"><a href="#cb7-509" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> height <span class="op">+</span> margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">bottom</span>)</span>
<span id="cb7-510"><a href="#cb7-510" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> width <span class="op">+</span> margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">right</span><span class="op">,</span> height <span class="op">+</span> margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">bottom</span>])</span>
<span id="cb7-511"><a href="#cb7-511" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"style"</span><span class="op">,</span> <span class="st">"max-width: 100%; height: auto; height: intrinsic;"</span>)<span class="op">;</span></span>
<span id="cb7-512"><a href="#cb7-512" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-513"><a href="#cb7-513" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> panel <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb7-514"><a href="#cb7-514" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>margin<span class="op">.</span><span class="at">left</span><span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>margin<span class="op">.</span><span class="at">top</span><span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb7-515"><a href="#cb7-515" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-516"><a href="#cb7-516" aria-hidden="true" tabindex="-1"></a>  <span class="co">// X axis</span></span>
<span id="cb7-517"><a href="#cb7-517" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> x <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb7-518"><a href="#cb7-518" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>])</span>
<span id="cb7-519"><a href="#cb7-519" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> width])<span class="op">;</span></span>
<span id="cb7-520"><a href="#cb7-520" aria-hidden="true" tabindex="-1"></a>  panel<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb7-521"><a href="#cb7-521" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(0, </span><span class="sc">${</span>height<span class="sc">}</span><span class="vs">)`</span>)</span>
<span id="cb7-522"><a href="#cb7-522" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(d3<span class="op">.</span><span class="fu">axisBottom</span>(x)<span class="op">.</span><span class="fu">ticks</span>(<span class="dv">4</span><span class="op">,</span> <span class="st">"%"</span>)<span class="op">.</span><span class="fu">tickPadding</span>([<span class="dv">8</span>]))</span>
<span id="cb7-523"><a href="#cb7-523" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">".75rem"</span>)<span class="op">;</span></span>
<span id="cb7-524"><a href="#cb7-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-525"><a href="#cb7-525" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Y axis</span></span>
<span id="cb7-526"><a href="#cb7-526" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> y <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleBand</span>()</span>
<span id="cb7-527"><a href="#cb7-527" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>(groups)</span>
<span id="cb7-528"><a href="#cb7-528" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> height])</span>
<span id="cb7-529"><a href="#cb7-529" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">padding</span>([<span class="op">.</span><span class="dv">3</span>])<span class="op">;</span></span>
<span id="cb7-530"><a href="#cb7-530" aria-hidden="true" tabindex="-1"></a>  panel<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb7-531"><a href="#cb7-531" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(d3<span class="op">.</span><span class="fu">axisLeft</span>(y)<span class="op">.</span><span class="fu">tickSize</span>([<span class="dv">0</span>])<span class="op">.</span><span class="fu">tickPadding</span>([<span class="dv">8</span>]))</span>
<span id="cb7-532"><a href="#cb7-532" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">".75rem"</span>)<span class="op">;</span></span>
<span id="cb7-533"><a href="#cb7-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-534"><a href="#cb7-534" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> stackedData <span class="op">=</span> d3<span class="op">.</span><span class="fu">stack</span>()</span>
<span id="cb7-535"><a href="#cb7-535" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">keys</span>(subgroups)</span>
<span id="cb7-536"><a href="#cb7-536" aria-hidden="true" tabindex="-1"></a>    (itemsWide)<span class="op">;</span></span>
<span id="cb7-537"><a href="#cb7-537" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-538"><a href="#cb7-538" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Tooltip</span></span>
<span id="cb7-539"><a href="#cb7-539" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> tooltip <span class="op">=</span> d3<span class="op">.</span><span class="fu">select</span>(<span class="st">"body"</span>)</span>
<span id="cb7-540"><a href="#cb7-540" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"div"</span>)</span>
<span id="cb7-541"><a href="#cb7-541" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"toolTip"</span>)</span>
<span id="cb7-542"><a href="#cb7-542" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"display"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb7-543"><a href="#cb7-543" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"position"</span><span class="op">,</span> <span class="st">"absolute"</span>)</span>
<span id="cb7-544"><a href="#cb7-544" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"width"</span><span class="op">,</span> <span class="dv">100</span>)</span>
<span id="cb7-545"><a href="#cb7-545" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"height"</span><span class="op">,</span> <span class="dv">20</span>)</span>
<span id="cb7-546"><a href="#cb7-546" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"background"</span><span class="op">,</span> <span class="st">"#f7f7f7"</span>)</span>
<span id="cb7-547"><a href="#cb7-547" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"border"</span><span class="op">,</span> <span class="st">"1px solid #cecece"</span>)</span>
<span id="cb7-548"><a href="#cb7-548" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="op">.</span><span class="dv">9</span>)</span>
<span id="cb7-549"><a href="#cb7-549" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"padding"</span><span class="op">,</span> <span class="st">".2em .45em"</span>)</span>
<span id="cb7-550"><a href="#cb7-550" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">".85rem"</span>)</span>
<span id="cb7-551"><a href="#cb7-551" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"line-height"</span><span class="op">,</span> <span class="fl">1.4</span>)<span class="op">;</span></span>
<span id="cb7-552"><a href="#cb7-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-553"><a href="#cb7-553" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> showTooltip <span class="op">=</span> <span class="kw">function</span>(<span class="bu">event</span><span class="op">,</span> d) {</span>
<span id="cb7-554"><a href="#cb7-554" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-555"><a href="#cb7-555" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> contract <span class="op">=</span> d<span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="at">contract_no</span><span class="op">;</span></span>
<span id="cb7-556"><a href="#cb7-556" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> itemShare <span class="op">=</span> d3<span class="op">.</span><span class="fu">format</span>(<span class="st">".1%"</span>)(d[<span class="dv">1</span>] <span class="op">-</span> d[<span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb7-557"><a href="#cb7-557" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> itemRow <span class="op">=</span> itemsDesc<span class="op">.</span><span class="fu">filter</span>(D <span class="kw">=&gt;</span> D<span class="op">.</span><span class="at">contract_no</span> <span class="op">===</span> contract <span class="op">&amp;&amp;</span> d3<span class="op">.</span><span class="fu">format</span>(<span class="st">".4"</span>)(D<span class="op">.</span><span class="at">value_norm</span>) <span class="op">===</span> d3<span class="op">.</span><span class="fu">format</span>(<span class="st">".4"</span>)(d[<span class="dv">1</span>] <span class="op">-</span> d[<span class="dv">0</span>]))[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb7-558"><a href="#cb7-558" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> itemName <span class="op">=</span> itemRow<span class="op">.</span><span class="at">item</span><span class="op">;</span></span>
<span id="cb7-559"><a href="#cb7-559" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> itemValue <span class="op">=</span> d3<span class="op">.</span><span class="fu">format</span>(<span class="st">",.0f"</span>)(itemRow<span class="op">.</span><span class="at">value</span>)<span class="op">;</span></span>
<span id="cb7-560"><a href="#cb7-560" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-561"><a href="#cb7-561" aria-hidden="true" tabindex="-1"></a>    tooltip</span>
<span id="cb7-562"><a href="#cb7-562" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"left"</span><span class="op">,</span> <span class="bu">event</span><span class="op">.</span><span class="at">pageX</span> <span class="op">+</span> <span class="dv">18</span> <span class="op">+</span> <span class="st">"px"</span>)</span>
<span id="cb7-563"><a href="#cb7-563" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"top"</span><span class="op">,</span> <span class="bu">event</span><span class="op">.</span><span class="at">pageY</span> <span class="op">+</span> <span class="dv">18</span> <span class="op">+</span> <span class="st">"px"</span>)</span>
<span id="cb7-564"><a href="#cb7-564" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"display"</span><span class="op">,</span> <span class="st">"block"</span>)</span>
<span id="cb7-565"><a href="#cb7-565" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">html</span>(<span class="vs">`</span><span class="sc">${</span>itemName<span class="sc">}</span><span class="vs">&lt;br&gt;₱</span><span class="sc">${</span>itemValue<span class="sc">}</span><span class="vs"> (</span><span class="sc">${</span>itemShare<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb7-566"><a href="#cb7-566" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-567"><a href="#cb7-567" aria-hidden="true" tabindex="-1"></a>    panel<span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb7-568"><a href="#cb7-568" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"highlight-rect"</span>)</span>
<span id="cb7-569"><a href="#cb7-569" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> d3<span class="op">.</span><span class="fu">select</span>(<span class="kw">this</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span>))</span>
<span id="cb7-570"><a href="#cb7-570" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> d3<span class="op">.</span><span class="fu">select</span>(<span class="kw">this</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span>))</span>
<span id="cb7-571"><a href="#cb7-571" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> d3<span class="op">.</span><span class="fu">select</span>(<span class="kw">this</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span>))</span>
<span id="cb7-572"><a href="#cb7-572" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span>d3<span class="op">.</span><span class="fu">select</span>(<span class="kw">this</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span>))</span>
<span id="cb7-573"><a href="#cb7-573" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="dv">1</span>)</span>
<span id="cb7-574"><a href="#cb7-574" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"#2B303A"</span>)</span>
<span id="cb7-575"><a href="#cb7-575" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="dv">3</span>)</span>
<span id="cb7-576"><a href="#cb7-576" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)<span class="op">;</span></span>
<span id="cb7-577"><a href="#cb7-577" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-578"><a href="#cb7-578" aria-hidden="true" tabindex="-1"></a>    d3<span class="op">.</span><span class="fu">select</span>(<span class="bu">event</span><span class="op">.</span><span class="at">target</span>)<span class="op">.</span><span class="fu">style</span>(<span class="st">"cursor"</span><span class="op">,</span> <span class="st">"pointer"</span>)<span class="op">;</span></span>
<span id="cb7-579"><a href="#cb7-579" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-580"><a href="#cb7-580" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-581"><a href="#cb7-581" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-582"><a href="#cb7-582" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> hideTooltip <span class="op">=</span> <span class="kw">function</span>(<span class="bu">event</span>) {</span>
<span id="cb7-583"><a href="#cb7-583" aria-hidden="true" tabindex="-1"></a>    tooltip<span class="op">.</span><span class="fu">style</span>(<span class="st">"display"</span><span class="op">,</span> <span class="st">"none"</span>)<span class="op">;</span></span>
<span id="cb7-584"><a href="#cb7-584" aria-hidden="true" tabindex="-1"></a>    d3<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"#highlight-rect"</span>)<span class="op">.</span><span class="fu">remove</span>()<span class="op">;</span></span>
<span id="cb7-585"><a href="#cb7-585" aria-hidden="true" tabindex="-1"></a>    d3<span class="op">.</span><span class="fu">select</span>(<span class="bu">event</span><span class="op">.</span><span class="at">target</span>)<span class="op">.</span><span class="fu">style</span>(<span class="st">"cursor"</span><span class="op">,</span> <span class="st">"default"</span>)<span class="op">;</span></span>
<span id="cb7-586"><a href="#cb7-586" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-587"><a href="#cb7-587" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-588"><a href="#cb7-588" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Build the chart</span></span>
<span id="cb7-589"><a href="#cb7-589" aria-hidden="true" tabindex="-1"></a>  panel<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb7-590"><a href="#cb7-590" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"g"</span>)</span>
<span id="cb7-591"><a href="#cb7-591" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(stackedData)</span>
<span id="cb7-592"><a href="#cb7-592" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">join</span>(<span class="st">"g"</span>)</span>
<span id="cb7-593"><a href="#cb7-593" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">color</span>(d<span class="op">.</span><span class="at">key</span>))</span>
<span id="cb7-594"><a href="#cb7-594" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"rect"</span>)</span>
<span id="cb7-595"><a href="#cb7-595" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(d <span class="kw">=&gt;</span> d)</span>
<span id="cb7-596"><a href="#cb7-596" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">join</span>(<span class="st">"rect"</span>)</span>
<span id="cb7-597"><a href="#cb7-597" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">x</span>(d[<span class="dv">0</span>]))</span>
<span id="cb7-598"><a href="#cb7-598" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">y</span>(d<span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="at">contract_no</span>))</span>
<span id="cb7-599"><a href="#cb7-599" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">x</span>(d[<span class="dv">1</span>]) <span class="op">-</span> <span class="fu">x</span>(d[<span class="dv">0</span>]))</span>
<span id="cb7-600"><a href="#cb7-600" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> y<span class="op">.</span><span class="fu">bandwidth</span>())</span>
<span id="cb7-601"><a href="#cb7-601" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="op">.</span><span class="dv">8</span>)</span>
<span id="cb7-602"><a href="#cb7-602" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">on</span>(<span class="st">"mousemove"</span><span class="op">,</span> showTooltip)</span>
<span id="cb7-603"><a href="#cb7-603" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">on</span>(<span class="st">"mouseleave"</span><span class="op">,</span> hideTooltip)<span class="op">;</span></span>
<span id="cb7-604"><a href="#cb7-604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-605"><a href="#cb7-605" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> svg<span class="op">.</span><span class="fu">node</span>()</span>
<span id="cb7-606"><a href="#cb7-606" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-607"><a href="#cb7-607" aria-hidden="true" tabindex="-1"></a><span class="fu">html</span><span class="vs">`&lt;div class="ojs-caption"&gt;Hover to see more details.&lt;/div&gt;`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell quarto-layout-panel" data-layout="[[1], [1], [1]]">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="ojs-cell-3-1" data-nodetype="expression">

</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="ojs-cell-3-2" data-nodetype="expression">

</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="ojs-cell-3-3" data-nodetype="expression">

</div>
</div>
</div>
</div>
<p>Among the largest components are solar pavement markers, “reflectorized thermoplastic pavement markings” (read: paint), and an assortment of road signs. Here and there are provisions for constructing bicycle racks, though I don’t think I’ve ever seen one in the wild. It’s clear from these line items that the plan had always been to build bike lanes of the most basic sort: painted strips that awkwardly take up two-thirds of the rightmost car lane.</p>
<p>With this bike lane building program, the government has seemingly spent ₱1 billion to make <a href="https://philstarlife.com/news-and-views/597729-bike-lane-issue-social-media">everyone unhappy</a> — cyclists because they find the lanes inadequate, motorists because they resent the intrusion into their space. But that’s fine! It’s a start! There are bike lanes now where there weren’t before. Making cycling a truly viable mode of transport will take several more billions yet. And in those future rounds of procurement, I hope that the government commits to improving its policy of transparency. The WeSolve paper notes several gaps in officially available data; even the very routes these contracts covered, I was frustrated to learn, are nowhere to be found. Let the data flow free! Don’t you know I love nothing more than learning how much fancy paint my taxes were able to buy? <img src="../../images/logo-icon.png" class="endmark img-fluid"></p>




<div id="quarto-appendix" class="default"><section id="data" class="level2 appendix"><h2 class="anchored quarto-appendix-heading">Data</h2><div class="quarto-appendix-contents">

<ul>
<li><a href="https://docs.google.com/spreadsheets/d/1eZLfoH0eA0xMU79GVp_8zM_uEcENMKhV52nWqLwH-Ao/edit#gid=794528651">Empowering Citizens to Build Better Bike Lanes through Open Contracting.xlsx</a></li>
<li><a href="../../datasets/philippines-json-maps">philippine-json-maps</a> (source: <a href="https://github.com/faeldon/philippines-json-maps">faeldon/philippines-json-maps</a>)</li>
<li><a href="../../datasets/bikelanes/contracts.csv">contracts.csv</a>, <a href="../../datasets/bikelanes/contractsMap.json">contractsMap.json</a>, <a href="../../datasets/bikelanes/biddersNodes.csv">biddersNodes.csv</a>, <a href="../../datasets/bikelanes/biddersLinks.csv">biddersLinks.csv</a>, <a href="../../datasets/bikelanes/itemsWide.csv">itemsWide.csv</a>, <a href="../../datasets/bikelanes/itemsDesc.csv">itemsDesc.csv</a></li>
</ul>
</div></section><section id="d3-observable-code" class="level2 appendix"><h2 class="anchored quarto-appendix-heading">D3 / Observable code</h2><div class="quarto-appendix-contents">

<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8" data-startfrom="628" data-source-offset="-17"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 627;"><span id="cb8-628"><a href="#cb8-628" aria-hidden="true" tabindex="-1"></a>d3 <span class="op">=</span> <span class="pp">require</span>(<span class="st">"d3@7"</span><span class="op">,</span> <span class="st">"d3-force-limit"</span>)<span class="op">;</span></span>
<span id="cb8-629"><a href="#cb8-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-630"><a href="#cb8-630" aria-hidden="true" tabindex="-1"></a><span class="co">// Data</span></span>
<span id="cb8-631"><a href="#cb8-631" aria-hidden="true" tabindex="-1"></a>ncr1339 <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"../../datasets/philippines-json-maps/municities-province-ph133900000.topo.0.1.json"</span>)<span class="op">.</span><span class="fu">json</span>()<span class="op">;</span></span>
<span id="cb8-632"><a href="#cb8-632" aria-hidden="true" tabindex="-1"></a>ncr1374 <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"../../datasets/philippines-json-maps/municities-province-ph137400000.topo.0.1.json"</span>)<span class="op">.</span><span class="fu">json</span>()<span class="op">;</span></span>
<span id="cb8-633"><a href="#cb8-633" aria-hidden="true" tabindex="-1"></a>ncr1375 <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"../../datasets/philippines-json-maps/municities-province-ph137500000.topo.0.1.json"</span>)<span class="op">.</span><span class="fu">json</span>()<span class="op">;</span></span>
<span id="cb8-634"><a href="#cb8-634" aria-hidden="true" tabindex="-1"></a>ncr1376 <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"../../datasets/philippines-json-maps/municities-province-ph137600000.topo.0.1.json"</span>)<span class="op">.</span><span class="fu">json</span>()<span class="op">;</span></span>
<span id="cb8-635"><a href="#cb8-635" aria-hidden="true" tabindex="-1"></a>centralLuzon <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"../../datasets/philippines-json-maps/provinces-region-ph030000000.topo.0.1.json"</span>)<span class="op">.</span><span class="fu">json</span>()<span class="op">;</span></span>
<span id="cb8-636"><a href="#cb8-636" aria-hidden="true" tabindex="-1"></a>calabarzon <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"../../datasets/philippines-json-maps/provinces-region-ph040000000.topo.0.1.json"</span>)<span class="op">.</span><span class="fu">json</span>()<span class="op">;</span></span>
<span id="cb8-637"><a href="#cb8-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-638"><a href="#cb8-638" aria-hidden="true" tabindex="-1"></a>ncrFeatures <span class="op">=</span> {</span>
<span id="cb8-639"><a href="#cb8-639" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> ncr1339Feature <span class="op">=</span> topojson<span class="op">.</span><span class="fu">feature</span>(ncr1339<span class="op">,</span> ncr1339[<span class="st">"objects"</span>][<span class="st">"municities-province-ph133900000.0.1"</span>])<span class="op">.</span><span class="at">features</span></span>
<span id="cb8-640"><a href="#cb8-640" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> ncr1374Feature <span class="op">=</span> topojson<span class="op">.</span><span class="fu">feature</span>(ncr1374<span class="op">,</span> ncr1374[<span class="st">"objects"</span>][<span class="st">"municities-province-ph137400000.0.1"</span>])<span class="op">.</span><span class="at">features</span></span>
<span id="cb8-641"><a href="#cb8-641" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> ncr1375Feature <span class="op">=</span> topojson<span class="op">.</span><span class="fu">feature</span>(ncr1375<span class="op">,</span> ncr1375[<span class="st">"objects"</span>][<span class="st">"municities-province-ph137500000.0.1"</span>])<span class="op">.</span><span class="at">features</span></span>
<span id="cb8-642"><a href="#cb8-642" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> ncr1376Feature <span class="op">=</span> topojson<span class="op">.</span><span class="fu">feature</span>(ncr1376<span class="op">,</span> ncr1376[<span class="st">"objects"</span>][<span class="st">"municities-province-ph137600000.0.1"</span>])<span class="op">.</span><span class="at">features</span></span>
<span id="cb8-643"><a href="#cb8-643" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> [<span class="op">...</span>ncr1339Feature<span class="op">,</span> <span class="op">...</span>ncr1374Feature<span class="op">,</span> <span class="op">...</span>ncr1375Feature<span class="op">,</span> <span class="op">...</span>ncr1376Feature]<span class="op">;</span></span>
<span id="cb8-644"><a href="#cb8-644" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-645"><a href="#cb8-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-646"><a href="#cb8-646" aria-hidden="true" tabindex="-1"></a>bgFeatures <span class="op">=</span> {</span>
<span id="cb8-647"><a href="#cb8-647" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> r3Features <span class="op">=</span> topojson<span class="op">.</span><span class="fu">feature</span>(centralLuzon<span class="op">,</span> centralLuzon[<span class="st">"objects"</span>][<span class="st">"provinces-region-ph030000000.0.1"</span>])<span class="op">.</span><span class="at">features</span></span>
<span id="cb8-648"><a href="#cb8-648" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> r4AFeatures <span class="op">=</span> topojson<span class="op">.</span><span class="fu">feature</span>(calabarzon<span class="op">,</span> calabarzon[<span class="st">"objects"</span>][<span class="st">"provinces-region-ph040000000.0.1"</span>])<span class="op">.</span><span class="at">features</span></span>
<span id="cb8-649"><a href="#cb8-649" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> [<span class="op">...</span>r3Features<span class="op">,</span> <span class="op">...</span>r4AFeatures]<span class="op">;</span></span>
<span id="cb8-650"><a href="#cb8-650" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-651"><a href="#cb8-651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-652"><a href="#cb8-652" aria-hidden="true" tabindex="-1"></a>contractsMap <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"../../datasets/bikelanes/contractsMap.json"</span>)<span class="op">.</span><span class="fu">json</span>()<span class="op">;</span></span>
<span id="cb8-653"><a href="#cb8-653" aria-hidden="true" tabindex="-1"></a>contractsFeatures <span class="op">=</span> topojson<span class="op">.</span><span class="fu">feature</span>(contractsMap<span class="op">,</span> contractsMap<span class="op">.</span><span class="at">objects</span><span class="op">.</span><span class="at">contractsMap</span>)<span class="op">.</span><span class="at">features</span><span class="op">;</span></span>
<span id="cb8-654"><a href="#cb8-654" aria-hidden="true" tabindex="-1"></a>contractNames <span class="op">=</span> d3<span class="op">.</span><span class="fu">map</span>(contractsFeatures<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">contract</span>)<span class="op">.</span><span class="fu">sort</span>()<span class="op">;</span></span>
<span id="cb8-655"><a href="#cb8-655" aria-hidden="true" tabindex="-1"></a>contractsDF <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"../../datasets/bikelanes/contracts.csv"</span>)<span class="op">.</span><span class="fu">csv</span>({ <span class="dt">typed</span><span class="op">:</span> <span class="kw">true</span> })<span class="op">;</span></span>
<span id="cb8-656"><a href="#cb8-656" aria-hidden="true" tabindex="-1"></a>contractDetails <span class="op">=</span> contractsDF<span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> contractNames<span class="op">.</span><span class="fu">includes</span>(d<span class="op">.</span><span class="at">contract_no</span>))<span class="op">;</span></span>
<span id="cb8-657"><a href="#cb8-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-658"><a href="#cb8-658" aria-hidden="true" tabindex="-1"></a>biddersNodes <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"../../datasets/bikelanes/biddersNodes.csv"</span>)<span class="op">.</span><span class="fu">csv</span>({ <span class="dt">typed</span><span class="op">:</span> <span class="kw">true</span> })<span class="op">;</span></span>
<span id="cb8-659"><a href="#cb8-659" aria-hidden="true" tabindex="-1"></a>biddersLinks <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"../../datasets/bikelanes/biddersLinks.csv"</span>)<span class="op">.</span><span class="fu">csv</span>({ <span class="dt">typed</span><span class="op">:</span> <span class="kw">true</span> })<span class="op">;</span></span>
<span id="cb8-660"><a href="#cb8-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-661"><a href="#cb8-661" aria-hidden="true" tabindex="-1"></a>itemsWide <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"../../datasets/bikelanes/itemsWide.csv"</span>)<span class="op">.</span><span class="fu">csv</span>({ <span class="dt">typed</span><span class="op">:</span> <span class="kw">true</span> })<span class="op">;</span></span>
<span id="cb8-662"><a href="#cb8-662" aria-hidden="true" tabindex="-1"></a>itemsDesc <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"../../datasets/bikelanes/itemsDesc.csv"</span>)<span class="op">.</span><span class="fu">csv</span>({ <span class="dt">typed</span><span class="op">:</span> <span class="kw">true</span> })<span class="op">;</span></span>
<span id="cb8-663"><a href="#cb8-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-664"><a href="#cb8-664" aria-hidden="true" tabindex="-1"></a><span class="co">// Drag function</span></span>
<span id="cb8-665"><a href="#cb8-665" aria-hidden="true" tabindex="-1"></a><span class="co">// Source: https://observablehq.com/@d3/mobile-patent-suits</span></span>
<span id="cb8-666"><a href="#cb8-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-667"><a href="#cb8-667" aria-hidden="true" tabindex="-1"></a>drag <span class="op">=</span> simulation <span class="kw">=&gt;</span> {</span>
<span id="cb8-668"><a href="#cb8-668" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-669"><a href="#cb8-669" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">dragstarted</span>(<span class="bu">event</span><span class="op">,</span> d) {</span>
<span id="cb8-670"><a href="#cb8-670" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span><span class="bu">event</span><span class="op">.</span><span class="at">active</span>) simulation<span class="op">.</span><span class="fu">alphaTarget</span>(<span class="fl">0.3</span>)<span class="op">.</span><span class="fu">restart</span>()<span class="op">;</span></span>
<span id="cb8-671"><a href="#cb8-671" aria-hidden="true" tabindex="-1"></a>    d<span class="op">.</span><span class="at">fx</span> <span class="op">=</span> d<span class="op">.</span><span class="at">x</span><span class="op">;</span></span>
<span id="cb8-672"><a href="#cb8-672" aria-hidden="true" tabindex="-1"></a>    d<span class="op">.</span><span class="at">fy</span> <span class="op">=</span> d<span class="op">.</span><span class="at">y</span><span class="op">;</span></span>
<span id="cb8-673"><a href="#cb8-673" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-674"><a href="#cb8-674" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-675"><a href="#cb8-675" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">dragged</span>(<span class="bu">event</span><span class="op">,</span> d) {</span>
<span id="cb8-676"><a href="#cb8-676" aria-hidden="true" tabindex="-1"></a>    d<span class="op">.</span><span class="at">fx</span> <span class="op">=</span> <span class="bu">event</span><span class="op">.</span><span class="at">x</span><span class="op">;</span></span>
<span id="cb8-677"><a href="#cb8-677" aria-hidden="true" tabindex="-1"></a>    d<span class="op">.</span><span class="at">fy</span> <span class="op">=</span> <span class="bu">event</span><span class="op">.</span><span class="at">y</span><span class="op">;</span></span>
<span id="cb8-678"><a href="#cb8-678" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-679"><a href="#cb8-679" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-680"><a href="#cb8-680" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">dragended</span>(<span class="bu">event</span><span class="op">,</span> d) {</span>
<span id="cb8-681"><a href="#cb8-681" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span><span class="bu">event</span><span class="op">.</span><span class="at">active</span>) simulation<span class="op">.</span><span class="fu">alphaTarget</span>(<span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb8-682"><a href="#cb8-682" aria-hidden="true" tabindex="-1"></a>    d<span class="op">.</span><span class="at">fx</span> <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb8-683"><a href="#cb8-683" aria-hidden="true" tabindex="-1"></a>    d<span class="op">.</span><span class="at">fy</span> <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb8-684"><a href="#cb8-684" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-685"><a href="#cb8-685" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-686"><a href="#cb8-686" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> d3<span class="op">.</span><span class="fu">drag</span>()</span>
<span id="cb8-687"><a href="#cb8-687" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">on</span>(<span class="st">"start"</span><span class="op">,</span> dragstarted)</span>
<span id="cb8-688"><a href="#cb8-688" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">on</span>(<span class="st">"drag"</span><span class="op">,</span> dragged)</span>
<span id="cb8-689"><a href="#cb8-689" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">on</span>(<span class="st">"end"</span><span class="op">,</span> dragended)<span class="op">;</span></span>
<span id="cb8-690"><a href="#cb8-690" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-4-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-4-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-4-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-4-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-4-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-4-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-4-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-4-8" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-4-9" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-4-10" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-4-11" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-4-12" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-4-13" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-4-14" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-4-15" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-4-16" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-4-17" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-4-18" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-4-19" data-nodetype="declaration">

</div>
</div>
</div>
</div>


</div></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>So I’ve heard. I don’t actually know how to ride a bike.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>The one contract without bidders data was for Metro Cebu.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section></div></main> <!-- /main -->
<script type="ojs-module-contents">
eyJjb250ZW50cyI6W3sibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlxuaHRtbGBcbiAgPGRpdiBjbGFzcz1cIm9qcy10aXRsZVwiPkxpZmUgaW4gdGhlIGJpa2UgbGFuZTwvZGl2PlxuICA8ZGl2IGNsYXNzPVwib2pzLXN1YnRpdGxlXCI+Q29udHJhY3RzIGZvciBNZXRybyBNYW5pbGEgYmlrZSBsYW5lcywgMjAyMC0yMDIxPC9kaXY+XG5gXG5cbntcbiAgLy8gUGFyYW1ldGVyc1xuICBcbiAgY29uc3Qgd2lkdGggPSA5MjA7XG4gIGNvbnN0IGhlaWdodCA9IDYyMDtcbiAgXG4gIGNvbnN0IGxlZ2VuZEJveFdpZHRoID0gMTAwO1xuICBjb25zdCBsZWdlbmRCb3hIZWlnaHQgPSAzNTtcbiAgY29uc3QgbGVnZW5kQm94R2FwID0gNTU7XG4gIGNvbnN0IGluc2V0TGVmdCA9IDU7XG4gIGNvbnN0IGluc2V0VG9wID0gMTE1O1xuICBjb25zdCBtYXJnaW5SaWdodCA9IDEwO1xuICBcbiAgY29uc3QgY29sb3JOQ1IgPSBcIiNjMGQ3ZGZcIlxuICBjb25zdCBjb2xvckJHID0gXCIjZWVlZWVlXCJcbiAgY29uc3QgY29sb3JMZWdlbmQgPSBcIiM4NGIwYzVcIlxuICBjb25zdCBjb2xvckxlZ2VuZFNlbGVjdCA9IFwiI2Y2OTdiYlwiXG4gIGNvbnN0IGNvbG9yTGFuZXMgPSBcIiM4NGIwYzVcIlxuICBjb25zdCBjb2xvckxhbmVzU2VsZWN0ID0gXCIjQjEzRDcwXCJcbiAgXG4gIC8vIENhbnZhc1xuICBcbiAgY29uc3Qgc3ZnID0gZDMuY3JlYXRlKFwic3ZnXCIpXG4gICAgLmF0dHIoXCJ3aWR0aFwiLCB3aWR0aClcbiAgICAuYXR0cihcImhlaWdodFwiLCBoZWlnaHQpXG4gICAgLmF0dHIoXCJ2aWV3Qm94XCIsIFswLCAwLCB3aWR0aCwgaGVpZ2h0XSlcbiAgICAuYXR0cihcInN0eWxlXCIsIFwibWF4LXdpZHRoOiAxMDAlOyBoZWlnaHQ6IGF1dG87IGhlaWdodDogaW50cmluc2ljO1wiKTtcblxuICAvLyBNYXBcbiAgXG4gIGNvbnN0IHByb2plY3Rpb24gPSBkMy5nZW9NZXJjYXRvcigpXG4gICAgLnNjYWxlKFsxMDAwMDBdKVxuICAgIC5jZW50ZXIoWzEyMC44OSwgMTQuNjRdKVxuICBcbiAgY29uc3QgcGF0aEdlbmVyYXRvciA9IGQzLmdlb1BhdGgocHJvamVjdGlvbik7XG4gIFxuICBjb25zdCBtYXAgPSBzdmcuYXBwZW5kKFwiZ1wiKVxuXG4gIG1hcC5zZWxlY3RBbGwoXCJiZ1wiKVxuICAgIC5kYXRhKGJnRmVhdHVyZXMpXG4gICAgLmpvaW4oXCJwYXRoXCIpXG4gICAgLmF0dHIoXCJkXCIsIHBhdGhHZW5lcmF0b3IpXG4gICAgLmF0dHIoXCJmaWxsXCIsIGNvbG9yQkcpXG4gIFxuICBtYXAuc2VsZWN0QWxsKFwiYm91bmRhcmllc1wiKVxuICAgIC5kYXRhKG5jckZlYXR1cmVzKVxuICAgIC5qb2luKFwicGF0aFwiKVxuICAgIC5hdHRyKFwiZFwiLCBwYXRoR2VuZXJhdG9yKVxuICAgIC5hdHRyKFwiZmlsbFwiLCBjb2xvck5DUilcbiAgICAuYXR0cihcIm9wYWNpdHlcIiwgLjgpXG4gICAgLmF0dHIoXCJzdHJva2VcIiwgXCIjZmZmZmZmXCIpXG4gICAgLmF0dHIoXCJzdHJva2Utd2lkdGhcIiwgMSlcbiAgXG4gIC8vIEJpa2UgbGFuZXNcbiAgXG4gIG1hcC5zZWxlY3RBbGwoXCJsYW5lc1wiKVxuICAgIC5kYXRhKGNvbnRyYWN0c0ZlYXR1cmVzKVxuICAgIC5qb2luKFwicGF0aFwiKVxuICAgIC5hdHRyKFwiZFwiLCBwYXRoR2VuZXJhdG9yKVxuICAgIC5hdHRyKFwiY2xhc3NcIiwgKGQpID0+IFwibGFuZXMgbGFuZS1cIiArIGQucHJvcGVydGllcy5jb250cmFjdClcbiAgICAuYXR0cihcImZpbGxcIiwgXCJub25lXCIpXG4gICAgLmF0dHIoXCJvcGFjaXR5XCIsIC44KVxuICAgIC5hdHRyKFwic3Ryb2tlXCIsIGNvbG9yTGFuZXMpXG4gICAgLmF0dHIoXCJzdHJva2Utd2lkdGhcIiwgMyk7XG4gIFxuICAvLyBMZWdlbmRcbiAgXG4gIGNvbnN0IG1vdXNlZW50ZXIgPSBmdW5jdGlvbihldmVudCwgZCkge1xuICAgIGxlZ2VuZC5zZWxlY3QoXCIubGVnZW5kYm94LVwiICsgZClcbiAgICAgIC50cmFuc2l0aW9uKCkuZHVyYXRpb24oMTAwKVxuICAgICAgLmF0dHIoXCJmaWxsXCIsIGNvbG9yTGVnZW5kU2VsZWN0KVxuICAgICAgLmF0dHIoXCJvcGFjaXR5XCIsIDEpO1xuICAgIG1hcC5zZWxlY3QoXCIubGFuZS1cIiArIGQpXG4gICAgICAudHJhbnNpdGlvbigpLmR1cmF0aW9uKDEwMClcbiAgICAgIC5hdHRyKFwib3BhY2l0eVwiLCAxKVxuICAgICAgLmF0dHIoXCJzdHJva2VcIiwgY29sb3JMYW5lc1NlbGVjdClcbiAgICAgIC5hdHRyKFwic3Ryb2tlLXdpZHRoXCIsIDQpO1xuICAgIGQzLnNlbGVjdChcIi5kZXRhaWwtXCIgKyBkKVxuICAgICAgLnRyYW5zaXRpb24oKS5kdXJhdGlvbigxMDApXG4gICAgICAuYXR0cihcIm9wYWNpdHlcIiwgMSk7XG4gICAgZDMuc2VsZWN0KGV2ZW50LnRhcmdldClcbiAgICAgIC5zdHlsZShcImN1cnNvclwiLCBcInBvaW50ZXJcIik7XG4gIH1cbiAgXG4gIGNvbnN0IG1vdXNlbGVhdmUgPSBmdW5jdGlvbihldmVudCkge1xuICAgIGxlZ2VuZC5zZWxlY3RBbGwoXCIubGVnZW5kYm94XCIpXG4gICAgICAudHJhbnNpdGlvbigpLmR1cmF0aW9uKDEwMClcbiAgICAgIC5hdHRyKFwiZmlsbFwiLCBjb2xvckxlZ2VuZClcbiAgICAgIC5hdHRyKFwib3BhY2l0eVwiLCAuMjUpO1xuICAgIG1hcC5zZWxlY3RBbGwoXCIubGFuZXNcIilcbiAgICAgIC50cmFuc2l0aW9uKCkuZHVyYXRpb24oODAwKVxuICAgICAgLmF0dHIoXCJvcGFjaXR5XCIsIC44KVxuICAgICAgLmF0dHIoXCJzdHJva2VcIiwgY29sb3JMYW5lcylcbiAgICAgIC5hdHRyKFwic3Ryb2tlLXdpZHRoXCIsIDMpO1xuICAgIGQzLnNlbGVjdEFsbChcIi5kZXRhaWxzXCIpXG4gICAgICAudHJhbnNpdGlvbigpLmR1cmF0aW9uKDEwMClcbiAgICAgIC5hdHRyKFwib3BhY2l0eVwiLCAuMjUpO1xuICAgIGQzLnNlbGVjdChldmVudC50YXJnZXQpXG4gICAgICAuc3R5bGUoXCJjdXJzb3JcIiwgXCJkZWZhdWx0XCIpO1xuICB9XG4gIFxuICBjb25zdCBsZWdlbmQgPSBzdmcuc2VsZWN0QWxsKFwiYm94ZXNcIilcbiAgICAuZGF0YShjb250cmFjdE5hbWVzKVxuICAgIC5qb2luKFwiZ1wiKVxuICAgIC5vbihcIm1vdXNlZW50ZXJcIiwgbW91c2VlbnRlcilcbiAgICAub24oXCJtb3VzZWxlYXZlXCIsIG1vdXNlbGVhdmUpO1xuICAgIFxuICBsZWdlbmQuYXBwZW5kKFwicmVjdFwiKVxuICAgIC5hdHRyKFwiY2xhc3NcIiwgKGQpID0+IFwibGVnZW5kYm94IGxlZ2VuZGJveC1cIiArIGQpXG4gICAgLmF0dHIoXCJ3aWR0aFwiLCBsZWdlbmRCb3hXaWR0aClcbiAgICAuYXR0cihcImhlaWdodFwiLCBsZWdlbmRCb3hIZWlnaHQpXG4gICAgLmF0dHIoXCJmaWxsXCIsIGNvbG9yTGVnZW5kKVxuICAgIC5hdHRyKFwicnhcIiwgXCIuMjVlbVwiKVxuICAgIC5hdHRyKFwicnlcIiwgXCIuMjVlbVwiKVxuICAgIC5hdHRyKFwib3BhY2l0eVwiLCAuMjUpXG4gICAgLmF0dHIoXCJ4XCIsIGluc2V0TGVmdClcbiAgICAuYXR0cihcInlcIiwgKGQsIGkpID0+IChpbnNldFRvcCArIGkgKiBsZWdlbmRCb3hHYXApKTtcbiAgXG4gIGxlZ2VuZC5hcHBlbmQoXCJ0ZXh0XCIpXG4gICAgLnRleHQoZCA9PiBkKVxuICAgIC5hdHRyKFwidGV4dC1hbmNob3JcIiwgXCJtaWRkbGVcIilcbiAgICAuc3R5bGUoXCJhbGlnbm1lbnQtYmFzZWxpbmVcIiwgXCJtaWRkbGVcIilcbiAgICAuYXR0cihcInhcIiwgaW5zZXRMZWZ0ICsgbGVnZW5kQm94V2lkdGggLyAyKVxuICAgIC5hdHRyKFwieVwiLCAoZCwgaSkgPT4gKGluc2V0VG9wICsgaSAqIGxlZ2VuZEJveEdhcCkpXG4gICAgLmF0dHIoXCJkeVwiLCBsZWdlbmRCb3hIZWlnaHQgLyAyICsgMSk7XG4gICAgXG4gIC8vIERldGFpbHNcbiAgXG4gIGNvbnN0IGRldGFpbHMgPSBzdmcuc2VsZWN0QWxsKFwiZGV0YWlsc1wiKVxuICAgIC5kYXRhKGNvbnRyYWN0RGV0YWlscylcbiAgICAuam9pbihcImdcIilcbiAgICAuYXR0cihcImNsYXNzXCIsIChkLCBpKSA9PiBcImRldGFpbHMgZGV0YWlsLVwiICsgY29udHJhY3REZXRhaWxzLm1hcChkZCA9PiBkZC5jb250cmFjdF9ubylbaV0pXG4gICAgLmF0dHIoXCJvcGFjaXR5XCIsIC4yNSlcbiAgXG4gIGRldGFpbHMuYXBwZW5kKFwidGV4dFwiKVxuICAgIC50ZXh0KChkLCBpKSA9PiBcIkJpZGRlcjogXCIgKyBjb250cmFjdERldGFpbHMubWFwKGRkID0+IGRkLm5vYV9zdXBwbGllcilbaV0pXG4gICAgLmF0dHIoXCJ4XCIsIGluc2V0TGVmdCArIGxlZ2VuZEJveFdpZHRoICsgbWFyZ2luUmlnaHQpXG4gICAgLmF0dHIoXCJ5XCIsIChkLCBpKSA9PiAoaW5zZXRUb3AgKyBpICogbGVnZW5kQm94R2FwKSlcbiAgICAuYXR0cihcImR5XCIsIDUpXG4gICAgLnN0eWxlKFwiZm9udC1zaXplXCIsIFwiLjc1cmVtXCIpXG4gICAgLnN0eWxlKFwiYWxpZ25tZW50LWJhc2VsaW5lXCIsIFwiaGFuZ2luZ1wiKVxuICBcbiAgZGV0YWlscy5hcHBlbmQoXCJ0ZXh0XCIpXG4gICAgLnRleHQoKGQsIGkpID0+IFwiVmFsdWU6IOKCsVwiICsgY29udHJhY3REZXRhaWxzLm1hcChkZCA9PiBkMy5mb3JtYXQoXCIsLjJyXCIpKGRkLm5vYV9hd2FyZF92YWx1ZSAvIDEwMDAwMDApKVtpXSArIFwiIG1pbGxpb25cIilcbiAgICAuYXR0cihcImNsYXNzXCIsIChkLCBpKSA9PiBcInZhbHVlcyB2YWx1ZS1cIiArIGNvbnRyYWN0RGV0YWlscy5tYXAoZGQgPT4gZGQuY29udHJhY3Rfbm8pW2ldKVxuICAgIC5hdHRyKFwieFwiLCBpbnNldExlZnQgKyBsZWdlbmRCb3hXaWR0aCArIG1hcmdpblJpZ2h0KVxuICAgIC5hdHRyKFwieVwiLCAoZCwgaSkgPT4gKGluc2V0VG9wICsgaSAqIGxlZ2VuZEJveEdhcCkpXG4gICAgLmF0dHIoXCJkeVwiLCAyMClcbiAgICAuc3R5bGUoXCJmb250LXNpemVcIiwgXCIuNzVyZW1cIilcbiAgICAuc3R5bGUoXCJhbGlnbm1lbnQtYmFzZWxpbmVcIiwgXCJoYW5naW5nXCIpXG5cbiAgLy8gVGlwXG4gIFxuICBjb25zdCB0aXAgPSBzdmcuYXBwZW5kKFwidGV4dFwiKVxuICAgIC50ZXh0KFwiSG92ZXIgb3ZlciBhIGNvbnRyYWN0IHRvIHNlZSBpdCBvbiB0aGUgbWFwXCIpXG4gICAgLmF0dHIoXCJ4XCIsIGluc2V0TGVmdCArIDUpXG4gICAgLmF0dHIoXCJ5XCIsIGluc2V0VG9wIC0gMzApXG4gICAgLnN0eWxlKFwiZm9udC13ZWlnaHRcIiwgXCJib2xkXCIpO1xuICBcbiAgcmV0dXJuIHN2Zy5ub2RlKCk7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTIiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJcbmh0bWxgXG4gIDxkaXYgY2xhc3M9XCJvanMtdGl0bGVcIj5TbGltIHBpY2tpbmdzPC9kaXY+XG4gIDxkaXYgY2xhc3M9XCJvanMtc3VidGl0bGVcIj5OZXR3b3JrIG9mIDxzcGFuIHN0eWxlPVwiZm9udC13ZWlnaHQ6Ym9sZDsgY29sb3I6IzdmYzZhNFwiPmNvbnRyYWN0czwvc3Bhbj4gYW5kIHRoZWlyIDxzcGFuIHN0eWxlPVwiZm9udC13ZWlnaHQ6Ym9sZDsgY29sb3I6IzQ4ODlhYlwiPmJpZGRlcnM8L3NwYW4+LCB3aXRoIHdpbm5pbmcgYmlkcyA8Yj5pZGVudGlmaWVkPC9iPiA8L3NwYW4+PC9kaXY+XG5gXG5cbntcbiAgLy8gUGFyYW1ldGVyc1xuICBjb25zdCB3aWR0aCA9IDc5MFxuICBjb25zdCBoZWlnaHQgPSAzNTBcbiAgY29uc3QgY29sb3JMaW5rcyA9IGQzLnNjYWxlT3JkaW5hbCgpXG4gICAgLmRvbWFpbihbMCwgMV0pXG4gICAgLnJhbmdlKFtcIiNjZWNlY2VcIiwgXCIjMkIzMDNBXCJdKTtcbiAgY29uc3Qgc3Ryb2tlTGlua3MgPSBkMy5zY2FsZU9yZGluYWwoKVxuICAgIC5kb21haW4oWzAsIDFdKVxuICAgIC5yYW5nZShbMSwgM10pO1xuICBjb25zdCBjb2xvck5vZGVzID0gZDMuc2NhbGVPcmRpbmFsKClcbiAgICAuZG9tYWluKFtcImJpZGRlclwiLCBcImNvbnRyYWN0XCJdKVxuICAgIC5yYW5nZShbXCIjNDg4OWFiXCIsIFwiIzdmYzZhNFwiXSk7XG4gICAgXG4gIC8vIERhdGFcbiAgY29uc3Qgbm9kZXMgPSBiaWRkZXJzTm9kZXMubWFwKGQgPT4gT2JqZWN0LmNyZWF0ZShkKSk7XG4gIGNvbnN0IGxpbmtzID0gYmlkZGVyc0xpbmtzLm1hcChkID0+IE9iamVjdC5jcmVhdGUoZCkpO1xuXG4gIC8vIERlZmluZSBmb3JjZXNcbiAgY29uc3Qgc2ltdWxhdGlvbiA9IGQzLmZvcmNlU2ltdWxhdGlvbihub2RlcylcbiAgICAuZm9yY2UoXCJsaW5rXCIsIGQzLmZvcmNlTGluayhsaW5rcykuaWQoZCA9PiBkLmlkKSlcbiAgICAuZm9yY2UoXCJjaGFyZ2VcIiwgZDMuZm9yY2VNYW55Qm9keSgpLnN0cmVuZ3RoKC0yMDApKVxuICAgIC5mb3JjZShcInhcIiwgZDMuZm9yY2VYKCkpXG4gICAgLmZvcmNlKFwieVwiLCBkMy5mb3JjZVkoKSlcbiAgICAuZm9yY2UoXCJsaW1pdFwiLCBkMy5mb3JjZUxpbWl0KCkueDAoLXdpZHRoIC8gMikueDEod2lkdGggLyAyKS55MCgtaGVpZ2h0IC8gMiArIDIwKS55MShoZWlnaHQgLyAyIC0gMjApLnJhZGl1cygxMCkpXG4gICAgLm9uKFwidGlja1wiLCAoKSA9PiB7XG4gICAgICBsaW5rXG4gICAgICAgIC5hdHRyKFwieDFcIiwgZCA9PiBkLnNvdXJjZS54KVxuICAgICAgICAuYXR0cihcInkxXCIsIGQgPT4gZC5zb3VyY2UueSAtIDIwKVxuICAgICAgICAuYXR0cihcIngyXCIsIGQgPT4gZC50YXJnZXQueClcbiAgICAgICAgLmF0dHIoXCJ5MlwiLCBkID0+IGQudGFyZ2V0LnkgLSAyMCk7XG4gICAgICBub2RlXG4gICAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGQgPT4gYHRyYW5zbGF0ZSgke2QueH0sICR7ZC55IC0gMjB9KWApO1xuICAgIH0pO1xuXG4gIC8vIENhbnZhc1xuICBjb25zdCBzdmcgPSBkMy5jcmVhdGUoXCJzdmdcIilcbiAgICAuYXR0cihcIndpZHRoXCIsIHdpZHRoKVxuICAgIC5hdHRyKFwiaGVpZ2h0XCIsIGhlaWdodClcbiAgICAuYXR0cihcInZpZXdCb3hcIiwgWy13aWR0aCAvIDIsIC1oZWlnaHQgLyAyLCB3aWR0aCwgaGVpZ2h0XSlcbiAgICAuYXR0cihcInN0eWxlXCIsIFwibWF4LXdpZHRoOiAxMDAlOyBoZWlnaHQ6IGF1dG87IGhlaWdodDogaW50cmluc2ljO1wiKTtcblxuICAvLyBUb29sdGlwXG4gIGNvbnN0IHRvb2x0aXAgPSBkMy5zZWxlY3QoXCJib2R5XCIpXG4gICAgLmFwcGVuZChcImRpdlwiKVxuICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJ0b29sVGlwXCIpXG4gICAgLnN0eWxlKFwiZGlzcGxheVwiLCBcIm5vbmVcIilcbiAgICAuc3R5bGUoXCJwb3NpdGlvblwiLCBcImFic29sdXRlXCIpXG4gICAgLnN0eWxlKFwid2lkdGhcIiwgMTAwKVxuICAgIC5zdHlsZShcImhlaWdodFwiLCAyMClcbiAgICAuc3R5bGUoXCJiYWNrZ3JvdW5kXCIsIFwiI2Y3ZjdmN1wiKVxuICAgIC5zdHlsZShcImJvcmRlclwiLCBcIjFweCBzb2xpZCAjY2VjZWNlXCIpXG4gICAgLnN0eWxlKFwib3BhY2l0eVwiLCAuOSlcbiAgICAuc3R5bGUoXCJwYWRkaW5nXCIsIFwiLjJlbSAuNDVlbVwiKVxuICAgIC5zdHlsZShcImZvbnQtc2l6ZVwiLCBcIi44NXJlbVwiKTtcblxuICBjb25zdCBzaG93VG9vbHRpcCA9IGZ1bmN0aW9uKGV2ZW50LCBkKSB7XG4gICAgZDMuc2VsZWN0KHRoaXMpXG4gICAgICAudHJhbnNpdGlvbigpLmR1cmF0aW9uKDUwKVxuICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgXCJzY2FsZSgxLjI1KVwiKTtcbiAgICB0b29sdGlwXG4gICAgICAuc3R5bGUoXCJsZWZ0XCIsIGV2ZW50LnBhZ2VYICsgMTggKyBcInB4XCIpXG4gICAgICAuc3R5bGUoXCJ0b3BcIiwgZXZlbnQucGFnZVkgKyAxOCArIFwicHhcIilcbiAgICAgIC5zdHlsZShcImRpc3BsYXlcIiwgXCJibG9ja1wiKVxuICAgICAgLnRleHQoZC5uYW1lKVxuICAgIGQzLnNlbGVjdChldmVudC50YXJnZXQpXG4gICAgICAuc3R5bGUoXCJjdXJzb3JcIiwgXCJwb2ludGVyXCIpO1xuICB9XG4gIFxuICBjb25zdCBoaWRlVG9vbHRpcCA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgZDMuc2VsZWN0KHRoaXMpXG4gICAgICAudHJhbnNpdGlvbigpLmR1cmF0aW9uKDUwKVxuICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgXCJzY2FsZSgxKVwiKTtcbiAgICB0b29sdGlwXG4gICAgICAuc3R5bGUoXCJkaXNwbGF5XCIsIFwibm9uZVwiKTtcbiAgICBkMy5zZWxlY3QoZXZlbnQudGFyZ2V0KVxuICAgICAgLnN0eWxlKFwiY3Vyc29yXCIsIFwiZGVmYXVsdFwiKTtcbiAgfVxuICBcbiAgY29uc3QgbGluayA9IHN2Zy5hcHBlbmQoXCJnXCIpXG4gICAgICAuYXR0cihcImZpbGxcIiwgXCJub25lXCIpXG4gICAgICAuYXR0cihcInN0cm9rZS13aWR0aFwiLCAxLjUpXG4gICAgLnNlbGVjdEFsbChcImxpbmVcIilcbiAgICAuZGF0YShsaW5rcylcbiAgICAuam9pbihcImxpbmVcIilcbiAgICAgIC5hdHRyKFwic3Ryb2tlXCIsIGQgPT4gY29sb3JMaW5rcyhkLndpbikpXG4gICAgICAuYXR0cihcInN0cm9rZS13aWR0aFwiLCBkID0+IHN0cm9rZUxpbmtzKGQud2luKSlcblxuICBjb25zdCBub2RlID0gc3ZnLmFwcGVuZChcImdcIilcbiAgICAgIC5hdHRyKFwic3Ryb2tlLWxpbmVjYXBcIiwgXCJyb3VuZFwiKVxuICAgICAgLmF0dHIoXCJzdHJva2UtbGluZWpvaW5cIiwgXCJyb3VuZFwiKVxuICAgIC5zZWxlY3RBbGwoXCJnXCIpXG4gICAgLmRhdGEobm9kZXMpXG4gICAgLmpvaW4oXCJnXCIpXG4gICAgLmNhbGwoZHJhZyhzaW11bGF0aW9uKSk7XG5cbiAgbm9kZS5hcHBlbmQoXCJjaXJjbGVcIilcbiAgICAgIC5hdHRyKFwic3Ryb2tlXCIsIFwid2hpdGVcIilcbiAgICAgIC5hdHRyKFwic3Ryb2tlLXdpZHRoXCIsIDEuNSlcbiAgICAgIC5hdHRyKFwiZmlsbFwiLCBkID0+IGNvbG9yTm9kZXMoZC50eXBlKSlcbiAgICAgIC5hdHRyKFwiclwiLCAxMClcbiAgICAub24oXCJtb3VzZW1vdmVcIiwgc2hvd1Rvb2x0aXApXG4gICAgLm9uKFwibW91c2VsZWF2ZVwiLCBoaWRlVG9vbHRpcCk7XG5cbiAgaW52YWxpZGF0aW9uLnRoZW4oKCkgPT4gc2ltdWxhdGlvbi5zdG9wKCkpO1xuXG4gIHJldHVybiBzdmcubm9kZSgpO1xufVxuXG5odG1sYDxkaXYgY2xhc3M9XCJvanMtY2FwdGlvblwiPkNsaWNrIGFuZCBkcmFnIHRvIGhpZ2hsaWdodCByZWxhdGlvbnNoaXBzLjwvZGl2PmBcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlxuaHRtbGBcbiAgPGRpdiBjbGFzcz1cIm9qcy10aXRsZVwiPklzIHRoYXQgZXZlcnl0aGluZz88L2Rpdj5cbiAgPGRpdiBjbGFzcz1cIm9qcy1zdWJ0aXRsZVwiPkl0ZW1pemVkIGJyZWFrZG93biBvZiB3aW5uaW5nIGNvbnRyYWN0IGJpZDwvZGl2PlxuYFxuXG57XG4gIC8vIFBhcmFtZXRlcnNcbiAgY29uc3QgbWFyZ2luID0geyB0b3A6IDAsIHJpZ2h0OiAyMCwgYm90dG9tOiAzMCwgbGVmdDogODAgfTtcbiAgY29uc3Qgd2lkdGggPSA3OTAgLSBtYXJnaW4ubGVmdCAtIG1hcmdpbi5yaWdodDtcbiAgY29uc3QgaGVpZ2h0ID0gNTAwIC0gbWFyZ2luLnRvcCAtIG1hcmdpbi5ib3R0b207XG5cbiAgY29uc3Qgc3ViZ3JvdXBzID0gaXRlbXNXaWRlLmNvbHVtbnMuc2xpY2UoMSk7XG4gIGNvbnN0IGdyb3VwcyA9IGl0ZW1zV2lkZS5tYXAoZCA9PiBkLmNvbnRyYWN0X25vKTtcbiAgXG4gIGNvbnN0IGNvbG9ycyA9IFtcbiAgICBcIiMwQzYyOTFcIixcbiAgICBcIiM0ODg5YWJcIixcbiAgICBcIiNCMTNENzBcIixcbiAgICBcIiNmNjk3YmJcIixcbiAgICBcIiMzMDczNTFcIixcbiAgICBcIiM3ZmM2YTRcIixcbiAgICBcIiNGQ0IxM0JcIixcbiAgICBcIiNGN0RENzJcIixcbiAgICBcIiNjMGQ3ZGZcIixcbiAgICBcIiNmN2Y3ZjdcIlxuICBdXG4gIGNvbnN0IGNvbG9yID0gZDMuc2NhbGVPcmRpbmFsKClcbiAgICAuZG9tYWluKHN1Ymdyb3VwcylcbiAgICAucmFuZ2UoY29sb3JzKTtcbiAgXG4gIC8vIENhbnZhc1xuICBjb25zdCBzdmcgPSBkMy5jcmVhdGUoXCJzdmdcIilcbiAgICAuYXR0cihcIndpZHRoXCIsIHdpZHRoICsgbWFyZ2luLmxlZnQgKyBtYXJnaW4ucmlnaHQpXG4gICAgLmF0dHIoXCJoZWlnaHRcIiwgaGVpZ2h0ICsgbWFyZ2luLnRvcCArIG1hcmdpbi5ib3R0b20pXG4gICAgLmF0dHIoXCJ2aWV3Qm94XCIsIFswLCAwLCB3aWR0aCArIG1hcmdpbi5sZWZ0ICsgbWFyZ2luLnJpZ2h0LCBoZWlnaHQgKyBtYXJnaW4udG9wICsgbWFyZ2luLmJvdHRvbV0pXG4gICAgLmF0dHIoXCJzdHlsZVwiLCBcIm1heC13aWR0aDogMTAwJTsgaGVpZ2h0OiBhdXRvOyBoZWlnaHQ6IGludHJpbnNpYztcIik7XG4gIFxuICBjb25zdCBwYW5lbCA9IHN2Zy5hcHBlbmQoXCJnXCIpXG4gICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgYHRyYW5zbGF0ZSgke21hcmdpbi5sZWZ0fSwgJHttYXJnaW4udG9wfSlgKTtcbiAgXG4gIC8vIFggYXhpc1xuICBjb25zdCB4ID0gZDMuc2NhbGVMaW5lYXIoKVxuICAgIC5kb21haW4oWzAsIDFdKVxuICAgIC5yYW5nZShbMCwgd2lkdGhdKTtcbiAgcGFuZWwuYXBwZW5kKFwiZ1wiKVxuICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGB0cmFuc2xhdGUoMCwgJHtoZWlnaHR9KWApXG4gICAgLmNhbGwoZDMuYXhpc0JvdHRvbSh4KS50aWNrcyg0LCBcIiVcIikudGlja1BhZGRpbmcoWzhdKSlcbiAgICAuc3R5bGUoXCJmb250LXNpemVcIiwgXCIuNzVyZW1cIik7XG5cbiAgLy8gWSBheGlzXG4gIGNvbnN0IHkgPSBkMy5zY2FsZUJhbmQoKVxuICAgIC5kb21haW4oZ3JvdXBzKVxuICAgIC5yYW5nZShbMCwgaGVpZ2h0XSlcbiAgICAucGFkZGluZyhbLjNdKTtcbiAgcGFuZWwuYXBwZW5kKFwiZ1wiKVxuICAgIC5jYWxsKGQzLmF4aXNMZWZ0KHkpLnRpY2tTaXplKFswXSkudGlja1BhZGRpbmcoWzhdKSlcbiAgICAuc3R5bGUoXCJmb250LXNpemVcIiwgXCIuNzVyZW1cIik7XG5cbiAgY29uc3Qgc3RhY2tlZERhdGEgPSBkMy5zdGFjaygpXG4gICAgLmtleXMoc3ViZ3JvdXBzKVxuICAgIChpdGVtc1dpZGUpO1xuICBcbiAgLy8gVG9vbHRpcFxuICBjb25zdCB0b29sdGlwID0gZDMuc2VsZWN0KFwiYm9keVwiKVxuICAgIC5hcHBlbmQoXCJkaXZcIilcbiAgICAuYXR0cihcImNsYXNzXCIsIFwidG9vbFRpcFwiKVxuICAgIC5zdHlsZShcImRpc3BsYXlcIiwgXCJub25lXCIpXG4gICAgLnN0eWxlKFwicG9zaXRpb25cIiwgXCJhYnNvbHV0ZVwiKVxuICAgIC5zdHlsZShcIndpZHRoXCIsIDEwMClcbiAgICAuc3R5bGUoXCJoZWlnaHRcIiwgMjApXG4gICAgLnN0eWxlKFwiYmFja2dyb3VuZFwiLCBcIiNmN2Y3ZjdcIilcbiAgICAuc3R5bGUoXCJib3JkZXJcIiwgXCIxcHggc29saWQgI2NlY2VjZVwiKVxuICAgIC5zdHlsZShcIm9wYWNpdHlcIiwgLjkpXG4gICAgLnN0eWxlKFwicGFkZGluZ1wiLCBcIi4yZW0gLjQ1ZW1cIilcbiAgICAuc3R5bGUoXCJmb250LXNpemVcIiwgXCIuODVyZW1cIilcbiAgICAuc3R5bGUoXCJsaW5lLWhlaWdodFwiLCAxLjQpO1xuXG4gIGNvbnN0IHNob3dUb29sdGlwID0gZnVuY3Rpb24oZXZlbnQsIGQpIHtcbiAgXG4gICAgY29uc3QgY29udHJhY3QgPSBkLmRhdGEuY29udHJhY3Rfbm87XG4gICAgY29uc3QgaXRlbVNoYXJlID0gZDMuZm9ybWF0KFwiLjElXCIpKGRbMV0gLSBkWzBdKTtcbiAgICBjb25zdCBpdGVtUm93ID0gaXRlbXNEZXNjLmZpbHRlcihEID0+IEQuY29udHJhY3Rfbm8gPT09IGNvbnRyYWN0ICYmIGQzLmZvcm1hdChcIi40XCIpKEQudmFsdWVfbm9ybSkgPT09IGQzLmZvcm1hdChcIi40XCIpKGRbMV0gLSBkWzBdKSlbMF07XG4gICAgY29uc3QgaXRlbU5hbWUgPSBpdGVtUm93Lml0ZW07XG4gICAgY29uc3QgaXRlbVZhbHVlID0gZDMuZm9ybWF0KFwiLC4wZlwiKShpdGVtUm93LnZhbHVlKTtcbiAgICBcbiAgICB0b29sdGlwXG4gICAgICAuc3R5bGUoXCJsZWZ0XCIsIGV2ZW50LnBhZ2VYICsgMTggKyBcInB4XCIpXG4gICAgICAuc3R5bGUoXCJ0b3BcIiwgZXZlbnQucGFnZVkgKyAxOCArIFwicHhcIilcbiAgICAgIC5zdHlsZShcImRpc3BsYXlcIiwgXCJibG9ja1wiKVxuICAgICAgLmh0bWwoYCR7aXRlbU5hbWV9PGJyPuKCsSR7aXRlbVZhbHVlfSAoJHtpdGVtU2hhcmV9KWApO1xuICAgIFxuICAgIHBhbmVsLmFwcGVuZChcInJlY3RcIilcbiAgICAgIC5hdHRyKFwiaWRcIiwgXCJoaWdobGlnaHQtcmVjdFwiKVxuICAgICAgLmF0dHIoXCJ4XCIsIGQzLnNlbGVjdCh0aGlzKS5hdHRyKFwieFwiKSlcbiAgICAgIC5hdHRyKFwieVwiLCBkMy5zZWxlY3QodGhpcykuYXR0cihcInlcIikpXG4gICAgICAuYXR0cihcIndpZHRoXCIsIGQzLnNlbGVjdCh0aGlzKS5hdHRyKFwid2lkdGhcIikpXG4gICAgICAuYXR0cihcImhlaWdodFwiLGQzLnNlbGVjdCh0aGlzKS5hdHRyKFwiaGVpZ2h0XCIpKVxuICAgICAgLnN0eWxlKFwib3BhY2l0eVwiLCAxKVxuICAgICAgLnN0eWxlKFwic3Ryb2tlXCIsIFwiIzJCMzAzQVwiKVxuICAgICAgLnN0eWxlKFwic3Ryb2tlLXdpZHRoXCIsIDMpXG4gICAgICAuc3R5bGUoXCJmaWxsXCIsIFwibm9uZVwiKTtcbiAgICBcbiAgICBkMy5zZWxlY3QoZXZlbnQudGFyZ2V0KS5zdHlsZShcImN1cnNvclwiLCBcInBvaW50ZXJcIik7XG4gICAgXG4gIH1cbiAgXG4gIGNvbnN0IGhpZGVUb29sdGlwID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgICB0b29sdGlwLnN0eWxlKFwiZGlzcGxheVwiLCBcIm5vbmVcIik7XG4gICAgZDMuc2VsZWN0QWxsKFwiI2hpZ2hsaWdodC1yZWN0XCIpLnJlbW92ZSgpO1xuICAgIGQzLnNlbGVjdChldmVudC50YXJnZXQpLnN0eWxlKFwiY3Vyc29yXCIsIFwiZGVmYXVsdFwiKTtcbiAgfVxuICBcbiAgLy8gQnVpbGQgdGhlIGNoYXJ0XG4gIHBhbmVsLmFwcGVuZChcImdcIilcbiAgICAuc2VsZWN0QWxsKFwiZ1wiKVxuICAgIC5kYXRhKHN0YWNrZWREYXRhKVxuICAgIC5qb2luKFwiZ1wiKVxuICAgICAgLmF0dHIoXCJmaWxsXCIsIGQgPT4gY29sb3IoZC5rZXkpKVxuICAgICAgLnNlbGVjdEFsbChcInJlY3RcIilcbiAgICAgIC5kYXRhKGQgPT4gZClcbiAgICAgIC5qb2luKFwicmVjdFwiKVxuICAgICAgICAuYXR0cihcInhcIiwgZCA9PiB4KGRbMF0pKVxuICAgICAgICAuYXR0cihcInlcIiwgZCA9PiB5KGQuZGF0YS5jb250cmFjdF9ubykpXG4gICAgICAgIC5hdHRyKFwid2lkdGhcIiwgZCA9PiB4KGRbMV0pIC0geChkWzBdKSlcbiAgICAgICAgLmF0dHIoXCJoZWlnaHRcIiwgeS5iYW5kd2lkdGgoKSlcbiAgICAgICAgLmF0dHIoXCJvcGFjaXR5XCIsIC44KVxuICAgICAgLm9uKFwibW91c2Vtb3ZlXCIsIHNob3dUb29sdGlwKVxuICAgICAgLm9uKFwibW91c2VsZWF2ZVwiLCBoaWRlVG9vbHRpcCk7XG5cbiAgcmV0dXJuIHN2Zy5ub2RlKClcbn1cblxuaHRtbGA8ZGl2IGNsYXNzPVwib2pzLWNhcHRpb25cIj5Ib3ZlciB0byBzZWUgbW9yZSBkZXRhaWxzLjwvZGl2PmBcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlxuLy8gRGVwZW5kZW5jaWVzXG5kMyA9IHJlcXVpcmUoXCJkM0A3XCIsIFwiZDMtZm9yY2UtbGltaXRcIik7XG5cbi8vIERhdGFcbm5jcjEzMzkgPSBGaWxlQXR0YWNobWVudChcIi4uLy4uL2RhdGFzZXRzL3BoaWxpcHBpbmVzLWpzb24tbWFwcy9tdW5pY2l0aWVzLXByb3ZpbmNlLXBoMTMzOTAwMDAwLnRvcG8uMC4xLmpzb25cIikuanNvbigpO1xubmNyMTM3NCA9IEZpbGVBdHRhY2htZW50KFwiLi4vLi4vZGF0YXNldHMvcGhpbGlwcGluZXMtanNvbi1tYXBzL211bmljaXRpZXMtcHJvdmluY2UtcGgxMzc0MDAwMDAudG9wby4wLjEuanNvblwiKS5qc29uKCk7XG5uY3IxMzc1ID0gRmlsZUF0dGFjaG1lbnQoXCIuLi8uLi9kYXRhc2V0cy9waGlsaXBwaW5lcy1qc29uLW1hcHMvbXVuaWNpdGllcy1wcm92aW5jZS1waDEzNzUwMDAwMC50b3BvLjAuMS5qc29uXCIpLmpzb24oKTtcbm5jcjEzNzYgPSBGaWxlQXR0YWNobWVudChcIi4uLy4uL2RhdGFzZXRzL3BoaWxpcHBpbmVzLWpzb24tbWFwcy9tdW5pY2l0aWVzLXByb3ZpbmNlLXBoMTM3NjAwMDAwLnRvcG8uMC4xLmpzb25cIikuanNvbigpO1xuY2VudHJhbEx1em9uID0gRmlsZUF0dGFjaG1lbnQoXCIuLi8uLi9kYXRhc2V0cy9waGlsaXBwaW5lcy1qc29uLW1hcHMvcHJvdmluY2VzLXJlZ2lvbi1waDAzMDAwMDAwMC50b3BvLjAuMS5qc29uXCIpLmpzb24oKTtcbmNhbGFiYXJ6b24gPSBGaWxlQXR0YWNobWVudChcIi4uLy4uL2RhdGFzZXRzL3BoaWxpcHBpbmVzLWpzb24tbWFwcy9wcm92aW5jZXMtcmVnaW9uLXBoMDQwMDAwMDAwLnRvcG8uMC4xLmpzb25cIikuanNvbigpO1xuXG5uY3JGZWF0dXJlcyA9IHtcbiAgY29uc3QgbmNyMTMzOUZlYXR1cmUgPSB0b3BvanNvbi5mZWF0dXJlKG5jcjEzMzksIG5jcjEzMzlbXCJvYmplY3RzXCJdW1wibXVuaWNpdGllcy1wcm92aW5jZS1waDEzMzkwMDAwMC4wLjFcIl0pLmZlYXR1cmVzXG4gIGNvbnN0IG5jcjEzNzRGZWF0dXJlID0gdG9wb2pzb24uZmVhdHVyZShuY3IxMzc0LCBuY3IxMzc0W1wib2JqZWN0c1wiXVtcIm11bmljaXRpZXMtcHJvdmluY2UtcGgxMzc0MDAwMDAuMC4xXCJdKS5mZWF0dXJlc1xuICBjb25zdCBuY3IxMzc1RmVhdHVyZSA9IHRvcG9qc29uLmZlYXR1cmUobmNyMTM3NSwgbmNyMTM3NVtcIm9iamVjdHNcIl1bXCJtdW5pY2l0aWVzLXByb3ZpbmNlLXBoMTM3NTAwMDAwLjAuMVwiXSkuZmVhdHVyZXNcbiAgY29uc3QgbmNyMTM3NkZlYXR1cmUgPSB0b3BvanNvbi5mZWF0dXJlKG5jcjEzNzYsIG5jcjEzNzZbXCJvYmplY3RzXCJdW1wibXVuaWNpdGllcy1wcm92aW5jZS1waDEzNzYwMDAwMC4wLjFcIl0pLmZlYXR1cmVzXG4gIHJldHVybiBbLi4ubmNyMTMzOUZlYXR1cmUsIC4uLm5jcjEzNzRGZWF0dXJlLCAuLi5uY3IxMzc1RmVhdHVyZSwgLi4ubmNyMTM3NkZlYXR1cmVdO1xufVxuXG5iZ0ZlYXR1cmVzID0ge1xuICBjb25zdCByM0ZlYXR1cmVzID0gdG9wb2pzb24uZmVhdHVyZShjZW50cmFsTHV6b24sIGNlbnRyYWxMdXpvbltcIm9iamVjdHNcIl1bXCJwcm92aW5jZXMtcmVnaW9uLXBoMDMwMDAwMDAwLjAuMVwiXSkuZmVhdHVyZXNcbiAgY29uc3QgcjRBRmVhdHVyZXMgPSB0b3BvanNvbi5mZWF0dXJlKGNhbGFiYXJ6b24sIGNhbGFiYXJ6b25bXCJvYmplY3RzXCJdW1wicHJvdmluY2VzLXJlZ2lvbi1waDA0MDAwMDAwMC4wLjFcIl0pLmZlYXR1cmVzXG4gIHJldHVybiBbLi4ucjNGZWF0dXJlcywgLi4ucjRBRmVhdHVyZXNdO1xufVxuXG5jb250cmFjdHNNYXAgPSBGaWxlQXR0YWNobWVudChcIi4uLy4uL2RhdGFzZXRzL2Jpa2VsYW5lcy9jb250cmFjdHNNYXAuanNvblwiKS5qc29uKCk7XG5jb250cmFjdHNGZWF0dXJlcyA9IHRvcG9qc29uLmZlYXR1cmUoY29udHJhY3RzTWFwLCBjb250cmFjdHNNYXAub2JqZWN0cy5jb250cmFjdHNNYXApLmZlYXR1cmVzO1xuY29udHJhY3ROYW1lcyA9IGQzLm1hcChjb250cmFjdHNGZWF0dXJlcywgZCA9PiBkLnByb3BlcnRpZXMuY29udHJhY3QpLnNvcnQoKTtcbmNvbnRyYWN0c0RGID0gRmlsZUF0dGFjaG1lbnQoXCIuLi8uLi9kYXRhc2V0cy9iaWtlbGFuZXMvY29udHJhY3RzLmNzdlwiKS5jc3YoeyB0eXBlZDogdHJ1ZSB9KTtcbmNvbnRyYWN0RGV0YWlscyA9IGNvbnRyYWN0c0RGLmZpbHRlcihkID0+IGNvbnRyYWN0TmFtZXMuaW5jbHVkZXMoZC5jb250cmFjdF9ubykpO1xuXG5iaWRkZXJzTm9kZXMgPSBGaWxlQXR0YWNobWVudChcIi4uLy4uL2RhdGFzZXRzL2Jpa2VsYW5lcy9iaWRkZXJzTm9kZXMuY3N2XCIpLmNzdih7IHR5cGVkOiB0cnVlIH0pO1xuYmlkZGVyc0xpbmtzID0gRmlsZUF0dGFjaG1lbnQoXCIuLi8uLi9kYXRhc2V0cy9iaWtlbGFuZXMvYmlkZGVyc0xpbmtzLmNzdlwiKS5jc3YoeyB0eXBlZDogdHJ1ZSB9KTtcblxuaXRlbXNXaWRlID0gRmlsZUF0dGFjaG1lbnQoXCIuLi8uLi9kYXRhc2V0cy9iaWtlbGFuZXMvaXRlbXNXaWRlLmNzdlwiKS5jc3YoeyB0eXBlZDogdHJ1ZSB9KTtcbml0ZW1zRGVzYyA9IEZpbGVBdHRhY2htZW50KFwiLi4vLi4vZGF0YXNldHMvYmlrZWxhbmVzL2l0ZW1zRGVzYy5jc3ZcIikuY3N2KHsgdHlwZWQ6IHRydWUgfSk7XG5cbi8vIERyYWcgZnVuY3Rpb25cbi8vIFNvdXJjZTogaHR0cHM6Ly9vYnNlcnZhYmxlaHEuY29tL0BkMy9tb2JpbGUtcGF0ZW50LXN1aXRzXG5cbmRyYWcgPSBzaW11bGF0aW9uID0+IHtcbiAgXG4gIGZ1bmN0aW9uIGRyYWdzdGFydGVkKGV2ZW50LCBkKSB7XG4gICAgaWYgKCFldmVudC5hY3RpdmUpIHNpbXVsYXRpb24uYWxwaGFUYXJnZXQoMC4zKS5yZXN0YXJ0KCk7XG4gICAgZC5meCA9IGQueDtcbiAgICBkLmZ5ID0gZC55O1xuICB9XG4gIFxuICBmdW5jdGlvbiBkcmFnZ2VkKGV2ZW50LCBkKSB7XG4gICAgZC5meCA9IGV2ZW50Lng7XG4gICAgZC5meSA9IGV2ZW50Lnk7XG4gIH1cbiAgXG4gIGZ1bmN0aW9uIGRyYWdlbmRlZChldmVudCwgZCkge1xuICAgIGlmICghZXZlbnQuYWN0aXZlKSBzaW11bGF0aW9uLmFscGhhVGFyZ2V0KDApO1xuICAgIGQuZnggPSBudWxsO1xuICAgIGQuZnkgPSBudWxsO1xuICB9XG4gIFxuICByZXR1cm4gZDMuZHJhZygpXG4gICAgLm9uKFwic3RhcnRcIiwgZHJhZ3N0YXJ0ZWQpXG4gICAgLm9uKFwiZHJhZ1wiLCBkcmFnZ2VkKVxuICAgIC5vbihcImVuZFwiLCBkcmFnZW5kZWQpO1xufVxuIn1dfQ==
</script>
<script type="module">
if (window.location.protocol === "file:") { alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."); }
window._ojs.paths.runtimeToDoc = "../../posts/2023-04-06-bikes";
window._ojs.paths.runtimeToRoot = "../..";
window._ojs.paths.docToRoot = "../..";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/twopoints\.blog");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">

<div class="cookie-consent-footer"><a href="#" id="open_preferences_center">Cookie Preferences</a></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>